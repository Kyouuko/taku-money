var Um=Object.defineProperty,Nm=Object.defineProperties,jm=Object.getOwnPropertyDescriptors,Om=Object.getOwnPropertySymbols,Gm=Object.prototype.hasOwnProperty,Zm=Object.prototype.propertyIsEnumerable,Fm=(Hn,Fi,me)=>Fi in Hn?Um(Hn,Fi,{enumerable:!0,configurable:!0,writable:!0,value:me}):Hn[Fi]=me,Im=(Hn,Fi)=>{for(var me in Fi||(Fi={}))Gm.call(Fi,me)&&Fm(Hn,me,Fi[me]);if(Om)for(var me of Om(Fi))Zm.call(Fi,me)&&Fm(Hn,me,Fi[me]);return Hn},Pm=(Hn,Fi)=>Nm(Hn,jm(Fi));(self.webpackChunkTAKUv2=self.webpackChunkTAKUv2||[]).push([[34],{7887:function(Hn){Hn.exports=function(){"use strict";var Fi,me,Ue;function Si(u,B){if(Fi)if(me){var $i="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Fi+")(sharedChunk); ("+me+")(sharedChunk); self.onerror = null;",mi={};Fi(mi),Ue=B(mi),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Ue.workerUrl=window.URL.createObjectURL(new Blob([$i],{type:"text/javascript"})))}else me=B;else Fi=B}return Si(0,function(u){var B="2.7.0",$i=mi;function mi(e,t,n,a){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=a,this.p2x=n,this.p2y=a}mi.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},mi.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},mi.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},mi.prototype.solveCurveX=function(e,t){var n,a,h,d,g;for(void 0===t&&(t=1e-6),h=e,g=0;g<8;g++){if(d=this.sampleCurveX(h)-e,Math.abs(d)<t)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=d/v}if((h=e)<(n=0))return n;if(h>(a=1))return a;for(;n<a;){if(d=this.sampleCurveX(h),Math.abs(d-e)<t)return h;e>d?n=h:a=h,h=.5*(a-n)+n}return h},mi.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var jt=Te;function Te(e,t){this.x=e,this.y=t}Te.prototype={clone:function(){return new Te(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),a=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=a,this},_rotateAround:function(e,t){var n=Math.cos(e),a=Math.sin(e),h=t.y+a*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Te.convert=function(e){return e instanceof Te?e:Array.isArray(e)?new Te(e[0],e[1]):e};var Pt="undefined"!=typeof self?self:{},Le=1e-6,ze="undefined"!=typeof Float32Array?Float32Array:Array;function ie(){var e=new ze(9);return ze!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Oe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ui(e,t,n){var a=t[0],h=t[1],d=t[2],g=t[3],v=t[4],w=t[5],C=t[6],k=t[7],I=t[8],P=t[9],U=t[10],G=t[11],H=t[12],Y=t[13],nt=t[14],ct=t[15],yt=n[0],vt=n[1],bt=n[2],Mt=n[3];return e[0]=yt*a+vt*v+bt*I+Mt*H,e[1]=yt*h+vt*w+bt*P+Mt*Y,e[2]=yt*d+vt*C+bt*U+Mt*nt,e[3]=yt*g+vt*k+bt*G+Mt*ct,e[4]=(yt=n[4])*a+(vt=n[5])*v+(bt=n[6])*I+(Mt=n[7])*H,e[5]=yt*h+vt*w+bt*P+Mt*Y,e[6]=yt*d+vt*C+bt*U+Mt*nt,e[7]=yt*g+vt*k+bt*G+Mt*ct,e[8]=(yt=n[8])*a+(vt=n[9])*v+(bt=n[10])*I+(Mt=n[11])*H,e[9]=yt*h+vt*w+bt*P+Mt*Y,e[10]=yt*d+vt*C+bt*U+Mt*nt,e[11]=yt*g+vt*k+bt*G+Mt*ct,e[12]=(yt=n[12])*a+(vt=n[13])*v+(bt=n[14])*I+(Mt=n[15])*H,e[13]=yt*h+vt*w+bt*P+Mt*Y,e[14]=yt*d+vt*C+bt*U+Mt*nt,e[15]=yt*g+vt*k+bt*G+Mt*ct,e}function de(e,t,n){var a,h,d,g,v,w,C,k,I,P,U,G,H=n[0],Y=n[1],nt=n[2];return t===e?(e[12]=t[0]*H+t[4]*Y+t[8]*nt+t[12],e[13]=t[1]*H+t[5]*Y+t[9]*nt+t[13],e[14]=t[2]*H+t[6]*Y+t[10]*nt+t[14],e[15]=t[3]*H+t[7]*Y+t[11]*nt+t[15]):(h=t[1],d=t[2],g=t[3],v=t[4],w=t[5],C=t[6],k=t[7],I=t[8],P=t[9],U=t[10],G=t[11],e[0]=a=t[0],e[1]=h,e[2]=d,e[3]=g,e[4]=v,e[5]=w,e[6]=C,e[7]=k,e[8]=I,e[9]=P,e[10]=U,e[11]=G,e[12]=a*H+v*Y+I*nt+t[12],e[13]=h*H+w*Y+P*nt+t[13],e[14]=d*H+C*Y+U*nt+t[14],e[15]=g*H+k*Y+G*nt+t[15]),e}function ei(e,t,n){var a=n[0],h=n[1],d=n[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*h,e[5]=t[5]*h,e[6]=t[6]*h,e[7]=t[7]*h,e[8]=t[8]*d,e[9]=t[9]*d,e[10]=t[10]*d,e[11]=t[11]*d,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function zi(e,t,n){var a=Math.sin(n),h=Math.cos(n),d=t[4],g=t[5],v=t[6],w=t[7],C=t[8],k=t[9],I=t[10],P=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=d*h+C*a,e[5]=g*h+k*a,e[6]=v*h+I*a,e[7]=w*h+P*a,e[8]=C*h-d*a,e[9]=k*h-g*a,e[10]=I*h-v*a,e[11]=P*h-w*a,e}function Ke(e,t,n){var a=Math.sin(n),h=Math.cos(n),d=t[0],g=t[1],v=t[2],w=t[3],C=t[8],k=t[9],I=t[10],P=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=d*h-C*a,e[1]=g*h-k*a,e[2]=v*h-I*a,e[3]=w*h-P*a,e[8]=d*a+C*h,e[9]=g*a+k*h,e[10]=v*a+I*h,e[11]=w*a+P*h,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ke=ui;function De(){var e=new ze(3);return ze!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function vi(e){var t=new ze(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function re(e){return Math.hypot(e[0],e[1],e[2])}function we(e,t,n){var a=new ze(3);return a[0]=e,a[1]=t,a[2]=n,a}function di(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Ti(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function an(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function nr(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function nn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function fn(e,t,n,a){return e[0]=t[0]+n[0]*a,e[1]=t[1]+n[1]*a,e[2]=t[2]+n[2]*a,e}function qn(e,t){var n=t[0],a=t[1],h=t[2],d=n*n+a*a+h*h;return d>0&&(d=1/Math.sqrt(d)),e[0]=t[0]*d,e[1]=t[1]*d,e[2]=t[2]*d,e}function Ki(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Mn(e,t,n){var a=t[0],h=t[1],d=t[2],g=n[0],v=n[1],w=n[2];return e[0]=h*w-d*v,e[1]=d*g-a*w,e[2]=a*v-h*g,e}function Ne(e,t,n){var a=t[0],h=t[1],d=t[2],g=n[3]*a+n[7]*h+n[11]*d+n[15];return e[0]=(n[0]*a+n[4]*h+n[8]*d+n[12])/(g=g||1),e[1]=(n[1]*a+n[5]*h+n[9]*d+n[13])/g,e[2]=(n[2]*a+n[6]*h+n[10]*d+n[14])/g,e}function hn(e,t,n){var a=n[0],h=n[1],d=n[2],g=t[0],v=t[1],w=t[2],C=h*w-d*v,k=d*g-a*w,I=a*v-h*g,P=h*I-d*k,U=d*C-a*I,G=a*k-h*C,H=2*n[3];return k*=H,I*=H,U*=2,G*=2,e[0]=g+(C*=H)+(P*=2),e[1]=v+k+U,e[2]=w+I+G,e}var on,e,Rr=Ti,Ai=an,_i=re;function Wn(e,t,n){var a=t[0],h=t[1],d=t[2],g=t[3];return e[0]=n[0]*a+n[4]*h+n[8]*d+n[12]*g,e[1]=n[1]*a+n[5]*h+n[9]*d+n[13]*g,e[2]=n[2]*a+n[6]*h+n[10]*d+n[14]*g,e[3]=n[3]*a+n[7]*h+n[11]*d+n[15]*g,e}function rr(){var e=new ze(4);return ze!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ra(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ci(e,t,n){n*=.5;var a=t[0],h=t[1],d=t[2],g=t[3],v=Math.sin(n),w=Math.cos(n);return e[0]=a*w+g*v,e[1]=h*w+d*v,e[2]=d*w-h*v,e[3]=g*w-a*v,e}function gn(e,t){return e[0]===t[0]&&e[1]===t[1]}De(),on=new ze(4),ze!=Float32Array&&(on[0]=0,on[1]=0,on[2]=0,on[3]=0),De(),we(1,0,0),we(0,1,0),rr(),rr(),ie(),e=new ze(2),ze!=Float32Array&&(e[0]=0,e[1]=0);const vr=Math.PI/180,Vi=180/Math.PI;function Ve(e){return e*vr}function ln(e){return e*Vi}const Bn=[[0,0],[1,0],[1,1],[0,1]];function Pn(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Ei(e,t,n,a){const h=new $i(e,t,n,a);return function(d){return h.solve(d)}}const Tn=Ei(.25,.1,.25,1);function pi(e,t,n){return Math.min(n,Math.max(t,e))}function Yi(e,t,n){return(n=pi((n-e)/(t-e),0,1))*n*(3-2*n)}function zn(e,t,n){const a=n-t,h=((e-t)%a+a)%a+t;return h===t?n:h}function Yn(e,t,n){if(!e.length)return n(null,[]);let a=e.length;const h=new Array(e.length);let d=null;e.forEach((g,v)=>{t(g,(w,C)=>{w&&(d=w),h[v]=C,0==--a&&n(d,h)})})}function he(e){const t=[];for(const n in e)t.push(e[n]);return t}function Ie(e,...t){for(const n of t)for(const a in n)e[a]=n[a];return e}let Wt=1;function le(){return Wt++}function ii(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Me(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Xn(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Ji(e,t){e.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function Pi(e,t){return-1!==e.indexOf(t,e.length-t.length)}function Cn(e,t,n){const a={};for(const h in e)a[h]=t.call(n||this,e[h],h,e);return a}function Ui(e,t,n){const a={};for(const h in e)t.call(n||this,e[h],h,e)&&(a[h]=e[h]);return a}function Ni(e){return Array.isArray(e)?e.map(Ni):"object"==typeof e&&e?Cn(e,Ni):e}const ji={};function bi(e){ji[e]||("undefined"!=typeof console&&console.warn(e),ji[e]=!0)}function mn(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Kn(e){let t=0;for(let n,a,h=0,d=e.length,g=d-1;h<d;g=h++)n=e[h],a=e[g],t+=(a.x-n.x)*(n.y+a.y);return t}function Rn(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function rs(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,h,d)=>{const g=h||d;return t[a]=!g||g.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let br,sr,yn,Vn=null;function Sn(e){if(null==Vn){const t=e.navigator?e.navigator.userAgent:null;Vn=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Vn}function ar(e){try{const t=Pt[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(t){return!1}}const xn={now:()=>void 0!==yn?yn:Pt.performance.now(),setNow(e){yn=e},restoreNow(){yn=void 0},frame(e){const t=Pt.requestAnimationFrame(e);return{cancel:()=>Pt.cancelAnimationFrame(t)}},getImageData(e,t=0){const n=Pt.document.createElement("canvas"),a=n.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return n.width=e.width,n.height=e.height,a.drawImage(e,0,0,e.width,e.height),a.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:e=>(br||(br=Pt.document.createElement("a")),br.href=e,br.href),get devicePixelRatio(){return Pt.devicePixelRatio},get prefersReducedMotion(){return!!Pt.matchMedia&&(null==sr&&(sr=Pt.matchMedia("(prefers-reduced-motion: reduce)")),sr.matches)}};let tt;const F={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==tt){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{tt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){tt=e}}return tt},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Z={supported:!1,testSupport:function(e){!ft&&rt&&(Tt?Ct(e):Q=e)}};let Q,rt,ft=!1,Tt=!1;function Ct(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,rt),e.isContextLost())return;Z.supported=!0}catch(n){}e.deleteTexture(t),ft=!0}Pt.document&&(rt=Pt.document.createElement("img"),rt.onload=function(){Q&&Ct(Q),Q=null,Tt=!0},rt.onerror=function(){ft=!0,Q=null},rt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const gt="01",St="NO_ACCESS_TOKEN";function Bt(e){return 0===e.indexOf("mapbox:")}function Nt(e){return F.API_URL_REGEX.test(e)}const Xt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function be(e){const t=e.match(Xt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ce(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function Se(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(Pt.atob(t[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(n){return null}}class Fe{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=Se(F.ACCESS_TOKEN);let a="";return a=n&&n.u?Pt.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(h,d)=>String.fromCharCode(Number("0x"+d)))):F.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const t=ar("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{const h=Pt.localStorage.getItem(n);h&&(this.eventData=JSON.parse(h));const d=Pt.localStorage.getItem(a);d&&(this.anonId=d)}catch(h){bi("Unable to read from LocalStorage")}}saveEventData(){const t=ar("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{Pt.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&Pt.localStorage.setItem(n,JSON.stringify(this.eventData))}catch(h){bi("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,a,h){if(!F.EVENTS_URL)return;const d=be(F.EVENTS_URL);d.params.push(`access_token=${h||F.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:gt,userId:this.anonId},v=n?Ie(g,n):g,w={url:Ce(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=Lr(w,C=>{this.pendingRequest=null,a(C),this.saveEventData(),this.processRequests(h)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Je=new class extends Fe{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){F.EVENTS_URL&&F.ACCESS_TOKEN&&Array.isArray(e)&&e.some(n=>Bt(n)||Nt(n))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Se(F.ACCESS_TOKEN),n=t?t.u:F.ACCESS_TOKEN;let a=n!==this.eventData.tokenU;Xn(this.anonId)||(this.anonId=ii(),a=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),g=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;a=a||v>=1||v<-1||d.getDate()!==g.getDate()}else a=!0;if(!a)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},d=>{d||(this.eventData.lastSuccess=h,this.eventData.tokenU=n)},e)}},wi=Je.postTurnstileEvent.bind(Je),Ri=new class extends Fe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,a){this.skuToken=t,this.errorCb=a,F.EVENTS_URL&&(n||F.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(St)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Xn(this.anonId)||(this.anonId=ii()),this.postEvent(n,{skuToken:this.skuToken},a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},e))}},yi=Ri.postMapLoadEvent.bind(Ri),Li=new class extends Fe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,a){if(!F.API_URL||!F.SESSION_PATH)return;const h=be(F.API_URL+F.SESSION_PATH);h.params.push(`sku=${t||""}`),h.params.push(`access_token=${a||F.ACCESS_TOKEN||""}`);const d={url:Ce(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ko(d,g=>{this.pendingRequest=null,n(g),this.saveEventData(),this.processRequests(a)})}getSessionAPI(e,t,n,a){this.skuToken=t,this.errorCb=a,F.SESSION_PATH&&F.API_URL&&(n||F.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(St)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},e)}},Jn=Li.getSessionAPI.bind(Li),ht=new Set,kt="mapbox-tiles";let E,V,it=500,xt=50;function ye(){Pt.caches&&!E&&(E=Pt.caches.open(kt))}function ni(e){const t=e.indexOf("?");return t<0?e:e.slice(0,t)}let Hi=1/0;const Un={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Un);class Qn extends Error{constructor(t,n,a){401===n&&Nt(a)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const tr=Rn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Pt.location.protocol?Pt.parent:Pt).location.href,un=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(tr())&&!/^\w+:/.test(n))){if(Pt.fetch&&Pt.Request&&Pt.AbortController&&Pt.Request.prototype.hasOwnProperty("signal"))return function(a,h){const d=new Pt.AbortController,g=new Pt.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:tr(),signal:d.signal});let v=!1,w=!1;const C=(k=g.url).indexOf("sku=")>0&&Nt(k);var k;"json"===a.type&&g.headers.set("Accept","application/json");const I=(U,G,H)=>{if(w)return;if(U&&"SecurityError"!==U.message&&bi(U),G&&H)return P(G);const Y=Date.now();Pt.fetch(g).then(nt=>{if(nt.ok){const ct=C?nt.clone():null;return P(nt,ct,Y)}return h(new Qn(nt.statusText,nt.status,a.url))}).catch(nt=>{20!==nt.code&&h(new Error(nt.message))})},P=(U,G,H)=>{("arrayBuffer"===a.type?U.arrayBuffer():"json"===a.type?U.json():U.text()).then(Y=>{w||(G&&H&&function(nt,ct,yt){if(ye(),!E)return;const vt={status:ct.status,statusText:ct.statusText,headers:new Pt.Headers};ct.headers.forEach((Mt,Vt)=>vt.headers.set(Vt,Mt));const bt=rs(ct.headers.get("Cache-Control")||"");bt["no-store"]||(bt["max-age"]&&vt.headers.set("Expires",new Date(yt+1e3*bt["max-age"]).toUTCString()),new Date(vt.headers.get("Expires")).getTime()-yt<42e4||function(Mt,Vt){if(void 0===V)try{new Response(new ReadableStream),V=!0}catch(Ot){V=!1}V?Vt(Mt.body):Mt.blob().then(Vt)}(ct,Mt=>{const Vt=new Pt.Response(Mt,vt);ye(),E&&E.then(Ot=>Ot.put(ni(nt.url),Vt)).catch(Ot=>bi(Ot.message))}))}(g,G,H),v=!0,h(null,Y,U.headers.get("Cache-Control"),U.headers.get("Expires")))}).catch(Y=>{w||h(new Error(Y.message))})};return C?function(U,G){if(ye(),!E)return G(null);const H=ni(U.url);E.then(Y=>{Y.match(H).then(nt=>{const ct=function(yt){if(!yt)return!1;const vt=new Date(yt.headers.get("Expires")||0),bt=rs(yt.headers.get("Cache-Control")||"");return vt>Date.now()&&!bt["no-cache"]}(nt);Y.delete(H),ct&&Y.put(H,nt.clone()),G(null,nt,ct)}).catch(G)}).catch(G)}(g,I):I(null,null),{cancel:()=>{w=!0,v||d.abort()}}}(e,t);if(Rn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(a,h){const d=new Pt.XMLHttpRequest;d.open(a.method||"GET",a.url,!0),"arrayBuffer"===a.type&&(d.responseType="arraybuffer");for(const g in a.headers)d.setRequestHeader(g,a.headers[g]);return"json"===a.type&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials="include"===a.credentials,d.onerror=()=>{h(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||0===d.status)&&null!==d.response){let g=d.response;if("json"===a.type)try{g=JSON.parse(d.response)}catch(v){return h(v)}h(null,g,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else h(new Qn(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(e,t)},ri=function(e,t){return un(Ie(e,{type:"arrayBuffer"}),t)},Lr=function(e,t){return un(Ie(e,{method:"POST"}),t)},ko=function(e,t){return un(Ie(e,{method:"GET"}),t)};function wc(e){const t=Pt.document.createElement("a");return t.href=e,t.protocol===Pt.document.location.protocol&&t.host===Pt.document.location.host}const or="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Is,ss;Is=[],ss=0;const as=function(e,t){if(Z.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),ss>=F.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Is.push(d),d}ss++;let n=!1;const a=()=>{if(!n)for(n=!0,ss--;Is.length&&ss<F.MAX_PARALLEL_IMAGE_REQUESTS;){const d=Is.shift(),{requestParameters:g,callback:v,cancelled:w}=d;w||(d.cancel=as(g,v).cancel)}},h=ri(e,(d,g,v,w)=>{a(),d?t(d):g&&(Pt.createImageBitmap?function(C,k){const I=new Pt.Blob([new Uint8Array(C)],{type:"image/png"});Pt.createImageBitmap(I).then(P=>{k(null,P)}).catch(P=>{k(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(C,k)=>t(C,k,v,w)):function(C,k){const I=new Pt.Image,P=Pt.URL;I.onload=()=>{k(null,I),P.revokeObjectURL(I.src),I.onload=null,Pt.requestAnimationFrame(()=>{I.src=or})},I.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const U=new Pt.Blob([new Uint8Array(C)],{type:"image/png"});I.src=C.byteLength?P.createObjectURL(U):or}(g,(C,k)=>t(C,k,v,w)))});return{cancel:()=>{h.cancel(),a()}}};function Ia(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Ps(e,t,n){if(n&&n[e]){const a=n[e].indexOf(t);-1!==a&&n[e].splice(a,1)}}class os{constructor(t,n={}){Ie(this,n),this.type=t}}class Do extends os{constructor(t,n={}){super("error",Ie({error:t},n))}}class Nn{on(t,n){return this._listeners=this._listeners||{},Ia(t,n,this._listeners),this}off(t,n){return Ps(t,n,this._listeners),Ps(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Ia(t,n,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,n){"string"==typeof t&&(t=new os(t,n||{}));const a=t.type;if(this.listens(a)){t.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of h)v.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of d)Ps(a,v,this._oneTimeListeners),v.call(this,t);const g=this._eventedParent;g&&(Ie(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Do&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var Rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class ue{constructor(t,n,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),null!=n&&n.__line__&&(this.line=n.__line__)}}function Pa(e){const t=e.value;return t?[new ue(e.key,t,"constants have been deprecated as of v8")]:[]}function ls(e,...t){for(const n of t)for(const a in n)e[a]=n[a];return e}function Qi(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Zr(e){if(Array.isArray(e))return e.map(Zr);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Zr(e[n]);return t}return Qi(e)}class Or extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class sa{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[a,h]of n)this.bindings[a]=h}concat(t){return new sa(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const $r={kind:"null"},oe={kind:"number"},je={kind:"string"},Re={kind:"boolean"},jn={kind:"color"},aa={kind:"object"},qe={kind:"value"},zs={kind:"collator"},An={kind:"formatted"},za={kind:"resolvedImage"};function lr(e,t){return{kind:"array",itemType:e,N:t}}function Gi(e){if("array"===e.kind){const t=Gi(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Nh=[$r,oe,je,Re,jn,An,aa,lr(qe),za];function Ln(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Ln(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const n of Nh)if(!Ln(n,t))return null}return`Expected ${Gi(e)} but found ${Gi(t)} instead.`}function Ra(e,t){return t.some(n=>n.kind===e.kind)}function cs(e,t){return t.some(n=>"null"===n?null===e:"array"===n?Array.isArray(e):"object"===n?e&&!Array.isArray(e)&&"object"==typeof e:n===typeof e)}function wr(e){var t={exports:{}};return e(t,t.exports),t.exports}var Rs=wr(function(e,t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(v){return(v=Math.round(v))<0?0:v>255?255:v}function h(v){return a("%"===v[v.length-1]?parseFloat(v)/100*255:parseInt(v))}function d(v){return(w="%"===v[v.length-1]?parseFloat(v)/100:parseFloat(v))<0?0:w>1?1:w;var w}function g(v,w,C){return C<0?C+=1:C>1&&(C-=1),6*C<1?v+(w-v)*C*6:2*C<1?w:3*C<2?v+(w-v)*(2/3-C)*6:v}try{t.parseCSSColor=function(v){var w,C=v.replace(/ /g,"").toLowerCase();if(C in n)return n[C].slice();if("#"===C[0])return 4===C.length?(w=parseInt(C.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:7===C.length&&(w=parseInt(C.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var k=C.indexOf("("),I=C.indexOf(")");if(-1!==k&&I+1===C.length){var P=C.substr(0,k),U=C.substr(k+1,I-(k+1)).split(","),G=1;switch(P){case"rgba":if(4!==U.length)return null;G=d(U.pop());case"rgb":return 3!==U.length?null:[h(U[0]),h(U[1]),h(U[2]),G];case"hsla":if(4!==U.length)return null;G=d(U.pop());case"hsl":if(3!==U.length)return null;var H=(parseFloat(U[0])%360+360)%360/360,Y=d(U[1]),nt=d(U[2]),ct=nt<=.5?nt*(Y+1):nt+Y-nt*Y,yt=2*nt-ct;return[a(255*g(yt,ct,H+1/3)),a(255*g(yt,ct,H)),a(255*g(yt,ct,H-1/3)),G];default:return null}}return null}}catch(v){}});class fi{constructor(t,n,a,h=1){this.r=t,this.g=n,this.b=a,this.a=h}static parse(t){if(!t)return;if(t instanceof fi)return t;if("string"!=typeof t)return;const n=Rs.parseCSSColor(t);return n?new fi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,a,h]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(a)},${h})`}toArray(){const{r:t,g:n,b:a,a:h}=this;return 0===h?[0,0,0,0]:[255*t/h,255*n/h,255*a/h,h]}}fi.black=new fi(0,0,0,1),fi.white=new fi(1,1,1,1),fi.transparent=new fi(0,0,0,0),fi.red=new fi(1,0,0,1),fi.blue=new fi(0,0,1,1);class oa{constructor(t,n,a){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Io{constructor(t,n,a,h,d){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=a,this.fontStack=h,this.textColor=d}}class Ye{constructor(t){this.sections=t}static fromString(t){return new Ye([new Io(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof Ye?t:Ye.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.name]);continue}t.push(n.text);const a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(a)}return t}}class cr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new cr({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Mc(e,t,n,a){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[e,t,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof a?[e,t,n,a]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function La(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof fi||e instanceof oa||e instanceof Ye||e instanceof cr)return!0;if(Array.isArray(e)){for(const t of e)if(!La(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!La(e[t]))return!1;return!0}return!1}function rn(e){if(null===e)return $r;if("string"==typeof e)return je;if("boolean"==typeof e)return Re;if("number"==typeof e)return oe;if(e instanceof fi)return jn;if(e instanceof oa)return zs;if(e instanceof Ye)return An;if(e instanceof cr)return za;if(Array.isArray(e)){const t=e.length;let n;for(const a of e){const h=rn(a);if(n){if(n===h)continue;n=qe;break}n=h}return lr(n||qe,t)}return aa}function Oa(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof fi||e instanceof Ye||e instanceof cr?e.toString():JSON.stringify(e)}class Fr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(2!==t.length)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!La(t[1]))return n.error("invalid value");const a=t[1];let h=rn(a);const d=n.expectedType;return"array"!==h.kind||0!==h.N||!d||"array"!==d.kind||"number"==typeof d.N&&0!==d.N||(h=d),new Fr(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof fi?["rgba"].concat(this.value.toArray()):this.value instanceof Ye?this.value.serialize():this.value}}class dn{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Po={string:je,number:oe,boolean:Re,object:aa};class hr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a,h=1;const d=t[0];if("array"===d){let v,w;if(t.length>2){const C=t[1];if("string"!=typeof C||!(C in Po)||"object"===C)return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=Po[C],h++}else v=qe;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}a=lr(v,w)}else a=Po[d];const g=[];for(;h<t.length;h++){const v=n.parse(t[h],h,qe);if(!v)return null;g.push(v)}return new hr(a,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(t);if(!Ln(this.type,rn(a)))return a;if(n===this.args.length-1)throw new dn(`Expected value to be of type ${Gi(this.type)}, but found ${Gi(rn(a))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if("array"===t.kind){const a=t.itemType;if("string"===a.kind||"number"===a.kind||"boolean"===a.kind){n.push(a.kind);const h=t.N;("number"==typeof h||this.args.length>1)&&n.push(h)}}return n.concat(this.args.map(a=>a.serialize()))}}class Mr{constructor(t){this.type=An,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&"object"==typeof a)return n.error("First argument must be an image or text section.");const h=[];let d=!1;for(let g=1;g<=t.length-1;++g){const v=t[g];if(d&&"object"==typeof v&&!Array.isArray(v)){d=!1;let w=null;if(v["font-scale"]&&(w=n.parse(v["font-scale"],1,oe),!w))return null;let C=null;if(v["text-font"]&&(C=n.parse(v["text-font"],1,lr(je)),!C))return null;let k=null;if(v["text-color"]&&(k=n.parse(v["text-color"],1,jn),!k))return null;const I=h[h.length-1];I.scale=w,I.font=C,I.textColor=k}else{const w=n.parse(t[g],1,qe);if(!w)return null;const C=w.type.kind;if("string"!==C&&"value"!==C&&"null"!==C&&"resolvedImage"!==C)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new Mr(h)}evaluate(t){return new Ye(this.sections.map(n=>{const a=n.content.evaluate(t);return rn(a)===za?new Io("",a,null,null,null):new Io(Oa(a),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),t.push(a)}return t}}class hs{constructor(t){this.type=za,this.input=t}static parse(t,n){if(2!==t.length)return n.error("Expected two arguments.");const a=n.parse(t[1],1,je);return a?new hs(a):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),a=cr.fromString(n);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(n)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const jh={"to-boolean":Re,"to-color":jn,"to-number":oe,"to-string":je};class Br{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[0];if(("to-boolean"===a||"to-string"===a)&&2!==t.length)return n.error("Expected one argument.");const h=jh[a],d=[];for(let g=1;g<t.length;g++){const v=n.parse(t[g],g,qe);if(!v)return null;d.push(v)}return new Br(h,d)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let n,a;for(const h of this.args){if(n=h.evaluate(t),a=null,n instanceof fi)return n;if("string"==typeof n){const d=t.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Mc(n[0],n[1],n[2],n[3]),!a))return new fi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new dn(a||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const a of this.args){if(n=a.evaluate(t),null===n)return 0;const h=Number(n);if(!isNaN(h))return h}throw new dn(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Ye.fromString(Oa(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?cr.fromString(Oa(this.args[0].evaluate(t))):Oa(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Mr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new hs(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(n=>{t.push(n.serialize())}),t}}const Ls=["Unknown","Point","LineString","Polygon"];class Pl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ls[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-t[0])+this.featureDistanceData.bearing[1]*(h*n-t[1])}return 0}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=fi.parse(t)),n}}class er{constructor(t,n,a,h){this.name=t,this.type=n,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const a=t[0],h=er.definitions[a];if(!h)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=g.filter(([C])=>!Array.isArray(C)||C.length===t.length-1);let w=null;for(const[C,k]of v){w=new Vr(n.registry,n.path,null,n.scope);const I=[];let P=!1;for(let U=1;U<t.length;U++){const G=t[U],H=Array.isArray(C)?C[U-1]:C.type,Y=w.parse(G,1+I.length,H);if(!Y){P=!0;break}I.push(Y)}if(!P)if(Array.isArray(C)&&C.length!==I.length)w.error(`Expected ${C.length} arguments, but found ${I.length} instead.`);else{for(let U=0;U<I.length;U++){const G=Array.isArray(C)?C[U]:C.type,H=I[U];w.concat(U+1).checkSubtype(G,H.type)}if(0===w.errors.length)return new er(a,d,k,I)}}if(1===v.length)n.errors.push(...w.errors);else{const C=(v.length?v:g).map(([I])=>{return P=I,Array.isArray(P)?`(${P.map(Gi).join(", ")})`:`(${Gi(P.type)}...)`;var P}).join(" | "),k=[];for(let I=1;I<t.length;I++){const P=n.parse(t[I],1+k.length);if(!P)return null;k.push(Gi(P.type))}n.error(`Expected arguments of type ${C}, but found (${k.join(", ")}) instead.`)}return null}static register(t,n){er.definitions=n;for(const a in n)t[a]=er}}class Fa{constructor(t,n,a){this.type=zs,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(2!==t.length)return n.error("Expected one argument.");const a=t[1];if("object"!=typeof a||Array.isArray(a))return n.error("Collator options argument must be an object.");const h=n.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,Re);if(!h)return null;const d=n.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,Re);if(!d)return null;let g=null;return a.locale&&(g=n.parse(a.locale,1,je),!g)?null:new Fa(h,d,g)}evaluate(t){return new oa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const us=8192;function zo(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ds(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Tc(e,t){const n=(180+e[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(n*h*us),Math.round(a*h*us)]}function Cc(e,t,n){const a=e[0]-t[0],h=e[1]-t[1],d=e[0]-n[0],g=e[1]-n[1];return a*g-d*h==0&&a*d<=0&&h*g<=0}function Ro(e,t){let n=!1;for(let g=0,v=t.length;g<v;g++){const w=t[g];for(let C=0,k=w.length;C<k-1;C++){if(Cc(e,w[C],w[C+1]))return!1;(h=w[C])[1]>(a=e)[1]!=(d=w[C+1])[1]>a[1]&&a[0]<(d[0]-h[0])*(a[1]-h[1])/(d[1]-h[1])+h[0]&&(n=!n)}}var a,h,d;return n}function Lo(e,t){for(let n=0;n<t.length;n++)if(Ro(e,t[n]))return!0;return!1}function la(e,t,n,a){const h=a[0]-n[0],d=a[1]-n[1],g=(e[0]-n[0])*d-h*(e[1]-n[1]),v=(t[0]-n[0])*d-h*(t[1]-n[1]);return g>0&&v<0||g<0&&v>0}function Oo(e,t,n){for(const C of n)for(let k=0;k<C.length-1;++k)if((v=[(g=C[k+1])[0]-(d=C[k])[0],g[1]-d[1]])[0]*(w=[(h=t)[0]-(a=e)[0],h[1]-a[1]])[1]-v[1]*w[0]!=0&&la(a,h,d,g)&&la(d,g,a,h))return!0;var a,h,d,g,v,w;return!1}function Sc(e,t){for(let n=0;n<e.length;++n)if(!Ro(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(Oo(e[n],e[n+1],t))return!1;return!0}function Gh(e,t){for(let n=0;n<t.length;n++)if(Sc(e,t[n]))return!0;return!1}function Hr(e,t,n){const a=[];for(let h=0;h<e.length;h++){const d=[];for(let g=0;g<e[h].length;g++){const v=Tc(e[h][g],n);zo(t,v),d.push(v)}a.push(d)}return a}function Ac(e,t,n){const a=[];for(let h=0;h<e.length;h++){const d=Hr(e[h],t,n);a.push(d)}return a}function zl(e,t,n,a){if(e[0]<n[0]||e[0]>n[2]){const h=.5*a;let d=e[0]-n[0]>h?-a:n[0]-e[0]>h?a:0;0===d&&(d=e[0]-n[2]>h?-a:n[2]-e[0]>h?a:0),e[0]+=d}zo(t,e)}function Rl(e,t,n,a){const h=Math.pow(2,a.z)*us,d=[a.x*us,a.y*us],g=[];for(const v of e)for(const w of v){const C=[w.x+d[0],w.y+d[1]];zl(C,t,n,h),g.push(C)}return g}function Ec(e,t,n,a){const h=Math.pow(2,a.z)*us,d=[a.x*us,a.y*us],g=[];for(const w of e){const C=[];for(const k of w){const I=[k.x+d[0],k.y+d[1]];zo(t,I),C.push(I)}g.push(C)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of g)for(const C of w)zl(C,t,n,h)}var v;return g}class qr{constructor(t,n){this.type=Re,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(La(t[1])){const a=t[1];if("FeatureCollection"===a.type)for(let h=0;h<a.features.length;++h){const d=a.features[h].geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new qr(a,a.features[h].geometry)}else if("Feature"===a.type){const h=a.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new qr(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new qr(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(n,a){const h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if("Polygon"===a.type){const v=Hr(a.coordinates,d,g),w=Rl(n.geometry(),h,d,g);if(!ds(h,d))return!1;for(const C of w)if(!Ro(C,v))return!1}if("MultiPolygon"===a.type){const v=Ac(a.coordinates,d,g),w=Rl(n.geometry(),h,d,g);if(!ds(h,d))return!1;for(const C of w)if(!Lo(C,v))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(n,a){const h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if("Polygon"===a.type){const v=Hr(a.coordinates,d,g),w=Ec(n.geometry(),h,d,g);if(!ds(h,d))return!1;for(const C of w)if(!Sc(C,v))return!1}if("MultiPolygon"===a.type){const v=Ac(a.coordinates,d,g),w=Ec(n.geometry(),h,d,g);if(!ds(h,d))return!1;for(const C of w)if(!Gh(C,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ca(e){if(e instanceof er&&("get"===e.name&&1===e.args.length||"feature-state"===e.name||"has"===e.name&&1===e.args.length||"properties"===e.name||"geometry-type"===e.name||"id"===e.name||/^filter-/.test(e.name))||e instanceof qr)return!1;let t=!0;return e.eachChild(n=>{t&&!ca(n)&&(t=!1)}),t}function ha(e){if(e instanceof er&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(n=>{t&&!ha(n)&&(t=!1)}),t}function Ba(e,t){if(e instanceof er&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(a=>{n&&!Ba(a,t)&&(n=!1)}),n}class Va{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("'var' expression requires exactly one string literal argument.");const a=t[1];return n.scope.has(a)?new Va(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Vr{constructor(t,n=[],a,h=new sa,d=[]){this.registry=t,this.path=n,this.key=n.map(g=>`[${g}]`).join(""),this.scope=h,this.errors=d,this.expectedType=a}parse(t,n,a,h,d={}){return n?this.concat(n,a,h)._parse(t,d):this._parse(t,d)}_parse(t,n){function a(h,d,g){return"assert"===g?new hr(d,[h]):"coerce"===g?new Br(d,[h]):h}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[h];if(d){let g=d.parse(t,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,w=g.type;if("string"!==v.kind&&"number"!==v.kind&&"boolean"!==v.kind&&"object"!==v.kind&&"array"!==v.kind||"value"!==w.kind)if("color"!==v.kind&&"formatted"!==v.kind&&"resolvedImage"!==v.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(v,w))return null}else g=a(g,v,n.typeAnnotation||"coerce");else g=a(g,v,n.typeAnnotation||"assert")}if(!(g instanceof Fr)&&"resolvedImage"!==g.type.kind&&Fo(g)){const v=new Pl;try{g=new Fr(g.type,g.evaluate(v))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,a){const h="number"==typeof t?this.path.concat(t):this.path,d=a?this.scope.concat(a):this.scope;return new Vr(this.registry,h,n||null,d,this.errors)}error(t,...n){const a=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Or(a,t))}checkSubtype(t,n){const a=Ln(t,n);return a&&this.error(a),a}}function Fo(e){if(e instanceof Va)return Fo(e.boundExpression);if(e instanceof er&&"error"===e.name||e instanceof Fa||e instanceof qr)return!1;const t=e instanceof Br||e instanceof hr;let n=!0;return e.eachChild(a=>{n=t?n&&Fo(a):n&&a instanceof Fr}),!!n&&ca(e)&&Ba(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ua(e,t){const n=e.length-1;let a,h,d=0,g=n,v=0;for(;d<=g;)if(v=Math.floor((d+g)/2),a=e[v],h=e[v+1],a<=t){if(v===n||t<h)return v;d=v+1}else{if(!(a>t))throw new dn("Input is not a number.");g=v-1}return 0}class ua{constructor(t,n,a){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[h,d]of a)this.labels.push(h),this.outputs.push(d)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(t[1],1,oe);if(!a)return null;const h=[];let d=null;n.expectedType&&"value"!==n.expectedType.kind&&(d=n.expectedType);for(let g=1;g<t.length;g+=2){const v=1===g?-1/0:t[g],w=t[g+1],C=g,k=g+1;if("number"!=typeof v)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const I=n.parse(w,k,d);if(!I)return null;d=d||I.type,h.push([v,I])}return new ua(d,a,h)}evaluate(t){const n=this.labels,a=this.outputs;if(1===n.length)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return a[0].evaluate(t);const d=n.length;return h>=n[d-1]?a[d-1].evaluate(t):a[Ua(n,h)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}function xi(e,t,n){return e*(1-n)+t*n}var ps=Object.freeze({__proto__:null,number:xi,color:function(e,t,n){return new fi(xi(e.r,t.r,n),xi(e.g,t.g,n),xi(e.b,t.b,n),xi(e.a,t.a,n))},array:function(e,t,n){return e.map((a,h)=>xi(a,t[h],n))}});const fs=4/29,ja=6/29,Ll=3*ja*ja,Dc=Math.PI/180,Ic=180/Math.PI;function Bo(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ll+fs}function Ga(e){return e>ja?e*e*e:Ll*(e-fs)}function Za(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function $a(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Pc(e){const t=$a(e.r),n=$a(e.g),a=$a(e.b),h=Bo((.4124564*t+.3575761*n+.1804375*a)/.95047),d=Bo((.2126729*t+.7151522*n+.072175*a)/1);return{l:116*d-16,a:500*(h-d),b:200*(d-Bo((.0193339*t+.119192*n+.9503041*a)/1.08883)),alpha:e.a}}function zc(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,a=isNaN(e.b)?t:t-e.b/200;return t=1*Ga(t),n=.95047*Ga(n),a=1.08883*Ga(a),new fi(Za(3.2404542*n-1.5371385*t-.4985314*a),Za(-.969266*n+1.8760108*t+.041556*a),Za(.0556434*n-.2040259*t+1.0572252*a),e.alpha)}function Rc(e,t,n){const a=t-e;return e+n*(a>180||a<-180?a-360*Math.round(a/360):a)}const Ha={forward:Pc,reverse:zc,interpolate:function(e,t,n){return{l:xi(e.l,t.l,n),a:xi(e.a,t.a,n),b:xi(e.b,t.b,n),alpha:xi(e.alpha,t.alpha,n)}}},da={forward:function(e){const{l:t,a:n,b:a}=Pc(e),h=Math.atan2(a,n)*Ic;return{h:h<0?h+360:h,c:Math.sqrt(n*n+a*a),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Dc,n=e.c;return zc({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:Rc(e.h,t.h,n),c:xi(e.c,t.c,n),l:xi(e.l,t.l,n),alpha:xi(e.alpha,t.alpha,n)}}};var Lc=Object.freeze({__proto__:null,lab:Ha,hcl:da});class Gn{constructor(t,n,a,h,d){this.type=t,this.operator=n,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[g,v]of d)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(t,n,a,h){let d=0;if("exponential"===t.name)d=ur(n,t.base,a,h);else if("linear"===t.name)d=ur(n,1,a,h);else if("cubic-bezier"===t.name){const g=t.controlPoints;d=new $i(g[0],g[1],g[2],g[3]).solve(ur(n,1,a,h))}return d}static parse(t,n){let[a,h,d,...g]=t;if(!Array.isArray(h)||0===h.length)return n.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const C=h[1];if("number"!=typeof C)return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if("cubic-bezier"!==h[0])return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(4!==C.length||C.some(k=>"number"!=typeof k||k<0||k>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,oe),!d)return null;const v=[];let w=null;"interpolate-hcl"===a||"interpolate-lab"===a?w=jn:n.expectedType&&"value"!==n.expectedType.kind&&(w=n.expectedType);for(let C=0;C<g.length;C+=2){const k=g[C],I=g[C+1],P=C+3,U=C+4;if("number"!=typeof k)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(v.length&&v[v.length-1][0]>=k)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const G=n.parse(I,U,w);if(!G)return null;w=w||G.type,v.push([k,G])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Gn(w,a,h,d,v):n.error(`Type ${Gi(w)} is not interpolatable.`)}evaluate(t){const n=this.labels,a=this.outputs;if(1===n.length)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return a[0].evaluate(t);const d=n.length;if(h>=n[d-1])return a[d-1].evaluate(t);const g=Ua(n,h),v=Gn.interpolationFactor(this.interpolation,h,n[g],n[g+1]),w=a[g].evaluate(t),C=a[g+1].evaluate(t);return"interpolate"===this.operator?ps[this.type.kind.toLowerCase()](w,C,v):"interpolate-hcl"===this.operator?da.reverse(da.interpolate(da.forward(w),da.forward(C),v)):Ha.reverse(Ha.interpolate(Ha.forward(w),Ha.forward(C),v))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function ur(e,t,n,a){const h=a-n,d=e-n;return 0===h?0:1===t?d/h:(Math.pow(t,d)-1)/(Math.pow(t,h)-1)}class ms{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let a=null;const h=n.expectedType;h&&"value"!==h.kind&&(a=h);const d=[];for(const v of t.slice(1)){const w=n.parse(v,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,d.push(w)}const g=h&&d.some(v=>Ln(h,v.type));return new ms(g?qe:a,d)}evaluate(t){let n,a=null,h=0;for(const d of this.args){if(h++,a=d.evaluate(t),a&&a instanceof cr&&!a.available&&(n||(n=a),a=null,h===this.args.length))return n;if(null!==a)break}return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}class Vo{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let d=1;d<t.length-1;d+=2){const g=t[d];if("string"!=typeof g)return n.error(`Expected string, but found ${typeof g} instead.`,d);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);const v=n.parse(t[d+1],d+1);if(!v)return null;a.push([g,v])}const h=n.parse(t[t.length-1],t.length-1,n.expectedType,a);return h?new Vo(a,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,a]of this.bindings)t.push(n,a.serialize());return t.push(this.result.serialize()),t}}class Ol{constructor(t,n,a){this.type=t,this.index=n,this.input=a}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,oe),h=n.parse(t[2],2,lr(n.expectedType||qe));return a&&h?new Ol(h.type.itemType,a,h):null}evaluate(t){const n=this.index.evaluate(t),a=this.input.evaluate(t);if(n<0)throw new dn(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new dn(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new dn(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Fl{constructor(t,n){this.type=Re,this.needle=t,this.haystack=n}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,qe),h=n.parse(t[2],2,qe);return a&&h?Ra(a.type,[Re,je,oe,$r,qe])?new Fl(a,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(a.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!cs(n,["boolean","string","number","null"]))throw new dn(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(rn(n))} instead.`);if(!cs(a,["string","array"]))throw new dn(`Expected second argument to be of type array or string, but found ${Gi(rn(a))} instead.`);return a.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Tr{constructor(t,n,a){this.type=oe,this.needle=t,this.haystack=n,this.fromIndex=a}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,qe),h=n.parse(t[2],2,qe);if(!a||!h)return null;if(!Ra(a.type,[Re,je,oe,$r,qe]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(a.type)} instead`);if(4===t.length){const d=n.parse(t[3],3,oe);return d?new Tr(a,h,d):null}return new Tr(a,h)}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!cs(n,["boolean","string","number","null"]))throw new dn(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(rn(n))} instead.`);if(!cs(a,["string","array"]))throw new dn(`Expected second argument to be of type array or string, but found ${Gi(rn(a))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return a.indexOf(n,h)}return a.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Uo{constructor(t,n,a,h,d,g){this.inputType=t,this.type=n,this.input=a,this.cases=h,this.outputs=d,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let a,h;n.expectedType&&"value"!==n.expectedType.kind&&(h=n.expectedType);const d={},g=[];for(let C=2;C<t.length-1;C+=2){let k=t[C];const I=t[C+1];Array.isArray(k)||(k=[k]);const P=n.concat(C);if(0===k.length)return P.error("Expected at least one branch label.");for(const G of k){if("number"!=typeof G&&"string"!=typeof G)return P.error("Branch labels must be numbers or strings.");if("number"==typeof G&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof G&&Math.floor(G)!==G)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,rn(G)))return null}else a=rn(G);if(void 0!==d[String(G)])return P.error("Branch labels must be unique.");d[String(G)]=g.length}const U=n.parse(I,C,h);if(!U)return null;h=h||U.type,g.push(U)}const v=n.parse(t[1],1,qe);if(!v)return null;const w=n.parse(t[t.length-1],t.length-1,h);return w?"value"!==v.type.kind&&n.concat(1).checkSubtype(a,v.type)?null:new Uo(a,h,v,d,g,w):null}evaluate(t){const n=this.input.evaluate(t);return(rn(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],h={};for(const g of n){const v=h[this.cases[g]];void 0===v?(h[this.cases[g]]=a.length,a.push([this.cases[g],[g]])):a[v][1].push(g)}const d=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,v]of a)t.push(1===v.length?d(v[0]):v.map(d)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}class Wr{constructor(t,n,a){this.type=t,this.branches=n,this.otherwise=a}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const v=n.parse(t[g],g,Re);if(!v)return null;const w=n.parse(t[g+1],g+1,a);if(!w)return null;h.push([v,w]),a=a||w.type}const d=n.parse(t[t.length-1],t.length-1,a);return d?new Wr(a,h,d):null}evaluate(t){for(const[n,a]of this.branches)if(n.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,a]of this.branches)t(n),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}class qa{constructor(t,n,a,h){this.type=t,this.input=n,this.beginIndex=a,this.endIndex=h}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,qe),h=n.parse(t[2],2,oe);if(!a||!h)return null;if(!Ra(a.type,[lr(qe),je,qe]))return n.error(`Expected first argument to be of type array or string, but found ${Gi(a.type)} instead`);if(4===t.length){const d=n.parse(t[3],3,oe);return d?new qa(a.type,a,h,d):null}return new qa(a.type,a,h)}evaluate(t){const n=this.input.evaluate(t),a=this.beginIndex.evaluate(t);if(!cs(n,["string","array"]))throw new dn(`Expected first argument to be of type array or string, but found ${Gi(rn(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return n.slice(a,h)}return n.slice(a)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Oc(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Wa(e,t,n,a){return 0===a.compare(t,n)}function _s(e,t,n){const a="=="!==e&&"!="!==e;return class Bm{constructor(d,g,v){this.type=Re,this.lhs=d,this.rhs=g,this.collator=v,this.hasUntypedArgument="value"===d.type.kind||"value"===g.type.kind}static parse(d,g){if(3!==d.length&&4!==d.length)return g.error("Expected two or three arguments.");const v=d[0];let w=g.parse(d[1],1,qe);if(!w)return null;if(!Oc(v,w.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${Gi(w.type)}'.`);let C=g.parse(d[2],2,qe);if(!C)return null;if(!Oc(v,C.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${Gi(C.type)}'.`);if(w.type.kind!==C.type.kind&&"value"!==w.type.kind&&"value"!==C.type.kind)return g.error(`Cannot compare types '${Gi(w.type)}' and '${Gi(C.type)}'.`);a&&("value"===w.type.kind&&"value"!==C.type.kind?w=new hr(C.type,[w]):"value"!==w.type.kind&&"value"===C.type.kind&&(C=new hr(w.type,[C])));let k=null;if(4===d.length){if("string"!==w.type.kind&&"string"!==C.type.kind&&"value"!==w.type.kind&&"value"!==C.type.kind)return g.error("Cannot use collator to compare non-string types.");if(k=g.parse(d[3],3,zs),!k)return null}return new Bm(w,C,k)}evaluate(d){const g=this.lhs.evaluate(d),v=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const w=rn(g),C=rn(v);if(w.kind!==C.kind||"string"!==w.kind&&"number"!==w.kind)throw new dn(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${w.kind}, ${C.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const w=rn(g),C=rn(v);if("string"!==w.kind||"string"!==C.kind)return t(d,g,v)}return this.collator?n(d,g,v,this.collator.evaluate(d)):t(d,g,v)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[e];return this.eachChild(g=>{d.push(g.serialize())}),d}}}const Fc=_s("==",function(e,t,n){return t===n},Wa),No=_s("!=",function(e,t,n){return t!==n},function(e,t,n,a){return!Wa(0,t,n,a)}),jo=_s("<",function(e,t,n){return t<n},function(e,t,n,a){return a.compare(t,n)<0}),Bc=_s(">",function(e,t,n){return t>n},function(e,t,n,a){return a.compare(t,n)>0}),Go=_s("<=",function(e,t,n){return t<=n},function(e,t,n,a){return a.compare(t,n)<=0}),Vc=_s(">=",function(e,t,n){return t>=n},function(e,t,n,a){return a.compare(t,n)>=0});class Zo{constructor(t,n,a,h,d){this.type=je,this.number=t,this.locale=n,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=d}static parse(t,n){if(3!==t.length)return n.error("Expected two arguments.");const a=n.parse(t[1],1,oe);if(!a)return null;const h=t[2];if("object"!=typeof h||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let d=null;if(h.locale&&(d=n.parse(h.locale,1,je),!d))return null;let g=null;if(h.currency&&(g=n.parse(h.currency,1,je),!g))return null;let v=null;if(h["min-fraction-digits"]&&(v=n.parse(h["min-fraction-digits"],1,oe),!v))return null;let w=null;return h["max-fraction-digits"]&&(w=n.parse(h["max-fraction-digits"],1,oe),!w)?null:new Zo(a,d,g,v,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class $o{constructor(t){this.type=oe,this.input=t}static parse(t,n){if(2!==t.length)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=n.parse(t[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?n.error(`Expected argument of type string or array, but found ${Gi(a.type)} instead.`):new $o(a):null}evaluate(t){const n=this.input.evaluate(t);if("string"==typeof n||Array.isArray(n))return n.length;throw new dn(`Expected value to be of type string or array, but found ${Gi(rn(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}const dr={"==":Fc,"!=":No,">":Bc,"<":jo,">=":Vc,"<=":Go,array:hr,at:Ol,boolean:hr,case:Wr,coalesce:ms,collator:Fa,format:Mr,image:hs,in:Fl,"index-of":Tr,interpolate:Gn,"interpolate-hcl":Gn,"interpolate-lab":Gn,length:$o,let:Vo,literal:Fr,match:Uo,number:hr,"number-format":Zo,object:hr,slice:qa,step:ua,string:hr,"to-boolean":Br,"to-color":Br,"to-number":Br,"to-string":Br,var:Va,within:qr};function Ho(e,[t,n,a,h]){t=t.evaluate(e),n=n.evaluate(e),a=a.evaluate(e);const d=h?h.evaluate(e):1,g=Mc(t,n,a,d);if(g)throw new dn(g);return new fi(t/255*d,n/255*d,a/255*d,d)}function Ya(e,t){return e in t}function Xa(e,t){const n=t[e];return void 0===n?null:n}function gs(e){return{type:e}}function pa(e){return{result:"success",value:e}}function Cr(e){return{result:"error",value:e}}function Os(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Uc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Sr(e){return!!e.expression&&e.expression.interpolated}function gi(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function qo(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Wo(e){return e}function Ka(e,t){const n="color"===t.type,a=e.stops&&"object"==typeof e.stops[0][0],h=a||!(a||void 0!==e.property),d=e.type||(Sr(t)?"exponential":"interval");if(n&&((e=ls({},e)).stops&&(e.stops=e.stops.map(C=>[C[0],fi.parse(C[1])])),e.default=fi.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Lc[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let g,v,w;if("exponential"===d)g=Yo;else if("interval"===d)g=Nc;else if("categorical"===d){g=Ja,v=Object.create(null);for(const C of e.stops)v[C[0]]=C[1];w=typeof e.stops[0][0]}else{if("identity"!==d)throw new Error(`Unknown function type "${d}"`);g=Zh}if(a){const C={},k=[];for(let U=0;U<e.stops.length;U++){const G=e.stops[U],H=G[0].zoom;void 0===C[H]&&(C[H]={zoom:H,type:e.type,property:e.property,default:e.default,stops:[]},k.push(H)),C[H].stops.push([G[0].value,G[1]])}const I=[];for(const U of k)I.push([C[U].zoom,Ka(C[U],t)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Gn.interpolationFactor.bind(void 0,P),zoomStops:I.map(U=>U[0]),evaluate:({zoom:U},G)=>Yo({stops:I,base:e.base},t,U).evaluate(U,G)}}if(h){const C="exponential"===d?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Gn.interpolationFactor.bind(void 0,C),zoomStops:e.stops.map(k=>k[0]),evaluate:({zoom:k})=>g(e,t,k,v,w)}}return{kind:"source",evaluate(C,k){const I=k&&k.properties?k.properties[e.property]:void 0;return void 0===I?vn(e.default,t.default):g(e,t,I,v,w)}}}function vn(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function Ja(e,t,n,a,h){return vn(typeof n===h?a[n]:void 0,e.default,t.default)}function Nc(e,t,n){if("number"!==gi(n))return vn(e.default,t.default);const a=e.stops.length;if(1===a||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[a-1][0])return e.stops[a-1][1];const h=Ua(e.stops.map(d=>d[0]),n);return e.stops[h][1]}function Yo(e,t,n){const a=void 0!==e.base?e.base:1;if("number"!==gi(n))return vn(e.default,t.default);const h=e.stops.length;if(1===h||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[h-1][0])return e.stops[h-1][1];const d=Ua(e.stops.map(k=>k[0]),n),g=function(k,I,P,U){const G=U-P,H=k-P;return 0===G?0:1===I?H/G:(Math.pow(I,H)-1)/(Math.pow(I,G)-1)}(n,a,e.stops[d][0],e.stops[d+1][0]),v=e.stops[d][1],w=e.stops[d+1][1];let C=ps[t.type]||Wo;if(e.colorSpace&&"rgb"!==e.colorSpace){const k=Lc[e.colorSpace];C=(I,P)=>k.reverse(k.interpolate(k.forward(I),k.forward(P),g))}return"function"==typeof v.evaluate?{evaluate(...k){const I=v.evaluate.apply(void 0,k),P=w.evaluate.apply(void 0,k);if(void 0!==I&&void 0!==P)return C(I,P,g)}}:C(v,w,g)}function Zh(e,t,n){return"color"===t.type?n=fi.parse(n):"formatted"===t.type?n=Ye.fromString(n.toString()):"resolvedImage"===t.type?n=cr.fromString(n.toString()):gi(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),vn(n,e.default,t.default)}er.register(dr,{error:[{kind:"error"},[je],(e,[t])=>{throw new dn(t.evaluate(e))}],typeof:[je,[qe],(e,[t])=>Gi(rn(t.evaluate(e)))],"to-rgba":[lr(oe,4),[jn],(e,[t])=>t.evaluate(e).toArray()],rgb:[jn,[oe,oe,oe],Ho],rgba:[jn,[oe,oe,oe,oe],Ho],has:{type:Re,overloads:[[[je],(e,[t])=>Ya(t.evaluate(e),e.properties())],[[je,aa],(e,[t,n])=>Ya(t.evaluate(e),n.evaluate(e))]]},get:{type:qe,overloads:[[[je],(e,[t])=>Xa(t.evaluate(e),e.properties())],[[je,aa],(e,[t,n])=>Xa(t.evaluate(e),n.evaluate(e))]]},"feature-state":[qe,[je],(e,[t])=>Xa(t.evaluate(e),e.featureState||{})],properties:[aa,[],e=>e.properties()],"geometry-type":[je,[],e=>e.geometryType()],id:[qe,[],e=>e.id()],zoom:[oe,[],e=>e.globals.zoom],pitch:[oe,[],e=>e.globals.pitch||0],"distance-from-center":[oe,[],e=>e.distanceFromCenter()],"heatmap-density":[oe,[],e=>e.globals.heatmapDensity||0],"line-progress":[oe,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[oe,[],e=>e.globals.skyRadialProgress||0],accumulated:[qe,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[oe,gs(oe),(e,t)=>{let n=0;for(const a of t)n+=a.evaluate(e);return n}],"*":[oe,gs(oe),(e,t)=>{let n=1;for(const a of t)n*=a.evaluate(e);return n}],"-":{type:oe,overloads:[[[oe,oe],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[oe],(e,[t])=>-t.evaluate(e)]]},"/":[oe,[oe,oe],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[oe,[oe,oe],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[oe,[],()=>Math.LN2],pi:[oe,[],()=>Math.PI],e:[oe,[],()=>Math.E],"^":[oe,[oe,oe],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[oe,[oe],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[oe,[oe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[oe,[oe],(e,[t])=>Math.log(t.evaluate(e))],log2:[oe,[oe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[oe,[oe],(e,[t])=>Math.sin(t.evaluate(e))],cos:[oe,[oe],(e,[t])=>Math.cos(t.evaluate(e))],tan:[oe,[oe],(e,[t])=>Math.tan(t.evaluate(e))],asin:[oe,[oe],(e,[t])=>Math.asin(t.evaluate(e))],acos:[oe,[oe],(e,[t])=>Math.acos(t.evaluate(e))],atan:[oe,[oe],(e,[t])=>Math.atan(t.evaluate(e))],min:[oe,gs(oe),(e,t)=>Math.min(...t.map(n=>n.evaluate(e)))],max:[oe,gs(oe),(e,t)=>Math.max(...t.map(n=>n.evaluate(e)))],abs:[oe,[oe],(e,[t])=>Math.abs(t.evaluate(e))],round:[oe,[oe],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[oe,[oe],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[oe,[oe],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Re,[je,qe],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[Re,[qe],(e,[t])=>e.id()===t.value],"filter-type-==":[Re,[je],(e,[t])=>e.geometryType()===t.value],"filter-<":[Re,[je,qe],(e,[t,n])=>{const a=e.properties()[t.value],h=n.value;return typeof a==typeof h&&a<h}],"filter-id-<":[Re,[qe],(e,[t])=>{const n=e.id(),a=t.value;return typeof n==typeof a&&n<a}],"filter->":[Re,[je,qe],(e,[t,n])=>{const a=e.properties()[t.value],h=n.value;return typeof a==typeof h&&a>h}],"filter-id->":[Re,[qe],(e,[t])=>{const n=e.id(),a=t.value;return typeof n==typeof a&&n>a}],"filter-<=":[Re,[je,qe],(e,[t,n])=>{const a=e.properties()[t.value],h=n.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[Re,[qe],(e,[t])=>{const n=e.id(),a=t.value;return typeof n==typeof a&&n<=a}],"filter->=":[Re,[je,qe],(e,[t,n])=>{const a=e.properties()[t.value],h=n.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[Re,[qe],(e,[t])=>{const n=e.id(),a=t.value;return typeof n==typeof a&&n>=a}],"filter-has":[Re,[qe],(e,[t])=>t.value in e.properties()],"filter-has-id":[Re,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Re,[lr(je)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Re,[lr(qe)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Re,[je,lr(qe)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Re,[je,lr(qe)],(e,[t,n])=>function(a,h,d,g){for(;d<=g;){const v=d+g>>1;if(h[v]===a)return!0;h[v]>a?g=v-1:d=v+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Re,overloads:[[[Re,Re],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[gs(Re),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Re,overloads:[[[Re,Re],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[gs(Re),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Re,[Re],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Re,[je],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[je,[je],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[je,[je],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[je,gs(qe),(e,t)=>t.map(n=>Oa(n.evaluate(e))).join("")],"resolved-locale":[je,[zs],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Bl{constructor(t,n){var a;this.expression=t,this._warningHistory={},this._evaluator=new Pl,this._defaultValue=n?"color"===(a=n).type&&qo(a.default)?new fi(0,0,0,0):"color"===a.type?fi.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(t,n,a,h,d,g,v,w){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(t,n,a,h,d,g,v,w){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const C=this.expression.evaluate(this._evaluator);if(null==C||"number"==typeof C&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new dn(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,"undefined"!=typeof console&&console.warn(C.message)),this._defaultValue}}}function fa(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in dr}function ma(e,t){const n=new Vr(dr,[],t?function(h){const d={color:jn,string:je,number:oe,enum:je,boolean:Re,formatted:An,resolvedImage:za};return"array"===h.type?lr(d[h.value]||qe,h.length):d[h.type]}(t):void 0),a=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return a?pa(new Bl(a,t)):Cr(n.errors)}class Qa{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent="constant"!==t&&!ha(n.expression)}evaluateWithoutErrorHandling(t,n,a,h,d,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,h,d,g)}evaluate(t,n,a,h,d,g){return this._styleExpression.evaluate(t,n,a,h,d,g)}}class Xo{constructor(t,n,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=n,this.isStateDependent="camera"!==t&&!ha(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,n,a,h,d,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,h,d,g)}evaluate(t,n,a,h,d,g){return this._styleExpression.evaluate(t,n,a,h,d,g)}interpolationFactor(t,n,a){return this.interpolationType?Gn.interpolationFactor(this.interpolationType,t,n,a):0}}function jc(e,t){if("error"===(e=ma(e,t)).result)return e;const n=e.value.expression,a=ca(n);if(!a&&!Os(t))return Cr([new Or("","data expressions not supported")]);const h=Ba(n,["zoom","pitch","distance-from-center"]);if(!h&&!Uc(t))return Cr([new Or("","zoom expressions not supported")]);const d=to(n);return d||h?d instanceof Or?Cr([d]):d instanceof Gn&&!Sr(t)?Cr([new Or("",'"interpolate" expressions cannot be used with this property')]):pa(d?new Xo(a?"camera":"composite",e.value,d.labels,d instanceof Gn?d.interpolation:void 0):new Qa(a?"constant":"source",e.value)):Cr([new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Fs{constructor(t,n){this._parameters=t,this._specification=n,ls(this,Ka(this._parameters,this._specification))}static deserialize(t){return new Fs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function to(e){let t=null;if(e instanceof Vo)t=to(e.result);else if(e instanceof ms){for(const n of e.args)if(t=to(n),t)break}else(e instanceof ua||e instanceof Gn)&&e.input instanceof er&&"zoom"===e.input.name&&(t=e);return t instanceof Or||e.eachChild(n=>{const a=to(n);a instanceof Or?t=a:!t&&a?t=new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function pr(e){const t=e.key,n=e.value,a=e.valueSpec||{},h=e.objectElementValidators||{},d=e.style,g=e.styleSpec;let v=[];const w=gi(n);if("object"!==w)return[new ue(t,n,`object expected, ${w} found`)];for(const C in n){const k=C.split(".")[0],I=a[k]||a["*"];let P;if(h[k])P=h[k];else if(a[k])P=pn;else if(h["*"])P=h["*"];else{if(!a["*"]){v.push(new ue(t,n[C],`unknown property "${C}"`));continue}P=pn}v=v.concat(P({key:(t&&`${t}.`)+C,value:n[C],valueSpec:I,style:d,styleSpec:g,object:n,objectKey:C},n))}for(const C in a)h[C]||a[C].required&&void 0===a[C].default&&void 0===n[C]&&v.push(new ue(t,n,`missing required property "${C}"`));return v}function eo(e){const t=e.value,n=e.valueSpec,a=e.style,h=e.styleSpec,d=e.key,g=e.arrayElementValidator||pn;if("array"!==gi(t))return[new ue(d,t,`array expected, ${gi(t)} found`)];if(n.length&&t.length!==n.length)return[new ue(d,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new ue(d,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum};h.$version<7&&(v.function=n.function),"object"===gi(n.value)&&(v=n.value);let w=[];for(let C=0;C<t.length;C++)w=w.concat(g({array:t,arrayIndex:C,value:t[C],valueSpec:v,style:a,styleSpec:h,key:`${d}[${C}]`}));return w}function Ko(e){const t=e.key,n=e.value,a=e.valueSpec;let h=gi(n);if("number"===h&&n!=n&&(h="NaN"),"number"!==h)return[new ue(t,n,`number expected, ${h} found`)];if("minimum"in a){let d=a.minimum;if("array"===gi(a.minimum)&&(d=a.minimum[e.arrayIndex]),n<d)return[new ue(t,n,`${n} is less than the minimum value ${d}`)]}if("maximum"in a){let d=a.maximum;if("array"===gi(a.maximum)&&(d=a.maximum[e.arrayIndex]),n>d)return[new ue(t,n,`${n} is greater than the maximum value ${d}`)]}return[]}function Jo(e){const t=e.valueSpec,n=Qi(e.value.type);let a,h,d,g={};const v="categorical"!==n&&void 0===e.value.property,w=!v,C="array"===gi(e.value.stops)&&"array"===gi(e.value.stops[0])&&"object"===gi(e.value.stops[0][0]),k=pr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(U){if("identity"===n)return[new ue(U.key,U.value,'identity function may not have a "stops" property')];let G=[];const H=U.value;return G=G.concat(eo({key:U.key,value:H,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:I})),"array"===gi(H)&&0===H.length&&G.push(new ue(U.key,H,"array must have at least one stop")),G},default:function(U){return pn({key:U.key,value:U.value,valueSpec:t,style:U.style,styleSpec:U.styleSpec})}}});return"identity"===n&&v&&k.push(new ue(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||k.push(new ue(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!Sr(e.valueSpec)&&k.push(new ue(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(w&&!Os(e.valueSpec)?k.push(new ue(e.key,e.value,"property functions not supported")):v&&!Uc(e.valueSpec)&&k.push(new ue(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!C||void 0!==e.value.property||k.push(new ue(e.key,e.value,'"property" property is required')),k;function I(U){let G=[];const H=U.value,Y=U.key;if("array"!==gi(H))return[new ue(Y,H,`array expected, ${gi(H)} found`)];if(2!==H.length)return[new ue(Y,H,`array length 2 expected, length ${H.length} found`)];if(C){if("object"!==gi(H[0]))return[new ue(Y,H,`object expected, ${gi(H[0])} found`)];if(void 0===H[0].zoom)return[new ue(Y,H,"object stop key must have zoom")];if(void 0===H[0].value)return[new ue(Y,H,"object stop key must have value")];if(d&&d>Qi(H[0].zoom))return[new ue(Y,H[0].zoom,"stop zoom values must appear in ascending order")];Qi(H[0].zoom)!==d&&(d=Qi(H[0].zoom),h=void 0,g={}),G=G.concat(pr({key:`${Y}[0]`,value:H[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Ko,value:P}}))}else G=G.concat(P({key:`${Y}[0]`,value:H[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},H));return fa(Zr(H[1]))?G.concat([new ue(`${Y}[1]`,H[1],"expressions are not allowed in function stops.")]):G.concat(pn({key:`${Y}[1]`,value:H[1],valueSpec:t,style:U.style,styleSpec:U.styleSpec}))}function P(U,G){const H=gi(U.value),Y=Qi(U.value),nt=null!==U.value?U.value:G;if(a){if(H!==a)return[new ue(U.key,nt,`${H} stop domain type must match previous stop domain type ${a}`)]}else a=H;if("number"!==H&&"string"!==H&&"boolean"!==H)return[new ue(U.key,nt,"stop domain value must be a number, string, or boolean")];if("number"!==H&&"categorical"!==n){let ct=`number expected, ${H} found`;return Os(t)&&void 0===n&&(ct+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ue(U.key,nt,ct)]}return"categorical"!==n||"number"!==H||isFinite(Y)&&Math.floor(Y)===Y?"categorical"!==n&&"number"===H&&void 0!==h&&Y<h?[new ue(U.key,nt,"stop domain values must appear in ascending order")]:(h=Y,"categorical"===n&&Y in g?[new ue(U.key,nt,"stop domain values must be unique")]:(g[Y]=!0,[])):[new ue(U.key,nt,`integer expected, found ${Y}`)]}}function Yr(e){const t=("property"===e.expressionContext?jc:ma)(Zr(e.value),e.valueSpec);if("error"===t.result)return t.value.map(a=>new ue(`${e.key}${a.key}`,e.value,a.message));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new ue(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!ha(n))return[new ue(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Qo(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Ba(n,["zoom","feature-state"]))return[new ue(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!ca(n))return[new ue(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qo(e,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of t.valueSpec.expression.parameters)n.delete(h);if(0===n.size)return[];const a=[];return e instanceof er&&n.has(e.name)?[new ue(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(h=>{a.push(...Qo(h,t))}),a)}function io(e){const t=e.key,n=e.value,a=e.valueSpec,h=[];return Array.isArray(a.values)?-1===a.values.indexOf(Qi(n))&&h.push(new ue(t,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(a.values).indexOf(Qi(n))&&h.push(new ue(t,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function no(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!no(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function ro(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};no(e)||(e=el(e));const n=e;let a=!0;try{a=function(C){if(!so(C))return C;let k=Zr(C);return ys(k),k=tl(k),k}(n)}catch(C){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const h=Rt[`filter_${t}`],d=ma(a,h);let g=null;if("error"===d.result)throw new Error(d.value.map(C=>`${C.key}: ${C.message}`).join(", "));g=(C,k,I)=>d.value.evaluate(C,k,{},I);let v=null,w=null;if(a!==n){const C=ma(n,h);if("error"===C.result)throw new Error(C.value.map(k=>`${k.key}: ${k.message}`).join(", "));v=(k,I,P,U,G)=>C.value.evaluate(k,I,{},P,void 0,void 0,U,G),w=!ca(C.value.expression)}return g=g,{filter:g,dynamicFilter:v||void 0,needGeometry:Vl(a),needFeature:!!w}}function tl(e){if(!Array.isArray(e))return e;const t=function(n){if($h.has(n[0]))for(let a=1;a<n.length;a++)if(so(n[a]))return!0;return n}(e);return!0===t?t:t.map(n=>tl(n))}function ys(e){let t=!1;const n=[];if("case"===e[0]){for(let a=1;a<e.length-1;a+=2)t=t||so(e[a]),n.push(e[a+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||so(e[1]);for(let a=2;a<e.length-1;a+=2)n.push(e[a+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||so(e[1]);for(let a=1;a<e.length-1;a+=2)n.push(e[a+1])}t&&(e.length=0,e.push("any",...n));for(let a=1;a<e.length;a++)ys(e[a])}function so(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(so(e[n]))return!0;return!1}const $h=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ao(e,t){return e<t?-1:e>t?1:0}function Vl(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(Vl(e[t]))return!0;return!1}function el(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?oo(e[1],e[2],"=="):"!="===t?nl(oo(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?oo(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(el))):"all"===t?["all"].concat(e.slice(1).map(el)):"none"===t?["all"].concat(e.slice(1).map(el).map(nl)):"in"===t?Gc(e[1],e.slice(2)):"!in"===t?nl(Gc(e[1],e.slice(2))):"has"===t?il(e[1]):"!has"===t?nl(il(e[1])):"within"!==t||e;var n}function oo(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function Gc(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",e,["literal",t.sort(ao)]]:["filter-in-small",e,["literal",t]]}}function il(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function nl(e){return["!",e]}function Ul(e){if(no(Zr(e.value))){const t=Zr(e.layerType);return Yr(ls({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${t||"fill"}`]}))}return rl(e)}function rl(e){const t=e.value,n=e.key;if("array"!==gi(t))return[new ue(n,t,`array expected, ${gi(t)} found`)];const a=e.styleSpec;let h,d=[];if(t.length<1)return[new ue(n,t,"filter array must have at least 1 element")];switch(d=d.concat(io({key:`${n}[0]`,value:t[0],valueSpec:a.filter_operator,style:e.style,styleSpec:e.styleSpec})),Qi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Qi(t[1])&&d.push(new ue(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&d.push(new ue(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=gi(t[1]),"string"!==h&&d.push(new ue(`${n}[1]`,t[1],`string expected, ${h} found`)));for(let g=2;g<t.length;g++)h=gi(t[g]),"$type"===Qi(t[1])?d=d.concat(io({key:`${n}[${g}]`,value:t[g],valueSpec:a.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&d.push(new ue(`${n}[${g}]`,t[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)d=d.concat(rl({key:`${n}[${g}]`,value:t[g],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":h=gi(t[1]),2!==t.length?d.push(new ue(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==h&&d.push(new ue(`${n}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=gi(t[1]),2!==t.length?d.push(new ue(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==h&&d.push(new ue(`${n}[1]`,t[1],`object expected, ${h} found`))}return d}function _a(e,t){const n=e.key,a=e.style,h=e.styleSpec,d=e.value,g=e.objectKey,v=h[`${t}_${e.layerType}`];if(!v)return[];const w=g.match(/^(.*)-transition$/);if("paint"===t&&w&&v[w[1]]&&v[w[1]].transition)return pn({key:n,value:d,valueSpec:h.transition,style:a,styleSpec:h});const C=e.valueSpec||v[g];if(!C)return[new ue(n,d,`unknown property "${g}"`)];let k;if("string"===gi(d)&&Os(C)&&!C.tokens&&(k=/^{([^}]+)}$/.exec(d)))return[new ue(n,d,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const I=[];return"symbol"===e.layerType&&("text-field"===g&&a&&!a.glyphs&&I.push(new ue(n,d,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&qo(Zr(d))&&"identity"===Qi(d.type)&&I.push(new ue(n,d,'"text-font" does not support identity functions'))),I.concat(pn({key:e.key,value:d,valueSpec:C,style:a,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:g}))}function Zc(e){return _a(e,"paint")}function Nl(e){return _a(e,"layout")}function Xr(e){let t=[];const n=e.value,a=e.key,h=e.style,d=e.styleSpec;n.type||n.ref||t.push(new ue(a,n,'either "type" or "ref" is required'));let g=Qi(n.type);const v=Qi(n.ref);if(n.id){const w=Qi(n.id);for(let C=0;C<e.arrayIndex;C++){const k=h.layers[C];Qi(k.id)===w&&t.push(new ue(a,n.id,`duplicate layer id "${n.id}", previously used at line ${k.id.__line__}`))}}if("ref"in n){let w;["type","source","source-layer","filter","layout"].forEach(C=>{C in n&&t.push(new ue(a,n[C],`"${C}" is prohibited for ref layers`))}),h.layers.forEach(C=>{Qi(C.id)===v&&(w=C)}),w?w.ref?t.push(new ue(a,n.ref,"ref cannot reference another ref layer")):g=Qi(w.type):t.push(new ue(a,n.ref,`ref layer "${v}" not found`))}else if("background"!==g&&"sky"!==g)if(n.source){const w=h.sources&&h.sources[n.source],C=w&&Qi(w.type);w?"vector"===C&&"raster"===g?t.push(new ue(a,n.source,`layer "${n.id}" requires a raster source`)):"raster"===C&&"raster"!==g?t.push(new ue(a,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==C||n["source-layer"]?"raster-dem"===C&&"hillshade"!==g?t.push(new ue(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!n.paint||!n.paint["line-gradient"]||"geojson"===C&&w.lineMetrics||t.push(new ue(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ue(a,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new ue(a,n.source,`source "${n.source}" not found`))}else t.push(new ue(a,n,'missing required property "source"'));return t=t.concat(pr({key:a,value:n,valueSpec:d.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>pn({key:`${a}.type`,value:n.type,valueSpec:d.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:w=>Ul(ls({layerType:g},w)),layout:w=>pr({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":C=>Nl(ls({layerType:g},C))}}),paint:w=>pr({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":C=>Zc(ls({layerType:g},C))}})}})),t}function Bs(e){const t=e.value,n=e.key,a=gi(t);return"string"!==a?[new ue(n,t,`string expected, ${a} found`)]:[]}const Vs={promoteId:function({key:e,value:t}){if("string"===gi(t))return Bs({key:e,value:t});{const n=[];for(const a in t)n.push(...Bs({key:`${e}.${a}`,value:t[a]}));return n}}};function $c(e){const t=e.value,n=e.key,a=e.styleSpec,h=e.style;if(!t.type)return[new ue(n,t,'"type" is required')];const d=Qi(t.type);let g;switch(d){case"vector":case"raster":case"raster-dem":return g=pr({key:n,value:t,valueSpec:a[`source_${d.replace("-","_")}`],style:e.style,styleSpec:a,objectElementValidators:Vs}),g;case"geojson":if(g=pr({key:n,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,objectElementValidators:Vs}),t.cluster)for(const v in t.clusterProperties){const[w,C]=t.clusterProperties[v],k="string"==typeof w?[w,["accumulated"],["get",v]]:w;g.push(...Yr({key:`${n}.${v}.map`,value:C,expressionContext:"cluster-map"})),g.push(...Yr({key:`${n}.${v}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return g;case"video":return pr({key:n,value:t,valueSpec:a.source_video,style:h,styleSpec:a});case"image":return pr({key:n,value:t,valueSpec:a.source_image,style:h,styleSpec:a});case"canvas":return[new ue(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return io({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:a})}}function jl(e){const t=e.value,n=e.styleSpec,a=n.light,h=e.style;let d=[];const g=gi(t);if(void 0===t)return d;if("object"!==g)return d=d.concat([new ue("light",t,`object expected, ${g} found`)]),d;for(const v in t){const w=v.match(/^(.*)-transition$/);d=d.concat(w&&a[w[1]]&&a[w[1]].transition?pn({key:v,value:t[v],valueSpec:n.transition,style:h,styleSpec:n}):a[v]?pn({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:n}):[new ue(v,t[v],`unknown property "${v}"`)])}return d}function Gl(e){const t=e.value,n=e.key,a=e.style,h=e.styleSpec,d=h.terrain;let g=[];const v=gi(t);if(void 0===t)return g;if("object"!==v)return g=g.concat([new ue("terrain",t,`object expected, ${v} found`)]),g;for(const w in t){const C=w.match(/^(.*)-transition$/);g=g.concat(C&&d[C[1]]&&d[C[1]].transition?pn({key:w,value:t[w],valueSpec:h.transition,style:a,styleSpec:h}):d[w]?pn({key:w,value:t[w],valueSpec:d[w],style:a,styleSpec:h}):[new ue(w,t[w],`unknown property "${w}"`)])}if(t.source){const w=a.sources&&a.sources[t.source],C=w&&Qi(w.type);w?"raster-dem"!==C&&g.push(new ue(n,t.source,`terrain cannot be used with a source of type ${C}, it only be used with a "raster-dem" source type`)):g.push(new ue(n,t.source,`source "${t.source}" not found`))}else g.push(new ue(n,t,'terrain is missing required property "source"'));return g}function Zl(e){const t=e.value,n=e.style,a=e.styleSpec,h=a.fog;let d=[];const g=gi(t);if(void 0===t)return d;if("object"!==g)return d=d.concat([new ue("fog",t,`object expected, ${g} found`)]),d;for(const v in t){const w=v.match(/^(.*)-transition$/);d=d.concat(w&&h[w[1]]&&h[w[1]].transition?pn({key:v,value:t[v],valueSpec:a.transition,style:n,styleSpec:a}):h[v]?pn({key:v,value:t[v],valueSpec:h[v],style:n,styleSpec:a}):[new ue(v,t[v],`unknown property "${v}"`)])}return d}const sl={"*":()=>[],array:eo,boolean:function(e){const t=e.value,n=e.key,a=gi(t);return"boolean"!==a?[new ue(n,t,`boolean expected, ${a} found`)]:[]},number:Ko,color:function(e){const t=e.key,n=e.value,a=gi(n);return"string"!==a?[new ue(t,n,`color expected, ${a} found`)]:null===Rs.parseCSSColor(n)?[new ue(t,n,`color expected, "${n}" found`)]:[]},constants:Pa,enum:io,filter:Ul,function:Jo,layer:Xr,object:pr,source:$c,light:jl,terrain:Gl,fog:Zl,string:Bs,formatted:function(e){return 0===Bs(e).length?[]:Yr(e)},resolvedImage:function(e){return 0===Bs(e).length?[]:Yr(e)},projection:function(e){const t=e.value,n=e.styleSpec,a=n.projection,h=e.style;let d=[];const g=gi(t);if("object"===g)for(const v in t)d=d.concat(pn({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:n}));else"string"!==g&&(d=d.concat([new ue("projection",t,`object or string expected, ${g} found`)]));return d}};function pn(e){const t=e.value,n=e.valueSpec,a=e.styleSpec;return n.expression&&qo(Qi(t))?Jo(e):n.expression&&fa(Zr(t))?Yr(e):n.type&&sl[n.type]?sl[n.type](e):pr(ls({},e,{valueSpec:n.type?a[n.type]:n}))}function $l(e){const t=e.value,n=e.key,a=Bs(e);return a.length||(-1===t.indexOf("{fontstack}")&&a.push(new ue(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&a.push(new ue(n,t,'"glyphs" url must include a "{range}" token'))),a}function Kr(e,t=Rt){let n=[];return n=n.concat(pn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:$l,"*":()=>[]}})),e.constants&&(n=n.concat(Pa({key:"constants",value:e.constants,style:e,styleSpec:t}))),Hc(n)}function Hc(e){return[].concat(e).sort((t,n)=>t.line-n.line)}function On(e){return function(...t){return Hc(e.apply(this,t))}}Kr.source=On($c),Kr.light=On(jl),Kr.terrain=On(Gl),Kr.fog=On(Zl),Kr.layer=On(Xr),Kr.filter=On(Ul),Kr.paintProperty=On(Zc),Kr.layoutProperty=On(Nl);const Jr=Kr,Us=Jr.light,En=Jr.fog,al=Jr.paintProperty,Hh=Jr.layoutProperty;function lo(e,t){let n=!1;if(t&&t.length)for(const a of t)e.fire(new Do(new Error(a.message))),n=!0;return n}var co=kn;function kn(e,t,n){var a=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var h=new Int32Array(this.arrayBuffer);e=h[0],this.d=(t=h[1])+2*(n=h[2]);for(var d=0;d<this.d*this.d;d++){var g=h[3+d],v=h[3+d+1];a.push(g===v?null:h.subarray(g,v))}var w=h[3+a.length+1];this.keys=h.subarray(h[3+a.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var C=0;C<this.d*this.d;C++)a.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var k=n/t*e;this.min=-k,this.max=e+k}kn.prototype.insert=function(e,t,n,a,h){this._forEachCell(t,n,a,h,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(h)},kn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},kn.prototype._insertCell=function(e,t,n,a,h,d){this.cells[h].push(d)},kn.prototype.query=function(e,t,n,a,h){var d=this.min,g=this.max;if(e<=d&&t<=d&&g<=n&&g<=a&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(e,t,n,a,this._queryCell,v,{},h),v},kn.prototype._queryCell=function(e,t,n,a,h,d,g,v){var w=this.cells[h];if(null!==w)for(var C=this.keys,k=this.bboxes,I=0;I<w.length;I++){var P=w[I];if(void 0===g[P]){var U=4*P;(v?v(k[U+0],k[U+1],k[U+2],k[U+3]):e<=k[U+2]&&t<=k[U+3]&&n>=k[U+0]&&a>=k[U+1])?(g[P]=!0,d.push(C[P])):g[P]=!1}}},kn.prototype._forEachCell=function(e,t,n,a,h,d,g,v){for(var w=this._convertToCellCoord(e),C=this._convertToCellCoord(t),k=this._convertToCellCoord(n),I=this._convertToCellCoord(a),P=w;P<=k;P++)for(var U=C;U<=I;U++){var G=this.d*U+P;if((!v||v(this._convertFromCellCoord(P),this._convertFromCellCoord(U),this._convertFromCellCoord(P+1),this._convertFromCellCoord(U+1)))&&h.call(this,e,t,n,a,G,d,g,v))return}},kn.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},kn.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},kn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var h=new Int32Array(t+n+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var d=t,g=0;g<e.length;g++){var v=e[g];h[3+g]=d,h.set(v,d),d+=v.length}return h[3+e.length]=d,h.set(this.keys,d),h[3+e.length+1]=d+=this.keys.length,h.set(this.bboxes,d),d+=this.bboxes.length,h.buffer};const{ImageData:ho,ImageBitmap:Ns}=Pt,uo={};function _e(e,t,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),uo[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}_e("Object",Object),co.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}},co.deserialize=function(e){return new co(e.buffer)},_e("Grid",co),_e("Color",fi),_e("Error",Error),_e("ResolvedImage",cr),_e("StylePropertyFunction",Fs),_e("StyleExpression",Bl,{omit:["_evaluator"]}),_e("ZoomDependentExpression",Xo),_e("ZoomConstantExpression",Qa),_e("CompoundExpression",er,{omit:["_evaluate"]});for(const e in dr)dr[e]._classRegistryKey||_e(`Expression_${e}`,dr[e]);function ga(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function po(e){return Ns&&e instanceof Ns}function fo(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(ga(e)||po(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const n=e;return t&&t.push(n.buffer),n}if(e instanceof ho)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const a of e)n.push(fo(a,t));return n}if("object"==typeof e){const n=e.constructor,a=n._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");const h=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const d in e){if(!e.hasOwnProperty(d)||uo[a].omit.indexOf(d)>=0)continue;const g=e[d];h[d]=uo[a].shallow.indexOf(d)>=0?g:fo(g,t)}e instanceof Error&&(h.message=e.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof e)}function xs(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||ga(e)||po(e)||ArrayBuffer.isView(e)||e instanceof ho)return e;if(Array.isArray(e))return e.map(xs);if("object"==typeof e){const t=e.$name||"Object",{klass:n}=uo[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const a=Object.create(n.prototype);for(const h of Object.keys(e)){if("$name"===h)continue;const d=e[h];a[h]=uo[t].shallow.indexOf(h)>=0?d:xs(d)}return a}throw new Error("can't deserialize object of type "+typeof e)}class p{constructor(){this.first=!0}update(t,n){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const i=e=>e>=1536&&e<=1791,l=e=>e>=1872&&e<=1919,m=e=>e>=2208&&e<=2303,y=e=>e>=11904&&e<=12031,b=e=>e>=12032&&e<=12255,T=e=>e>=12272&&e<=12287,A=e=>e>=12288&&e<=12351,z=e=>e>=12352&&e<=12447,R=e=>e>=12448&&e<=12543,O=e=>e>=12544&&e<=12591,N=e=>e>=12704&&e<=12735,$=e=>e>=12736&&e<=12783,X=e=>e>=12784&&e<=12799,W=e=>e>=12800&&e<=13055,J=e=>e>=13056&&e<=13311,dt=e=>e>=13312&&e<=19903,K=e=>e>=19968&&e<=40959,lt=e=>e>=40960&&e<=42127,ot=e=>e>=42128&&e<=42191,st=e=>e>=44032&&e<=55215,at=e=>e>=63744&&e<=64255,pt=e=>e>=64336&&e<=65023,At=e=>e>=65040&&e<=65055,It=e=>e>=65072&&e<=65103,ee=e=>e>=65104&&e<=65135,qt=e=>e>=65136&&e<=65279,Yt=e=>e>=65280&&e<=65519;function Lt(e){for(const t of e)if(Ut(t.charCodeAt(0)))return!0;return!1}function Dt(e){for(const t of e)if(!Zt(t.charCodeAt(0)))return!1;return!0}function Zt(e){return!(i(e)||l(e)||m(e)||pt(e)||qt(e))}function Ut(e){return!(746!==e&&747!==e&&(e<4352||!(N(e)||O(e)||It(e)&&!(e>=65097&&e<=65103)||at(e)||J(e)||y(e)||$(e)||!(!A(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||dt(e)||K(e)||W(e)||(t=e,t>=12592&&t<=12687)||(t=>t>=43360&&t<=43391)(e)||(t=>t>=55216&&t<=55295)(e)||(t=>t>=4352&&t<=4607)(e)||st(e)||z(e)||T(e)||(t=>t>=12688&&t<=12703)(e)||b(e)||X(e)||R(e)&&12540!==e||!(!Yt(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ee(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(t=>t>=5120&&t<=5759)(e)||(t=>t>=6320&&t<=6399)(e)||At(e)||(t=>t>=19904&&t<=19967)(e)||lt(e)||ot(e))));var t}function xe(e){return!(Ut(e)||(t=e,(n=t)>=128&&n<=255&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(n=>n>=8192&&n<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(n=>n>=8448&&n<=8527)(t)||(n=>n>=8528&&n<=8591)(t)||(n=>n>=8960&&n<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(n=>n>=9216&&n<=9279)(t)&&9251!==t||(n=>n>=9280&&n<=9311)(t)||(n=>n>=9312&&n<=9471)(t)||(n=>n>=9632&&n<=9727)(t)||(n=>n>=9728&&n<=9983)(t)&&!(t>=9754&&t<=9759)||(n=>n>=11008&&n<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||A(t)||R(t)||(n=>n>=57344&&n<=63743)(t)||It(t)||ee(t)||Yt(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t,n}function Ae(e){return e>=1424&&e<=2303||pt(e)||qt(e)}function Qe(e,t){return!(!t&&Ae(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(n=e,n>=6016&&n<=6143));var n}function te(e){for(const t of e)if(Ae(t.charCodeAt(0)))return!0;return!1}const Pe="deferred",$e="loading",si="loaded";let ki=null,Ge="unavailable",ti=null;const Bi=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Ge="error"),ki&&ki(e)};function cn(){Dn.fire(new os("pluginStateChange",{pluginStatus:Ge,pluginURL:ti}))}const Dn=new Nn,fr=function(){return Ge},Ar=function(){if(Ge!==Pe||!ti)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ge=$e,cn(),ti&&ri({url:ti},e=>{e?Bi(e):(Ge=si,cn())})},hi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ge===si||null!=hi.applyArabicShaping,isLoading:()=>Ge===$e,setState(e){Ge=e.pluginStatus,ti=e.pluginURL},isParsed:()=>null!=hi.applyArabicShaping&&null!=hi.processBidirectionalText&&null!=hi.processStyledBidirectionalText,getPluginURL:()=>ti};class Ze{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new p,this.transition={},this.pitch=0)}isSupportedScript(t){return function(n,a){for(const h of n)if(!Qe(h.charCodeAt(0),a))return!1;return!0}(t,hi.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*n}}}class li{constructor(t,n){this.property=t,this.value=n,this.expression=function(a,h){if(qo(a))return new Fs(a,h);if(fa(a)){const d=jc(a,h);if("error"===d.result)throw new Error(d.value.map(g=>`${g.key}: ${g.message}`).join(", "));return d.value}{let d=a;return"string"==typeof a&&"color"===h.type&&(d=fi.parse(a)),{kind:"constant",evaluate:()=>d}}}(void 0===n?t.specification.default:n,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,n,a){return this.property.possiblyEvaluate(this,t,n,a)}}class qi{constructor(t){this.property=t,this.value=new li(t,void 0)}transitioned(t,n){return new Oi(this.property,this.value,n,Ie({},t.transition,this.transition),t.now)}untransitioned(){return new Oi(this.property,this.value,null,{},0)}}class Zn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Ni(this._values[t].value.value)}setValue(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new qi(this._values[t].property)),this._values[t].value=new li(this._values[t].property,null===n?void 0:Ni(n))}getTransition(t){return Ni(this._values[t].transition)}setTransition(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new qi(this._values[t].property)),this._values[t].transition=Ni(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);void 0!==a&&(t[n]=a);const h=this.getTransition(n);void 0!==h&&(t[`${n}-transition`]=h)}return t}transitioned(t,n){const a=new $n(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,n._values[h]);return a}untransitioned(){const t=new $n(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Oi{constructor(t,n,a,h,d){const g=h.delay||0,v=h.duration||0;d=d||0,this.property=t,this.value=n,this.begin=d+g,this.end=this.begin+v,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,n,a){const h=t.now||0,d=this.value.possiblyEvaluate(t,n,a),g=this.prior;if(g){if(h>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(h<this.begin)return g.possiblyEvaluate(t,n,a);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,a),d,Pn(v))}}return d}}class $n{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,a){const h=new Er(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].possiblyEvaluate(t,n,a);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ya{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return Ni(this._values[t].value)}setValue(t,n){this._values[t]=new li(this._values[t].property,null===n?void 0:Ni(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);void 0!==a&&(t[n]=a)}return t}possiblyEvaluate(t,n,a){const h=new Er(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].possiblyEvaluate(t,n,a);return h}}class bn{constructor(t,n,a){this.property=t,this.value=n,this.parameters=a}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,n,a,h){return this.property.evaluate(this.value,this.parameters,t,n,a,h)}}class Er{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ve{constructor(t){this.specification=t}possiblyEvaluate(t,n){return t.expression.evaluate(n)}interpolate(t,n,a){const h=ps[this.specification.type];return h?h(t,n,a):t}}class Ee{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,a,h){return new bn(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(n,null,{},a,h)}:t.expression,n)}interpolate(t,n,a){if("constant"!==t.value.kind||"constant"!==n.value.kind)return t;if(void 0===t.value.value||void 0===n.value.value)return new bn(this,{kind:"constant",value:void 0},t.parameters);const h=ps[this.specification.type];return h?new bn(this,{kind:"constant",value:h(t.value.value,n.value.value,a)},t.parameters):t}evaluate(t,n,a,h,d,g){return"constant"===t.kind?t.value:t.evaluate(n,a,h,d,g)}}class _n extends Ee{possiblyEvaluate(t,n,a,h){if(void 0===t.value)return new bn(this,{kind:"constant",value:void 0},n);if("constant"===t.expression.kind){const d=t.expression.evaluate(n,null,{},a,h),g="resolvedImage"===t.property.specification.type&&"string"!=typeof d?d.name:d,v=this._calculate(g,g,g,n);return new bn(this,{kind:"constant",value:v},n)}if("camera"===t.expression.kind){const d=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new bn(this,{kind:"constant",value:d},n)}return new bn(this,t.expression,n)}evaluate(t,n,a,h,d,g){if("source"===t.kind){const v=t.evaluate(n,a,h,d,g);return this._calculate(v,v,v,n)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},a,h),t.evaluate({zoom:Math.floor(n.zoom)},a,h),t.evaluate({zoom:Math.floor(n.zoom)+1},a,h),n):t.value}_calculate(t,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n,other:a}:{from:a,to:n,other:t}}interpolate(t){return t}}class js{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,h){if(void 0!==t.value){if("constant"===t.expression.kind){const d=t.expression.evaluate(n,null,{},a,h);return this._calculate(d,d,d,n)}return this._calculate(t.expression.evaluate(new Ze(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Ze(Math.floor(n.zoom),n)),t.expression.evaluate(new Ze(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class vs{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,h){return!!t.expression.evaluate(n,null,{},a,h)}interpolate(){return!1}}class wn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const a=t[n];a.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new li(a,void 0),d=this.defaultTransitionablePropertyValues[n]=new qi(a);this.defaultTransitioningPropertyValues[n]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}function qh(e,t){return 256*(e=pi(Math.floor(e),0,255))+pi(Math.floor(t),0,255)}_e("DataDrivenProperty",Ee),_e("DataConstantProperty",ve),_e("CrossFadedDataDrivenProperty",_n),_e("CrossFadedProperty",js),_e("ColorRampProperty",vs);const od={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ol{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Zi(e,t=1){let n=0,a=0;return{members:e.map(h=>{const d=od[h.type].BYTES_PER_ELEMENT,g=n=Hl(n,Math.max(t,d)),v=h.components||1;return a=Math.max(a,d),n+=d*v,{name:h.name,type:h.type,components:v,offset:g}}),size:Hl(n,Math.max(a,t)),alignment:t}}function Hl(e,t){return Math.ceil(e/t)*t}class mo extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const h=2*t;return this.int16[h+0]=n,this.int16[h+1]=a,t}}mo.prototype.bytesPerElement=4,_e("StructArrayLayout2i4",mo);class ll extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,a,h)}emplace(t,n,a,h,d){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=a,this.int16[g+2]=h,this.int16[g+3]=d,t}}ll.prototype.bytesPerElement=8,_e("StructArrayLayout4i8",ll);class Wh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,a,h,d,g,v)}emplace(t,n,a,h,d,g,v,w){const C=6*t,k=12*t,I=3*t;return this.int16[C+0]=n,this.int16[C+1]=a,this.uint8[k+4]=h,this.uint8[k+5]=d,this.uint8[k+6]=g,this.uint8[k+7]=v,this.float32[I+2]=w,t}}Wh.prototype.bytesPerElement=12,_e("StructArrayLayout2i4ub1f12",Wh);class bs extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){const d=3*t;return this.float32[d+0]=n,this.float32[d+1]=a,this.float32[d+2]=h,t}}bs.prototype.bytesPerElement=12,_e("StructArrayLayout3f12",bs);class Gs extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d,g,v,w,C,k){const I=this.length;return this.resize(I+1),this.emplace(I,t,n,a,h,d,g,v,w,C,k)}emplace(t,n,a,h,d,g,v,w,C,k,I){const P=10*t;return this.uint16[P+0]=n,this.uint16[P+1]=a,this.uint16[P+2]=h,this.uint16[P+3]=d,this.uint16[P+4]=g,this.uint16[P+5]=v,this.uint16[P+6]=w,this.uint16[P+7]=C,this.uint16[P+8]=k,this.uint16[P+9]=I,t}}Gs.prototype.bytesPerElement=20,_e("StructArrayLayout10ui20",Gs);class Qr extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d,g,v,w){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,a,h,d,g,v,w)}emplace(t,n,a,h,d,g,v,w,C){const k=8*t;return this.uint16[k+0]=n,this.uint16[k+1]=a,this.uint16[k+2]=h,this.uint16[k+3]=d,this.uint16[k+4]=g,this.uint16[k+5]=v,this.uint16[k+6]=w,this.uint16[k+7]=C,t}}Qr.prototype.bytesPerElement=16,_e("StructArrayLayout8ui16",Qr);class qc extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y){const nt=this.length;return this.resize(nt+1),this.emplace(nt,t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y)}emplace(t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y,nt){const ct=16*t;return this.int16[ct+0]=n,this.int16[ct+1]=a,this.int16[ct+2]=h,this.int16[ct+3]=d,this.uint16[ct+4]=g,this.uint16[ct+5]=v,this.uint16[ct+6]=w,this.uint16[ct+7]=C,this.int16[ct+8]=k,this.int16[ct+9]=I,this.int16[ct+10]=P,this.int16[ct+11]=U,this.int16[ct+12]=G,this.int16[ct+13]=H,this.int16[ct+14]=Y,this.int16[ct+15]=nt,t}}qc.prototype.bytesPerElement=32,_e("StructArrayLayout4i4ui4i4i32",qc);class Yh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Yh.prototype.bytesPerElement=4,_e("StructArrayLayout1ul4",Yh);class Xh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d,g,v,w,C,k,I,P,U){const G=this.length;return this.resize(G+1),this.emplace(G,t,n,a,h,d,g,v,w,C,k,I,P,U)}emplace(t,n,a,h,d,g,v,w,C,k,I,P,U,G){const H=20*t,Y=10*t;return this.int16[H+0]=n,this.int16[H+1]=a,this.int16[H+2]=h,this.int16[H+3]=d,this.int16[H+4]=g,this.float32[Y+3]=v,this.float32[Y+4]=w,this.float32[Y+5]=C,this.float32[Y+6]=k,this.int16[H+14]=I,this.uint32[Y+8]=P,this.uint16[H+18]=U,this.uint16[H+19]=G,t}}Xh.prototype.bytesPerElement=40,_e("StructArrayLayout5i4f1i1ul2ui40",Xh);class Zs extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,a,h,d,g,v)}emplace(t,n,a,h,d,g,v,w){const C=8*t;return this.int16[C+0]=n,this.int16[C+1]=a,this.int16[C+2]=h,this.int16[C+4]=d,this.int16[C+5]=g,this.int16[C+6]=v,this.int16[C+7]=w,t}}Zs.prototype.bytesPerElement=16,_e("StructArrayLayout3i2i2i16",Zs);class ql extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,a,h,d)}emplace(t,n,a,h,d,g){const v=4*t,w=8*t;return this.float32[v+0]=n,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[w+6]=d,this.int16[w+7]=g,t}}ql.prototype.bytesPerElement=16,_e("StructArrayLayout2f1f2i16",ql);class Kh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,a,h)}emplace(t,n,a,h,d){const g=12*t,v=3*t;return this.uint8[g+0]=n,this.uint8[g+1]=a,this.float32[v+1]=h,this.float32[v+2]=d,t}}Kh.prototype.bytesPerElement=12,_e("StructArrayLayout2ub2f12",Kh);class kr extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){const d=3*t;return this.uint16[d+0]=n,this.uint16[d+1]=a,this.uint16[d+2]=h,t}}kr.prototype.bytesPerElement=6,_e("StructArrayLayout3ui6",kr);class Jh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y,nt,ct,yt,vt,bt){const Mt=this.length;return this.resize(Mt+1),this.emplace(Mt,t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y,nt,ct,yt,vt,bt)}emplace(t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y,nt,ct,yt,vt,bt,Mt){const Vt=30*t,Ot=15*t,ne=60*t;return this.int16[Vt+0]=n,this.int16[Vt+1]=a,this.int16[Vt+2]=h,this.float32[Ot+2]=d,this.float32[Ot+3]=g,this.uint16[Vt+8]=v,this.uint16[Vt+9]=w,this.uint32[Ot+5]=C,this.uint32[Ot+6]=k,this.uint32[Ot+7]=I,this.uint16[Vt+16]=P,this.uint16[Vt+17]=U,this.uint16[Vt+18]=G,this.float32[Ot+10]=H,this.float32[Ot+11]=Y,this.uint8[ne+48]=nt,this.uint8[ne+49]=ct,this.uint8[ne+50]=yt,this.uint32[Ot+13]=vt,this.int16[Vt+28]=bt,this.uint8[ne+58]=Mt,t}}Jh.prototype.bytesPerElement=60,_e("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Jh);class _o extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y,nt,ct,yt,vt,bt,Mt,Vt,Ot,ne,Ht,Ft,Qt,Jt,$t){const pe=this.length;return this.resize(pe+1),this.emplace(pe,t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y,nt,ct,yt,vt,bt,Mt,Vt,Ot,ne,Ht,Ft,Qt,Jt,$t)}emplace(t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y,nt,ct,yt,vt,bt,Mt,Vt,Ot,ne,Ht,Ft,Qt,Jt,$t,pe){const o=38*t,s=19*t;return this.int16[o+0]=n,this.int16[o+1]=a,this.int16[o+2]=h,this.float32[s+2]=d,this.float32[s+3]=g,this.int16[o+8]=v,this.int16[o+9]=w,this.int16[o+10]=C,this.int16[o+11]=k,this.int16[o+12]=I,this.int16[o+13]=P,this.uint16[o+14]=U,this.uint16[o+15]=G,this.uint16[o+16]=H,this.uint16[o+17]=Y,this.uint16[o+18]=nt,this.uint16[o+19]=ct,this.uint16[o+20]=yt,this.uint16[o+21]=vt,this.uint16[o+22]=bt,this.uint16[o+23]=Mt,this.uint16[o+24]=Vt,this.uint16[o+25]=Ot,this.uint16[o+26]=ne,this.uint16[o+27]=Ht,this.uint16[o+28]=Ft,this.uint32[s+15]=Qt,this.float32[s+16]=Jt,this.float32[s+17]=$t,this.float32[s+18]=pe,t}}_o.prototype.bytesPerElement=76,_e("StructArrayLayout3i2f6i15ui1ul3f76",_o);class Wl extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Wl.prototype.bytesPerElement=4,_e("StructArrayLayout1f4",Wl);class Qh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){const d=3*t;return this.int16[d+0]=n,this.int16[d+1]=a,this.int16[d+2]=h,t}}Qh.prototype.bytesPerElement=6,_e("StructArrayLayout3i6",Qh);class Yl extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h,d,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,a,h,d,g,v)}emplace(t,n,a,h,d,g,v,w){const C=7*t;return this.float32[C+0]=n,this.float32[C+1]=a,this.float32[C+2]=h,this.float32[C+3]=d,this.float32[C+4]=g,this.float32[C+5]=v,this.float32[C+6]=w,t}}Yl.prototype.bytesPerElement=28,_e("StructArrayLayout7f28",Yl);class Wc extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,a,h)}emplace(t,n,a,h,d){const g=6*t;return this.uint32[3*t+0]=n,this.uint16[g+2]=a,this.uint16[g+3]=h,this.uint16[g+4]=d,t}}Wc.prototype.bytesPerElement=12,_e("StructArrayLayout1ul3ui12",Wc);class xa extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const h=2*t;return this.uint16[h+0]=n,this.uint16[h+1]=a,t}}xa.prototype.bytesPerElement=4,_e("StructArrayLayout2ui4",xa);class Yc extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Yc.prototype.bytesPerElement=2,_e("StructArrayLayout1ui2",Yc);class cl extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const h=2*t;return this.float32[h+0]=n,this.float32[h+1]=a,t}}cl.prototype.bytesPerElement=8,_e("StructArrayLayout2f8",cl);class tu extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,a,h)}emplace(t,n,a,h,d){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=a,this.float32[g+2]=h,this.float32[g+3]=d,t}}tu.prototype.bytesPerElement=16,_e("StructArrayLayout4f16",tu);class ld extends ol{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ld.prototype.size=40;class eu extends Xh{get(t){return new ld(this,t)}}_e("CollisionBoxArray",eu);class cd extends ol{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}cd.prototype.size=60;class hd extends Jh{get(t){return new cd(this,t)}}_e("PlacedSymbolArray",hd);class hl extends ol{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}hl.prototype.size=76;class iu extends _o{get(t){return new hl(this,t)}}_e("SymbolInstanceArray",iu);class nu extends Wl{getoffsetX(t){return this.float32[1*t+0]}}_e("GlyphOffsetArray",nu);class ru extends Qh{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}_e("SymbolLineVertexArray",ru);class $s extends ol{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}$s.prototype.size=12;class ud extends Wc{get(t){return new $s(this,t)}}_e("FeatureIndexArray",ud);class dd extends ol{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}dd.prototype.size=4;class pd extends xa{get(t){return new dd(this,t)}}_e("FillExtrusionCentroidArray",pd);const su=Zi([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Zp=Zi([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var fd=wr(function(e){e.exports=function(t,n){var a,h,d,g,v,w,C,k;for(h=t.length-(a=3&t.length),d=n,v=3432918353,w=461845907,k=0;k<h;)C=255&t.charCodeAt(k)|(255&t.charCodeAt(++k))<<8|(255&t.charCodeAt(++k))<<16|(255&t.charCodeAt(++k))<<24,++k,d=27492+(65535&(g=5*(65535&(d=(d^=C=(65535&(C=(C=(65535&C)*v+(((C>>>16)*v&65535)<<16)&4294967295)<<15|C>>>17))*w+(((C>>>16)*w&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(C=0,a){case 3:C^=(255&t.charCodeAt(k+2))<<16;case 2:C^=(255&t.charCodeAt(k+1))<<8;case 1:d^=C=(65535&(C=(C=(65535&(C^=255&t.charCodeAt(k)))*v+(((C>>>16)*v&65535)<<16)&4294967295)<<15|C>>>17))*w+(((C>>>16)*w&65535)<<16)&4294967295}return d^=t.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}}),au=wr(function(e){e.exports=function(t,n){for(var a,h=t.length,d=n^h,g=0;h>=4;)a=1540483477*(65535&(a=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:d^=(255&t.charCodeAt(g+2))<<16;case 2:d^=(255&t.charCodeAt(g+1))<<8;case 1:d=1540483477*(65535&(d^=255&t.charCodeAt(g)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}}),Hs=fd,$p=au;Hs.murmur3=fd,Hs.murmur2=$p;class Xc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,a,h){this.ids.push(md(t)),this.positions.push(n,a,h)}getPositions(t){const n=md(t);let a=0,h=this.ids.length-1;for(;a<h;){const g=a+h>>1;this.ids[g]>=n?h=g:a=g+1}const d=[];for(;this.ids[a]===n;)d.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return d}static serialize(t,n){const a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Kc(a,h,0,a.length-1),n&&n.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){const n=new Xc;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function md(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Hs(String(e))}function Kc(e,t,n,a){for(;n<a;){const h=e[n+a>>1];let d=n-1,g=a+1;for(;;){do{d++}while(e[d]<h);do{g--}while(e[g]>h);if(d>=g)break;Xl(e,d,g),Xl(t,3*d,3*g),Xl(t,3*d+1,3*g+1),Xl(t,3*d+2,3*g+2)}g-n<a-g?(Kc(e,t,n,g),n=g+1):(Kc(e,t,g+1,a),a=g)}}function Xl(e,t,n){const a=e[t];e[t]=e[n],e[n]=a}_e("FeaturePositionMap",Xc);class qs{constructor(t,n){this.gl=t.gl,this.location=n}}class Jc extends qs{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class _d extends qs{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class gd extends qs{constructor(t,n){super(t,n),this.current=fi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Hp=new Float32Array(16),qp=new Float32Array(9),yd=new Float32Array(4);function ou(e){return[qh(255*e.r,255*e.g),qh(255*e.b,255*e.a)]}class Kl{constructor(t,n,a){this.value=t,this.uniformNames=n.map(h=>`u_${h}`),this.type=a}setUniform(t,n,a){t.set(a.constantOr(this.value))}getBinding(t,n,a){return"color"===this.type?new gd(t,n):new Jc(t,n)}}class va{constructor(t,n){this.uniformNames=n.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tl.concat(n.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,n,a,h){const d="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;d&&t.set(d)}getBinding(t,n,a){return"u_pattern_from"===a||"u_pattern_to"===a||"u_dash_from"===a||"u_dash_to"===a?new _d(t,n):new Jc(t,n)}}class Ws{constructor(t,n,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:"color"===a?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,n,a,h,d,g){const v=this.paintVertexArray.length,w=this.expression.evaluate(new Ze(0),n,{},d,h,g);this.paintVertexArray.resize(t),this._setPaintValue(v,t,w)}updatePaintArray(t,n,a,h,d){const g=this.expression.evaluate({zoom:0},a,h,void 0,d);this._setPaintValue(t,n,g)}_setPaintValue(t,n,a){if("color"===this.type){const h=ou(a);for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,h[0],h[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ts{constructor(t,n,a,h,d,g){this.expression=t,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===a?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,n,a,h,d,g){const v=this.expression.evaluate(new Ze(this.zoom),n,{},d,h,g),w=this.expression.evaluate(new Ze(this.zoom+1),n,{},d,h,g),C=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(C,t,v,w)}updatePaintArray(t,n,a,h,d){const g=this.expression.evaluate({zoom:this.zoom},a,h,void 0,d),v=this.expression.evaluate({zoom:this.zoom+1},a,h,void 0,d);this._setPaintValue(t,n,g,v)}_setPaintValue(t,n,a,h){if("color"===this.type){const d=ou(a),g=ou(h);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,d[0],d[1],g[0],g[1])}else{for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=pi(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,n,a){return new Jc(t,n)}}class ba{constructor(t,n,a,h,d,g,v){this.expression=t,this.type=a,this.useIntegerZoom=h,this.zoom=d,this.layerId=v,this.paintVertexAttributes=("array"===a?Zp:su).members;for(let w=0;w<n.length;++w);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,n,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(t,n,a,h,d,g){this._setPaintValues(t,n,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,n,a,h){if(!h||!a)return;const{min:d,mid:g,max:v}=a,w=h[d],C=h[g],k=h[v];if(w&&C&&k)for(let I=t;I<n;I++)this._setPaintValue(this.zoomInPaintVertexArray,I,C,w),this._setPaintValue(this.zoomOutPaintVertexArray,I,C,k)}_setPaintValue(t,n,a,h){t.emplace(n,a.tl[0],a.tl[1],a.br[0],a.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],a.pixelRatio,h.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ys{constructor(t,n,a=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const d in t.paint._values){if(!a(d))continue;const g=t.paint.get(d);if(!(g instanceof bn&&Os(g.property.specification)))continue;const v=xd(d,t.type),w=g.value,C=g.property.specification.type,k=g.property.useIntegerZoom,I=g.property.specification["property-type"],P="cross-faded"===I||"cross-faded-data-driven"===I,U="line-dasharray"===String(d)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==w.kind||U)if("source"===w.kind||U||P){const G=Qc(d,C,"source");this.binders[d]=P?new ba(w,v,C,k,n,G,t.id):new Ws(w,v,C,G),h.push(`/a_${d}`)}else{const G=Qc(d,C,"composite");this.binders[d]=new ts(w,v,C,k,n,G),h.push(`/z_${d}`)}else this.binders[d]=P?new va(w.value,v):new Kl(w.value,v,C),h.push(`/u_${d}`)}this.cacheKey=h.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ws||n instanceof ts?n.maxValue:0}populatePaintArrays(t,n,a,h,d,g){for(const v in this.binders){const w=this.binders[v];(w instanceof Ws||w instanceof ts||w instanceof ba)&&w.populatePaintArray(t,n,a,h,d,g)}}setConstantPatternPositions(t,n){for(const a in this.binders){const h=this.binders[a];h instanceof va&&h.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,a,h,d,g){let v=!1;for(const w in t){const C=n.getPositions(w);for(const k of C){const I=a.feature(k.index);for(const P in this.binders){const U=this.binders[P];if((U instanceof Ws||U instanceof ts||U instanceof ba)&&!0===U.expression.isStateDependent){const G=h.paint.get(P);U.expression=G.value,U.updatePaintArray(k.start,k.end,I,t[w],d,g),v=!0}}}}return v}defines(){const t=[];for(const n in this.binders){const a=this.binders[n];(a instanceof Kl||a instanceof va)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Ws||a instanceof ts||a instanceof ba)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Kl||a instanceof va||a instanceof ts)for(const h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const a=[];for(const h in this.binders){const d=this.binders[h];if(d instanceof Kl||d instanceof va||d instanceof ts)for(const g of d.uniformNames)if(n[g]){const v=d.getBinding(t,n[g],g);a.push({name:g,property:h,binding:v})}}return a}setUniforms(t,n,a,h){for(const{name:d,property:g,binding:v}of n)this.binders[g].setUniform(v,h,a.get(g),d)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const a=this.binders[n];if(t&&a instanceof ba){const h=2===t.fromScale?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof Ws||a instanceof ts)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const n in this.binders){const a=this.binders[n];(a instanceof Ws||a instanceof ts||a instanceof ba)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ws||n instanceof ts||n instanceof ba)&&n.destroy()}}}class go{constructor(t,n,a=(()=>!0)){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Ys(h,n,a);this.needsUpload=!1,this._featureMap=new Xc,this._bufferOffset=0}populatePaintArrays(t,n,a,h,d,g,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,n,h,d,g,v);void 0!==n.id&&this._featureMap.add(n.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,a,h,d){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,n,g,h,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Wp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function xd(e,t){return Wp[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Yp={"line-pattern":{source:Gs,composite:Gs},"fill-pattern":{source:Gs,composite:Gs},"fill-extrusion-pattern":{source:Gs,composite:Gs},"line-dasharray":{source:Qr,composite:Qr}},vd={color:{source:cl,composite:tu},number:{source:Wl,composite:cl}};function Qc(e,t,n){const a=Yp[e];return a&&a[n]||vd[t][n]}_e("ConstantBinder",Kl),_e("CrossFadedConstantBinder",va),_e("SourceExpressionBinder",Ws),_e("CrossFadedCompositeBinder",ba),_e("CompositeExpressionBinder",ts),_e("ProgramConfiguration",Ys,{omit:["_buffers"]}),_e("ProgramConfigurationSet",go);const Jl="-transition";class es extends Nn{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new ya(n.layout)),n.paint)){this._transitionablePaint=new Zn(n.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Er(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,a={}){null!=n&&this._validate(Hh,`layers.${this.id}.layout.${t}`,t,n,a)||("visibility"!==t?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return Pi(t,Jl)?this._transitionablePaint.getTransition(t.slice(0,-Jl.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,a={}){if(null!=n&&this._validate(al,`layers.${this.id}.paint.${t}`,t,n,a))return!1;if(Pi(t,Jl))return this._transitionablePaint.setTransition(t.slice(0,-Jl.length),n||void 0),!1;{const h=this._transitionablePaint._values[t],d="cross-faded-data-driven"===h.property.specification["property-type"],g=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||g||d||this._handleOverridablePaintPropertyUpdate(t,v,w)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,n,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ui(t,(n,a)=>!(void 0===n||"layout"===a&&!Object.keys(n).length||"paint"===a&&!Object.keys(n).length))}_validate(t,n,a,h,d={}){return(!d||!1!==d.validate)&&lo(this,t.call(Jr,{key:n,layerType:this.type,objectKey:a,value:h,styleSpec:Rt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof bn&&Os(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ro(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Xp=Zi([{name:"a_pos",components:2,type:"Int16"}],4),{members:bd}=Xp;class tn{constructor(t=[]){this.segments=t}prepareSegment(t,n,a,h){let d=this.segments[this.segments.length-1];return t>tn.MAX_VERTEX_ARRAY_LENGTH&&bi(`Max vertices per segment is ${tn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!d||d.vertexLength+t>tn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==h)&&(d={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},void 0!==h&&(d.sortKey=h),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,a,h){return new tn([{vertexOffset:t,primitiveOffset:n,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}tn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_e("SegmentVector",tn);var ai=8192;class Xs{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Mi?new Mi(t.lng,t.lat):Mi.convert(t),this}setSouthWest(t){return this._sw=t instanceof Mi?new Mi(t.lng,t.lat):Mi.convert(t),this}extend(t){const n=this._sw,a=this._ne;let h,d;if(t instanceof Mi)h=t,d=t;else{if(!(t instanceof Xs))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Xs.convert(t)):this.extend(Mi.convert(t)):this;if(h=t._sw,d=t._ne,!h||!d)return this}return n||a?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new Mi(h.lng,h.lat),this._ne=new Mi(d.lng,d.lat)),this}getCenter(){return new Mi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Mi(this.getWest(),this.getNorth())}getSouthEast(){return new Mi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:a}=Mi.convert(t);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&h}static convert(t){return!t||t instanceof Xs?t:new Xs(t)}}const lu=6371008.8;class Mi{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Mi(zn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,a=this.lat*n,h=t.lat*n,d=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*n);return lu*Math.acos(Math.min(d,1))}toBounds(t=0){const n=360*t/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new Xs(new Mi(this.lng-a,this.lat-n),new Mi(this.lng+a,this.lat+n))}static convert(t){if(t instanceof Mi)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Mi(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Mi(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const wd=2*Math.PI*lu;function cu(e){return wd*Math.cos(e*Math.PI/180)}function ul(e){return(180+e)/360}function yo(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Dr(e,t){return e/cu(t)}function Ks(e){return 360*e-180}function Ir(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Ql(e,t){return e*cu(Ir(t))}const ws=85.051129;class wa{constructor(t,n,a=0){this.x=+t,this.y=+n,this.z=+a}static fromLngLat(t,n=0){const a=Mi.convert(t);return new wa(ul(a.lng),yo(a.lat),Dr(n,a.lat))}toLngLat(){return new Mi(Ks(this.x),Ir(this.y))}toAltitude(){return Ql(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/wd*(t=Ir(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ur(e,t,n,a,h,d,g,v,w){const C=(t+a)/2,k=(n+h)/2,I=new jt(C,k);v(I),function(P,U,G,H,Y,nt){const ct=G-Y,yt=H-nt;return Math.abs((H-U)*ct-(G-P)*yt)/Math.hypot(ct,yt)}(I.x,I.y,d.x,d.y,g.x,g.y)>=w?(Ur(e,t,n,C,k,d,I,v,w),Ur(e,C,k,a,h,I,g,v,w)):e.push(g)}function Js(e,t,n){const a=[];let h,d,g;for(const v of e){const{x:w,y:C}=v;t(v),g?Ur(a,h,d,w,C,g,v,t,n):a.push(v),h=w,d=C,g=v}return a}const hu=Math.pow(2,14)-1,uu=-hu-1;function Kp(e,t){const n=Math.round(e.x*t),a=Math.round(e.y*t);return e.x=pi(n,uu,hu),e.y=pi(a,uu,hu),(n<e.x||n>e.x+1||a<e.y||a>e.y+1)&&bi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Qs(e,t,n){const a=e.loadGeometry(),h=e.extent,d=ai/h;if(t&&n&&n.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:v,x:w,y:C,projection:k}=n,I=P=>{const U=Ks((t.x+P.x/h)/g),G=Ir((t.y+P.y/h)/g),H=k.project(U,G);P.x=(H.x*v-w)*h,P.y=(H.y*v-C)*h};for(let P=0;P<a.length;P++)if(1!==e.type)a[P]=Js(a[P],I,1);else{const U=[];for(const G of a[P])G.x<0||G.x>=h||G.y<0||G.y>=h||(I(G),U.push(G));a[P]=U}}for(const g of a)for(const v of g)Kp(v,d);return a}function xo(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Qs(e):[]}}function tc(e,t,n,a,h){e.emplaceBack(2*t+(a+1)/2,2*n+(h+1)/2)}class du{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new mo,this.indexArray=new kr,this.segments=new tn,this.programConfigurations=new go(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a,h){const d=this.layers[0],g=[];let v=null;"circle"===d.type&&(v=d.layout.get("circle-sort-key"));for(const{feature:w,id:C,index:k,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,U=xo(w,P);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),U,a))continue;const G=v?v.evaluate(U,{},a):void 0,H={id:C,properties:w.properties,type:w.type,sourceLayerIndex:I,index:k,geometry:P?U.geometry:Qs(w,a,h),patterns:{},sortKey:G};g.push(H)}v&&g.sort((w,C)=>w.sortKey-C.sortKey);for(const w of g){const{geometry:C,index:k,sourceLayerIndex:I}=w,P=t[k].feature;this.addFeature(w,C,k,n.availableImages,a),n.featureIndex.insert(P,C,k,I,this.index)}}update(t,n,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,a,h,d){for(const g of n)for(const v of g){const w=v.x,C=v.y;if(w<0||w>=ai||C<0||C>=ai)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),I=k.vertexLength;tc(this.layoutVertexArray,w,C,-1,-1),tc(this.layoutVertexArray,w,C,1,-1),tc(this.layoutVertexArray,w,C,1,1),tc(this.layoutVertexArray,w,C,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h,d)}}function Md(e,t){for(let n=0;n<e.length;n++)if(dl(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(dl(e,t[n]))return!0;return!!pu(e,t)}function Td(e,t,n){return!!dl(e,t)||!!th(t,e,n)}function ec(e,t){if(1===e.length)return Ad(t,e[0]);for(let n=0;n<t.length;n++){const a=t[n];for(let h=0;h<a.length;h++)if(dl(e,a[h]))return!0}for(let n=0;n<e.length;n++)if(Ad(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(pu(e,t[n]))return!0;return!1}function Cd(e,t,n){if(e.length>1){if(pu(e,t))return!0;for(let a=0;a<t.length;a++)if(th(t[a],e,n))return!0}for(let a=0;a<e.length;a++)if(th(e[a],t,n))return!0;return!1}function pu(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const a=e[n],h=e[n+1];for(let d=0;d<t.length-1;d++)if(Sd(a,h,t[d],t[d+1]))return!0}return!1}function Sd(e,t,n,a){return mn(e,n,a)!==mn(t,n,a)&&mn(e,t,n)!==mn(e,t,a)}function th(e,t,n){const a=n*n;if(1===t.length)return e.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(fu(e,t[h-1],t[h])<a)return!0;return!1}function fu(e,t,n){const a=t.distSqr(n);if(0===a)return e.distSqr(t);const h=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/a;return e.distSqr(h<0?t:h>1?n:n.sub(t)._mult(h)._add(t))}function Ad(e,t){let n,a,h,d=!1;for(let g=0;g<e.length;g++){n=e[g];for(let v=0,w=n.length-1;v<n.length;w=v++)a=n[v],h=n[w],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(d=!d)}return d}function dl(e,t){let n=!1;for(let a=0,h=e.length-1;a<e.length;h=a++){const d=e[a],g=e[h];d.y>t.y!=g.y>t.y&&t.x<(g.x-d.x)*(t.y-d.y)/(g.y-d.y)+d.x&&(n=!n)}return n}function Ed(e,t,n,a,h){for(const g of e)if(t<=g.x&&n<=g.y&&a>=g.x&&h>=g.y)return!0;const d=[new jt(t,n),new jt(t,h),new jt(a,h),new jt(a,n)];if(e.length>2)for(const g of d)if(dl(e,g))return!0;for(let g=0;g<e.length-1;g++)if(Jp(e[g],e[g+1],d))return!0;return!1}function Jp(e,t,n){const a=n[0],h=n[2];if(e.x<a.x&&t.x<a.x||e.x>h.x&&t.x>h.x||e.y<a.y&&t.y<a.y||e.y>h.y&&t.y>h.y)return!1;const d=mn(e,t,n[0]);return d!==mn(e,t,n[1])||d!==mn(e,t,n[2])||d!==mn(e,t,n[3])}function Ms(e,t,n){const a=t.paint.get(e).value;return"constant"===a.kind?a.value:n.programConfigurations.get(t.id).getMaxValue(e)}function eh(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function mu(e,t,n,a,h){if(!t[0]&&!t[1])return e;const d=jt.convert(t)._mult(h);"viewport"===n&&d._rotate(-a);const g=[];for(let v=0;v<e.length;v++)g.push(e[v].sub(d));return g}function ic(e,t,n,a){const h=jt.convert(e)._mult(a);return"viewport"===t&&h._rotate(-n),h}_e("CircleBucket",du,{omit:["layers"]});const ih=new wn({"circle-sort-key":new Ee(Rt.layout_circle["circle-sort-key"])});var kd={paint:new wn({"circle-radius":new Ee(Rt.paint_circle["circle-radius"]),"circle-color":new Ee(Rt.paint_circle["circle-color"]),"circle-blur":new Ee(Rt.paint_circle["circle-blur"]),"circle-opacity":new Ee(Rt.paint_circle["circle-opacity"]),"circle-translate":new ve(Rt.paint_circle["circle-translate"]),"circle-translate-anchor":new ve(Rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ve(Rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ve(Rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ee(Rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ee(Rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ee(Rt.paint_circle["circle-stroke-opacity"])}),layout:ih};class _u{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,a,h){const d=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const C=Wn([],w,t),k=1/C[3]/n*d;return(I=C)[0]=(P=C)[0]*(U=[k,k,h?1/C[3]:k,k])[0],I[1]=P[1]*U[1],I[2]=P[2]*U[2],I[3]=P[3]*U[3],I;var I,P,U}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const C=qn([],Mn([],Rr([],g[w[0]],g[w[1]]),Rr([],g[w[2]],g[w[1]]))),k=-Ki(C,g[w[1]]);return C.concat(k)});return new _u(g,v)}}class Pr{constructor(t,n){this.min=t,this.max=n,this.center=nn([],di([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],a=vi(this.min),h=vi(this.max);for(let d=0;d<n.length;d++)a[d]=n[d]?this.min[d]:this.center[d],h[d]=n[d]?this.center[d]:this.max[d];return h[2]=this.max[2],new Pr(a,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,n=this.max;return[[t[0],t[1],t[2]],[n[0],t[1],t[2]],[n[0],n[1],t[2]],[t[0],n[1],t[2]],[t[0],t[1],n[2]],[n[0],t[1],n[2]],[n[0],n[1],n[2]],[t[0],n[1],n[2]]]}intersects(t){const n=this.getCorners();let a=!0;for(let h=0;h<t.planes.length;h++){const d=t.planes[h];let g=0;for(let v=0;v<n.length;v++)g+=Ki(d,n[v])+d[3]>=0;if(0===g)return 0;g!==n.length&&(a=!1)}if(a)return 2;for(let h=0;h<3;h++){let d=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let v=0;v<t.points.length;v++){const w=t.points[v][h]-this.min[h];d=Math.min(d,w),g=Math.max(g,w)}if(g<0||d>this.max[h]-this.min[h])return 0}return 1}}function nh(e,t,n,a,h,d,g,v,w){if(d&&e.queryGeometry.isAboveHorizon)return!1;d&&(w*=e.pixelToTileUnitsFactor);for(const C of t)for(const k of C){const I=k.add(v),P=h&&n.elevation?n.elevation.exaggeration()*h.getElevationAt(I.x,I.y,!0):0,U=d?I:Qp(I,P,a),G=d?e.tilespaceRays.map(Y=>ef(Y,P)):e.queryGeometry.screenGeometry,H=Wn([],[k.x,k.y,P,1],a);if(!g&&d?w*=H[3]/n.cameraToCenterDistance:g&&!d&&(w*=n.cameraToCenterDistance/H[3]),Td(G,U,w))return!0}return!1}function Qp(e,t,n){const a=Wn([],[e.x,e.y,t,1],n);return new jt(a[0]/a[3],a[1]/a[3])}const gu=we(0,0,0),tf=we(0,0,1);function ef(e,t){const n=De();return gu[2]=t,e.intersectsPlane(gu,tf,n),new jt(n[0],n[1])}class Dd extends du{}function yu(e,{width:t,height:n},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*n*a)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*n*a);return e.width=t,e.height=n,e.data=h,e}function Id(e,{width:t,height:n},a){if(t===e.width&&n===e.height)return;const h=yu({},{width:t,height:n},a);xu(e,h,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,n)},a),e.width=t,e.height=n,e.data=h.data}function xu(e,t,n,a,h,d){if(0===h.width||0===h.height)return t;if(h.width>e.width||h.height>e.height||n.x>e.width-h.width||n.y>e.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=e.data,v=t.data;for(let w=0;w<h.height;w++){const C=((n.y+w)*e.width+n.x)*d,k=((a.y+w)*t.width+a.x)*d;for(let I=0;I<h.width*d;I++)v[k+I]=g[C+I]}return t}_e("HeatmapBucket",Dd,{omit:["layers"]});class Ma{constructor(t,n){yu(this,t,1,n)}resize(t){Id(this,t,1)}clone(){return new Ma({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,h,d){xu(t,n,a,h,d,1)}}class mr{constructor(t,n){yu(this,t,4,n)}resize(t){Id(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new mr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,h,d){xu(t,n,a,h,d,4)}}_e("AlphaImage",Ma),_e("RGBAImage",mr);var nf={paint:new wn({"heatmap-radius":new Ee(Rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ee(Rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ve(Rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vs(Rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ve(Rt.paint_heatmap["heatmap-opacity"])})};function vu(e){const t={},n=e.resolution||256,a=e.clips?e.clips.length:1,h=e.image||new mr({width:n,height:a}),d=(g,v,w)=>{t[e.evaluationKey]=w;const C=e.expression.evaluate(t);h.data[g+v+0]=Math.floor(255*C.r/C.a),h.data[g+v+1]=Math.floor(255*C.g/C.a),h.data[g+v+2]=Math.floor(255*C.b/C.a),h.data[g+v+3]=Math.floor(255*C.a)};if(e.clips)for(let g=0,v=0;g<a;++g,v+=4*n)for(let w=0,C=0;w<n;w++,C+=4){const k=w/(n-1),{start:I,end:P}=e.clips[g];d(v,C,I*(1-k)+P*k)}else for(let g=0,v=0;g<n;g++,v+=4)d(0,v,g/(n-1));return h}var pl={paint:new wn({"hillshade-illumination-direction":new ve(Rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ve(Rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ve(Rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ve(Rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ve(Rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ve(Rt.paint_hillshade["hillshade-accent-color"])})};const rh=Zi([{name:"a_pos",components:2,type:"Int16"}],4),{members:_r}=rh;var sh=nc,Pd=nc;function nc(e,t,n){n=n||2;var a,h,d,g,v,w,C,k=t&&t.length,I=k?t[0]*n:e.length,P=zd(e,0,I,n,!0),U=[];if(!P||P.next===P.prev)return U;if(k&&(P=function(H,Y,nt,ct){var yt,vt,bt,Mt=[];for(yt=0,vt=Y.length;yt<vt;yt++)(bt=zd(H,Y[yt]*ct,yt<vt-1?Y[yt+1]*ct:H.length,ct,!1))===bt.next&&(bt.steiner=!0),Mt.push(af(bt));for(Mt.sort(oh),yt=0;yt<Mt.length;yt++)nt=Ta(nt=sf(Mt[yt],nt),nt.next);return nt}(e,t,P,n)),e.length>80*n){a=d=e[0],h=g=e[1];for(var G=n;G<I;G+=n)(v=e[G])<a&&(a=v),(w=e[G+1])<h&&(h=w),v>d&&(d=v),w>g&&(g=w);C=0!==(C=Math.max(d-a,g-h))?1/C:0}return fl(P,U,n,a,h,C),U}function zd(e,t,n,a,h){var d,g;if(h===Tu(e,t,n,a)>0)for(d=t;d<n;d+=a)g=Od(d,e[d],e[d+1],g);else for(d=n-a;d>=t;d-=a)g=Od(d,e[d],e[d+1],g);return g&&lh(g,g.next)&&(ac(g),g=g.next),g}function Ta(e,t){if(!e)return e;t||(t=e);var n,a=e;do{if(n=!1,a.steiner||!lh(a,a.next)&&0!==Wi(a.prev,a,a.next))a=a.next;else{if(ac(a),(a=t=a.prev)===a.next)break;n=!0}}while(n||a!==t);return t}function fl(e,t,n,a,h,d,g){if(e){!g&&d&&function(k,I,P,U){var G=k;do{null===G.z&&(G.z=wu(G.x,G.y,I,P,U)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next}while(G!==k);G.prevZ.nextZ=null,G.prevZ=null,function(H){var Y,nt,ct,yt,vt,bt,Mt,Vt,Ot=1;do{for(nt=H,H=null,vt=null,bt=0;nt;){for(bt++,ct=nt,Mt=0,Y=0;Y<Ot&&(Mt++,ct=ct.nextZ);Y++);for(Vt=Ot;Mt>0||Vt>0&&ct;)0!==Mt&&(0===Vt||!ct||nt.z<=ct.z)?(yt=nt,nt=nt.nextZ,Mt--):(yt=ct,ct=ct.nextZ,Vt--),vt?vt.nextZ=yt:H=yt,yt.prevZ=vt,vt=yt;nt=ct}vt.nextZ=null,Ot*=2}while(bt>1)}(G)}(e,a,h,d);for(var v,w,C=e;e.prev!==e.next;)if(v=e.prev,w=e.next,d?Rd(e,a,h,d):rf(e))t.push(v.i/n),t.push(e.i/n),t.push(w.i/n),ac(e),e=w.next,C=w.next;else if((e=w)===C){g?1===g?fl(e=bu(Ta(e),t,n),t,n,a,h,d,2):2===g&&ah(e,t,n,a,h,d):fl(Ta(e),t,n,a,h,d,1);break}}}function rf(e){var t=e.prev,n=e,a=e.next;if(Wi(t,n,a)>=0)return!1;for(var h=e.next.next;h!==e.prev;){if(ml(t.x,t.y,n.x,n.y,a.x,a.y,h.x,h.y)&&Wi(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function Rd(e,t,n,a){var h=e.prev,d=e,g=e.next;if(Wi(h,d,g)>=0)return!1;for(var v=h.x>d.x?h.x>g.x?h.x:g.x:d.x>g.x?d.x:g.x,w=h.y>d.y?h.y>g.y?h.y:g.y:d.y>g.y?d.y:g.y,C=wu(h.x<d.x?h.x<g.x?h.x:g.x:d.x<g.x?d.x:g.x,h.y<d.y?h.y<g.y?h.y:g.y:d.y<g.y?d.y:g.y,t,n,a),k=wu(v,w,t,n,a),I=e.prevZ,P=e.nextZ;I&&I.z>=C&&P&&P.z<=k;){if(I!==e.prev&&I!==e.next&&ml(h.x,h.y,d.x,d.y,g.x,g.y,I.x,I.y)&&Wi(I.prev,I,I.next)>=0||(I=I.prevZ,P!==e.prev&&P!==e.next&&ml(h.x,h.y,d.x,d.y,g.x,g.y,P.x,P.y)&&Wi(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;I&&I.z>=C;){if(I!==e.prev&&I!==e.next&&ml(h.x,h.y,d.x,d.y,g.x,g.y,I.x,I.y)&&Wi(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;P&&P.z<=k;){if(P!==e.prev&&P!==e.next&&ml(h.x,h.y,d.x,d.y,g.x,g.y,P.x,P.y)&&Wi(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function bu(e,t,n){var a=e;do{var h=a.prev,d=a.next.next;!lh(h,d)&&rc(h,a,a.next,d)&&sc(h,d)&&sc(d,h)&&(t.push(h.i/n),t.push(a.i/n),t.push(d.i/n),ac(a),ac(a.next),a=e=d),a=a.next}while(a!==e);return Ta(a)}function ah(e,t,n,a,h,d){var g=e;do{for(var v=g.next.next;v!==g.prev;){if(g.i!==v.i&&of(g,v)){var w=Ld(g,v);return g=Ta(g,g.next),w=Ta(w,w.next),fl(g,t,n,a,h,d),void fl(w,t,n,a,h,d)}v=v.next}g=g.next}while(g!==e)}function oh(e,t){return e.x-t.x}function sf(e,t){var n=function(d,g){var v,w=g,C=d.x,k=d.y,I=-1/0;do{if(k<=w.y&&k>=w.next.y&&w.next.y!==w.y){var P=w.x+(k-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(P<=C&&P>I){if(I=P,P===C){if(k===w.y)return w;if(k===w.next.y)return w.next}v=w.x<w.next.x?w:w.next}}w=w.next}while(w!==g);if(!v)return null;if(C===I)return v;var U,G=v,H=v.x,Y=v.y,nt=1/0;w=v;do{C>=w.x&&w.x>=H&&C!==w.x&&ml(k<Y?C:I,k,H,Y,k<Y?I:C,k,w.x,w.y)&&(U=Math.abs(k-w.y)/(C-w.x),sc(w,d)&&(U<nt||U===nt&&(w.x>v.x||w.x===v.x&&zm(v,w)))&&(v=w,nt=U)),w=w.next}while(w!==G);return v}(e,t);if(!n)return t;var a=Ld(n,e),h=Ta(n,n.next);return Ta(a,a.next),t===n?h:t}function zm(e,t){return Wi(e.prev,e,t.prev)<0&&Wi(t.next,e,e.next)<0}function wu(e,t,n,a,h){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*h)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-a)*h)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function af(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function ml(e,t,n,a,h,d,g,v){return(h-g)*(t-v)-(e-g)*(d-v)>=0&&(e-g)*(a-v)-(n-g)*(t-v)>=0&&(n-g)*(d-v)-(h-g)*(a-v)>=0}function of(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(n,a){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==a.i&&h.next.i!==a.i&&rc(h,h.next,n,a))return!0;h=h.next}while(h!==n);return!1}(e,t)&&(sc(e,t)&&sc(t,e)&&function(n,a){var h=n,d=!1,g=(n.x+a.x)/2,v=(n.y+a.y)/2;do{h.y>v!=h.next.y>v&&h.next.y!==h.y&&g<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(d=!d),h=h.next}while(h!==n);return d}(e,t)&&(Wi(e.prev,e,t.prev)||Wi(e,t.prev,t))||lh(e,t)&&Wi(e.prev,e,e.next)>0&&Wi(t.prev,t,t.next)>0)}function Wi(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function lh(e,t){return e.x===t.x&&e.y===t.y}function rc(e,t,n,a){var h=hh(Wi(e,t,n)),d=hh(Wi(e,t,a)),g=hh(Wi(n,a,e)),v=hh(Wi(n,a,t));return h!==d&&g!==v||!(0!==h||!ch(e,n,t))||!(0!==d||!ch(e,a,t))||!(0!==g||!ch(n,e,a))||!(0!==v||!ch(n,t,a))}function ch(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function hh(e){return e>0?1:e<0?-1:0}function sc(e,t){return Wi(e.prev,e,e.next)<0?Wi(e,t,e.next)>=0&&Wi(e,e.prev,t)>=0:Wi(e,t,e.prev)<0||Wi(e,e.next,t)<0}function Ld(e,t){var n=new Mu(e.i,e.x,e.y),a=new Mu(t.i,t.x,t.y),h=e.next,d=t.prev;return e.next=t,t.prev=e,n.next=h,h.prev=n,a.next=n,n.prev=a,d.next=a,a.prev=d,a}function Od(e,t,n,a){var h=new Mu(e,t,n);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function ac(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Mu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Tu(e,t,n,a){for(var h=0,d=t,g=n-a;d<n;d+=a)h+=(e[g]-e[d])*(e[d+1]+e[g+1]),g=d;return h}function lf(e,t,n,a,h){Fd(e,t,n||0,a||e.length-1,h||uh)}function Fd(e,t,n,a,h){for(;a>n;){if(a-n>600){var d=a-n+1,g=t-n+1,v=Math.log(d),w=.5*Math.exp(2*v/3),C=.5*Math.sqrt(v*w*(d-w)/d)*(g-d/2<0?-1:1);Fd(e,t,Math.max(n,Math.floor(t-g*w/d+C)),Math.min(a,Math.floor(t+(d-g)*w/d+C)),h)}var k=e[t],I=n,P=a;for(Ts(e,n,t),h(e[a],k)>0&&Ts(e,n,a);I<P;){for(Ts(e,I,P),I++,P--;h(e[I],k)<0;)I++;for(;h(e[P],k)>0;)P--}0===h(e[n],k)?Ts(e,n,P):Ts(e,++P,a),P<=t&&(n=P+1),t<=P&&(a=P-1)}}function Ts(e,t,n){var a=e[t];e[t]=e[n],e[n]=a}function uh(e,t){return e<t?-1:e>t?1:0}function Cu(e,t){const n=e.length;if(n<=1)return[e];const a=[];let h,d;for(let g=0;g<n;g++){const v=Kn(e[g]);0!==v&&(e[g].area=Math.abs(v),void 0===d&&(d=v<0),d===v<0?(h&&a.push(h),h=[e[g]]):h.push(e[g]))}if(h&&a.push(h),t>1)for(let g=0;g<a.length;g++)a[g].length<=t||(lf(a[g],t,1,a[g].length-1,cf),a[g]=a[g].slice(0,t));return a}function cf(e,t){return t.area-e.area}function Su(e,t,n){const a=n.patternDependencies;let h=!1;for(const d of t){const g=d.paint.get(`${e}-pattern`);g.isConstant()||(h=!0);const v=g.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function Au(e,t,n,a,h){const d=h.patternDependencies;for(const g of t){const v=g.paint.get(`${e}-pattern`).value;if("constant"!==v.kind){let w=v.evaluate({zoom:a-1},n,{},h.availableImages),C=v.evaluate({zoom:a},n,{},h.availableImages),k=v.evaluate({zoom:a+1},n,{},h.availableImages);w=w&&w.name?w.name:w,C=C&&C.name?C.name:C,k=k&&k.name?k.name:k,d[w]=!0,d[C]=!0,d[k]=!0,n.patterns[g.id]={min:w,mid:C,max:k}}}return n}nc.deviation=function(e,t,n,a){var h=t&&t.length,d=Math.abs(Tu(e,0,h?t[0]*n:e.length,n));if(h)for(var g=0,v=t.length;g<v;g++)d-=Math.abs(Tu(e,t[g]*n,g<v-1?t[g+1]*n:e.length,n));var w=0;for(g=0;g<a.length;g+=3){var C=a[g]*n,k=a[g+1]*n,I=a[g+2]*n;w+=Math.abs((e[C]-e[I])*(e[k+1]-e[C+1])-(e[C]-e[k])*(e[I+1]-e[C+1]))}return 0===d&&0===w?0:Math.abs((w-d)/d)},nc.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},a=0,h=0;h<e.length;h++){for(var d=0;d<e[h].length;d++)for(var g=0;g<t;g++)n.vertices.push(e[h][d][g]);h>0&&n.holes.push(a+=e[h-1].length)}return n},sh.default=Pd;class dh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mo,this.indexArray=new kr,this.indexArray2=new xa,this.programConfigurations=new go(t.layers,t.zoom),this.segments=new tn,this.segments2=new tn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a,h){this.hasPattern=Su("fill",this.layers,n);const d=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:v,id:w,index:C,sourceLayerIndex:k}of t){const I=this.layers[0]._featureFilter.needGeometry,P=xo(v,I);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),P,a))continue;const U=d?d.evaluate(P,{},a,n.availableImages):void 0,G={id:w,properties:v.properties,type:v.type,sourceLayerIndex:k,index:C,geometry:I?P.geometry:Qs(v,a,h),patterns:{},sortKey:U};g.push(G)}d&&g.sort((v,w)=>v.sortKey-w.sortKey);for(const v of g){const{geometry:w,index:C,sourceLayerIndex:k}=v;if(this.hasPattern){const I=Au("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(v,w,C,a,{},n.availableImages);n.featureIndex.insert(t[C].feature,w,C,k,this.index)}}update(t,n,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a,h)}addFeatures(t,n,a,h){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,a,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_r),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,a,h,d,g=[]){for(const v of Cu(n,500)){let w=0;for(const G of v)w+=G.length;const C=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),k=C.vertexLength,I=[],P=[];for(const G of v){if(0===G.length)continue;G!==v[0]&&P.push(I.length/2);const H=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),Y=H.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(Y+G.length-1,Y),I.push(G[0].x),I.push(G[0].y);for(let nt=1;nt<G.length;nt++)this.layoutVertexArray.emplaceBack(G[nt].x,G[nt].y),this.indexArray2.emplaceBack(Y+nt-1,Y+nt),I.push(G[nt].x),I.push(G[nt].y);H.vertexLength+=G.length,H.primitiveLength+=G.length}const U=sh(I,P);for(let G=0;G<U.length;G+=3)this.indexArray.emplaceBack(k+U[G],k+U[G+1],k+U[G+2]);C.vertexLength+=w,C.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,d,g,h)}}_e("FillBucket",dh,{omit:["layers","patternFeatures"]});const hf=new wn({"fill-sort-key":new Ee(Rt.layout_fill["fill-sort-key"])});var uf={paint:new wn({"fill-antialias":new ve(Rt.paint_fill["fill-antialias"]),"fill-opacity":new Ee(Rt.paint_fill["fill-opacity"]),"fill-color":new Ee(Rt.paint_fill["fill-color"]),"fill-outline-color":new Ee(Rt.paint_fill["fill-outline-color"]),"fill-translate":new ve(Rt.paint_fill["fill-translate"]),"fill-translate-anchor":new ve(Rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new _n(Rt.paint_fill["fill-pattern"])}),layout:hf};const df=Zi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pf=Zi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Bd}=df;var Vd=_l;function _l(e,t,n,a,h){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=a,this._values=h,e.readFields(gl,this,t)}function gl(e,t,n){1==e?t.id=n.readVarint():2==e?function(a,h){for(var d=a.readVarint()+a.pos;a.pos<d;){var g=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[g]=v}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function ff(e){for(var t,n,a=0,h=0,d=e.length,g=d-1;h<d;g=h++)a+=((n=e[g]).x-(t=e[h]).x)*(t.y+n.y);return a}_l.types=["Unknown","Point","LineString","Polygon"],_l.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,a=1,h=0,d=0,g=0,v=[];e.pos<n;){if(h<=0){var w=e.readVarint();a=7&w,h=w>>3}if(h--,1===a||2===a)d+=e.readSVarint(),g+=e.readSVarint(),1===a&&(t&&v.push(t),t=[]),t.push(new jt(d,g));else{if(7!==a)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&v.push(t),v},_l.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,a=0,h=0,d=0,g=1/0,v=-1/0,w=1/0,C=-1/0;e.pos<t;){if(a<=0){var k=e.readVarint();n=7&k,a=k>>3}if(a--,1===n||2===n)(h+=e.readSVarint())<g&&(g=h),h>v&&(v=h),(d+=e.readSVarint())<w&&(w=d),d>C&&(C=d);else if(7!==n)throw new Error("unknown command "+n)}return[g,w,v,C]},_l.prototype.toGeoJSON=function(e,t,n){var a,h,d=this.extent*Math.pow(2,n),g=this.extent*e,v=this.extent*t,w=this.loadGeometry(),C=_l.types[this.type];function k(U){for(var G=0;G<U.length;G++){var H=U[G];U[G]=[360*(H.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+v)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(a=0;a<w.length;a++)I[a]=w[a][0];k(w=I);break;case 2:for(a=0;a<w.length;a++)k(w[a]);break;case 3:for(w=function(U){var G=U.length;if(G<=1)return[U];for(var H,Y,nt=[],ct=0;ct<G;ct++){var yt=ff(U[ct]);0!==yt&&(void 0===Y&&(Y=yt<0),Y===yt<0?(H&&nt.push(H),H=[U[ct]]):H.push(U[ct]))}return H&&nt.push(H),nt}(w),a=0;a<w.length;a++)for(h=0;h<w[a].length;h++)k(w[a][h])}1===w.length?w=w[0]:C="Multi"+C;var P={type:"Feature",geometry:{type:C,coordinates:w},properties:this.properties};return"id"in this&&(P.id=this.id),P};var oc=Eu;function Eu(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(mf,this,t),this.length=this._features.length}function mf(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(a){for(var h=null,d=a.readVarint()+a.pos;a.pos<d;){var g=a.readVarint()>>3;h=1===g?a.readString():2===g?a.readFloat():3===g?a.readDouble():4===g?a.readVarint64():5===g?a.readVarint():6===g?a.readSVarint():7===g?a.readBoolean():null}return h}(n))}function _f(e,t,n){if(3===e){var a=new oc(n,n.readVarint()+n.pos);a.length&&(t[a.name]=a)}}Eu.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Vd(this._pbf,t,this.extent,this._keys,this._values)};var is={VectorTile:function(e,t){this.layers=e.readFields(_f,{},t)},VectorTileFeature:Vd,VectorTileLayer:oc};const gf=is.VectorTileFeature.types,yf=Math.pow(2,13);function lc(e,t,n,a,h,d,g,v){e.emplaceBack((t<<1)+g,(n<<1)+d,(Math.floor(a*yf)<<1)+h,Math.round(v))}class Ud{constructor(){this.acc=new jt(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new jt(t.x,t.y),this.max=new jt(t.x,t.y))}append(t,n){this.currentPolyCount.edges++,this.acc._add(t);let a=!!this.borders;const h=this.min,d=this.max;t.x<h.x?(h.x=t.x,a=!0):t.x>d.x&&(d.x=t.x,a=!0),t.y<h.y?(h.y=t.y,a=!0):t.y>d.y&&(d.y=t.y,a=!0),((0===t.x||t.x===ai)&&t.x===n.x)!=((0===t.y||t.y===ai)&&t.y===n.y)&&this.processBorderOverlap(t,n),a&&this.checkBorderIntersection(t,n)}checkBorderIntersection(t,n){n.x<0!=t.x<0&&this.addBorderIntersection(0,xi(n.y,t.y,(0-n.x)/(t.x-n.x))),n.x>ai!=t.x>ai&&this.addBorderIntersection(1,xi(n.y,t.y,(ai-n.x)/(t.x-n.x))),n.y<0!=t.y<0&&this.addBorderIntersection(2,xi(n.x,t.x,(0-n.y)/(t.y-n.y))),n.y>ai!=t.y>ai&&this.addBorderIntersection(3,xi(n.x,t.x,(ai-n.y)/(t.y-n.y)))}addBorderIntersection(t,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[t];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(t,n){if(t.x===n.x){if(t.y===n.y)return;const a=0===t.x?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,t.y)}else{const a=0===t.y?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,t.x)}}centroid(){const t=this.polyCount.reduce((n,a)=>n+a.edges,0);return 0!==t?this.acc.div(t)._round():new jt(0,0)}span(){return new jt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,n)=>t+ +(n[0]!==Number.MAX_VALUE),0)}}class ku{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ll,this.centroidVertexArray=new pd,this.indexArray=new kr,this.programConfigurations=new go(t.layers,t.zoom),this.segments=new tn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=t.enableTerrain}populate(t,n,a,h){this.features=[],this.hasPattern=Su("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(d){const g=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*g/(g*g+1)/ai/(1<<d.z)}(a);for(const{feature:d,id:g,index:v,sourceLayerIndex:w}of t){const C=this.layers[0]._featureFilter.needGeometry,k=xo(d,C);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),k,a))continue;const I={id:g,sourceLayerIndex:w,index:v,geometry:C?k.geometry:Qs(d,a,h),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(Au("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,v,a,{},n.availableImages),n.featureIndex.insert(d,I.geometry,v,w,this.index,P)}this.sortBorders()}addFeatures(t,n,a,h){for(const d of this.features){const{geometry:g}=d;this.addFeature(d,g,d.index,n,a,h)}this.sortBorders()}update(t,n,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,pf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,a,h,d,g){const v=this.enableTerrain?new Ud:null;for(const C of Cu(n,500)){let k=0,I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===C.length||(w=C[0]).every(Y=>Y.x<=0)||w.every(Y=>Y.x>=ai)||w.every(Y=>Y.y<=0)||w.every(Y=>Y.y>=ai))continue;for(let Y=0;Y<C.length;Y++){const nt=C[Y];if(0===nt.length)continue;k+=nt.length;let ct=0;v&&v.startRing(nt[0]);for(let yt=0;yt<nt.length;yt++){const vt=nt[yt];if(yt>=1){const bt=nt[yt-1];if(!xf(vt,bt)){v&&v.append(vt,bt),I.vertexLength+4>tn.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Mt=vt.sub(bt)._perp(),Vt=Mt.x/(Math.abs(Mt.x)+Math.abs(Mt.y)),Ot=Mt.y>0?1:0,ne=bt.dist(vt);ct+ne>32768&&(ct=0),lc(this.layoutVertexArray,vt.x,vt.y,Vt,Ot,0,0,ct),lc(this.layoutVertexArray,vt.x,vt.y,Vt,Ot,0,1,ct),ct+=ne,lc(this.layoutVertexArray,bt.x,bt.y,Vt,Ot,0,0,ct),lc(this.layoutVertexArray,bt.x,bt.y,Vt,Ot,0,1,ct);const Ht=I.vertexLength;this.indexArray.emplaceBack(Ht,Ht+2,Ht+1),this.indexArray.emplaceBack(Ht+1,Ht+2,Ht+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+k>tn.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),"Polygon"!==gf[t.type])continue;const P=[],U=[],G=I.vertexLength;for(let Y=0;Y<C.length;Y++){const nt=C[Y];if(0!==nt.length){nt!==C[0]&&U.push(P.length/2);for(let ct=0;ct<nt.length;ct++){const yt=nt[ct];lc(this.layoutVertexArray,yt.x,yt.y,0,0,1,1,0),P.push(yt.x),P.push(yt.y),v&&v.currentPolyCount.top++}}}const H=sh(P,U);for(let Y=0;Y<H.length;Y+=3)this.indexArray.emplaceBack(G+H[Y],G+H[Y+2],G+H[Y+1]);I.primitiveLength+=H.length/3,I.vertexLength+=k}var w;if(v&&v.polyCount.length>0){if(v.borders){v.vertexArrayOffset=this.centroidVertexArray.length;const C=v.borders,k=this.featuresOnBorder.push(v)-1;for(let I=0;I<4;I++)C[I][0]!==Number.MAX_VALUE&&this.borders[I].push(k)}this.encodeCentroid(v.borders?void 0:v.centroid(),v)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,d,g,h)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((n,a)=>this.featuresOnBorder[n].borders[t][0]-this.featuresOnBorder[a].borders[t][0])}encodeCentroid(t,n,a=!0){let h,d;if(t)if(0!==t.y){const v=n.span()._mult(this.tileToMeter);h=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(v.x/10)),d=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else h=Math.ceil(7*(t.x+450)),d=0;else h=0,d=+a;let g=a?this.centroidVertexArray.length:n.vertexArrayOffset;for(const v of n.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let w=0;w<2*v.edges;w++)this.centroidVertexArray.emplace(g++,0,d),this.centroidVertexArray.emplace(g++,h,d);for(let w=0;w<v.top;w++)this.centroidVertexArray.emplace(g++,h,d)}}}function xf(e,t){return e.x===t.x&&(e.x<0||e.x>ai)||e.y===t.y&&(e.y<0||e.y>ai)}_e("FillExtrusionBucket",ku,{omit:["layers","features"]}),_e("PartMetadata",Ud);var vf={paint:new wn({"fill-extrusion-opacity":new ve(Rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ee(Rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ve(Rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ve(Rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _n(Rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ee(Rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ee(Rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ve(Rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function cc(e,t){return e.x*t.x+e.y*t.y}function Du(e,t){if(1===e.length){let n=0;const a=t[n++];let h;for(;!h||a.equals(h);)if(h=t[n++],!h)return 1/0;for(;n<t.length;n++){const d=t[n],g=e[0],v=h.sub(a),w=d.sub(a),C=g.sub(a),k=cc(v,v),I=cc(v,w),P=cc(w,w),U=cc(C,v),G=cc(C,w),H=k*P-I*I,Y=(P*U-I*G)/H,nt=(k*G-I*U)/H,ct=a.z*(1-Y-nt)+h.z*Y+d.z*nt;if(isFinite(ct))return ct}return 1/0}{let n=1/0;for(const a of t)n=Math.min(n,a.z);return n}}function Nd(e){const t=new jt(e[0],e[1]);return t.z=e[2],t}function ph(e,t,n,a,h,d,g,v){const w=g*h.getElevationAt(e,t,!0,!0),C=0!==d[0],k=C?0===d[1]?g*(d[0]/7-450):g*function(I,P,U){const G=Math.floor(P[0]/8),H=Math.floor(P[1]/8),Y=10*(P[0]-8*G),nt=10*(P[1]-8*H),ct=I.getElevationAt(G,H,!0,!0),yt=I.getMeterToDEM(U),vt=Math.floor(.5*(Y*yt-1)),bt=Math.floor(.5*(nt*yt-1)),Mt=I.tileCoordToPixel(G,H),Vt=2*vt+1,Ot=2*bt+1,ne=(r=Vt,c=Ot,[(pe=I).getElevationAtPixel(o=Mt.x-vt,s=Mt.y-bt,!0),pe.getElevationAtPixel(o+c,s,!0),pe.getElevationAtPixel(o,s+c,!0),pe.getElevationAtPixel(o+r,s+c,!0)]),Ht=Math.abs(ne[0]-ne[1]),Ft=Math.abs(ne[2]-ne[3]),Qt=Math.abs(ne[0]-ne[2])+Math.abs(ne[1]-ne[3]),Jt=Math.min(.25,.5*yt*(Ht+Ft)/Vt),$t=Math.min(.25,.5*yt*Qt/Ot);var pe,o,s,r,c;return ct+Math.max(Jt*Y,$t*nt)}(h,d,v):w;return{base:w+(0===n)?-1:n,top:C?Math.max(k+a,w+n+2):w+a}}const bf=Zi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:vo}=bf,wf=Zi([{name:"a_packed",components:3,type:"Float32"}]),{members:Mf}=wf,Tf=is.VectorTileFeature.types,Cf=Math.cos(Math.PI/180*37.5);class fh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Wh,this.layoutVertexArray2=new bs,this.indexArray=new kr,this.programConfigurations=new go(t.layers,t.zoom),this.segments=new tn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a,h){this.hasPattern=Su("line",this.layers,n);const d=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:k,id:I,index:P,sourceLayerIndex:U}of t){const G=this.layers[0]._featureFilter.needGeometry,H=xo(k,G);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),H,a))continue;const Y=d?d.evaluate(H,{},a):void 0,nt={id:I,properties:k.properties,type:k.type,sourceLayerIndex:U,index:P,geometry:G?H.geometry:Qs(k,a,h),patterns:{},sortKey:Y};g.push(nt)}d&&g.sort((k,I)=>k.sortKey-I.sortKey);const{lineAtlas:v,featureIndex:w}=n,C=this.addConstantDashes(v);for(const k of g){const{geometry:I,index:P,sourceLayerIndex:U}=k;if(C&&this.addFeatureDashes(k,v),this.hasPattern){const G=Au("line",this.layers,k,this.zoom,n);this.patternFeatures.push(G)}else this.addFeature(k,I,P,a,v.positions,n.availableImages);w.insert(t[P].feature,I,P,U,this.index)}}addConstantDashes(t){let n=!1;for(const a of this.layers){const h=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==d.kind)n=!0;else{const g=d.value,v=h.value;if(!v)continue;t.addDash(v.from,g),t.addDash(v.to,g),v.other&&t.addDash(v.other,g)}}return n}addFeatureDashes(t,n){const a=this.zoom;for(const h of this.layers){const d=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if("constant"===d.kind&&"constant"===g.kind)continue;let v,w,C,k,I,P;if("constant"===d.kind){const Y=d.value;if(!Y)continue;v=Y.other||Y.to,w=Y.to,C=Y.from}else v=d.evaluate({zoom:a-1},t),w=d.evaluate({zoom:a},t),C=d.evaluate({zoom:a+1},t);"constant"===g.kind?k=I=P=g.value:(k=g.evaluate({zoom:a-1},t),I=g.evaluate({zoom:a},t),P=g.evaluate({zoom:a+1},t)),n.addDash(v,k),n.addDash(w,I),n.addDash(C,P);const U=n.getKey(v,k),G=n.getKey(w,I),H=n.getKey(C,P);t.patterns[h.id]={min:U,mid:G,max:H}}}update(t,n,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a,h)}addFeatures(t,n,a,h){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,a,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Mf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,a,h,d,g){const v=this.layers[0].layout,w=v.get("line-join").evaluate(t,{}),C=v.get("line-cap").evaluate(t,{}),k=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of n)this.addLine(P,t,w,C,k,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,d,g,h)}addLine(t,n,a,h,d,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let nt=0;nt<t.length-1;nt++)this.totalDistance+=t[nt].dist(t[nt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v="Polygon"===Tf[n.type];let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let C=0;for(;C<w-1&&t[C].equals(t[C+1]);)C++;if(w<(v?3:2))return;"bevel"===a&&(d=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let P,U,G,H,Y;this.e1=this.e2=-1,v&&(P=t[w-2],Y=t[C].sub(P)._unit()._perp());for(let nt=C;nt<w;nt++){if(G=nt===w-1?v?t[C+1]:void 0:t[nt+1],G&&t[nt].equals(G))continue;Y&&(H=Y),P&&(U=P),P=t[nt],Y=G?G.sub(P)._unit()._perp():H,H=H||Y;let ct=H.add(Y);0===ct.x&&0===ct.y||ct._unit();const yt=H.x*Y.x+H.y*Y.y,vt=ct.x*Y.x+ct.y*Y.y,bt=0!==vt?1/vt:1/0,Mt=2*Math.sqrt(2-2*vt),Vt=vt<Cf&&U&&G,Ot=H.x*Y.y-H.y*Y.x>0;if(Vt&&nt>C){const Ft=P.dist(U);if(Ft>2*k){const Qt=P.sub(P.sub(U)._mult(k/Ft)._round());this.updateDistance(U,Qt),this.addCurrentVertex(Qt,H,0,0,I),U=Qt}}const ne=U&&G;let Ht=ne?a:v?"butt":h;if(ne&&"round"===Ht&&(bt<g?Ht="miter":bt<=2&&(Ht="fakeround")),"miter"===Ht&&bt>d&&(Ht="bevel"),"bevel"===Ht&&(bt>2&&(Ht="flipbevel"),bt<d&&(Ht="miter")),U&&this.updateDistance(U,P),"miter"===Ht)ct._mult(bt),this.addCurrentVertex(P,ct,0,0,I);else if("flipbevel"===Ht){if(bt>100)ct=Y.mult(-1);else{const Ft=bt*H.add(Y).mag()/H.sub(Y).mag();ct._perp()._mult(Ft*(Ot?-1:1))}this.addCurrentVertex(P,ct,0,0,I),this.addCurrentVertex(P,ct.mult(-1),0,0,I)}else if("bevel"===Ht||"fakeround"===Ht){const Ft=-Math.sqrt(bt*bt-1),Qt=Ot?Ft:0,Jt=Ot?0:Ft;if(U&&this.addCurrentVertex(P,H,Qt,Jt,I),"fakeround"===Ht){const $t=Math.round(180*Mt/Math.PI/20);for(let pe=1;pe<$t;pe++){let o=pe/$t;if(.5!==o){const r=o-.5;o+=o*r*(o-1)*((1.0904+yt*(yt*(3.55645-1.43519*yt)-3.2452))*r*r+(.848013+yt*(.215638*yt-1.06021)))}const s=Y.sub(H)._mult(o)._add(H)._unit()._mult(Ot?-1:1);this.addHalfVertex(P,s.x,s.y,!1,Ot,0,I)}}G&&this.addCurrentVertex(P,Y,-Qt,-Jt,I)}else if("butt"===Ht)this.addCurrentVertex(P,ct,0,0,I);else if("square"===Ht){const Ft=U?1:-1;U||this.addCurrentVertex(P,ct,Ft,Ft,I),this.addCurrentVertex(P,ct,0,0,I),U&&this.addCurrentVertex(P,ct,Ft,Ft,I)}else"round"===Ht&&(U&&(this.addCurrentVertex(P,H,0,0,I),this.addCurrentVertex(P,H,1,1,I,!0)),G&&(this.addCurrentVertex(P,Y,-1,-1,I,!0),this.addCurrentVertex(P,Y,0,0,I)));if(Vt&&nt<w-1){const Ft=P.dist(G);if(Ft>2*k){const Qt=P.add(G.sub(P)._mult(k/Ft)._round());this.updateDistance(P,Qt),this.addCurrentVertex(Qt,Y,0,0,I),P=Qt}}}}addCurrentVertex(t,n,a,h,d,g=!1){const v=n.y*h-n.x,w=-n.y-n.x*h;this.addHalfVertex(t,n.x+n.y*a,n.y-n.x*a,g,!1,a,d),this.addHalfVertex(t,v,w,g,!0,-h,d)}addHalfVertex({x:t,y:n},a,h,d,g,v,w){this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(n<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(0===v?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),g?this.e2=C:this.e1=C}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}_e("LineBucket",fh,{omit:["layers","patternFeatures"]});const Iu=new wn({"line-cap":new Ee(Rt.layout_line["line-cap"]),"line-join":new Ee(Rt.layout_line["line-join"]),"line-miter-limit":new ve(Rt.layout_line["line-miter-limit"]),"line-round-limit":new ve(Rt.layout_line["line-round-limit"]),"line-sort-key":new Ee(Rt.layout_line["line-sort-key"])});var jd={paint:new wn({"line-opacity":new Ee(Rt.paint_line["line-opacity"]),"line-color":new Ee(Rt.paint_line["line-color"]),"line-translate":new ve(Rt.paint_line["line-translate"]),"line-translate-anchor":new ve(Rt.paint_line["line-translate-anchor"]),"line-width":new Ee(Rt.paint_line["line-width"]),"line-gap-width":new Ee(Rt.paint_line["line-gap-width"]),"line-offset":new Ee(Rt.paint_line["line-offset"]),"line-blur":new Ee(Rt.paint_line["line-blur"]),"line-dasharray":new _n(Rt.paint_line["line-dasharray"]),"line-pattern":new _n(Rt.paint_line["line-pattern"]),"line-gradient":new vs(Rt.paint_line["line-gradient"])}),layout:Iu};const mh=new class extends Ee{possiblyEvaluate(e,t){return t=new Ze(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,a){return t=Ie({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,a)}}(jd.paint.properties["line-width"].specification);function Pu(e,t){return t>0?t+2*e:e}mh.useIntegerZoom=!0;const Sf=Zi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Af=Zi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Zi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ef=Zi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),kf=Zi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Zi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gd=Zi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Df=Zi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Zi([{name:"triangle",components:3,type:"Uint16"}]),Zi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Zi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Zi([{type:"Float32",name:"offsetX"}]),Zi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Cs=128;function zu(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ze(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:a,interpolationType:h}=n;let d=0;for(;d<a.length&&a[d]<=e;)d++;d=Math.max(0,d-1);let g=d;for(;g<a.length&&a[g]<e+1;)g++;g=Math.min(a.length-1,g);const v=a[d],w=a[g];return"composite"===n.kind?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:n.evaluate(new Ze(v)),maxSize:n.evaluate(new Ze(w)),interpolationType:h}}}function _h(e,{uSize:t,uSizeT:n},{lowerSize:a,upperSize:h}){return"source"===e.kind?a/Cs:"composite"===e.kind?xi(a/Cs,h/Cs,n):t}function yl(e,t){let n=0,a=0;if("constant"===e.kind)a=e.layoutSize;else if("source"!==e.kind){const{interpolationType:h,minZoom:d,maxZoom:g}=e,v=h?pi(Gn.interpolationFactor(h,t,d,g),0,1):0;"camera"===e.kind?a=xi(e.minSize,e.maxSize,v):n=v}return{uSizeT:n,uSize:a}}var If=Object.freeze({__proto__:null,getSizeData:zu,evaluateSizeForFeature:_h,evaluateSizeForZoom:yl,SIZE_PACK_FACTOR:Cs});function Pf(e,t,n){return e.sections.forEach(a=>{a.text=function(h,d,g){const v=d.layout.get("text-transform").evaluate(g,{});return"uppercase"===v?h=h.toLocaleUpperCase():"lowercase"===v&&(h=h.toLocaleLowerCase()),hi.applyArabicShaping&&(h=hi.applyArabicShaping(h)),h}(a.text,t,n)}),e}const hc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function zf(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function Rf(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}var Zd=function(e,t,n,a,h){var d,g,v=8*h-a-1,w=(1<<v)-1,C=w>>1,k=-7,I=n?h-1:0,P=n?-1:1,U=e[t+I];for(I+=P,d=U&(1<<-k)-1,U>>=-k,k+=v;k>0;d=256*d+e[t+I],I+=P,k-=8);for(g=d&(1<<-k)-1,d>>=-k,k+=a;k>0;g=256*g+e[t+I],I+=P,k-=8);if(0===d)d=1-C;else{if(d===w)return g?NaN:1/0*(U?-1:1);g+=Math.pow(2,a),d-=C}return(U?-1:1)*g*Math.pow(2,d-a)},$d=function(e,t,n,a,h,d){var g,v,w,C=8*d-h-1,k=(1<<C)-1,I=k>>1,P=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,U=a?0:d-1,G=a?1:-1,H=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,g=k):(g=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-g))<1&&(g--,w*=2),(t+=g+I>=1?P/w:P*Math.pow(2,1-I))*w>=2&&(g++,w/=2),g+I>=k?(v=0,g=k):g+I>=1?(v=(t*w-1)*Math.pow(2,h),g+=I):(v=t*Math.pow(2,I-1)*Math.pow(2,h),g=0));h>=8;e[n+U]=255&v,U+=G,v/=256,h-=8);for(g=g<<h|v,C+=h;C>0;e[n+U]=255&g,U+=G,g/=256,C-=8);e[n+U-G]|=128*H},bo=Di;function Di(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Di.Varint=0,Di.Fixed64=1,Di.Bytes=2,Di.Fixed32=5;var gh=4294967296,Hd=1/gh,xl="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ta(e){return e.type===Di.Bytes?e.readVarint()+e.pos:e.pos+1}function qd(e,t,n){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(a);for(var h=n.pos-1;h>=e;h--)n.buf[h+a]=n.buf[h]}function Lf(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function Of(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function Ff(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function Bf(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function Vf(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function Uf(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function Nf(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function jf(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function Gf(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function yh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function bl(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Wd(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Zf(e,t,n){t.glyphs=[],1===e&&n.readMessage(wl,t)}function wl(e,t,n){if(3===e){const{id:a,bitmap:h,width:d,height:g,left:v,top:w,advance:C}=n.readMessage(Yd,{});t.glyphs.push({id:a,bitmap:new Ma({width:d+6,height:g+6},h),metrics:{width:d,height:g,left:v,top:w,advance:C}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function Yd(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}function Ru(e){let t=0,n=0;for(const g of e)t+=g.w*g.h,n=Math.max(n,g.w);e.sort((g,v)=>v.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let h=0,d=0;for(const g of e)for(let v=a.length-1;v>=0;v--){const w=a[v];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,d=Math.max(d,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===w.w&&g.h===w.h){const C=a.pop();v<a.length&&(a[v]=C)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(a.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:h,h:d,fill:t/(h*d)||0}}Di.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),h=a>>3,d=this.pos;this.type=7&a,e(h,t,this),this.pos===d&&this.skip(a)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=yh(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Wd(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=yh(this.buf,this.pos)+yh(this.buf,this.pos+4)*gh;return this.pos+=8,e},readSFixed64:function(){var e=yh(this.buf,this.pos)+Wd(this.buf,this.pos+4)*gh;return this.pos+=8,e},readFloat:function(){var e=Zd(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Zd(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,a=this.buf;return t=127&(n=a[this.pos++]),n<128?t:(t|=(127&(n=a[this.pos++]))<<7,n<128?t:(t|=(127&(n=a[this.pos++]))<<14,n<128?t:(t|=(127&(n=a[this.pos++]))<<21,n<128?t:function(h,d,g){var v,w,C=g.buf;if(v=(112&(w=C[g.pos++]))>>4,w<128||(v|=(127&(w=C[g.pos++]))<<3,w<128)||(v|=(127&(w=C[g.pos++]))<<10,w<128)||(v|=(127&(w=C[g.pos++]))<<17,w<128)||(v|=(127&(w=C[g.pos++]))<<24,w<128)||(v|=(1&(w=C[g.pos++]))<<31,w<128))return function(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}(h,v,d);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=a[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&xl?xl.decode(this.buf.subarray(t,e)):function(n,a,h){for(var d="",g=a;g<h;){var v,w,C,k=n[g],I=null,P=k>239?4:k>223?3:k>191?2:1;if(g+P>h)break;1===P?k<128&&(I=k):2===P?128==(192&(v=n[g+1]))&&(I=(31&k)<<6|63&v)<=127&&(I=null):3===P?(w=n[g+2],128==(192&(v=n[g+1]))&&128==(192&w)&&((I=(15&k)<<12|(63&v)<<6|63&w)<=2047||I>=55296&&I<=57343)&&(I=null)):4===P&&(w=n[g+2],C=n[g+3],128==(192&(v=n[g+1]))&&128==(192&w)&&128==(192&C)&&((I=(15&k)<<18|(63&v)<<12|(63&w)<<6|63&C)<=65535||I>=1114112)&&(I=null)),null===I?(I=65533,P=1):I>65535&&(I-=65536,d+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),d+=String.fromCharCode(I),g+=P}return d}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Di.Bytes)return e.push(this.readVarint(t));var n=ta(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Di.Bytes)return e.push(this.readSVarint());var t=ta(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Di.Bytes)return e.push(this.readBoolean());var t=ta(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Di.Bytes)return e.push(this.readFloat());var t=ta(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Di.Bytes)return e.push(this.readDouble());var t=ta(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Di.Bytes)return e.push(this.readFixed32());var t=ta(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Di.Bytes)return e.push(this.readSFixed32());var t=ta(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Di.Bytes)return e.push(this.readFixed64());var t=ta(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Di.Bytes)return e.push(this.readSFixed64());var t=ta(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Di.Varint)for(;this.buf[this.pos++]>127;);else if(t===Di.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Di.Fixed32)this.pos+=4;else{if(t!==Di.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),bl(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),bl(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),bl(this.buf,-1&e,this.pos),bl(this.buf,Math.floor(e*Hd),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),bl(this.buf,-1&e,this.pos),bl(this.buf,Math.floor(e*Hd),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,n){var a,h,d,v;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),d=a,(v=n).buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,v.buf[v.pos]=127&(d>>>=7),function(d,g){var v=(7&d)<<4;g.buf[g.pos++]|=v|((d>>>=3)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d)))))}(h,n)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(a,h,d){for(var g,v,w=0;w<h.length;w++){if((g=h.charCodeAt(w))>55295&&g<57344){if(!v){g>56319||w+1===h.length?(a[d++]=239,a[d++]=191,a[d++]=189):v=g;continue}if(g<56320){a[d++]=239,a[d++]=191,a[d++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(a[d++]=239,a[d++]=191,a[d++]=189,v=null);g<128?a[d++]=g:(g<2048?a[d++]=g>>6|192:(g<65536?a[d++]=g>>12|224:(a[d++]=g>>18|240,a[d++]=g>>12&63|128),a[d++]=g>>6&63|128),a[d++]=63&g|128)}return d}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&qd(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),$d(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),$d(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var a=this.pos-n;a>=128&&qd(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(e,t,n){this.writeTag(e,Di.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Lf,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Of,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Vf,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Ff,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Bf,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Uf,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Nf,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,jf,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Gf,t)},writeBytesField:function(e,t){this.writeTag(e,Di.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Di.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Di.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Di.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Di.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Di.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Di.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Di.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Di.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Di.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class Lu{constructor(t,{pixelRatio:n,version:a,stretchX:h,stretchY:d,content:g}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=h,this.stretchY=d,this.content=g,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Xd{constructor(t,n){const a={},h={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,a,d),this.addImages(n,h,d);const{w:g,h:v}=Ru(d),w=new mr({width:g||1,height:v||1});for(const C in t){const k=t[C],I=a[C].paddedRect;mr.copy(k.data,w,{x:0,y:0},{x:I.x+1,y:I.y+1},k.data)}for(const C in n){const k=n[C],I=h[C].paddedRect,P=I.x+1,U=I.y+1,G=k.data.width,H=k.data.height;mr.copy(k.data,w,{x:0,y:0},{x:P,y:U},k.data),mr.copy(k.data,w,{x:0,y:H-1},{x:P,y:U-1},{width:G,height:1}),mr.copy(k.data,w,{x:0,y:0},{x:P,y:U+H},{width:G,height:1}),mr.copy(k.data,w,{x:G-1,y:0},{x:P-1,y:U},{width:1,height:H}),mr.copy(k.data,w,{x:0,y:0},{x:P+G,y:U},{width:1,height:H})}this.image=w,this.iconPositions=a,this.patternPositions=h}addImages(t,n,a){for(const h in t){const d=t[h],g={x:0,y:0,w:d.data.width+2,h:d.data.height+2};a.push(g),n[h]=new Lu(g,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),n)}patchUpdatedImage(t,n,a){if(!t||!n||t.version===n.version)return;t.version=n.version;const[h,d]=t.tl;a.update(n.data,void 0,{x:h,y:d})}}_e("ImagePosition",Lu),_e("ImageAtlas",Xd);const zr={horizontal:1,vertical:2,horizontalOnly:3};class uc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const a=new uc;return a.scale=t||1,a.fontStack=n,a}static forImage(t){const n=new uc;return n.imageName=t,n}}class ea{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const a=new ea;for(let h=0;h<t.sections.length;h++){const d=t.sections[h];d.image?a.addImageSection(d):a.addTextSection(d,n)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(n,a){let h="";for(let d=0;d<n.length;d++){const g=n.charCodeAt(d+1)||null,v=n.charCodeAt(d-1)||null;h+=!a&&(g&&xe(g)&&!hc[n[d+1]]||v&&xe(v)&&!hc[n[d-1]])||!hc[n[d]]?n[d]:hc[n[d]]}return h}(this.text,t)}trim(){let t=0;for(let a=0;a<this.text.length&&xh[this.text.charCodeAt(a)];a++)t++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&xh[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const a=new ea;return a.text=this.text.substring(t,n),a.sectionIndex=this.sectionIndex.slice(t,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(uc.forText(t.scale,t.fontStack||n));const a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){const n=t.image?t.image.name:"";if(0===n.length)return void bi("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(uc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):bi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ou(e,t,n,a,h,d,g,v,w,C,k,I,P,U,G,H){const Y=ea.fromFeature(e,h);let nt;I===zr.vertical&&Y.verticalizePunctuation(P);const{processBidirectionalText:ct,processStyledBidirectionalText:yt}=hi;if(ct&&1===Y.sections.length){nt=[];const Mt=ct(Y.toString(),Ca(Y,C,d,t,a,U,G));for(const Vt of Mt){const Ot=new ea;Ot.text=Vt,Ot.sections=Y.sections;for(let ne=0;ne<Vt.length;ne++)Ot.sectionIndex.push(0);nt.push(Ot)}}else if(yt){nt=[];const Mt=yt(Y.text,Y.sectionIndex,Ca(Y,C,d,t,a,U,G));for(const Vt of Mt){const Ot=new ea;Ot.text=Vt[0],Ot.sectionIndex=Vt[1],Ot.sections=Y.sections,nt.push(Ot)}}else nt=function(Mt,Vt){const Ot=[],ne=Mt.text;let Ht=0;for(const Ft of Vt)Ot.push(Mt.substring(Ht,Ft)),Ht=Ft;return Ht<ne.length&&Ot.push(Mt.substring(Ht,ne.length)),Ot}(Y,Ca(Y,C,d,t,a,U,G));const vt=[],bt={positionedLines:vt,text:Y.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Mt,Vt,Ot,ne,Ht,Ft,Qt,Jt,$t,pe,o,s){let r=0,c=0,f=0;const _="right"===Jt?1:"left"===Jt?0:.5;let x=!1;for(const q of Ht){const et=q.getSections();for(const ut of et){if(ut.imageName)continue;const mt=Vt[ut.fontStack];if(mt&&(x=void 0!==mt.ascender&&void 0!==mt.descender,!x))break}if(!x)break}let M=0;for(const q of Ht){q.trim();const et=q.getMaxScale(),ut=24*(et-1),mt={positionedGlyphs:[],lineOffset:0};Mt.positionedLines[M]=mt;const wt=mt.positionedGlyphs;let Et=0;if(!q.length()){c+=Ft,++M;continue}let Gt=0,se=0;for(let zt=0;zt<q.length();zt++){const ae=q.getSection(zt),fe=q.getSectionIndex(zt),ge=q.getCharCode(zt);let ce=ae.scale,Xe=null,Be=null,We=null,ci=24,Ii=0;const He=!($t===zr.horizontal||!o&&!Ut(ge)||o&&(xh[ge]||(S=ge,i(S)||l(S)||m(S)||pt(S)||qt(S))));if(ae.imageName){const oi=ne[ae.imageName];if(!oi)continue;We=ae.imageName,Mt.iconsInText=Mt.iconsInText||!0,Be=oi.paddedRect;const en=oi.displaySize;ce=24*ce/s,Xe={width:en[0],height:en[1],left:1,top:-3,advance:He?en[1]:en[0],localGlyph:!1},Ii=x?-Xe.height*ce:24*et-17-en[1]*ce,ci=Xe.advance;const Fn=(He?en[0]:en[1])*ce-24*et;Fn>0&&Fn>Et&&(Et=Fn)}else{const oi=Ot[ae.fontStack];if(!oi)continue;oi[ge]&&(Be=oi[ge]);const en=Vt[ae.fontStack];if(!en)continue;const Fn=en.glyphs[ge];if(!Fn)continue;if(Xe=Fn.metrics,ci=8203!==ge?24:0,x){const ks=void 0!==en.ascender?Math.abs(en.ascender):0,ka=void 0!==en.descender?Math.abs(en.descender):0,Ds=(ks+ka)*ce;Gt<Ds&&(Gt=Ds,se=(ks-ka)/2*ce),Ii=-ks*ce}else Ii=24*(et-ce)-17}He?(Mt.verticalizable=!0,wt.push({glyph:ge,imageName:We,x:r,y:c+Ii,vertical:He,scale:ce,localGlyph:Xe.localGlyph,fontStack:ae.fontStack,sectionIndex:fe,metrics:Xe,rect:Be}),r+=ci*ce+pe):(wt.push({glyph:ge,imageName:We,x:r,y:c+Ii,vertical:He,scale:ce,localGlyph:Xe.localGlyph,fontStack:ae.fontStack,sectionIndex:fe,metrics:Xe,rect:Be}),r+=Xe.advance*ce+pe)}0!==wt.length&&(f=Math.max(r-pe,f),x?ep(wt,_,Et,se,Ft*et/2):ep(wt,_,Et,0,Ft/2)),r=0;const Kt=Ft*et+Et;mt.lineOffset=Math.max(Et,ut),c+=Kt,++M}var S;const D=c,{horizontalAlign:L,verticalAlign:j}=Fu(Qt);(function(q,et,ut,mt,wt,Et){const Gt=(et-ut)*wt,se=-Et*mt;for(const Kt of q)for(const zt of Kt.positionedGlyphs)zt.x+=Gt,zt.y+=se})(Mt.positionedLines,_,L,j,f,D),Mt.top+=-j*D,Mt.bottom=Mt.top+D,Mt.left+=-L*f,Mt.right=Mt.left+f,Mt.hasBaseline=x}(bt,t,n,a,nt,g,v,w,I,C,P,H),!function(Mt){for(const Vt of Mt)if(0!==Vt.positionedGlyphs.length)return!1;return!0}(vt)&&bt}const xh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$f={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kd(e,t,n,a,h,d){if(t.imageName){const g=a[t.imageName];return g?g.displaySize[0]*t.scale*24/d+h:0}{const g=n[t.fontStack],v=g&&g.glyphs[e];return v?v.metrics.advance*t.scale+h:0}}function Jd(e,t,n,a){const h=Math.pow(e-t,2);return a?e<t?h/2:2*h:h+Math.abs(n)*n}function Hf(e,t,n){let a=0;return 10===e&&(a-=1e4),n&&(a+=150),40!==e&&65288!==e||(a+=50),41!==t&&65289!==t||(a+=50),a}function Qd(e,t,n,a,h,d){let g=null,v=Jd(t,n,h,d);for(const w of a){const C=Jd(t-w.x,n,h,d)+w.badness;C<=v&&(g=w,v=C)}return{index:e,x:t,priorBreak:g,badness:v}}function tp(e){return e?tp(e.priorBreak).concat(e.index):[]}function Ca(e,t,n,a,h,d,g){if("point"!==d)return[];if(!e)return[];const v=[],w=function(P,U,G,H,Y,nt){let ct=0;for(let yt=0;yt<P.length();yt++){const vt=P.getSection(yt);ct+=Kd(P.getCharCode(yt),vt,H,Y,U,nt)}return ct/Math.max(1,Math.ceil(ct/G))}(e,t,n,a,h,g),C=e.text.indexOf("\u200b")>=0;let k=0;for(let P=0;P<e.length();P++){const U=e.getSection(P),G=e.getCharCode(P);if(xh[G]||(k+=Kd(G,U,a,h,t,g)),P<e.length()-1){const H=!((I=G)<11904||!(N(I)||O(I)||It(I)||at(I)||J(I)||y(I)||$(I)||A(I)||dt(I)||K(I)||W(I)||Yt(I)||z(I)||T(I)||b(I)||X(I)||R(I)||At(I)||ot(I)||lt(I)));($f[G]||H||U.imageName)&&v.push(Qd(P+1,k,w,v,Hf(G,e.getCharCode(P+1),H&&C),!1))}}var I;return tp(Qd(e.length(),k,w,v,0,!0))}function Fu(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function ep(e,t,n,a,h){if(!(t||n||a||h))return;const d=e.length-1,g=e[d],v=(g.x+g.metrics.advance*g.scale)*t;for(let w=0;w<=d;w++)e[w].x-=v,e[w].y+=n+a+h}function qf(e,t,n){const{horizontalAlign:a,verticalAlign:h}=Fu(n),d=t[0]-e.displaySize[0]*a,g=t[1]-e.displaySize[1]*h;return{image:e,top:g,bottom:g+e.displaySize[1],left:d,right:d+e.displaySize[0]}}function ip(e,t,n,a,h,d){const g=e.image;let v;if(g.content){const Y=g.content,nt=g.pixelRatio||1;v=[Y[0]/nt,Y[1]/nt,g.displaySize[0]-Y[2]/nt,g.displaySize[1]-Y[3]/nt]}const w=t.left*d,C=t.right*d;let k,I,P,U;"width"===n||"both"===n?(U=h[0]+w-a[3],I=h[0]+C+a[1]):(U=h[0]+(w+C-g.displaySize[0])/2,I=U+g.displaySize[0]);const G=t.top*d,H=t.bottom*d;return"height"===n||"both"===n?(k=h[1]+G-a[0],P=h[1]+H+a[2]):(k=h[1]+(G+H-g.displaySize[1])/2,P=k+g.displaySize[1]),{image:g,top:k,right:I,bottom:P,left:U,collisionPadding:v}}class gr extends jt{constructor(t,n,a,h,d){super(t,n),this.angle=h,this.z=a,void 0!==d&&(this.segment=d)}clone(){return new gr(this.x,this.y,this.z,this.angle,this.segment)}}function np(e,t,n,a,h){if(void 0===t.segment)return!0;let d=t,g=t.segment+1,v=0;for(;v>-n/2;){if(g--,g<0)return!1;v-=e[g].dist(d),d=e[g]}v+=e[g].dist(e[g+1]),g++;const w=[];let C=0;for(;v<n/2;){const k=e[g],I=e[g+1];if(!I)return!1;let P=e[g-1].angleTo(k)-k.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:P}),C+=P;v-w[0].distance>a;)C-=w.shift().angleDelta;if(C>h)return!1;g++,v+=k.dist(I)}return!0}function rp(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function dc(e,t,n){return e?.6*t*n:0}function sp(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Bu(e,t,n,a,h,d){const g=dc(n,h,d),v=sp(n,a)*d;let w=0;const C=rp(e)/2;for(let k=0;k<e.length-1;k++){const I=e[k],P=e[k+1],U=I.dist(P);if(w+U>C){const G=(C-w)/U,H=xi(I.x,P.x,G),Y=xi(I.y,P.y,G),nt=new gr(H,Y,0,P.angleTo(I),k);return!g||np(e,nt,v,g,t)?nt:void 0}w+=U}}function Wf(e,t,n,a,h,d,g,v,w){const C=dc(a,d,g),k=sp(a,h),I=k*g,P=0===e[0].x||e[0].x===w||0===e[0].y||e[0].y===w;return t-I<t/4&&(t=I+t/4),vh(e,P?t/2*v%t:(k/2+2*d)*g*v%t,t,C,n,I,P,!1,w)}function vh(e,t,n,a,h,d,g,v,w){const C=d/2,k=rp(e);let I=0,P=t-n,U=[];for(let G=0;G<e.length-1;G++){const H=e[G],Y=e[G+1],nt=H.dist(Y),ct=Y.angleTo(H);for(;P+n<I+nt;){P+=n;const yt=(P-I)/nt,vt=xi(H.x,Y.x,yt),bt=xi(H.y,Y.y,yt);if(vt>=0&&vt<w&&bt>=0&&bt<w&&P-C>=0&&P+C<=k){const Mt=new gr(vt,bt,0,ct,G);Mt._round(),a&&!np(e,Mt,d,a,h)||U.push(Mt)}}I+=nt}return v||U.length||g||(U=vh(e,I/2,n,a,h,d,g,!0,w)),U}function ap(e,t,n,a,h){const d=[];for(let g=0;g<e.length;g++){const v=e[g];let w;for(let C=0;C<v.length-1;C++){let k=v[C],I=v[C+1];k.x<t&&I.x<t||(k.x<t?k=new jt(t,k.y+(t-k.x)/(I.x-k.x)*(I.y-k.y))._round():I.x<t&&(I=new jt(t,k.y+(t-k.x)/(I.x-k.x)*(I.y-k.y))._round()),k.y<n&&I.y<n||(k.y<n?k=new jt(k.x+(n-k.y)/(I.y-k.y)*(I.x-k.x),n)._round():I.y<n&&(I=new jt(k.x+(n-k.y)/(I.y-k.y)*(I.x-k.x),n)._round()),k.x>=a&&I.x>=a||(k.x>=a?k=new jt(a,k.y+(a-k.x)/(I.x-k.x)*(I.y-k.y))._round():I.x>=a&&(I=new jt(a,k.y+(a-k.x)/(I.x-k.x)*(I.y-k.y))._round()),k.y>=h&&I.y>=h||(k.y>=h?k=new jt(k.x+(h-k.y)/(I.y-k.y)*(I.x-k.x),h)._round():I.y>=h&&(I=new jt(k.x+(h-k.y)/(I.y-k.y)*(I.x-k.x),h)._round()),w&&k.equals(w[w.length-1])||(w=[k],d.push(w)),w.push(I)))))}}return d}_e("Anchor",gr);const bh=1e20;function op(e,t,n,a,h,d,g,v,w){for(let C=t;C<t+a;C++)lp(e,n*d+C,d,h,g,v,w);for(let C=n;C<n+h;C++)lp(e,C*d+t,1,a,g,v,w)}function lp(e,t,n,a,h,d,g){d[0]=0,g[0]=-bh,g[1]=bh,h[0]=e[t];for(let v=1,w=0,C=0;v<a;v++){h[v]=e[t+v*n];const k=v*v;do{const I=d[w];C=(h[v]-h[I]+k-I*I)/(v-I)/2}while(C<=g[w]&&--w>-1);w++,d[w]=v,g[w]=C,g[w+1]=bh}for(let v=0,w=0;v<a;v++){for(;g[w+1]<v;)w++;const C=d[w],k=v-C;e[t+v*n]=h[C]+k*k}}const wh={none:0,ideographs:1,all:2};class wo{constructor(t,n,a){this.requestManager=t,this.localGlyphMode=n,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,n){const a=[];for(const h in t)for(const d of t[h])a.push({stack:h,id:d});Yn(a,({stack:h,id:d},g)=>{let v=this.entries[h];v||(v=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=v.glyphs[d];if(void 0!==w)return void g(null,{stack:h,id:d,glyph:w});if(w=this._tinySDF(v,h,d),w)return v.glyphs[d]=w,void g(null,{stack:h,id:d,glyph:w});const C=Math.floor(d/256);if(256*C>65535)return void g(new Error("glyphs > 65535 not supported"));if(v.ranges[C])return void g(null,{stack:h,id:d,glyph:w});let k=v.requests[C];k||(k=v.requests[C]=[],wo.loadGlyphRange(h,C,this.url,this.requestManager,(I,P)=>{if(P){v.ascender=P.ascender,v.descender=P.descender;for(const U in P.glyphs)this._doesCharSupportLocalGlyph(+U)||(v.glyphs[+U]=P.glyphs[+U]);v.ranges[C]=!0}for(const U of k)U(I,P);delete v.requests[C]})),k.push((I,P)=>{I?g(I):P&&g(null,{stack:h,id:d,glyph:P.glyphs[d]||null})})},(h,d)=>{if(h)n(h);else if(d){const g={};for(const{stack:v,id:w,glyph:C}of d)void 0===g[v]&&(g[v]={}),void 0===g[v].glyphs&&(g[v].glyphs={}),g[v].glyphs[w]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},g[v].ascender=this.entries[v].ascender,g[v].descender=this.entries[v].descender;n(null,g)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==wh.none&&(this.localGlyphMode===wh.all?!!this.localFontFamily:!!this.localFontFamily&&(K(t)||st(t)||z(t)||R(t))||A(t))}_tinySDF(t,n,a){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(a))return;let d=t.tinySDF;if(!d){let H="400";/bold/i.test(n)?H="900":/medium/i.test(n)?H="500":/light/i.test(n)&&(H="200"),d=t.tinySDF=new wo.TinySDF({fontFamily:h,fontWeight:H,fontSize:48,buffer:6,radius:16}),d.fontWeight=H}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const g=String.fromCharCode(a),{data:v,width:w,height:C,glyphWidth:k,glyphHeight:I,glyphLeft:P,glyphTop:U,glyphAdvance:G}=d.draw(g);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new Ma({width:w,height:C},v),metrics:{width:k/2,height:I/2,left:P/2,top:U/2-27,advance:G/2,localGlyph:!0}}}}function cp(e,t,n,a){const h=[],d=e.image,g=d.pixelRatio,v=d.paddedRect.w-2,w=d.paddedRect.h-2,C=e.right-e.left,k=e.bottom-e.top,I=d.stretchX||[[0,v]],P=d.stretchY||[[0,w]],U=(Ft,Qt)=>Ft+Qt[1]-Qt[0],G=I.reduce(U,0),H=P.reduce(U,0),Y=v-G,nt=w-H;let ct=0,yt=G,vt=0,bt=H,Mt=0,Vt=Y,Ot=0,ne=nt;if(d.content&&a){const Ft=d.content;ct=pc(I,0,Ft[0]),vt=pc(P,0,Ft[1]),yt=pc(I,Ft[0],Ft[2]),bt=pc(P,Ft[1],Ft[3]),Mt=Ft[0]-ct,Ot=Ft[1]-vt,Vt=Ft[2]-Ft[0]-yt,ne=Ft[3]-Ft[1]-bt}const Ht=(Ft,Qt,Jt,$t)=>{const pe=Mh(Ft.stretch-ct,yt,C,e.left),o=Th(Ft.fixed-Mt,Vt,Ft.stretch,G),s=Mh(Qt.stretch-vt,bt,k,e.top),r=Th(Qt.fixed-Ot,ne,Qt.stretch,H),c=Mh(Jt.stretch-ct,yt,C,e.left),f=Th(Jt.fixed-Mt,Vt,Jt.stretch,G),_=Mh($t.stretch-vt,bt,k,e.top),x=Th($t.fixed-Ot,ne,$t.stretch,H),M=new jt(pe,s),S=new jt(c,s),D=new jt(c,_),L=new jt(pe,_),j=new jt(o/g,r/g),q=new jt(f/g,x/g),et=t*Math.PI/180;if(et){const wt=Math.sin(et),Et=Math.cos(et),Gt=[Et,-wt,wt,Et];M._matMult(Gt),S._matMult(Gt),L._matMult(Gt),D._matMult(Gt)}const ut=Ft.stretch+Ft.fixed,mt=Qt.stretch+Qt.fixed;return{tl:M,tr:S,bl:L,br:D,tex:{x:d.paddedRect.x+1+ut,y:d.paddedRect.y+1+mt,w:Jt.stretch+Jt.fixed-ut,h:$t.stretch+$t.fixed-mt},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:j,pixelOffsetBR:q,minFontScaleX:Vt/g/C,minFontScaleY:ne/g/k,isSDF:n}};if(a&&(d.stretchX||d.stretchY)){const Ft=Vu(I,Y,G),Qt=Vu(P,nt,H);for(let Jt=0;Jt<Ft.length-1;Jt++){const $t=Ft[Jt],pe=Ft[Jt+1];for(let o=0;o<Qt.length-1;o++)h.push(Ht($t,Qt[o],pe,Qt[o+1]))}}else h.push(Ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function pc(e,t,n){let a=0;for(const h of e)a+=Math.max(t,Math.min(n,h[1]))-Math.max(t,Math.min(n,h[0]));return a}function Vu(e,t,n){const a=[{fixed:-1,stretch:0}];for(const[h,d]of e){const g=a[a.length-1];a.push({fixed:h-g.stretch,stretch:g.stretch}),a.push({fixed:h-g.stretch,stretch:g.stretch+(d-h)})}return a.push({fixed:t+1,stretch:n}),a}function Mh(e,t,n,a){return e/t*n+a}function Th(e,t,n,a){return e-t*n/a}function Yf(e,t,n,a){const h=t+e.positionedLines[a].lineOffset;return 0===a?n+h/2:n+(h+(t+e.positionedLines[a-1].lineOffset))/2}wo.loadGlyphRange=function(e,t,n,a,h){const d=256*t,g=d+255,v=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",`${d}-${g}`),Un.Glyphs);ri(v,(w,C)=>{if(w)h(w);else if(C){const k={},I=new bo(C).readFields(Zf,{});for(const P of I.glyphs)k[P.id]=P;h(null,{glyphs:k,ascender:I.ascender,descender:I.descender})}})},wo.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:a=.25,fontFamily:h="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}){this.buffer=t,this.cutoff=a,this.radius=n;const v=this.size=e+4*t,w=this._createCanvas(v),C=this.ctx=w.getContext("2d",{willReadFrequently:!0});C.font=`${g} ${d} ${e}px ${h}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:h,actualBoundingBoxRight:d}=this.ctx.measureText(e),g=Math.floor(n),v=Math.min(this.size-this.buffer,Math.ceil(d-h)),w=Math.min(this.size-this.buffer,Math.ceil(n)+Math.ceil(a)),C=v+2*this.buffer,k=w+2*this.buffer,I=C*k,P=new Uint8ClampedArray(I),U={data:P,width:C,height:k,glyphWidth:v,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(0===v||0===w)return U;const{ctx:G,buffer:H,gridInner:Y,gridOuter:nt}=this;G.clearRect(H,H,v,w),G.fillText(e,H,H+g+1);const ct=G.getImageData(H,H,v,w);nt.fill(bh,0,I),Y.fill(0,0,I);for(let yt=0;yt<w;yt++)for(let vt=0;vt<v;vt++){const bt=ct.data[4*(yt*v+vt)+3]/255;if(0===bt)continue;const Mt=(yt+H)*C+vt+H;if(1===bt)nt[Mt]=0,Y[Mt]=bh;else{const Vt=.5-bt;nt[Mt]=Vt>0?Vt*Vt:0,Y[Mt]=Vt<0?Vt*Vt:0}}op(nt,0,0,C,k,C,this.f,this.v,this.z),op(Y,H,H,v,w,C,this.f,this.v,this.z);for(let yt=0;yt<I;yt++){const vt=Math.sqrt(nt[yt])-Math.sqrt(Y[yt]);P[yt]=Math.round(255-255*(vt/this.radius+this.cutoff))}return U}};class hp{constructor(t=[],n=Xf){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:a}=this,h=n[t];for(;t>0;){const d=t-1>>1,g=n[d];if(a(h,g)>=0)break;n[t]=g,t=d}n[t]=h}_down(t){const{data:n,compare:a}=this,h=this.length>>1,d=n[t];for(;t<h;){let g=1+(t<<1),v=n[g];const w=g+1;if(w<this.length&&a(n[w],v)<0&&(g=w,v=n[w]),a(v,d)>=0)break;n[t]=v,t=g}n[t]=d}}function Xf(e,t){return e<t?-1:e>t?1:0}function Kf(e,t=1,n=!1){let a=1/0,h=1/0,d=-1/0,g=-1/0;const v=e[0];for(let U=0;U<v.length;U++){const G=v[U];(!U||G.x<a)&&(a=G.x),(!U||G.y<h)&&(h=G.y),(!U||G.x>d)&&(d=G.x),(!U||G.y>g)&&(g=G.y)}const w=Math.min(d-a,g-h);let C=w/2;const k=new hp([],Jf);if(0===w)return new jt(a,h);for(let U=a;U<d;U+=w)for(let G=h;G<g;G+=w)k.push(new Ml(U+C,G+C,C,e));let I=function(U){let G=0,H=0,Y=0;const nt=U[0];for(let ct=0,yt=nt.length,vt=yt-1;ct<yt;vt=ct++){const bt=nt[ct],Mt=nt[vt],Vt=bt.x*Mt.y-Mt.x*bt.y;H+=(bt.x+Mt.x)*Vt,Y+=(bt.y+Mt.y)*Vt,G+=3*Vt}return new Ml(H/G,Y/G,0,U)}(e),P=k.length;for(;k.length;){const U=k.pop();(U.d>I.d||!I.d)&&(I=U,n&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,P)),U.max-I.d<=t||(C=U.h/2,k.push(new Ml(U.p.x-C,U.p.y-C,C,e)),k.push(new Ml(U.p.x+C,U.p.y-C,C,e)),k.push(new Ml(U.p.x-C,U.p.y+C,C,e)),k.push(new Ml(U.p.x+C,U.p.y+C,C,e)),P+=4)}return n&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function Jf(e,t){return t.max-e.max}function Ml(e,t,n,a){this.p=new jt(e,t),this.h=n,this.d=function(h,d){let g=!1,v=1/0;for(let w=0;w<d.length;w++){const C=d[w];for(let k=0,I=C.length,P=I-1;k<I;P=k++){const U=C[k],G=C[P];U.y>h.y!=G.y>h.y&&h.x<(G.x-U.x)*(h.y-U.y)/(G.y-U.y)+U.x&&(g=!g),v=Math.min(v,fu(h,U,G))}}return(g?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const Uu=Number.POSITIVE_INFINITY,Qf=Math.sqrt(2);function Nu(e,t){return t[1]!==Uu?function(n,a,h){let d=0,g=0;switch(a=Math.abs(a),h=Math.abs(h),n){case"top-right":case"top-left":case"top":g=h-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-h}switch(n){case"top-right":case"bottom-right":case"right":d=-a;break;case"top-left":case"bottom-left":case"left":d=a}return[d,g]}(e,t[0],t[1]):function(n,a){let h=0,d=0;a<0&&(a=0);const g=a/Qf;switch(n){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-a;break;case"top":d=a-7}switch(n){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=a;break;case"right":h=-a}return[h,d]}(e,t[0])}function tm(e,t,n,a,h,d,g,v,w,C){e.createArrays(),e.tilePixelRatio=ai/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const k=e.layers[0].layout,I=e.layers[0]._unevaluatedLayout._values,P={};if("composite"===e.textSizeData.kind){const{minZoom:H,maxZoom:Y}=e.textSizeData;P.compositeTextSizes=[I["text-size"].possiblyEvaluate(new Ze(H),v),I["text-size"].possiblyEvaluate(new Ze(Y),v)]}if("composite"===e.iconSizeData.kind){const{minZoom:H,maxZoom:Y}=e.iconSizeData;P.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new Ze(H),v),I["icon-size"].possiblyEvaluate(new Ze(Y),v)]}P.layoutTextSize=I["text-size"].possiblyEvaluate(new Ze(w+1),v),P.layoutIconSize=I["icon-size"].possiblyEvaluate(new Ze(w+1),v),P.textMaxSize=I["text-size"].possiblyEvaluate(new Ze(18),v);const U="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),G=k.get("text-size");for(const H of e.features){const Y=k.get("text-font").evaluate(H,{},v).join(","),nt=G.evaluate(H,{},v),ct=P.layoutTextSize.evaluate(H,{},v),yt=(P.layoutIconSize.evaluate(H,{},v),{horizontal:{},vertical:void 0}),vt=H.text;let bt,Mt=[0,0];if(vt){const ne=vt.toString(),Ht=24*k.get("text-letter-spacing").evaluate(H,{},v),Ft=24*k.get("text-line-height").evaluate(H,{},v),Qt=Dt(ne)?Ht:0,Jt=k.get("text-anchor").evaluate(H,{},v),$t=k.get("text-variable-anchor");if(!$t){const f=k.get("text-radial-offset").evaluate(H,{},v);Mt=f?Nu(Jt,[24*f,Uu]):k.get("text-offset").evaluate(H,{},v).map(_=>24*_)}let pe=U?"center":k.get("text-justify").evaluate(H,{},v);const o=k.get("symbol-placement"),s="point"===o,r="point"===o?24*k.get("text-max-width").evaluate(H,{},v):0,c=f=>{e.allowVerticalPlacement&&Lt(ne)&&(yt.vertical=Ou(vt,t,n,h,Y,r,Ft,Jt,f,Qt,Mt,zr.vertical,!0,o,ct,nt))};if(!U&&$t){const f="auto"===pe?$t.map(x=>ju(x)):[pe];let _=!1;for(let x=0;x<f.length;x++){const M=f[x];if(!yt.horizontal[M])if(_)yt.horizontal[M]=yt.horizontal[0];else{const S=Ou(vt,t,n,h,Y,r,Ft,"center",M,Qt,Mt,zr.horizontal,!1,o,ct,nt);S&&(yt.horizontal[M]=S,_=1===S.positionedLines.length)}}c("left")}else{if("auto"===pe&&(pe=ju(Jt)),s||k.get("text-writing-mode").indexOf("horizontal")>=0||!Lt(ne)){const f=Ou(vt,t,n,h,Y,r,Ft,Jt,pe,Qt,Mt,zr.horizontal,!1,o,ct,nt);f&&(yt.horizontal[pe]=f)}c("point"===o?"left":pe)}}let Vt=!1;if(H.icon&&H.icon.name){const ne=a[H.icon.name];ne&&(bt=qf(h[H.icon.name],k.get("icon-offset").evaluate(H,{},v),k.get("icon-anchor").evaluate(H,{},v)),Vt=ne.sdf,void 0===e.sdfIcons?e.sdfIcons=ne.sdf:e.sdfIcons!==ne.sdf&&bi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ne.pixelRatio!==e.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const Ot=Gu(yt.horizontal)||yt.vertical;e.iconsInText||(e.iconsInText=!!Ot&&Ot.iconsInText),(Ot||bt)&&em(e,H,yt,bt,a,P,ct,0,Mt,Vt,g,v,C)}d&&e.generateCollisionDebugBuffers(w,e.collisionBoxArray)}function ju(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function em(e,t,n,a,h,d,g,v,w,C,k,I,P){let U=d.textMaxSize.evaluate(t,{},I);void 0===U&&(U=g);const G=e.layers[0].layout,H=G.get("icon-offset").evaluate(t,{},I),Y=Gu(n.horizontal)||n.vertical,nt=g/24,ct=e.tilePixelRatio*U/24,yt=e.tilePixelRatio*G.get("symbol-spacing"),vt=G.get("text-padding")*e.tilePixelRatio,bt=G.get("icon-padding")*e.tilePixelRatio,Mt=Ve(G.get("text-max-angle")),Vt="map"===G.get("text-rotation-alignment")&&"point"!==G.get("symbol-placement"),Ot="map"===G.get("icon-rotation-alignment")&&"point"!==G.get("symbol-placement"),ne=G.get("symbol-placement"),Ht=yt/2,Ft=G.get("icon-text-fit");let Qt;a&&"none"!==Ft&&(e.allowVerticalPlacement&&n.vertical&&(Qt=ip(a,n.vertical,Ft,G.get("icon-text-fit-padding"),H,nt)),Y&&(a=ip(a,Y,Ft,G.get("icon-text-fit-padding"),H,nt)));const Jt=($t,pe,o)=>{if(pe.x<0||pe.x>=ai||pe.y<0||pe.y>=ai)return;const{x:s,y:r,z:c}=P.projectTilePoint(pe.x,pe.y,o),f=new gr(s,r,c,0,void 0);!function(_,x,M,S,D,L,j,q,et,ut,mt,wt,Et,Gt,se,Kt,zt,ae,fe,ge,ce,Xe,Be,We,ci){const Ii=_.addToLineVertexArray(x,S);let He,oi,en,Fn,ks,ka,Ds,kl=0,Dl=0,Vh=0,Uh=0,Cm=-1,Sm=-1;const Da={};let Rm=Hs(""),Am=0,Em=0;if(void 0===et._unevaluatedLayout.getValue("text-radial-offset")?[Am,Em]=et.layout.get("text-offset").evaluate(ce,{},ci).map(jr=>24*jr):(Am=24*et.layout.get("text-radial-offset").evaluate(ce,{},ci),Em=Uu),_.allowVerticalPlacement&&D.vertical){const jr=D.vertical;if(se)ka=Zu(jr),q&&(Ds=Zu(q));else{const Gr=et.layout.get("text-rotate").evaluate(ce,{},ci)+90;en=Ch(ut,M,x,mt,wt,Et,jr,Gt,Gr,Kt),q&&(Fn=Ch(ut,M,x,mt,wt,Et,q,ae,Gr))}}if(L){const jr=et.layout.get("icon-rotate").evaluate(ce,{},ci),Gr="none"!==et.layout.get("icon-text-fit"),ad=cp(L,jr,Be,Gr),Dm=q?cp(q,jr,Be,Gr):void 0;oi=Ch(ut,M,x,mt,wt,Et,L,ae,jr),kl=4*ad.length;const Lm=_.iconSizeData;let bc=null;"source"===Lm.kind?(bc=[Cs*et.layout.get("icon-size").evaluate(ce,{},ci)],bc[0]>Mo&&bi(`${_.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Lm.kind&&(bc=[Cs*Xe.compositeIconSizes[0].evaluate(ce,{},ci),Cs*Xe.compositeIconSizes[1].evaluate(ce,{},ci)],(bc[0]>Mo||bc[1]>Mo)&&bi(`${_.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),_.addSymbols(_.icon,ad,bc,ge,fe,ce,!1,M,x,Ii.lineStartIndex,Ii.lineLength,-1,We,ci),Cm=_.icon.placedSymbolArray.length-1,Dm&&(Dl=4*Dm.length,_.addSymbols(_.icon,Dm,bc,ge,fe,ce,zr.vertical,M,x,Ii.lineStartIndex,Ii.lineLength,-1,We,ci),Sm=_.icon.placedSymbolArray.length-1)}for(const jr in D.horizontal){const Gr=D.horizontal[jr];He||(Rm=Hs(Gr.text),se?ks=Zu(Gr):He=Ch(ut,M,x,mt,wt,Et,Gr,Gt,et.layout.get("text-rotate").evaluate(ce,{},ci),Kt));const ad=1===Gr.positionedLines.length;if(Vh+=up(_,M,x,Gr,j,et,se,ce,Kt,Ii,D.vertical?zr.horizontal:zr.horizontalOnly,ad?Object.keys(D.horizontal):[jr],Da,Cm,Xe,We,ci),ad)break}D.vertical&&(Uh+=up(_,M,x,D.vertical,j,et,se,ce,Kt,Ii,zr.vertical,["vertical"],Da,Sm,Xe,We,ci));let Il=-1;const km=(jr,Gr)=>jr?Math.max(jr,Gr):Gr;Il=km(ks,Il),Il=km(ka,Il),Il=km(Ds,Il);const Vm=Il>-1?1:0;_.glyphOffsetArray.length>=ia.MAX_GLYPHS&&bi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ce.sortKey&&_.addToSortKeyRanges(_.symbolInstances.length,ce.sortKey),_.symbolInstances.emplaceBack(M.x,M.y,M.z,x.x,x.y,Da.right>=0?Da.right:-1,Da.center>=0?Da.center:-1,Da.left>=0?Da.left:-1,Da.vertical>=0?Da.vertical:-1,Cm,Sm,Rm,void 0!==He?He:_.collisionBoxArray.length,void 0!==He?He+1:_.collisionBoxArray.length,void 0!==en?en:_.collisionBoxArray.length,void 0!==en?en+1:_.collisionBoxArray.length,void 0!==oi?oi:_.collisionBoxArray.length,void 0!==oi?oi+1:_.collisionBoxArray.length,Fn||_.collisionBoxArray.length,Fn?Fn+1:_.collisionBoxArray.length,mt,Vh,Uh,kl,Dl,Vm,0,Am,Em,Il)}(e,pe,f,$t,n,a,h,Qt,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,vt,Vt,w,0,bt,Ot,H,t,d,C,k,I)};if("line"===ne)for(const $t of ap(t.geometry,0,0,ai,ai)){const pe=Wf($t,yt,Mt,n.vertical||Y,a,24,ct,e.overscaling,ai);for(const o of pe){const s=Y;s&&dp(e,s.text,Ht,o)||Jt($t,o,I)}}else if("line-center"===ne){for(const $t of t.geometry)if($t.length>1){const pe=Bu($t,Mt,n.vertical||Y,a,24,ct);pe&&Jt($t,pe,I)}}else if("Polygon"===t.type)for(const $t of Cu(t.geometry,0)){const pe=Kf($t,16);Jt($t[0],new gr(pe.x,pe.y,0,0,void 0),I)}else if("LineString"===t.type)for(const $t of t.geometry)Jt($t,new gr($t[0].x,$t[0].y,0,0,void 0),I);else if("Point"===t.type)for(const $t of t.geometry)for(const pe of $t)Jt([pe],new gr(pe.x,pe.y,0,0,void 0),I)}const Mo=32640;function up(e,t,n,a,h,d,g,v,w,C,k,I,P,U,G,H,Y){const nt=function(vt,bt,Mt,Vt,Ot,ne,Ht,Ft){const Qt=[];if(0===bt.positionedLines.length)return Qt;const Jt=Vt.layout.get("text-rotate").evaluate(ne,{})*Math.PI/180,$t=function(c){const f=c[0],_=c[1],x=f*_;return x>0?[f,-_]:x<0?[-f,_]:0===f?[_,f]:[_,-f]}(Mt);let pe=Math.abs(bt.top-bt.bottom);for(const c of bt.positionedLines)pe-=c.lineOffset;const o=bt.positionedLines.length,s=pe/o;let r=bt.top-Mt[1];for(let c=0;c<o;++c){const f=bt.positionedLines[c];r=Yf(bt,s,r,c);for(const _ of f.positionedGlyphs){if(!_.rect)continue;const x=_.rect||{};let M=4,S=!0,D=1,L=0;if(_.imageName){const Be=Ht[_.imageName];if(!Be)continue;if(Be.sdf){bi("SDF images are not supported in formatted text and will be ignored.");continue}S=!1,D=Be.pixelRatio,M=1/D}const j=(Ot||Ft)&&_.vertical,q=_.metrics.advance*_.scale/2,et=_.metrics,ut=_.rect;if(null===ut)continue;Ft&&bt.verticalizable&&(L=_.imageName?q-_.metrics.width*_.scale/2:0);const mt=Ot?[_.x+q,_.y]:[0,0];let wt=[0,0],Et=[0,0],Gt=!1;Ot||(j?(Et=[_.x+q+$t[0],_.y+$t[1]-L],Gt=!0):wt=[_.x+q+Mt[0],_.y+Mt[1]-L]);const se=ut.w*_.scale/(D*(_.localGlyph?2:1)),Kt=ut.h*_.scale/(D*(_.localGlyph?2:1));let zt,ae,fe,ge;if(j){const Be=_.y-r,We=new jt(-q,q-Be),ci=-Math.PI/2,Ii=new jt(...Et);zt=new jt(-q+wt[0],wt[1]),zt._rotateAround(ci,We)._add(Ii),zt.x+=-Be+q,zt.y-=(et.left-M)*_.scale;const He=_.imageName?et.advance*_.scale:24*_.scale,oi=String.fromCharCode(_.glyph);zf(oi)?zt.x+=(1-M)*_.scale:Rf(oi)?zt.x+=He-et.height*_.scale+(-M-1)*_.scale:zt.x+=_.imageName||et.width+2*M===ut.w&&et.height+2*M===ut.h?(He-Kt)/2:(He-(et.height+2*M)*_.scale)/2,ae=new jt(zt.x,zt.y-se),fe=new jt(zt.x+Kt,zt.y),ge=new jt(zt.x+Kt,zt.y-se)}else{const Be=(et.left-M)*_.scale-q+wt[0],We=(-et.top-M)*_.scale+wt[1],ci=Be+se,Ii=We+Kt;zt=new jt(Be,We),ae=new jt(ci,We),fe=new jt(Be,Ii),ge=new jt(ci,Ii)}if(Jt){let Be;Be=Ot?new jt(0,0):Gt?new jt($t[0],$t[1]):new jt(Mt[0],Mt[1]),zt._rotateAround(Jt,Be),ae._rotateAround(Jt,Be),fe._rotateAround(Jt,Be),ge._rotateAround(Jt,Be)}const ce=new jt(0,0),Xe=new jt(0,0);Qt.push({tl:zt,tr:ae,bl:fe,br:ge,tex:x,writingMode:bt.writingMode,glyphOffset:mt,sectionIndex:_.sectionIndex,isSDF:S,pixelOffsetTL:ce,pixelOffsetBR:Xe,minFontScaleX:0,minFontScaleY:0})}}return Qt}(0,a,w,d,g,v,h,e.allowVerticalPlacement),ct=e.textSizeData;let yt=null;"source"===ct.kind?(yt=[Cs*d.layout.get("text-size").evaluate(v,{},Y)],yt[0]>Mo&&bi(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ct.kind&&(yt=[Cs*G.compositeTextSizes[0].evaluate(v,{},Y),Cs*G.compositeTextSizes[1].evaluate(v,{},Y)],(yt[0]>Mo||yt[1]>Mo)&&bi(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,nt,yt,w,g,v,k,t,n,C.lineStartIndex,C.lineLength,U,H,Y);for(const vt of I)P[vt]=e.text.placedSymbolArray.length-1;return 4*nt.length}function Gu(e){for(const t in e)return e[t];return null}function Ch(e,t,n,a,h,d,g,v,w,C){let k=g.top,I=g.bottom,P=g.left,U=g.right;const G=g.collisionPadding;if(G&&(P-=G[0],k-=G[1],U+=G[2],I+=G[3]),w){const H=new jt(P,k),Y=new jt(U,k),nt=new jt(P,I),ct=new jt(U,I),yt=Ve(w);let vt=new jt(0,0);C&&(vt=new jt(C[0],C[1])),H._rotateAround(yt,vt),Y._rotateAround(yt,vt),nt._rotateAround(yt,vt),ct._rotateAround(yt,vt),P=Math.min(H.x,Y.x,nt.x,ct.x),U=Math.max(H.x,Y.x,nt.x,ct.x),k=Math.min(H.y,Y.y,nt.y,ct.y),I=Math.max(H.y,Y.y,nt.y,ct.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,P,k,U,I,v,a,h,d),e.length-1}function Zu(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function dp(e,t,n,a){const h=e.compareText;if(t in h){const d=h[t];for(let g=d.length-1;g>=0;g--)if(a.dist(d[g])<n)return!0}else h[t]=[];return h[t].push(a),!1}const im=is.VectorTileFeature.types,nm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sh(e,t,n,a,h,d,g,v,w,C,k,I,P,U,G,H){const Y=k?Math.min(Mo,Math.round(k[0])):0,nt=k?Math.min(Mo,Math.round(k[1])):0;e.emplaceBack(t,n,Math.round(32*g),Math.round(32*v),w,C,(Y<<1)+(I?1:0),nt,16*P,16*U,256*G,256*H,a,h,d,0)}function To(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function rm(e){for(const t of e.sections)if(te(t.text))return!0;return!1}class $u{constructor(t){this.layoutVertexArray=new qc,this.indexArray=new kr,this.programConfigurations=t,this.segments=new tn,this.dynamicLayoutVertexArray=new bs,this.opacityVertexArray=new Yh,this.placedSymbolArray=new hd}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,n,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sf.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Af.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,nm,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}_e("SymbolBuffers",$u);class Ah{constructor(t,n,a){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new a,this.segments=new tn,this.collisionVertexArray=new Kh,this.collisionVertexArrayExt=new bs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ef.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,kf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}_e("CollisionBuffers",Ah);class ia{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Oe([]),this.placementViewportMatrix=Oe([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zu(this.zoom,n["text-size"]),this.iconSizeData=zu(this.zoom,n["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==d&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===d||"auto"===d&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(g=>zr[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new $u(new go(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new $u(new go(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new nu,this.lineVertexArray=new ru,this.symbolInstances=new iu}calculateGlyphDependencies(t,n,a,h,d){for(let g=0;g<t.length;g++)if(n[t.charCodeAt(g)]=!0,h&&d){const v=hc[t.charAt(g)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,a,h){const d=this.layers[0],g=d.layout,v=g.get("text-font"),w=g.get("text-field"),C=g.get("icon-image"),k=("constant"!==w.value.kind||w.value.value instanceof Ye&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==v.value.kind||v.value.value.length>0),I="constant"!==C.value.kind||!!C.value.value||Object.keys(C.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!k&&!I)return;const U=n.iconDependencies,G=n.glyphDependencies,H=n.availableImages,Y=new Ze(this.zoom);for(const{feature:nt,id:ct,index:yt,sourceLayerIndex:vt}of t){const bt=d._featureFilter.needGeometry,Mt=xo(nt,bt);if(!d._featureFilter.filter(Y,Mt,a))continue;let Vt,Ot;if(bt||(Mt.geometry=Qs(nt,a,h)),k){const Ht=d.getValueAndResolveTokens("text-field",Mt,a,H),Ft=Ye.factory(Ht);rm(Ft)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===fr()||this.hasRTLText&&hi.isParsed())&&(Vt=Pf(Ft,d,Mt))}if(I){const Ht=d.getValueAndResolveTokens("icon-image",Mt,a,H);Ot=Ht instanceof cr?Ht:cr.fromString(Ht)}if(!Vt&&!Ot)continue;const ne=this.sortFeaturesByKey?P.evaluate(Mt,{},a):void 0;if(this.features.push({id:ct,text:Vt,icon:Ot,index:yt,sourceLayerIndex:vt,geometry:Mt.geometry,properties:nt.properties,type:im[nt.type],sortKey:ne}),Ot&&(U[Ot.name]=!0),Vt){const Ht=v.evaluate(Mt,{},a).join(","),Ft="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zr.vertical)>=0;for(const Qt of Vt.sections)if(Qt.image)U[Qt.image.name]=!0;else{const Jt=Lt(Vt.toString()),$t=Qt.fontStack||Ht,pe=G[$t]=G[$t]||{};this.calculateGlyphDependencies(Qt.text,pe,Ft,this.allowVerticalPlacement,Jt)}}}"line"===g.get("symbol-placement")&&(this.features=function(nt){const ct={},yt={},vt=[];let bt=0;function Mt(Ht){vt.push(nt[Ht]),bt++}function Vt(Ht,Ft,Qt){const Jt=yt[Ht];return delete yt[Ht],yt[Ft]=Jt,vt[Jt].geometry[0].pop(),vt[Jt].geometry[0]=vt[Jt].geometry[0].concat(Qt[0]),Jt}function Ot(Ht,Ft,Qt){const Jt=ct[Ft];return delete ct[Ft],ct[Ht]=Jt,vt[Jt].geometry[0].shift(),vt[Jt].geometry[0]=Qt[0].concat(vt[Jt].geometry[0]),Jt}function ne(Ht,Ft,Qt){const Jt=Qt?Ft[0][Ft[0].length-1]:Ft[0][0];return`${Ht}:${Jt.x}:${Jt.y}`}for(let Ht=0;Ht<nt.length;Ht++){const Ft=nt[Ht],Qt=Ft.geometry,Jt=Ft.text?Ft.text.toString():null;if(!Jt){Mt(Ht);continue}const $t=ne(Jt,Qt),pe=ne(Jt,Qt,!0);if($t in yt&&pe in ct&&yt[$t]!==ct[pe]){const o=Ot($t,pe,Qt),s=Vt($t,pe,vt[o].geometry);delete ct[$t],delete yt[pe],yt[ne(Jt,vt[s].geometry,!0)]=s,vt[o].geometry=null}else $t in yt?Vt($t,pe,Qt):pe in ct?Ot($t,pe,Qt):(Mt(Ht),ct[$t]=bt-1,yt[pe]=bt-1)}return vt.filter(Ht=>Ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((nt,ct)=>nt.sortKey-ct.sortKey)}update(t,n,a,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,a,h),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,a,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const a=this.lineVertexArray.length;if(void 0!==t.segment){let h=t.dist(n[t.segment+1]),d=t.dist(n[t.segment]);const g={};for(let v=t.segment+1;v<n.length;v++)g[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:h},v<n.length-1&&(h+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)g[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:d},v>0&&(d+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const w=g[v];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,n,a,h,d,g,v,w,C,k,I,P,U,G){const H=t.indexArray,Y=t.layoutVertexArray,nt=t.segments.prepareSegment(4*n.length,Y,H,this.canOverlap?g.sortKey:void 0),ct=this.glyphOffsetArray.length,yt=nt.vertexLength,vt=this.allowVerticalPlacement&&v===zr.vertical?Math.PI/2:0,bt=g.text&&g.text.sections;for(let Mt=0;Mt<n.length;Mt++){const{tl:Vt,tr:Ot,bl:ne,br:Ht,tex:Ft,pixelOffsetTL:Qt,pixelOffsetBR:Jt,minFontScaleX:$t,minFontScaleY:pe,glyphOffset:o,isSDF:s,sectionIndex:r}=n[Mt],c=nt.vertexLength,f=o[1];Sh(Y,w.x,w.y,w.z,C.x,C.y,Vt.x,f+Vt.y,Ft.x,Ft.y,a,s,Qt.x,Qt.y,$t,pe),Sh(Y,w.x,w.y,w.z,C.x,C.y,Ot.x,f+Ot.y,Ft.x+Ft.w,Ft.y,a,s,Jt.x,Qt.y,$t,pe),Sh(Y,w.x,w.y,w.z,C.x,C.y,ne.x,f+ne.y,Ft.x,Ft.y+Ft.h,a,s,Qt.x,Jt.y,$t,pe),Sh(Y,w.x,w.y,w.z,C.x,C.y,Ht.x,f+Ht.y,Ft.x+Ft.w,Ft.y+Ft.h,a,s,Jt.x,Jt.y,$t,pe),To(t.dynamicLayoutVertexArray,w,vt),H.emplaceBack(c,c+1,c+2),H.emplaceBack(c+1,c+2,c+3),nt.vertexLength+=4,nt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(o[0]),Mt!==n.length-1&&r===n[Mt+1].sectionIndex||t.programConfigurations.populatePaintArrays(Y.length,g,g.index,{},U,G,bt&&bt[r])}t.placedSymbolArray.emplaceBack(w.x,w.y,w.z,C.x,C.y,ct,this.glyphOffsetArray.length-ct,yt,k,I,C.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,P,0)}_commitLayoutVertex(t,n,a,h,d,g,v){t.emplaceBack(n,a,h,d,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(t,n,a,h,d,g,v){const w=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),C=w.vertexLength,k=v.tileAnchorX,I=v.tileAnchorY;for(let U=0;U<4;U++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(n,-t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(n,t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(n,t.padding,t.padding),a.collisionVertexArrayExt.emplaceBack(n,-t.padding,t.padding),this._commitLayoutVertex(a.layoutVertexArray,h,d,g,k,I,new jt(t.x1,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,d,g,k,I,new jt(t.x2,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,d,g,k,I,new jt(t.x2,t.y2)),this._commitLayoutVertex(a.layoutVertexArray,h,d,g,k,I,new jt(t.x1,t.y2)),w.vertexLength+=4;const P=a.indexArray;P.emplaceBack(C,C+1),P.emplaceBack(C+1,C+2),P.emplaceBack(C+2,C+3),P.emplaceBack(C+3,C),w.primitiveLength+=4}_addTextDebugCollisionBoxes(t,n,a,h,d,g){for(let v=h;v<d;v++){const w=a.get(v),C=this.getSymbolInstanceTextSize(t,g,n,v);this._addCollisionDebugVertices(w,C,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,n,a,h,d,g){for(let v=h;v<d;v++){const w=a.get(v),C=this.getSymbolInstanceIconSize(t,n,v);this._addCollisionDebugVertices(w,C,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ah(Zs,Gd.members,xa),this.iconCollisionBox=new Ah(Zs,Gd.members,xa);const a=yl(this.iconSizeData,t),h=yl(this.textSizeData,t);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(h,t,n,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,t,n,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,t,n,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,t,n,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,n,a,h){const d=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:h),g=_h(this.textSizeData,t,d)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,n,a){const h=this.icon.placedSymbolArray.get(a),d=_h(this.iconSizeData,t,h);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(t,n,a){t.emplaceBack(n,-a,-a),t.emplaceBack(n,a,-a),t.emplaceBack(n,a,a),t.emplaceBack(n,-a,a)}_updateTextDebugCollisionBoxes(t,n,a,h,d,g){for(let v=h;v<d;v++){const w=a.get(v),C=this.getSymbolInstanceTextSize(t,g,n,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,w.padding)}}_updateIconDebugCollisionBoxes(t,n,a,h,d){for(let g=h;g<d;g++){const v=a.get(g),w=this.getSymbolInstanceIconSize(t,n,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,v.padding)}}updateCollisionDebugBuffers(t,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=yl(this.iconSizeData,t),h=yl(this.textSizeData,t);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(h,t,n,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(h,t,n,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(a,t,n,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(a,t,n,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,n,a,h,d,g,v,w,C){const k={};for(let I=n;I<a;I++){const P=t.get(I);k.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},k.textFeatureIndex=P.featureIndex;break}for(let I=h;I<d;I++){const P=t.get(I);k.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},k.verticalTextFeatureIndex=P.featureIndex;break}for(let I=g;I<v;I++){const P=t.get(I);k.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},k.iconFeatureIndex=P.featureIndex;break}for(let I=w;I<C;I++){const P=t.get(I);k.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},k.verticalIconFeatureIndex=P.featureIndex;break}return k}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const a=t.placedSymbolArray.get(n),h=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<h;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(t),a=Math.cos(t),h=[],d=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(n*w.tileAnchorX+a*w.tileAnchorY)),d.push(w.featureIndex)}return g.sort((v,w)=>h[v]-h[w]||d[w]-d[v]),g}addToSortKeyRanges(t,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,d,g)=>{h>=0&&g.indexOf(h)===d&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}_e("SymbolBucket",ia,{omit:["layers","collisionBoxArray","features","compareText"]}),ia.MAX_GLYPHS=65535,ia.addDynamicAttributes=To;const sm=new wn({"symbol-placement":new ve(Rt.layout_symbol["symbol-placement"]),"symbol-spacing":new ve(Rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ve(Rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ee(Rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ve(Rt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ve(Rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ve(Rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ve(Rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ve(Rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ee(Rt.layout_symbol["icon-size"]),"icon-text-fit":new ve(Rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ve(Rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ee(Rt.layout_symbol["icon-image"]),"icon-rotate":new Ee(Rt.layout_symbol["icon-rotate"]),"icon-padding":new ve(Rt.layout_symbol["icon-padding"]),"icon-keep-upright":new ve(Rt.layout_symbol["icon-keep-upright"]),"icon-offset":new Ee(Rt.layout_symbol["icon-offset"]),"icon-anchor":new Ee(Rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ve(Rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ve(Rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ve(Rt.layout_symbol["text-rotation-alignment"]),"text-field":new Ee(Rt.layout_symbol["text-field"]),"text-font":new Ee(Rt.layout_symbol["text-font"]),"text-size":new Ee(Rt.layout_symbol["text-size"]),"text-max-width":new Ee(Rt.layout_symbol["text-max-width"]),"text-line-height":new Ee(Rt.layout_symbol["text-line-height"]),"text-letter-spacing":new Ee(Rt.layout_symbol["text-letter-spacing"]),"text-justify":new Ee(Rt.layout_symbol["text-justify"]),"text-radial-offset":new Ee(Rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ve(Rt.layout_symbol["text-variable-anchor"]),"text-anchor":new Ee(Rt.layout_symbol["text-anchor"]),"text-max-angle":new ve(Rt.layout_symbol["text-max-angle"]),"text-writing-mode":new ve(Rt.layout_symbol["text-writing-mode"]),"text-rotate":new Ee(Rt.layout_symbol["text-rotate"]),"text-padding":new ve(Rt.layout_symbol["text-padding"]),"text-keep-upright":new ve(Rt.layout_symbol["text-keep-upright"]),"text-transform":new Ee(Rt.layout_symbol["text-transform"]),"text-offset":new Ee(Rt.layout_symbol["text-offset"]),"text-allow-overlap":new ve(Rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ve(Rt.layout_symbol["text-ignore-placement"]),"text-optional":new ve(Rt.layout_symbol["text-optional"])});var Hu={paint:new wn({"icon-opacity":new Ee(Rt.paint_symbol["icon-opacity"]),"icon-color":new Ee(Rt.paint_symbol["icon-color"]),"icon-halo-color":new Ee(Rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ee(Rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ee(Rt.paint_symbol["icon-halo-blur"]),"icon-translate":new ve(Rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ve(Rt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ee(Rt.paint_symbol["text-opacity"]),"text-color":new Ee(Rt.paint_symbol["text-color"],{runtimeType:jn,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Ee(Rt.paint_symbol["text-halo-color"]),"text-halo-width":new Ee(Rt.paint_symbol["text-halo-width"]),"text-halo-blur":new Ee(Rt.paint_symbol["text-halo-blur"]),"text-translate":new ve(Rt.paint_symbol["text-translate"]),"text-translate-anchor":new ve(Rt.paint_symbol["text-translate-anchor"])}),layout:sm};class pp{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:$r,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_e("FormatSectionOverride",pp,{omit:["defaultValue"]});class Tl extends es{constructor(t){super(t,Hu)}recalculate(t,n){super.recalculate(t,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const d of a)h.indexOf(d)<0&&h.push(d);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,n,a,h){const d=this.layout.get(t).evaluate(n,{},a,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||fa(g.value)||!d?d:(v=n.properties,d.replace(/{([^{}]+)}/g,(C,k)=>k in v?String(v[k]):""));var v}createBucket(t){return new ia(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Hu.paint.overridableProperties){if(!Tl.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),a=new pp(n),h=new Bl(a,n.property.specification);let d=null;d="constant"===n.value.kind||"source"===n.value.kind?new Qa("source",h):new Xo("composite",h,n.value.zoomStops,n.value._interpolationType),this.paint._values[t]=new bn(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Tl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const a=t.get("text-field"),h=Hu.paint.properties[n];let d=!1;const g=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(d=!0)};if("constant"===a.value.kind&&a.value.value instanceof Ye)g(a.value.value.sections);else if("source"===a.value.kind){const v=C=>{d||(C instanceof Fr&&rn(C.value)===An?g(C.value.sections):C instanceof Mr?g(C.sections):C.eachChild(v))},w=a.value;w._styleExpression&&v(w._styleExpression.expression)}return d}getProgramConfiguration(t){return new Ys(this,t)}}var am={paint:new wn({"background-color":new ve(Rt.paint_background["background-color"]),"background-pattern":new js(Rt.paint_background["background-pattern"]),"background-opacity":new ve(Rt.paint_background["background-opacity"])})},qu={paint:new wn({"raster-opacity":new ve(Rt.paint_raster["raster-opacity"]),"raster-hue-rotate":new ve(Rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ve(Rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ve(Rt.paint_raster["raster-brightness-max"]),"raster-saturation":new ve(Rt.paint_raster["raster-saturation"]),"raster-contrast":new ve(Rt.paint_raster["raster-contrast"]),"raster-resampling":new ve(Rt.paint_raster["raster-resampling"]),"raster-fade-duration":new ve(Rt.paint_raster["raster-fade-duration"])})};class om extends es{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var lm={paint:new wn({"sky-type":new ve(Rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new ve(Rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ve(Rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ve(Rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ve(Rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new vs(Rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ve(Rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ve(Rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ve(Rt.paint_sky["sky-opacity"])})};function Eh(e,t,n){const a=we(0,0,1),h=ra(rr());return function(d,g,v){v*=.5;var w=g[0],C=g[1],k=g[2],I=g[3],P=Math.sin(v),U=Math.cos(v);d[0]=w*U-k*P,d[1]=C*U+I*P,d[2]=k*U+w*P,d[3]=I*U-C*P}(h,h,n?-Ve(e)+Math.PI:Ve(e)),Ci(h,h,-Ve(t)),hn(a,a,h),qn(a,a)}const cm={circle:class extends es{constructor(e){super(e,kd)}createBucket(e){return new du(e)}queryRadius(e){const t=e;return Ms("circle-radius",this,t)+Ms("circle-stroke-width",this,t)+eh(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,a,h,d,g,v){const w=ic(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,e.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return nh(e,a,d,g,v,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,C)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new Ys(this,e)}},heatmap:class extends es{createBucket(e){return new Dd(e)}constructor(e){super(e,nf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Ms("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,a,h,d,g,v){const w=this.paint.get("heatmap-radius").evaluate(t,n);return nh(e,a,d,g,v,!0,!0,new jt(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new Ys(this,e)}},hillshade:class extends es{constructor(e){super(e,pl)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(e){return new Ys(this,e)}},fill:class extends es{constructor(e){super(e,uf)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(e){return new Ys(this,e)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new dh(e)}queryRadius(){return eh(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,a,h,d){return!e.queryGeometry.isAboveHorizon&&ec(mu(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,e.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends es{constructor(e){super(e,vf)}createBucket(e){return new ku(e)}queryRadius(){return eh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new Ys(this,e)}queryIntersectsFeature(e,t,n,a,h,d,g,v,w){const C=ic(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,e.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(t,n),I=this.paint.get("fill-extrusion-base").evaluate(t,n),P=[0,0],U=v&&d.elevation,G=d.elevation?d.elevation.exaggeration():1;if(U){const nt=e.tile.getBucket(this).centroidVertexArray,ct=w+1;if(ct<nt.length){const yt=nt.get(ct);P[0]=yt.a_centroid_pos0,P[1]=yt.a_centroid_pos1}}if(0===P[0]&&1===P[1])return!1;const H=(nt=a,ct=I,yt=k,vt=C,bt=g,(Mt=U?v:null)?function(Ht,Ft,Qt,Jt,$t,pe,o,s,r){const c=[],f=[],_=[0,0,0,1];for(const x of Ht){const M=[],S=[];for(const D of x){const L=D.x+Jt.x,j=D.y+Jt.y,q=ph(L,j,Ft,Qt,pe,o,s,r);_[0]=L,_[1]=j,_[2]=q.base,_[3]=1,Wn(_,_,$t),_[3]=Math.max(_[3],1e-5);const et=Nd([_[0]/_[3],_[1]/_[3],_[2]/_[3]]);_[0]=L,_[1]=j,_[2]=q.top,_[3]=1,Wn(_,_,$t),_[3]=Math.max(_[3],1e-5);const ut=Nd([_[0]/_[3],_[1]/_[3],_[2]/_[3]]);M.push(et),S.push(ut)}c.push(M),f.push(S)}return[c,f]}(nt,ct,yt,vt,bt,Mt,P,G,d.center.lat):function(Ht,Ft,Qt,Jt,$t){const pe=[],o=[],s=$t[8]*Ft,r=$t[9]*Ft,c=$t[10]*Ft,f=$t[11]*Ft,_=$t[8]*Qt,x=$t[9]*Qt,M=$t[10]*Qt,S=$t[11]*Qt;for(const D of Ht){const L=[],j=[];for(const q of D){const et=q.x+Jt.x,ut=q.y+Jt.y,mt=$t[0]*et+$t[4]*ut+$t[12],wt=$t[1]*et+$t[5]*ut+$t[13],Et=$t[2]*et+$t[6]*ut+$t[14],Gt=$t[3]*et+$t[7]*ut+$t[15],se=mt+s,Kt=wt+r,zt=Et+c,ae=Math.max(Gt+f,1e-5),fe=mt+_,ge=wt+x,ce=Et+M,Xe=Math.max(Gt+S,1e-5),Be=new jt(se/ae,Kt/ae);Be.z=zt/ae,L.push(Be);const We=new jt(fe/Xe,ge/Xe);We.z=ce/Xe,j.push(We)}pe.push(L),o.push(j)}return[pe,o]}(nt,ct,yt,vt,bt)),Y=e.queryGeometry;var nt,ct,yt,vt,bt,Mt;return function(nt,ct,yt){let vt=1/0;ec(yt,ct)&&(vt=Du(yt,ct[0]));for(let bt=0;bt<ct.length;bt++){const Mt=ct[bt],Vt=nt[bt];for(let Ot=0;Ot<Mt.length-1;Ot++){const ne=Mt[Ot],Ht=[ne,Mt[Ot+1],Vt[Ot+1],Vt[Ot],ne];Md(yt,Ht)&&(vt=Math.min(vt,Du(yt,Ht)))}}return vt!==1/0&&vt}(H[0],H[1],Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends es{constructor(e){super(e,jd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof ua,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=mh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new fh(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new Ys(this,e)}queryRadius(e){const t=e,n=Pu(Ms("line-width",this,t),Ms("line-gap-width",this,t)),a=Ms("line-offset",this,t);return n/2+Math.abs(a)+eh(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,a,h,d){if(e.queryGeometry.isAboveHorizon)return!1;const g=mu(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,e.pixelToTileUnitsFactor),v=e.pixelToTileUnitsFactor/2*Pu(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),w=this.paint.get("line-offset").evaluate(t,n);return w&&(a=function(C,k){const I=[],P=new jt(0,0);for(let U=0;U<C.length;U++){const G=C[U],H=[];for(let Y=0;Y<G.length;Y++){const nt=G[Y-1],ct=G[Y],yt=G[Y+1],vt=0===Y?P:ct.sub(nt)._unit()._perp(),bt=Y===G.length-1?P:yt.sub(ct)._unit()._perp(),Mt=vt._add(bt)._unit();Mt._mult(1/(Mt.x*bt.x+Mt.y*bt.y)),H.push(Mt._mult(k)._add(ct))}I.push(H)}return I}(a,w*e.pixelToTileUnitsFactor)),function(C,k,I){for(let P=0;P<k.length;P++){const U=k[P];if(C.length>=3)for(let G=0;G<U.length;G++)if(dl(C,U[G]))return!0;if(Cd(C,U,I))return!0}return!1}(g,a,v)}isTileClipped(){return!0}},symbol:Tl,background:class extends es{constructor(e){super(e,am)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends es{constructor(e){super(e,qu)}getProgramIds(){return["raster"]}},sky:class extends es{constructor(e){super(e,lm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}}getCenter(e,t){const n=this.paint.get("sky-type");if("atmosphere"===n){const a=this.paint.get("sky-atmosphere-sun"),h=!a,d=e.style.light,g=d.properties.get("position");return h&&"viewport"===d.properties.get("anchor")&&bi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Eh(g.azimuthal,90-g.polar,t):Eh(a[0],90-a[1],t)}if("gradient"===n){const a=this.paint.get("sky-gradient-center");return Eh(a[0],90-a[1],t)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}},{HTMLImageElement:kh,HTMLCanvasElement:fp,HTMLVideoElement:mp,ImageData:_p,ImageBitmap:Dh}=Pt;class fc{constructor(t,n,a,h){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(n,h)}update(t,n,a){const{width:h,height:d}=t,{context:g}=this,{gl:v}=g;if(v.bindTexture(v.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!n||!1!==n.premultiply)),a||this.size&&this.size[0]===h&&this.size[1]===d){const{x:w,y:C}=a||{x:0,y:0};t instanceof kh||t instanceof fp||t instanceof mp||t instanceof _p||Dh&&t instanceof Dh?v.texSubImage2D(v.TEXTURE_2D,0,w,C,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,w,C,h,d,v.RGBA,v.UNSIGNED_BYTE,t.data)}else this.size=[h,d],t instanceof kh||t instanceof fp||t instanceof mp||t instanceof _p||Dh&&t instanceof Dh?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,h,d,0,this.format,v.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(t,n){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:t),this.filter=t),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Ih{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.image=new Ma({width:t,height:n}),this.positions={},this.uploaded=!1}getDash(t,n){const a=this.getKey(t,n);return this.positions[a]}trim(){const t=this.width,n=this.height=Me(this.nextRow);this.image.resize({width:t,height:n})}getKey(t,n){return t.join(",")+n}getDashRanges(t,n,a){const h=[];let d=t.length%2==1?-t[t.length-1]*a:0,g=t[0]*a,v=!0;h.push({left:d,right:g,isDash:v,zeroLength:0===t[0]});let w=t[0];for(let C=1;C<t.length;C++){v=!v;const k=t[C];d=w*a,w+=k,g=w*a,h.push({left:d,right:g,isDash:v,zeroLength:0===k})}return h}addRoundDash(t,n,a){const h=n/2;for(let d=-a;d<=a;d++){const g=this.width*(this.nextRow+a+d);let v=0,w=t[v];for(let C=0;C<this.width;C++){C/w.right>1&&(w=t[++v]);const k=Math.abs(C-w.left),I=Math.abs(C-w.right),P=Math.min(k,I);let U;const G=d/a*(h+1);if(w.isDash){const H=h-Math.abs(G);U=Math.sqrt(P*P+H*H)}else U=h-Math.sqrt(P*P+G*G);this.image.data[g+C]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t,n){for(let w=t.length-1;w>=0;--w){const C=t[w],k=t[w+1];C.zeroLength?t.splice(w,1):k&&k.isDash===C.isDash&&(k.left=C.left,t.splice(w,1))}const a=t[0],h=t[t.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const d=this.width*this.nextRow;let g=0,v=t[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=t[++g]);const C=Math.abs(w-v.left),k=Math.abs(w-v.right),I=Math.min(C,k);this.image.data[d+w]=Math.max(0,Math.min(255,(v.isDash?I:-I)+n+128))}}addDash(t,n){const a=this.getKey(t,n);if(this.positions[a])return this.positions[a];const h="round"===n,d=h?7:0,g=2*d+1;if(this.nextRow+g>this.height)return bi("LineAtlas out of space"),null;0===t.length&&t.push(1);let v=0;for(let k=0;k<t.length;k++)t[k]<0&&(bi("Negative value is found in line dasharray, replacing values with 0"),t[k]=0),v+=t[k];if(0!==v){const k=this.width/v,I=this.getDashRanges(t,this.width,k);h?this.addRoundDash(I,k,d):this.addRegularDash(I,"square"===n?.5*k:0)}const w=this.nextRow+d;this.nextRow+=g;const C={tl:[w,d],br:[v,0]};return this.positions[a]=C,C}}_e("LineAtlas",Ih);class hm{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const gp=Pt.performance;function yp(e){const t=e?e.url.toString():void 0;return gp.getEntriesByName(t)}class um{constructor(){this.tasks={},this.taskQueue=[],Ji(["process"],this),this.invoker=new hm(this.process),this.nextId=0}add(t,n){const a=this.nextId++,h=function({type:d,isSymbolTile:g,zoom:v}){return v=v||0,"message"===d?0:"maybePrepare"!==d||g?"parseTile"!==d||g?"parseTile"===d&&g?300-v:"maybePrepare"===d&&g?400-v:500:200-v:100-v}(n);if(0===h){Rn();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:t,metadata:n,priority:h,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Rn();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let t=null,n=1/0;for(let h=0;h<this.taskQueue.length;h++){const d=this.tasks[this.taskQueue[h]];d.priority<n&&(n=d.priority,t=h)}if(null===t)return null;const a=this.taskQueue[t];return this.taskQueue.splice(t,1),a}remove(){this.invoker.remove()}}function Wu(e,t,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[e*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Ph{constructor(t,n,a){this.z=t,this.x=n,this.y=a,this.key=Cl(0,t,t,n,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n){const a=(g=this.y,v=this.z,w=Wu(256*(d=this.x),256*(g=Math.pow(2,v)-g-1),v),C=Wu(256*(d+1),256*(g+1),v),w[0]+","+w[1]+","+C[0]+","+C[1]),h=function(d,g,v){let w,C="";for(let k=d;k>0;k--)w=1<<k-1,C+=(g&w?1:0)+(v&w?2:0);return C}(this.z,this.x,this.y);var d,g,v,w,C;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yu{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Cl(t,n.z,n.z,n.x,n.y)}}class ir{constructor(t,n,a,h,d){this.overscaledZ=t,this.wrap=n,this.canonical=new Ph(a,+h,+d),this.key=0===n&&t===a?this.canonical.key:Cl(n,t,a,h,d)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const n=this.canonical.z-t;return t>this.canonical.z?new ir(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ir(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n=!0){if(this.overscaledZ===t&&n)return this.key;if(t>this.canonical.z)return Cl(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-t;return Cl(this.wrap*+n,t,t,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new ir(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new ir(n,this.wrap,n,a,h),new ir(n,this.wrap,n,a+1,h),new ir(n,this.wrap,n,a,h+1),new ir(n,this.wrap,n,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ir(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ir(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Cl(e,t,n,a,h){const d=1<<Math.min(n,22);let g=d*(h%d)+a%d;return e&&n<22&&(g+=d*d*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*g+n)+(t-n)}_e("CanonicalTileID",Ph),_e("OverscaledTileID",ir,{omit:["projMatrix"]});class Sl{constructor(t,n,a){this.func=t,this.mask=n,this.range=a}}Sl.ReadOnly=!1,Sl.ReadWrite=!0,Sl.disabled=new Sl(519,Sl.ReadOnly,[0,1]);class Ku{constructor(t,n,a,h,d,g){this.test=t,this.ref=n,this.mask=a,this.fail=h,this.depthFail=d,this.pass=g}}Ku.disabled=new Ku({func:519,mask:0},0,0,7680,7680,7680);class Ss{constructor(t,n,a){this.blendFunction=t,this.blendColor=n,this.mask=a}}Ss.Replace=[1,0],Ss.disabled=new Ss(Ss.Replace,fi.transparent,[!1,!1,!1,!1]),Ss.unblended=new Ss(Ss.Replace,fi.transparent,[!0,!0,!0,!0]),Ss.alphaBlended=new Ss([1,771],fi.transparent,[!0,!0,!0,!0]);class ns{constructor(t,n,a){this.enable=t,this.mode=n,this.frontFace=a}}ns.disabled=new ns(!1,1029,2305),ns.backCCW=new ns(!0,1029,2305),ns.backCW=new ns(!0,1029,2304),ns.frontCW=new ns(!0,1028,2304),ns.frontCCW=new ns(!0,1028,2305);class xp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const a=t[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class vp{constructor(t,n,a,h,d){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=a,t._y=h,this.properties=t.properties,this.id=d}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)"_geometry"!==n&&"_vectorTileFeature"!==n&&(t[n]=this[n]);return t}}class dm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,a){const h=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Ie(this.stateChanges[t][h],a),null===this.deletedStates[t]){this.deletedStates[t]={};for(const d in this.state[t])d!==h&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][h]){this.deletedStates[t][h]={};for(const d in this.state[t][h])a[d]||(this.deletedStates[t][h][d]=null)}else for(const d in a)this.deletedStates[t]&&this.deletedStates[t][h]&&null===this.deletedStates[t][h][d]&&delete this.deletedStates[t][h][d]}removeFeatureState(t,n,a){if(null===this.deletedStates[t])return;const h=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&void 0!==n)null!==this.deletedStates[t][h]&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][a]=null);else if(void 0!==n)if(this.stateChanges[t]&&this.stateChanges[t][h])for(a in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][a]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,n){const a=String(n),h=Ie({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const d=this.deletedStates[t][n];if(null===d)return{};for(const g in d)delete h[g]}return h}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const a={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const d={};for(const g in this.stateChanges[h])this.state[h][g]||(this.state[h][g]={}),Ie(this.state[h][g],this.stateChanges[h][g]),d[g]=this.state[h][g];a[h]=d}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const d={};if(null===this.deletedStates[h])for(const g in this.state[h])d[g]={},this.state[h][g]={};else for(const g in this.deletedStates[h]){if(null===this.deletedStates[h][g])this.state[h][g]={};else for(const v of Object.keys(this.deletedStates[h][g]))delete this.state[h][g][v];d[g]=this.state[h][g]}a[h]=a[h]||{},Ie(a[h],d)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(a).length)for(const h in t)t[h].setFeatureState(a,n)}}class bp{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,n){const a=this.toIdx(t,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(t,n){return this.leaves[this.toIdx(t,n)]}toIdx(t,n){return n*this.size+t}}function wp(e,t,n,a){let h=0,d=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(a[g])<1e-15){if(n[g]<e[g]||n[g]>t[g])return null}else{const v=1/a[g];let w=(e[g]-n[g])*v,C=(t[g]-n[g])*v;if(w>C){const k=w;w=C,C=k}if(w>h&&(h=w),C<d&&(d=C),h>d)return null}return h}function Mp(e,t,n,a,h,d,g,v,w,C,k){const I=a-e,P=h-t,U=d-n,G=g-e,H=v-t,Y=w-n,nt=k[1]*Y-k[2]*H,ct=k[2]*G-k[0]*Y,yt=k[0]*H-k[1]*G,vt=I*nt+P*ct+U*yt;if(Math.abs(vt)<1e-15)return null;const bt=1/vt,Mt=C[0]-e,Vt=C[1]-t,Ot=C[2]-n,ne=(Mt*nt+Vt*ct+Ot*yt)*bt;if(ne<0||ne>1)return null;const Ht=Vt*U-Ot*P,Ft=Ot*I-Mt*U,Qt=Mt*P-Vt*I,Jt=(k[0]*Ht+k[1]*Ft+k[2]*Qt)*bt;return Jt<0||ne+Jt>1?null:(G*Ht+H*Ft+Y*Qt)*bt}function Tp(e,t,n){return(e-t)/(n-t)}function Cp(e,t,n,a,h,d,g,v,w){const C=1<<n,k=d-a,I=g-h,P=(e+1)/C*k+a,U=(t+0)/C*I+h,G=(t+1)/C*I+h;v[0]=(e+0)/C*k+a,v[1]=U,w[0]=P,w[1]=G}class Sp{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(d){const g=Math.ceil(Math.log2(d.dim/8)),v=[];let w=Math.ceil(Math.pow(2,g));const C=1/w,k=(U,G,H,Y,nt)=>{const ct=Y?1:0,yt=(U+1)*H-ct,vt=G*H,bt=(G+1)*H-ct;nt[0]=U*H,nt[1]=vt,nt[2]=yt,nt[3]=bt};let I=new bp(w);const P=[];for(let U=0;U<w*w;U++){k(U%w,Math.floor(U/w),C,!1,P);const G=Sa(P[0],P[1],d),H=Sa(P[2],P[1],d),Y=Sa(P[2],P[3],d),nt=Sa(P[0],P[3],d);I.minimums.push(Math.min(G,H,Y,nt)),I.maximums.push(Math.max(G,H,Y,nt)),I.leaves.push(1)}for(v.push(I),w/=2;w>=1;w/=2){const U=v[v.length-1];I=new bp(w);for(let G=0;G<w*w;G++){k(G%w,Math.floor(G/w),2,!0,P);const H=U.getElevation(P[0],P[1]),Y=U.getElevation(P[2],P[1]),nt=U.getElevation(P[2],P[3]),ct=U.getElevation(P[0],P[3]),yt=U.isLeaf(P[0],P[1]),vt=U.isLeaf(P[2],P[1]),bt=U.isLeaf(P[2],P[3]),Mt=U.isLeaf(P[0],P[3]),Vt=Math.min(H.min,Y.min,nt.min,ct.min),Ot=Math.max(H.max,Y.max,nt.max,ct.max),ne=yt&&vt&&bt&&Mt;I.maximums.push(Ot),I.minimums.push(Vt),I.leaves.push(Ot-Vt<=5&&ne?1:0)}v.push(I)}return v}(this.dem),a=n.length-1,h=n[a];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(t,n,a,h,d,g,v=1){return wp([t,n,-100],[a,h,this.maximums[0]*v],d,g)}raycast(t,n,a,h,d,g,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(t,n,a,h,d,g,v);if(null==w)return null;const C=[],k=[],I=[],P=[],U=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;U.length>0;){const{idx:G,t:H,nodex:Y,nodey:nt,depth:ct}=U.pop();if(this.leaves[G]){Cp(Y,nt,ct,t,n,a,h,I,P);const vt=1<<ct,bt=(Y+0)/vt,Mt=(Y+1)/vt,Vt=(nt+0)/vt,Ot=(nt+1)/vt,ne=Sa(bt,Vt,this.dem)*v,Ht=Sa(Mt,Vt,this.dem)*v,Ft=Sa(Mt,Ot,this.dem)*v,Qt=Sa(bt,Ot,this.dem)*v,Jt=Mp(I[0],I[1],ne,P[0],I[1],Ht,P[0],P[1],Ft,d,g),$t=Mp(P[0],P[1],Ft,I[0],P[1],Qt,I[0],I[1],ne,d,g),pe=Math.min(null!==Jt?Jt:Number.MAX_VALUE,null!==$t?$t:Number.MAX_VALUE);if(pe!==Number.MAX_VALUE)return pe;{const o=fn([],d,g,H);if(Ap(ne,Ht,Qt,Ft,Tp(o[0],I[0],P[0]),Tp(o[1],I[1],P[1]))>=o[2])return H}continue}let yt=0;for(let vt=0;vt<this._siblingOffset.length;vt++){Cp((Y<<1)+this._siblingOffset[vt][0],(nt<<1)+this._siblingOffset[vt][1],ct+1,t,n,a,h,I,P),I[2]=-100,P[2]=this.maximums[this.childOffsets[G]+vt]*v;const bt=wp(I,P,d,g);if(null!=bt){const Mt=bt;C[vt]=Mt;let Vt=!1;for(let Ot=0;Ot<yt&&!Vt;Ot++)Mt>=C[k[Ot]]&&(k.splice(Ot,0,vt),Vt=!0);Vt||(k[yt]=vt),yt++}}for(let vt=0;vt<yt;vt++){const bt=k[vt];U.push({idx:this.childOffsets[G]+bt,t:C[bt],nodex:(Y<<1)+this._siblingOffset[bt][0],nodey:(nt<<1)+this._siblingOffset[bt][1],depth:ct+1})}}return null}_addNode(t,n,a){return this.minimums.push(t),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(t,n,a,h,d){if(1===t[h].isLeaf(n,a))return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const g=h-1,v=t[g];let w,C=0;for(let k=0;k<this._siblingOffset.length;k++){const I=2*n+this._siblingOffset[k][0],P=2*a+this._siblingOffset[k][1],U=v.getElevation(I,P),G=v.isLeaf(I,P),H=this._addNode(U.min,U.max,G);G&&(C|=1<<k),w||(w=H)}for(let k=0;k<this._siblingOffset.length;k++)C&1<<k||this._construct(t,2*n+this._siblingOffset[k][0],2*a+this._siblingOffset[k][1],g,w+k)}}function Ap(e,t,n,a,h,d){return xi(xi(e,n,d),xi(t,a,d),h)}function Sa(e,t,n){const a=n.dim,h=pi(e*a-.5,0,a-1),d=pi(t*a-.5,0,a-1),g=Math.floor(h),v=Math.floor(d),w=Math.min(g+1,a-1),C=Math.min(v+1,a-1);return Ap(n.get(g,v),n.get(w,v),n.get(g,C),n.get(w,C),h-g,d-v)}const Ep={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class zh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,n,a,h=!1,d=!1){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&"mapbox"!==a&&"terrarium"!==a)return bi(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const g=this.dim=n.height-2;if(this.data=new Uint32Array(n.data.buffer),this.encoding=a||"mapbox",this.borderReady=h,!h){for(let v=0;v<g;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(g,v)]=this.data[this._idx(g-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,g)]=this.data[this._idx(v,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Sp(this)}get(t,n,a=!1){const h=new Uint8Array(this.data.buffer);a&&(t=pi(t,-1,this.dim),n=pi(n,-1,this.dim));const d=4*this._idx(t,n);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[d],h[d+1],h[d+2])}static getUnpackVector(t){return Ep[t]}get unpackVector(){return Ep[this.encoding]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}_unpackMapbox(t,n,a){return(256*t*256+256*n+a)/10-1e4}_unpackTerrarium(t,n,a){return 256*t+n+a/256-32768}static pack(t,n){const a=[0,0,0,0],h=zh.getUnpackVector(n);let d=Math.floor((t+h[3])/h[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new mr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,d=n*this.dim+this.dim,g=a*this.dim,v=a*this.dim+this.dim;switch(n){case-1:h=d-1;break;case 1:d=h+1}switch(a){case-1:g=v-1;break;case 1:v=g+1}const w=-n*this.dim,C=-a*this.dim;for(let k=g;k<v;k++)for(let I=h;I<d;I++)this.data[this._idx(I,k)]=t.data[this._idx(I+w,k+C)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}_e("DEMData",zh),_e("DemMinMaxQuadTree",Sp,{omit:["dem"]});class pm{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,a){const h=t.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const d={value:n,timeout:void 0};if(void 0!==a&&(d.timeout=setTimeout(()=>{this.remove(t,d)},a)),this.data[h].push(d),this.order.push(h),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const a=t.wrapped().key,h=void 0===n?0:this.data[a].indexOf(n),d=this.data[a][h];return this.data[a].splice(h,1),d.timeout&&clearTimeout(d.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const a in this.data)for(const h of this.data[a])t(h.value)||n.push(h);for(const a of n)this.remove(a.value.tileID,a)}}class Co extends Nn{constructor(t,n,a){super(),this.id=t,this._onlySymbols=a,n.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new pm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new dm}onAdd(t){this.map=t,this._minTileCacheSize=t?t._minTileCacheSize:null,this._maxTileCacheSize=t?t._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return he(this._tiles).map(t=>t.tileID).sort(kp).map(t=>t.key)}getRenderableIds(t){const n=[];for(const a in this._tiles)this._isIdRenderable(+a,t)&&n.push(this._tiles[a]);return t?n.sort((a,h)=>{const d=a.tileID,g=h.tileID,v=new jt(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),w=new jt(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-g.overscaledZ||w.y-v.y||w.x-v.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(kp).map(a=>a.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const a=this._tiles[t];a&&("loading"!==a.state&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,t,n)))}_tileLoaded(t,n,a,h){if(h)if(t.state="errored",404!==h.status)this._source.fire(new Do(h,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=xn.now(),"expired"===a&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new os("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const d=n[h];if(t.neighboringTiles&&t.neighboringTiles[d]){const g=this.getTileByID(d);a(t,g),a(g,t)}}function a(h,d){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let g=d.tileID.canonical.x-h.tileID.canonical.x;const v=d.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),C=d.tileID.key;0===g&&0===v||Math.abs(v)>1||(Math.abs(g)>1&&(1===Math.abs(g+w)?g+=w:1===Math.abs(g-w)&&(g-=w)),d.dem&&h.dem&&(h.dem.backfillBorder(d.dem,g,v),h.neighboringTiles&&h.neighboringTiles[C]&&(h.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,a,h){for(const d in this._tiles){let g=this._tiles[d];if(h[d]||!g.hasData()||g.tileID.overscaledZ<=n||g.tileID.overscaledZ>a)continue;let v=g.tileID;for(;g&&g.tileID.overscaledZ>n+1;){const C=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[C.key],g&&g.hasData()&&(v=C)}let w=v;for(;w.overscaledZ>n;)if(w=w.scaledTo(w.overscaledZ-1),t[w.key]){h[v.key]=v;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=t.overscaledZ-1;a>=n;a--){const h=t.scaledTo(a),d=this._getLoadedTile(h);if(d)return d}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const a=Math.ceil(t.width/n)+1,h=Math.ceil(t.height/n)+1,d=Math.floor(a*h*5),g="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,d):d,v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(t){const n=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,n){const a={};for(const h in this._tiles){const d=this._tiles[h];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),a[d.tileID.key]=d}this._tiles=a;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(t,n,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let h;this.updateCacheSize(t,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new ir(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(h=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(v=>this._source.hasTile(v)))):h=[];const d=this._updateRetainedTiles(h);if(Dp(this._source.type)&&0!==h.length){const v={},w={},C=Object.keys(d);for(const I of C){const P=d[I],U=this._tiles[I];if(!U||U.fadeEndTime&&U.fadeEndTime<=xn.now())continue;const G=this.findLoadedParent(P,Math.max(P.overscaledZ-Co.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),v[G.tileID.key]=G.tileID),w[I]=P}const k=h[h.length-1].overscaledZ;for(const I in this._tiles){const P=this._tiles[I];if(d[I]||!P.hasData())continue;let U=P.tileID;for(;U.overscaledZ>k;){U=U.scaledTo(U.overscaledZ-1);const G=this._tiles[U.key];if(G&&G.hasData()&&w[U.key]){d[I]=P.tileID;break}}}for(const I in v)d[I]||(this._coveredTiles[I]=!0,d[I]=v[I])}for(const v in d)this._tiles[v].clearFadeHold();const g=function(v,w){const C=[];for(const k in v)k in w||C.push(k);return C}(this._tiles,d);for(const v of g){const w=this._tiles[v];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(0===t.length)return n;const a={},h=t.reduce((C,k)=>Math.min(C,k.overscaledZ),1/0),d=t[0].overscaledZ,g=Math.max(d-Co.maxOverzooming,this._source.minzoom),v=Math.max(d+Co.maxUnderzooming,this._source.minzoom),w={};for(const C of t){const k=this._addTile(C);n[C.key]=C,k.hasData()||h<this._source.maxzoom&&(w[C.key]=C)}this._retainLoadedChildren(w,h,v,n);for(const C of t){let k=this._tiles[C.key];if(k.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const P=C.children(this._source.maxzoom)[0],U=this.getTile(P);if(U&&U.hasData()){n[P.key]=P;continue}}else{const P=C.children(this._source.maxzoom);if(n[P[0].key]&&n[P[1].key]&&n[P[2].key]&&n[P[3].key])continue}let I=k.wasRequested();for(let P=C.overscaledZ-1;P>=g;--P){const U=C.scaledTo(P);if(a[U.key]||(a[U.key]=!0,k=this.getTile(U),!k&&I&&(k=this._addTile(U)),k&&(n[U.key]=U,I=k.wasRequested(),k.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let a,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){a=this._loadedParentTiles[h.key];break}n.push(h.key);const d=h.scaledTo(h.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;h=d}for(const d of n)this._loadedParentTiles[d]=a}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const a=Boolean(n);if(!a){const h=this.map?this.map.painter:null,d="raster"===this._source.type||"raster-dem"===this._source.type;n=new Lh(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,h,d),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,a||this._source.fire(new os("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=n.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(t,n,a){const h=[],d=this.transform;if(!d)return h;for(const g in this._tiles){const v=this._tiles[g];if(a&&v.clearQueryDebugViz(),v.holdingForFade())continue;const w=t.containsTile(v,d,n);w&&h.push(w)}return h}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of n)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Dp(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=xn.now())return!0}return!1}setFeatureState(t,n,a){this._state.updateState(t=t||"_geojsonTileLayer",n,a)}removeFeatureState(t,n,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,a)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,a){const h=this._tiles[t];h&&h.setDependencies(n,a)}reloadTilesForDependencies(t,n){for(const a in this._tiles)this._tiles[a].hasDependency(t,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(t,n))}_preloadTiles(t,n){const a=new Map,h=Array.isArray(t)?t:[t],d=this.map.painter.terrain,g=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const C of h){const k=C.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of k)a.set(I.key,I);this.usedForTerrain&&C.updateElevation(!1)}const v=Array.from(a.values()),w="raster"===this._source.type||"raster-dem"===this._source.type;Yn(v,(C,k)=>{const I=new Lh(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,w);this._loadTile(I,P=>{"raster-dem"===this._source.type&&I.dem&&this._backfillDEM(I),k(P,I)})},n)}}function kp(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||a-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Dp(e){return"raster"===e||"image"===e||"video"===e}Co.maxOverzooming=10,Co.maxUnderzooming=3;class Rh{constructor(t,n,a){this._demTile=t,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(t,n,a){const h=a||t.findDEMTileFor(n);if(!h||!h.dem)return;const d=h.dem,g=h.tileID,v=1<<n.canonical.z-g.canonical.z;return new Rh(h,h.tileSize/ai/v,[(n.canonical.x/v-g.canonical.x)*d.dim,(n.canonical.y/v-g.canonical.y)*d.dim])}tileCoordToPixel(t,n){const a=n*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),d=Math.floor(a);return new jt(h,d)}getElevationAt(t,n,a,h){const d=t*this._scale+this._offset[0],g=n*this._scale+this._offset[1],v=Math.floor(d),w=Math.floor(g),C=this._dem;return h=!!h,a?xi(xi(C.get(v,w,h),C.get(v,w+1,h),g-w),xi(C.get(v+1,w,h),C.get(v+1,w+1,h),g-w),d-v):C.get(v,w,h)}getElevationAtPixel(t,n,a){return this._dem.get(t,n,!!a)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Dr(1,t)*this._dem.stride}}class Ip{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new co(ai,16,0),this.featureIndexArray=new ud,this.promoteId=n}insert(t,n,a,h,d,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,d,g);const w=this.grid;for(let C=0;C<n.length;C++){const k=n[C],I=[1/0,1/0,-1/0,-1/0];for(let P=0;P<k.length;P++){const U=k[P];I[0]=Math.min(I[0],U.x),I[1]=Math.min(I[1],U.y),I[2]=Math.max(I[2],U.x),I[3]=Math.max(I[3],U.y)}I[0]<ai&&I[1]<ai&&I[2]>=0&&I[3]>=0&&w.insert(v,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new is.VectorTile(new bo(this.rawTileData)).layers,this.sourceLayerCoder=new xp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,n,a,h){this.loadVTLayers();const d=t.params||{},g=ro(d.filter),v=t.tileResult,w=t.transform,C=v.bufferedTilespaceBounds,k=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(G,H,Y,nt)=>Ed(v.bufferedTilespaceGeometry,G,H,Y,nt));k.sort(fm);let I=null;w.elevation&&k.length>0&&(I=Rh.create(w.elevation,this.tileID));const P={};let U;for(let G=0;G<k.length;G++){const H=k[G];if(H===U)continue;U=H;const Y=this.featureIndexArray.get(H);let nt=null;this.loadMatchingFeature(P,Y,g,d.layers,d.availableImages,n,a,h,(ct,yt,vt,bt=0)=>(nt||(nt=Qs(ct,this.tileID.canonical,t.tileTransform)),yt.queryIntersectsFeature(v,ct,vt,nt,this.z,t.transform,t.pixelPosMatrix,I,bt)))}return P}loadMatchingFeature(t,n,a,h,d,g,v,w,C){const{featureIndex:k,bucketIndex:I,sourceLayerIndex:P,layoutVertexArrayOffset:U}=n,G=this.bucketLayerIDs[I];if(h&&!function(ct,yt){for(let vt=0;vt<ct.length;vt++)if(yt.indexOf(ct[vt])>=0)return!0;return!1}(h,G))return;const H=this.sourceLayerCoder.decode(P),Y=this.vtLayers[H].feature(k);if(a.needGeometry){const ct=xo(Y,!0);if(!a.filter(new Ze(this.tileID.overscaledZ),ct,this.tileID.canonical))return}else if(!a.filter(new Ze(this.tileID.overscaledZ),Y))return;const nt=this.getId(Y,H);for(let ct=0;ct<G.length;ct++){const yt=G[ct];if(h&&h.indexOf(yt)<0)continue;const vt=g[yt];if(!vt)continue;let bt={};void 0!==nt&&w&&(bt=w.getState(vt.sourceLayer||"_geojsonTileLayer",nt));const Mt=Ie({},v[yt]);Mt.paint=Pp(Mt.paint,vt.paint,Y,bt,d),Mt.layout=Pp(Mt.layout,vt.layout,Y,bt,d);const Vt=!C||C(Y,vt,bt,U);if(!Vt)continue;const Ot=new vp(Y,this.z,this.x,this.y,nt);Ot.layer=Mt;let ne=t[yt];void 0===ne&&(ne=t[yt]=[]),ne.push({featureIndex:k,feature:Ot,intersectionZ:Vt})}}lookupSymbolFeatures(t,n,a,h,d,g,v,w){const C={};this.loadVTLayers();const k=ro(d);for(const I of t)this.loadMatchingFeature(C,{bucketIndex:a,sourceLayerIndex:h,featureIndex:I,layoutVertexArrayOffset:0},k,g,v,w,n);return C}loadFeature(t){const{featureIndex:n,sourceLayerIndex:a}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(a),d=this.vtFeatures[h];if(d[n])return d[n];const g=this.vtLayers[h].feature(n);return d[n]=g,g}hasLayer(t){for(const n of this.bucketLayerIDs)for(const a of n)if(t===a)return!0;return!1}getId(t,n){let a=t.id;return this.promoteId&&(a=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[n]],"boolean"==typeof a&&(a=Number(a))),a}}function Pp(e,t,n,a,h){return Cn(e,(d,g)=>{const v=t instanceof Er?t.get(g):null;return v&&v.evaluate?v.evaluate(n,a,h):v})}function fm(e,t){return t-e}_e("FeatureIndex",Ip,{omit:["rawTileData","sourceLayerCoder"]});var Xi=Zi([{name:"a_pos",type:"Int16",components:2}]);const Aa=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,n=0,a=0,h=0,d=0,g=0,v=0;for(1&t?h=d=g=32:n=a=v=32;(t>>=1)>1;){const C=n+h>>1,k=a+d>>1;1&t?(h=n,d=a,n=g,a=v):(n=h,a=d,h=g,d=v),g=C,v=k}const w=4*e;Aa[w+0]=n,Aa[w+1]=a,Aa[w+2]=h,Aa[w+3]=d}const Es=new Uint16Array(2178),na=new Uint8Array(1089),Ea=new Uint16Array(1089);function zp(e){return 0===e?-.03125:32===e?.03125:0}var mc=Zi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Rp={type:2,extent:ai,loadGeometry:()=>[[new jt(0,0),new jt(8193,0),new jt(8193,8193),new jt(0,8193),new jt(0,0)]]};class Lh{constructor(t,n,a,h,d){this.tileID=t,this.uid=le(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<xn.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ao(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,a){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,d){const g={};if(!d)return g;for(const v of h){const w=v.layerIds.map(C=>d.getLayer(C)).filter(Boolean);if(0!==w.length){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(C=>w.filter(k=>k.id===C)[0]));for(const C of w)g[C.id]=v}}return g}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const d=this.buckets[h];if(d instanceof ia){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const d=this.buckets[h];if(d instanceof ia&&d.hasRTLText){this.hasRTLText=!0,hi.isLoading()||hi.isLoaded()||"deferred"!==fr()||Ar();break}}this.queryPadding=0;for(const h in this.buckets){const d=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new eu}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const h=this.buckets[a];h.uploadPending()&&h.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new fc(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new fc(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new fc(t,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,a,h,d,g,v,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:g,params:d,tileTransform:this.tileTransform},t,n,a):{}}querySourceFeatures(t,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const h=a.loadVTLayers(),d=n?n.sourceLayer:"",g=h._geojsonTileLayer||h[d];if(!g)return;const v=ro(n&&n.filter),{z:w,x:C,y:k}=this.tileID.canonical,I={z:w,x:C,y:k};for(let P=0;P<g.length;P++){const U=g.feature(P);if(v.needGeometry){const Y=xo(U,!0);if(!v.filter(new Ze(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!v.filter(new Ze(this.tileID.overscaledZ),U))continue;const G=a.getId(U,d),H=new vp(U,w,C,k,G);H.tile=I,t.push(H)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const a=rs(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let h=!1;if(this.expirationTime>a)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const d=this.expirationTime-n;d?this.expirationTime=a+Math.max(d,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!n)return;const a=this.latestFeatureIndex.loadVTLayers(),h=n.style.listImages();for(const d in this.buckets){if(!n.style.hasLayer(d))continue;const g=this.buckets[d],v=g.layers[0].sourceLayer||"_geojsonTileLayer",w=a[v],C=t[v];if(!w||!C||0===Object.keys(C).length)continue;if(g.update(C,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof fh||g instanceof dh){const I=n.style._getSourceCache(g.layers[0].source);n._terrain&&n._terrain.enabled&&I&&g.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(I.id,this.tileID)}const k=n&&n.style&&n.style.getLayer(d);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<xn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=xn.now()+t}setDependencies(t,n){const a={};for(const h of n)a[h]=!0;this.dependencies[t]=a}hasDependency(t,n){for(const a of t){const h=this.dependencies[a];if(h)for(const d of n)if(h[d])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const a=Qs(Rp,this.tileID.canonical,this.tileTransform)[0],h=new mo,d=new Yc;for(let g=0;g<a.length;g++){const{x:v,y:w}=a[g];h.emplaceBack(v,w),d.emplaceBack(g)}d.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(d),this._tileDebugBuffer=t.createVertexBuffer(h,mc.members),this._tileDebugSegments=tn.simpleSegment(0,0,h.length,d.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const a=Qs(Rp,this.tileID.canonical,this.tileTransform)[0];let h,d;if(this.isRaster){const g=function(v,w){const C=Ao(v,w),k=Math.pow(2,v.z);for(let Y=0;Y<33;Y++)for(let nt=0;nt<33;nt++){const ct=Ks((v.x+(nt+zp(nt))/32)/k),yt=Ir((v.y+(Y+zp(Y))/32)/k),vt=w.project(ct,yt),bt=33*Y+nt;Es[2*bt+0]=Math.round((vt.x*C.scale-C.x)*ai),Es[2*bt+1]=Math.round((vt.y*C.scale-C.y)*ai)}na.fill(0),Ea.fill(0);for(let Y=2045;Y>=0;Y--){const nt=4*Y,ct=Aa[nt+0],yt=Aa[nt+1],vt=Aa[nt+2],bt=Aa[nt+3],Mt=ct+vt>>1,Vt=yt+bt>>1,Ot=Mt+Vt-yt,ne=Vt+ct-Mt,Ht=33*yt+ct,Ft=33*bt+vt,Qt=33*Vt+Mt,Jt=Math.hypot((Es[2*Ht+0]+Es[2*Ft+0])/2-Es[2*Qt+0],(Es[2*Ht+1]+Es[2*Ft+1])/2-Es[2*Qt+1])>=16;if(na[Qt]=na[Qt]||(Jt?1:0),Y<1022){const $t=33*(yt+ne>>1)+(ct+Ot>>1),pe=33*(bt+ne>>1)+(vt+Ot>>1);na[Qt]=na[Qt]||na[$t]||na[pe]}}const I=new ll,P=new kr;let U=0;function G(Y,nt){const ct=33*nt+Y;return 0===Ea[ct]&&(I.emplaceBack(Es[2*ct+0],Es[2*ct+1],Y*ai/32,nt*ai/32),Ea[ct]=++U),Ea[ct]-1}function H(Y,nt,ct,yt,vt,bt){const Mt=Y+ct>>1,Vt=nt+yt>>1;if(Math.abs(Y-vt)+Math.abs(nt-bt)>1&&na[33*Vt+Mt])H(vt,bt,Y,nt,Mt,Vt),H(ct,yt,vt,bt,Mt,Vt);else{const Ot=G(Y,nt),ne=G(ct,yt),Ht=G(vt,bt);P.emplaceBack(Ot,ne,Ht)}}return H(0,0,32,32,32,0),H(32,32,0,0,0,32),{vertices:I,indices:P}}(this.tileID.canonical,n);h=g.vertices,d=g.indices}else{h=new ll,d=new kr;for(const{x:v,y:w}of a)h.emplaceBack(v,w,0,0);const g=sh(h.int16,void 0,4);for(let v=0;v<g.length;v+=3)d.emplaceBack(g[v],g[v+1],g[v+2])}this._tileBoundsBuffer=t.createVertexBuffer(h,mc.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(d),this._tileBoundsSegments=tn.simpleSegment(0,0,h.length,d.length)}}const Lp=Zi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),mm=Zi([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:td}=Lp;function So(e,t){const n=e.fovAboveCenter,a=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,h=(e._camera.position[2]*e.worldSize-a)/Math.cos(e._pitch),d=Math.sin(n)*h/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),g=Math.sin(e._pitch)*d+h;return Math.min(1.01*g,h*(1/e._horizonShift))}const _c=ai/Math.PI/2,yr=-_c,xr=_c,_m=[new Pr([yr,yr,yr],[xr,xr,xr]),new Pr([yr,yr,yr],[0,0,xr]),new Pr([0,yr,yr],[xr,0,xr]),new Pr([yr,0,yr],[0,xr,xr]),new Pr([0,0,yr],[xr,xr,xr])];function Oh(e){if(e.z<=1)return _m[e.z+2*e.y+e.x];const[t,n]=Op(e),a=[Fh(t[0],t[1]),Fh(t[0],n[1]),Fh(n[0],t[1]),Fh(n[0],n[1])],h=[xr,xr,xr],d=[yr,yr,yr];for(const g of a)h[0]=Math.min(h[0],g[0]),h[1]=Math.min(h[1],g[1]),h[2]=Math.min(h[2],g[2]),d[0]=Math.max(d[0],g[0]),d[1]=Math.max(d[1],g[1]),d[2]=Math.max(d[2],g[2]);return new Pr(h,d)}function Op(e){const t=Math.pow(2,e.z),n=e.x/t,a=(e.x+1)/t,h=(e.y+1)/t;return[[Ir(e.y/t),Ks(n)],[Ir(h),Ks(a)]]}function ed(e,t,n,a){return n=Ve(n),a||(a=_c),[e*Math.sin(n)*a,-t*a,e*Math.cos(n)*a]}function Fh(e,t,n){return ed(Math.cos(Ve(e)),Math.sin(Ve(e)),t,n)}function Fp(e){return 16383/Math.max(...Rr([],e.max,e.min))}function Bp(e){const t=Oe(new Float64Array(16)),n=1/Fp(e);return de(t,t,e.min),ei(t,t,[n,n,n]),t}function Vp(e,t,n){const a=t/(2*Math.PI),h=function(g){const v=ai/(2*Math.PI);return g/(2*Math.PI)/v}(t);if(!n){const g=pi(e.center.lat,-85.051129,ws);n=[ul(e.center.lng)*t,yo(g)*t]}const d=Oe(new Float64Array(16));return de(d,d,[n[0],n[1],-a]),ei(d,d,[h,h,h]),zi(d,d,Ve(-e._center.lat)),Ke(d,d,Ve(-e._center.lng)),d}class id{constructor(t){const n=this._createGridIndices();this.gridIndexBuffer=t.createIndexBuffer(n,!0),this.gridSegments=tn.simpleSegment(0,0,4225,8192);const a=this._createPoleTriangleIndices();this.poleIndexBuffer=t.createIndexBuffer(a,!0),this.poleSegments=tn.simpleSegment(0,0,66,64);const h=new Yl;h.emplaceBack(-1,1,1,0,0,0,0),h.emplaceBack(1,1,1,0,0,1,0),h.emplaceBack(1,-1,1,0,0,1,1),h.emplaceBack(-1,-1,1,0,0,0,1);const d=new kr;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.atmosphereVertexBuffer=t.createVertexBuffer(h,mm.members),this.atmosphereIndexBuffer=t.createIndexBuffer(d),this.atmosphereSegments=tn.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(t,n,a){const h=new Yl,d=n/Math.PI/2;h.emplaceBack(0,-d,0,0,0,.5,a?0:1);const g=360/t,v=Math.cos(Ve(85)),w=Math.sin(Ve(85));for(let k=0;k<=64;k++){const I=k/64,P=ed(v,w,0*(1-(C=I))+g*C,d);h.emplaceBack(P[0],P[1],P[2],0,0,I,a?0:1)}var C;return h}_createPoleTriangleIndices(){const t=new kr;for(let n=0;n<=64;n++)t.emplaceBack(0,n+1,n+2);return t}static createGridVertices(t){const n=Math.pow(2,t.z),a=(w,C,k)=>w*(1-k)+C*k,[h,d]=Op(t),g=new Yl,v=function(w){const C=Oe(new Float64Array(16)),k=Fp(w);var I,P;return ei(C,C,[k,k,k]),de(C,C,((I=[])[0]=-(P=w.min)[0],I[1]=-P[1],I[2]=-P[2],I)),C}(Oh(t));g.reserve(4096);for(let w=0;w<65;w++){const C=a(h[0],d[0],w/64),k=yo(C),I=k*n-t.y,P=Math.sin(Ve(C)),U=Math.cos(Ve(C));for(let G=0;G<65;G++){const H=G/64,Y=a(h[1],d[1],H),nt=ed(U,P,Y);Ne(nt,nt,v);const ct=ul(Y);g.emplaceBack(nt[0],nt[1],nt[2],ct,k,H,I)}}return g}_createGridIndices(){const t=new kr,n=(a,h)=>{const d=65*h+a;t.emplaceBack(d+1,d,d+65),t.emplaceBack(d+65,d+65+1,d+1)};for(let a=0;a<64;a++)for(let h=0;h<64;h++)n(h,a);return t}getWirefameBuffer(t){if(!this.wireframeSegments){const n=this._createWireframeGrid();this.wireframeIndexBuffer=t.createIndexBuffer(n),this.wireframeSegments=tn.simpleSegment(0,0,4096,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const t=new xa,n=(a,h)=>{const d=65*h+a;t.emplaceBack(d,d+1),t.emplaceBack(d,d+65),t.emplaceBack(d,d+65+1)};for(let a=0;a<64;a++)for(let h=0;h<64;h++)n(h,a);return t}}function Ao(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),a=e.x*n,h=(e.x+1)*n,d=e.y*n,g=(e.y+1)*n,v=Ks(a),w=Ks(h),C=Ir(d),k=Ir(g),I=t.project(v,C),P=t.project(w,C),U=t.project(w,k),G=t.project(v,k);let H=Math.min(I.x,P.x,U.x,G.x),Y=Math.min(I.y,P.y,U.y,G.y),nt=Math.max(I.x,P.x,U.x,G.x),ct=Math.max(I.y,P.y,U.y,G.y);const yt=n/16;function vt(Mt,Vt,Ot,ne,Ht,Ft){const Qt=(Ot+Ht)/2,Jt=(ne+Ft)/2,$t=t.project(Ks(Qt),Ir(Jt)),pe=Math.max(0,H-$t.x,Y-$t.y,$t.x-nt,$t.y-ct);H=Math.min(H,$t.x),nt=Math.max(nt,$t.x),Y=Math.min(Y,$t.y),ct=Math.max(ct,$t.y),pe>yt&&(vt(Mt,$t,Ot,ne,Qt,Jt),vt($t,Vt,Qt,Jt,Ht,Ft))}vt(I,P,a,d,h,d),vt(P,U,h,d,h,g),vt(U,G,h,g,a,g),vt(G,I,a,g,a,d),H-=yt,Y-=yt,nt+=yt,ct+=yt;const bt=1/Math.max(nt-H,ct-Y);return{scale:bt,x:H*bt,y:Y*bt,x2:nt*bt,y2:ct*bt,projection:t}}class Up{constructor(t){const n={},a=[];for(const v in t){const w=t[v],C=n[v]={};for(const k in w.glyphs){const I=w.glyphs[+k];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const P=I.metrics.localGlyph?2:1,U={x:0,y:0,w:I.bitmap.width+2*P,h:I.bitmap.height+2*P};a.push(U),C[k]=U}}const{w:h,h:d}=Ru(a),g=new Ma({width:h||1,height:d||1});for(const v in t){const w=t[v];for(const C in w.glyphs){const k=w.glyphs[+C];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const I=n[v][C],P=k.metrics.localGlyph?2:1;Ma.copy(k.bitmap,g,{x:0,y:0},{x:I.x+P,y:I.y+P},k.bitmap)}}this.image=g,this.positions=n}}_e("GlyphAtlas",Up);class gm{constructor(t){this.tileID=new ir(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Ao(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,n,a,h,d){this.status="parsing",this.data=t,this.collisionBoxArray=new eu;const g=new xp(Object.keys(t.layers).sort()),v=new Ip(this.tileID,this.promoteId);v.bucketLayerIDs=[];const w={},C=new Ih(256,256),k={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:C,availableImages:a},I=n.familiesBySource[this.source];for(const bt in I){const Mt=t.layers[bt];if(!Mt)continue;let Vt=!1,Ot=!1;for(const Ft of I[bt])"symbol"===Ft[0].type?Vt=!0:Ot=!0;if(!0===this.isSymbolTile&&!Vt||!1===this.isSymbolTile&&!Ot)continue;1===Mt.version&&bi(`Vector tile source "${this.source}" layer "${bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ne=g.encode(bt),Ht=[];for(let Ft=0;Ft<Mt.length;Ft++){const Qt=Mt.feature(Ft),Jt=v.getId(Qt,bt);Ht.push({feature:Qt,id:Jt,index:Ft,sourceLayerIndex:ne})}for(const Ft of I[bt]){const Qt=Ft[0];void 0!==this.isSymbolTile&&"symbol"===Qt.type!==this.isSymbolTile||Qt.minzoom&&this.zoom<Math.floor(Qt.minzoom)||Qt.maxzoom&&this.zoom>=Qt.maxzoom||"none"!==Qt.visibility&&(nd(Ft,this.zoom,a),(w[Qt.id]=Qt.createBucket({index:v.bucketLayerIDs.length,layers:Ft,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ne,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:a})).populate(Ht,k,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(Ft.map(Jt=>Jt.id)))}}let P,U,G,H;C.trim();const Y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},nt=Cn(k.glyphDependencies,bt=>Object.keys(bt).map(Number));Object.keys(nt).length?h.send("getGlyphs",{uid:this.uid,stacks:nt},(bt,Mt)=>{P||(P=bt,U=Mt,vt.call(this))},void 0,!1,Y):U={};const ct=Object.keys(k.iconDependencies);ct.length?h.send("getImages",{icons:ct,source:this.source,tileID:this.tileID,type:"icons"},(bt,Mt)=>{P||(P=bt,G=Mt,vt.call(this))},void 0,!1,Y):G={};const yt=Object.keys(k.patternDependencies);function vt(){if(P)return d(P);if(U&&G&&H){const bt=new Up(U),Mt=new Xd(G,H);for(const Vt in w){const Ot=w[Vt];Ot instanceof ia?(nd(Ot.layers,this.zoom,a),tm(Ot,U,bt.positions,G,Mt.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection),Ot.projection=this.projection.name):Ot.hasPattern&&(Ot instanceof fh||Ot instanceof dh||Ot instanceof ku)&&(nd(Ot.layers,this.zoom,a),Ot.addFeatures(k,this.tileID.canonical,Mt.patternPositions,a))}this.status="done",d(null,{buckets:he(w).filter(Vt=>!Vt.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bt.image,lineAtlas:C,imageAtlas:Mt,glyphMap:this.returnDependencies?U:null,iconMap:this.returnDependencies?G:null,glyphPositions:this.returnDependencies?bt.positions:null})}}yt.length?h.send("getImages",{icons:yt,source:this.source,tileID:this.tileID,type:"patterns"},(bt,Mt)=>{P||(P=bt,H=Mt,vt.call(this))},void 0,!1,Y):H={},vt.call(this)}}function nd(e,t,n){const a=new Ze(t);for(const h of e)h.recalculate(a,n)}class Np{constructor(t){this.entries={},this.scheduler=t}request(t,n,a,h){const d=this.entries[t]=this.entries[t]||{callbacks:[]};if(d.result){const[g,v]=d.result;return this.scheduler?this.scheduler.add(()=>{h(g,v)},n):h(g,v),()=>{}}return d.callbacks.push(h),d.cancel||(d.cancel=a((g,v)=>{d.result=[g,v];for(const w of d.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,v)},n):w(g,v);setTimeout(()=>delete this.entries[t],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==h),d.callbacks.length||(d.cancel(),delete this.entries[t]))}}}function jp(e,t,n){const a=JSON.stringify(e.request);return e.data&&(this.deduped.entries[a]={result:[null,e.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},h=>{const d=ri(e.request,(g,v,w,C)=>{g?h(g):v&&h(null,{vectorTile:n?void 0:new is.VectorTile(new bo(v)),rawData:v,cacheControl:w,expires:C})});return()=>{d.cancel(),h()}},t)}const ym=Oe(new Float64Array(16));class Eo{constructor(t,n){this._tr=t,this._worldSize=n}createInversionMatrix(){return ym}createTileMatrix(t){let n,a,h;const d=t.canonical,g=Oe(new Float64Array(16)),v=this._tr.projection;if(v.isReprojectedInTileSpace){const w=Ao(d,v);n=1,a=w.x+t.wrap*w.scale,h=w.y,ei(g,g,[n/w.scale,n/w.scale,this._tr.pixelsPerMeter/this._worldSize])}else n=this._worldSize/this._tr.zoomScale(d.z),a=(d.x+Math.pow(2,d.z)*t.wrap)*n,h=d.y*n;return de(g,g,[a,h,0]),ei(g,g,[n/ai,n/ai,1]),g}pointCoordinate(t,n,a){const h=this._tr.horizonLineFromTop(!1),d=new jt(t,Math.max(h,n));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(d,a))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var xm={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&gn(this.parallels,this.constants.parallels))return;const e=Math.sin(Ve(this.parallels[0])),t=(e+Math.sin(Ve(this.parallels[1])))/2,n=1+e*(2*t-e),a=Math.sqrt(n)/t;this.constants={n:t,c:n,r0:a,parallels:this.parallels}},project(e,t){this.initializeConstants();const n=Ve(e-this.center[0]),a=Ve(t),{n:h,c:d,r0:g}=this.constants,v=Math.sqrt(d-2*h*Math.sin(a))/h;return{x:v*Math.sin(n*h),y:v*Math.cos(n*h)-g,z:0}},unproject(e,t){this.initializeConstants();const{n,c:a,r0:h}=this.constants,d=h+t;let g=Math.atan2(e,Math.abs(d))*Math.sign(d);d*n<0&&(g-=Math.PI*Math.sign(e)*Math.sign(d));const v=Ve(this.center[0])*n;g=zn(g,-Math.PI-v,Math.PI-v);const w=ln(g/n)+this.center[0],C=Math.asin(pi((a-(e*e+d*d)*n*n)/(2*n),-1,1)),k=pi(ln(C),-85.051129,ws);return new Mi(w,k)},projectTilePoint:(e,t)=>({x:e,y:t,z:0}),locationPoint:(e,t)=>e._coordinatePoint(e.locationCoordinate(t),!1),pixelsPerMeter:(e,t)=>Dr(1,e)*t,farthestPixelDistance(e){return So(e,this.pixelsPerMeter(e.center.lat,e.worldSize))},createTileTransform:(e,t)=>new Eo(e,t)};const gc=1.340264,yc=-.081106,xc=893e-6,Al=.003796,Bh=Math.sqrt(3)/2;var vm={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Bh*Math.sin(t)),a=n*n,h=a*a*a;return{x:.5*(e*Math.cos(n)/(Bh*(gc+3*yc*a+h*(7*xc+9*Al*a)))/Math.PI+.5),y:1-.5*(n*(gc+yc*a+h*(xc+Al*a))/Math.PI+1),z:0}},unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,a=n*n,h=a*a*a;for(let C,k,I,P=0;P<12&&(k=n*(gc+yc*a+h*(xc+Al*a))-t,I=gc+3*yc*a+h*(7*xc+9*Al*a),C=k/I,n=pi(n-C,-Math.PI/3,Math.PI/3),a=n*n,h=a*a*a,!(Math.abs(C)<1e-12));++P);const d=Bh*e*(gc+3*yc*a+h*(7*xc+9*Al*a))/Math.cos(n),g=Math.asin(Math.sin(n)/Bh),v=pi(180*d/Math.PI,-180,180),w=pi(180*g/Math.PI,-85.051129,ws);return new Mi(v,w)},projectTilePoint:(e,t)=>({x:e,y:t,z:0}),locationPoint:(e,t)=>e._coordinatePoint(e.locationCoordinate(t),!1),pixelsPerMeter:(e,t)=>Dr(1,e)*t,farthestPixelDistance(e){return So(e,this.pixelsPerMeter(e.center.lat,e.worldSize))},createTileTransform:(e,t)=>new Eo(e,t)},bm={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(e,t)=>({x:.5+e/360,y:.5-t/360,z:0}),unproject(e,t){const n=360*(e-.5),a=pi(360*(.5-t),-85.051129,ws);return new Mi(n,a)},projectTilePoint:(e,t)=>({x:e,y:t,z:0}),locationPoint:(e,t)=>e._coordinatePoint(e.locationCoordinate(t),!1),pixelsPerMeter:(e,t)=>Dr(1,e)*t,farthestPixelDistance(e){return So(e,this.pixelsPerMeter(e.center.lat,e.worldSize))},createTileTransform:(e,t)=>new Eo(e,t)};const El=Math.PI/2;function vc(e){return Math.tan((El+e)/2)}var wm={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&gn(this.parallels,this.constants.parallels))return;const e=Ve(this.parallels[0]),t=Ve(this.parallels[1]),n=Math.cos(e),a=e===t?Math.sin(e):Math.log(n/Math.cos(t))/Math.log(vc(t)/vc(e)),h=n*Math.pow(vc(e),a)/a;this.constants={n:a,f:h,parallels:this.parallels}},project(e,t){this.initializeConstants(),t=Ve(t),e=Ve(e-this.center[0]);const n=1e-6,{n:a,f:h}=this.constants;h>0?t<-El+n&&(t=-El+n):t>El-n&&(t=El-n);const d=h/Math.pow(vc(t),a),g=d*Math.sin(a*e),v=h-d*Math.cos(a*e);return{x:.5*(g/Math.PI+.5),y:1-.5*(v/Math.PI+.5),z:0}},unproject(e,t){this.initializeConstants(),e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n,f:a}=this.constants,h=a-t,d=Math.sign(h),g=Math.sign(n)*Math.sqrt(e*e+h*h);let v=Math.atan2(e,Math.abs(h))*d;h*n<0&&(v-=Math.PI*Math.sign(e)*d);const w=pi(ln(v/n)+this.center[0],-180,180),C=pi(ln(2*Math.atan(Math.pow(a/g,1/n))-El),-85.051129,ws);return new Mi(w,C)},projectTilePoint:(e,t)=>({x:e,y:t,z:0}),locationPoint:(e,t)=>e._coordinatePoint(e.locationCoordinate(t),!1),pixelsPerMeter:(e,t)=>Dr(1,e)*t,farthestPixelDistance(e){return So(e,this.pixelsPerMeter(e.center.lat,e.worldSize))},createTileTransform:(e,t)=>new Eo(e,t)},Mm={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(e,t)=>({x:ul(e),y:yo(t),z:0}),unproject(e,t){const n=Ks(e),a=Ir(t);return new Mi(n,a)},projectTilePoint:(e,t)=>({x:e,y:t,z:0}),locationPoint:(e,t)=>e._coordinatePoint(e.locationCoordinate(t),!1),pixelsPerMeter:(e,t)=>Dr(1,e)*t,farthestPixelDistance(e){return So(e,this.pixelsPerMeter(e.center.lat,e.worldSize))},createTileTransform:(e,t)=>new Eo(e,t)};const rd=Ve(ws);var Tm={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(e,t){const n=(t=Ve(t))*t,a=n*n;return{x:.5*((e=Ve(e))*(.8707-.131979*n+a*(a*(.003971*n-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+a*(.028874*n-.044475-.005916*a)))/Math.PI+1),z:0}},unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,a=25,h=0,d=n*n;do{d=n*n;const w=d*d;h=(n*(1.007226+d*(.015085+w*(.028874*d-.044475-.005916*w)))-t)/(1.007226+d*(.045255+w*(.259866*d-.311325-.005916*11*w))),n=pi(n-h,-rd,rd)}while(Math.abs(h)>1e-6&&--a>0);d=n*n;const g=pi(ln(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),v=ln(n);return new Mi(g,v)},projectTilePoint:(e,t)=>({x:e,y:t,z:0}),locationPoint:(e,t)=>e._coordinatePoint(e.locationCoordinate(t),!1),pixelsPerMeter:(e,t)=>Dr(1,e)*t,farthestPixelDistance(e){return So(e,this.pixelsPerMeter(e.center.lat,e.worldSize))},createTileTransform:(e,t)=>new Eo(e,t)};const Gp=Ve(ws),sd={albers:xm,equalEarth:vm,equirectangular:bm,lambertConformalConic:wm,mercator:Mm,naturalEarth:Tm,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(e,t){t=Ve(t),e=Ve(e);const n=Math.cos(t),a=2/Math.PI,h=Math.acos(n*Math.cos(e/2)),d=Math.sin(h)/h,g=.5*(e*a+2*n*Math.sin(e/2)/d)||0,v=.5*(t+Math.sin(t)/d)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}},unproject(e,t){let n=e=(2*e-.5)*Math.PI,a=t=(2*(1-t)-1)*Math.PI,h=25;const d=1e-6;let g=0,v=0;do{const w=Math.cos(a),C=Math.sin(a),k=2*C*w,I=C*C,P=w*w,U=Math.cos(n/2),G=Math.sin(n/2),H=2*U*G,Y=G*G,nt=1-P*U*U,ct=nt?1/nt:0,yt=nt?Math.acos(w*U)*Math.sqrt(1/nt):0,vt=.5*(2*yt*w*G+2*n/Math.PI)-e,bt=.5*(yt*C+a)-t,Mt=.5*ct*(P*Y+yt*w*U*I)+1/Math.PI,Vt=ct*(H*k/4-yt*C*G),Ot=.125*ct*(k*G-yt*C*P*H),ne=.5*ct*(I*U+yt*Y*w)+.5,Ht=Vt*Ot-ne*Mt;g=(bt*Vt-vt*ne)/Ht,v=(vt*Ot-bt*Mt)/Ht,n=pi(n-g,-Math.PI,Math.PI),a=pi(a-v,-Gp,Gp)}while((Math.abs(g)>d||Math.abs(v)>d)&&--h>0);return new Mi(ln(n),ln(a))},projectTilePoint:(e,t)=>({x:e,y:t,z:0}),locationPoint:(e,t)=>e._coordinatePoint(e.locationCoordinate(t),!1),pixelsPerMeter:(e,t)=>Dr(1,e)*t,farthestPixelDistance(e){return So(e,this.pixelsPerMeter(e.center.lat,e.worldSize))},createTileTransform:(e,t)=>new Eo(e,t)}};u.ARRAY_TYPE=ze,u.AUTH_ERR_MSG=St,u.Aabb=Pr,u.Actor=class{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Ji(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Rn()?e:Pt,this.scheduler=new um}send(e,t,n,a,h=!1,d){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=d,this.callbacks[g]=n);const v=Sn(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:e,hasCallback:!!n,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:fo(t,v)},v),{cancel:()=>{n&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const a=this.cancelCallbacks[n];delete this.cancelCallbacks[n],a&&a.cancel()}else if(t.mustQueue||Rn()){const a=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,t),a&&a.metadata||{type:"message"})}else this.processTask(n,t)}processTask(e,t){if("<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(xs(t.error)):n(null,xs(t.data)))}else{const n=Sn(this.globalScope)?void 0:[],a=t.hasCallback?(d,g)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?fo(d):null,data:fo(g,n)},n)}:d=>{},h=xs(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,h,a);else if(this.parent.getWorkerSource){const d=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,d[0],h.source)[d[1]](h,a)}else a(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=Ph,u.Color=fi,u.ColorMode=Ss,u.CullFaceMode=ns,u.DEMData=zh,u.DataConstantProperty=ve,u.DedupedRequest=Np,u.DepthMode=Sl,u.EXTENT=ai,u.Elevation=class{getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,n=!0){null==t&&(t=null);const a=this._source();if(!a||e.y<0||e.y>1)return t;const h=a.getSource().maxzoom,d=1<<h,g=Math.floor(e.x),v=e.x-g,w=new ir(h,g,h,Math.floor(v*d),Math.floor(e.y*d)),C=this.findDEMTileFor(w);if(!C||!C.dem)return t;const k=C.dem,I=1<<C.tileID.canonical.z,P=(v*I-C.tileID.canonical.x)*k.dim,U=(e.y*I-C.tileID.canonical.y)*k.dim,G=Math.floor(P),H=Math.floor(U);return(n?this.exaggeration():1)*xi(xi(k.get(G,H),k.get(G,H+1),U-H),xi(k.get(G+1,H),k.get(G+1,H+1),U-H),P-G)}getAtTileOffset(e,t,n){const a=1<<e.canonical.z;return this.getAtPointOrZero(new wa(e.wrap+(e.canonical.x+t/ai)/a,(e.canonical.y+n/ai)/a))}getAtTileOffsetFunc(e,t){return n=>{const a=this.getAtTileOffset(e,n.x,n.y),h=t.upVector(e.canonical,n.x,n.y);return nn(h,h,a*t.upVectorScale(e.canonical)),h}}getForTilePoints(e,t,n,a){const h=Rh.create(this,e,a);return!!h&&(t.forEach(d=>{d[2]=this.exaggeration()*h.getElevationAt(d[0],d[1],n)}),!0)}getMinMaxForTile(e){const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,a=t.tileID,h=1<<e.canonical.z-a.canonical.z;let d=e.canonical.x/h-a.canonical.x,g=e.canonical.y/h-a.canonical.y,v=0;for(let w=0;w<e.canonical.z-a.canonical.z&&!n.leaves[v];w++){d*=2,g*=2;const C=2*Math.floor(g)+Math.floor(d);v=n.childOffsets[v]+C,d%=1,g%=1}return{min:this.exaggeration()*n.minimums[v],max:this.exaggeration()*n.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=Do,u.EvaluationParameters=Ze,u.Event=os,u.Evented=Nn,u.Frustum=_u,u.GLOBE_ZOOM_THRESHOLD_MAX=6,u.GlobeSharedBuffers=id,u.GlyphManager=wo,u.ImagePosition=Lu,u.LineAtlas=Ih,u.LngLat=Mi,u.LngLatBounds=Xs,u.LocalGlyphMode=wh,u.MAX_MERCATOR_LATITUDE=ws,u.MercatorCoordinate=wa,u.ONE_EM=24,u.OverscaledTileID=ir,u.Properties=wn,u.RGBAImage=mr,u.Ray=class{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const a=Ki(t,this.dir);if(Math.abs(a)<1e-6)return!1;const h=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/a;return n[0]=this.pos[0]+this.dir[0]*h,n[1]=this.pos[1]+this.dir[1]*h,n[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,t,n){if(G=(P=this.pos)[0],H=P[1],Y=P[2],nt=(U=e)[0],ct=U[1],yt=U[2],Math.abs(G-nt)<=Le*Math.max(1,Math.abs(G),Math.abs(nt))&&Math.abs(H-ct)<=Le*Math.max(1,Math.abs(H),Math.abs(ct))&&Math.abs(Y-yt)<=Le*Math.max(1,Math.abs(Y),Math.abs(yt))||0===t)return n[0]=n[1]=n[2]=0,!1;var P,U,G,H,Y,nt,ct,yt;const[a,h,d]=this.dir,g=this.pos[0]-e[0],v=this.pos[1]-e[1],w=this.pos[2]-e[2],C=a*a+h*h+d*d,k=2*(g*a+v*h+w*d),I=k*k-4*C*(g*g+v*v+w*w-t*t);if(I<0){const P=Math.max(-k/2,0),U=g+a*P,G=v+h*P,H=w+d*P,Y=Math.hypot(U,G,H);return n[0]=U*t/Y,n[1]=G*t/Y,n[2]=H*t/Y,!1}{const P=(-k-Math.sqrt(I))/(2*C);if(P<0){const U=Math.hypot(g,v,w);return n[0]=g*t/U,n[1]=v*t/U,n[2]=w*t/U,!1}return n[0]=g+a*P,n[1]=v+h*P,n[2]=w+d*P,!0}}},u.RequestManager=class{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let t="";for(let n=0;n<10;n++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",gt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Bt(e))return e;const n=be(e);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Bt(e))return e;const n=be(e);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(e,t){if(!Bt(e))return e;const n=be(e);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSpriteURL(e,t,n,a){const h=be(e);return Bt(e)?(h.path=`/styles/v1${h.path}/sprite${t}${n}`,this._makeAPIURL(h,this._customAccessToken||a)):(h.path+=`${t}${n}`,Ce(h))}normalizeTileURL(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Bt(e))return e;const a=be(e);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||n&&"raster"!==a.authority&&512===n?"@2x":""}${Z.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${F.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${F.TILE_URL_VERSION}${a.path}`);const h=this._customAccessToken||function(d){for(const g of d){const v=g.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(a.params)||F.ACCESS_TOKEN;return F.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,h)}canonicalizeTileURL(e,t){const n=be(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${F.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${F.TILE_URL_VERSION}/`,"")}`;let h=n.params;return t&&(h=h.filter(d=>!d.match(/^access_token=/))),h.length&&(a+=`?${h.join("&")}`),a}canonicalizeTileset(e,t){const n=!!t&&Bt(t),a=[];for(const h of e.tiles||[])Nt(h)?a.push(this.canonicalizeTileURL(h,n)):a.push(h);return a}_makeAPIURL(e,t){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=be(F.API_URL);if(e.protocol=a.protocol,e.authority=a.authority,"http"===e.protocol){const h=e.params.indexOf("secure");h>=0&&e.params.splice(h,1)}if("/"!==a.path&&(e.path=`${a.path}${e.path}`),!F.REQUIRE_ACCESS_TOKEN)return Ce(e);if(t=t||F.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return e.params=e.params.filter(h=>-1===h.indexOf("access_token")),e.params.push(`access_token=${t||""}`),Ce(e)}},u.ResourceType=Un,u.SegmentVector=tn,u.SourceCache=Co,u.StencilMode=Ku,u.StructArrayLayout1ui2=Yc,u.StructArrayLayout2f1f2i16=ql,u.StructArrayLayout2i4=mo,u.StructArrayLayout2ui4=xa,u.StructArrayLayout3f12=bs,u.StructArrayLayout3ui6=kr,u.StructArrayLayout4i8=ll,u.Texture=fc,u.Tile=Lh,u.Transitionable=Zn,u.Uniform1f=Jc,u.Uniform1i=class extends qs{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},u.Uniform2f=class extends qs{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},u.Uniform3f=class extends qs{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},u.Uniform4f=_d,u.UniformColor=gd,u.UniformMatrix2f=class extends qs{constructor(e,t){super(e,t),this.current=yd}set(e){for(let t=0;t<4;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix2fv(this.location,!1,e);break}}},u.UniformMatrix3f=class extends qs{constructor(e,t){super(e,t),this.current=qp}set(e){for(let t=0;t<9;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix3fv(this.location,!1,e);break}}},u.UniformMatrix4f=class extends qs{constructor(e,t){super(e,t),this.current=Hp}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},u.UnwrappedTileID=Yu,u.ValidationError=ue,u.VectorTileWorkerSource=class extends Nn{constructor(e,t,n,a,h){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=h||jp,this.loading={},this.loaded={},this.deduped=new Np(e.scheduler),this.isSpriteLoaded=a,this.scheduler=e.scheduler}loadTile(e,t){const n=e.uid,a=e&&e.request,h=a&&a.collectResourceTiming,d=this.loading[n]=new gm(e);d.abort=this.loadVectorData(e,(g,v)=>{const w=!this.loading[n];if(delete this.loading[n],w||g||!v)return d.status="done",w||(this.loaded[n]=d),t(g);const C=v.rawData,k={};v.expires&&(k.expires=v.expires),v.cacheControl&&(k.cacheControl=v.cacheControl),d.vectorTile=v.vectorTile||new is.VectorTile(new bo(C));const I=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,U)=>{if(P||!U)return t(P);const G={};if(h){const H=yp(a);H.length>0&&(G.resourceTiming=JSON.parse(JSON.stringify(H)))}t(null,Ie({rawTileData:C.slice(0)},U,k,G))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[n]=d})}reloadTile(e,t){const n=this.loaded,a=e.uid,h=this;if(n&&n[a]){const d=n[a];d.showCollisionBoxes=e.showCollisionBoxes,d.enableTerrain=!!e.enableTerrain,d.projection=e.projection;const g=(v,w)=>{const C=d.reloadCallback;C&&(delete d.reloadCallback,d.parse(d.vectorTile,h.layerIndex,this.availableImages,h.actor,C)),t(v,w)};"parsing"===d.status?d.reloadCallback=g:"done"===d.status&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(e,t){const n=e.uid,a=this.loading[n];a&&(a.abort&&a.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,a=e.uid;n&&n[a]&&delete n[a],t()}},u.WritingMode=zr,u.ZoomHistory=p,u.add=di,u.addDynamicAttributes=To,u.adjoint=function(e,t){var n=t[0],a=t[1],h=t[2],d=t[3],g=t[4],v=t[5],w=t[6],C=t[7],k=t[8];return e[0]=g*k-v*C,e[1]=h*C-a*k,e[2]=a*v-h*g,e[3]=v*w-d*k,e[4]=n*k-h*w,e[5]=h*d-n*v,e[6]=d*C-g*w,e[7]=a*w-n*C,e[8]=n*g-a*d,e},u.asyncAll=Yn,u.bezier=Ei,u.bindAll=Ji,u.boundsAttributes=mc,u.bufferConvexPolygon=function(e,t){const n=[];for(let a=0;a<e.length;a++){const h=zn(a-1,-1,e.length-1),d=zn(a+1,-1,e.length-1),g=e[a],v=e[d],w=e[h].sub(g).unit(),C=v.sub(g).unit(),k=C.angleWithSep(w.x,w.y),I=w.add(C).unit().mult(-1*t/Math.sin(k/2));n.push(g.add(I))}return n},u.cacheEntryPossiblyAdded=function(e){Hi++,Hi>xt&&(e.getActor().send("enforceCacheSizeLimit",it),Hi=0)},u.calculateGlobeMatrix=Vp,u.calculateGlobeMercatorMatrix=function(e){const t=e.worldSize,n=pi(e.center.lat,-85.051129,ws),a=new jt(ul(e.center.lng)*t,yo(n)*t),h=Dr(1,e.center.lat)*t,d=e.pixelsPerMeter,g=t/(h/e.pixelsPerMeter),v=Oe(new Float64Array(16));return de(v,v,[a.x,a.y,0]),ei(v,v,[g,g,d]),v},u.clamp=pi,u.clearTileCache=function(e){const t=Pt.caches.delete(kt);e&&t.catch(e).then(()=>e())},u.clipLine=ap,u.clone=function(e){var t=new ze(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.clone$1=Ni,u.collisionCircleLayout=Df,u.config=F,u.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},u.create=function(){var e=new ze(16);return ze!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},u.create$1=ie,u.createExpression=ma,u.createLayout=Zi,u.createStyleLayer=function(e){return"custom"===e.type?new om(e):new cm[e.type](e)},u.cross=Mn,u.degToRad=Ve,u.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},u.dot=Ki,u.ease=Tn,u.easeCubicInOut=Pn,u.emitValidationErrors=lo,u.endsWith=Pi,u.enforceCacheSizeLimit=function(e){ye(),E&&E.then(t=>{t.keys().then(n=>{for(let a=0;a<n.length-e;a++)t.delete(n[a])})})},u.evaluateSizeForFeature=_h,u.evaluateSizeForZoom=yl,u.evaluateVariableOffset=Nu,u.evented=Dn,u.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},u.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},u.exported=xn,u.exported$1=Z,u.extend=Ie,u.extend$1=ls,u.filterObject=Ui,u.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},u.fromQuat=function(e,t){var n=t[0],a=t[1],h=t[2],d=t[3],g=n+n,v=a+a,w=h+h,C=n*g,k=a*g,I=a*v,P=h*g,U=h*v,G=h*w,H=d*g,Y=d*v,nt=d*w;return e[0]=1-I-G,e[1]=k+nt,e[2]=P-Y,e[3]=0,e[4]=k-nt,e[5]=1-C-G,e[6]=U+H,e[7]=0,e[8]=P+Y,e[9]=U-H,e[10]=1-C-I,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},u.fromRotation=function(e,t){var n=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=n,e[2]=0,e[3]=-n,e[4]=a,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},u.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},u.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return Bn[t]},u.getAABBPointSquareDist=function(e,t,n){let a=0;for(let h=0;h<2;++h){const d=n?n[h]:0;e[h]>d&&(a+=(e[h]-d)*(e[h]-d)),t[h]<d&&(a+=(d-t[h])*(d-t[h]))}return a},u.getAnchorAlignment=Fu,u.getAnchorJustification=ju,u.getBounds=function(e){let t=1/0,n=1/0,a=-1/0,h=-1/0;for(const d of e)t=Math.min(t,d.x),n=Math.min(n,d.y),a=Math.max(a,d.x),h=Math.max(h,d.y);return{min:new jt(t,n),max:new jt(a,h)}},u.getColumn=function(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]},u.getImage=as,u.getJSON=function(e,t){return un(Ie(e,{type:"json"}),t)},u.getMapSessionAPI=Jn,u.getPerformanceMeasurement=yp,u.getProjection=function(e){const t=sd[e.name];if(!t)throw new Error(`Invalid projection name: ${e.name}`);return t.conic?function(n,a){if(a.parallels&&Math.abs(a.parallels[0]+a.parallels[1])<.01){let h=function(d){const g=Math.max(.01,Math.cos(Ve(d))),v=1/(2*Math.max(Math.PI*g,1/g));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(w,C){const k=Ve(w)*g,I=Math.sin(Ve(C))/g;return{x:k*v+.5,y:-I*v+.5,z:0}},unproject(w,C){const k=-(C-.5)/v,I=pi(ln((w-.5)/v)/g,-180,180),P=Math.asin(pi(k*g,-1,1)),U=pi(ln(P),-85.051129,ws);return new Mi(I,U)}}}(a.parallels[0]);if("lambertConformalConic"===a.name){const{project:d,unproject:g}=sd.mercator;h={wrap:!0,supportsWorldCopies:!0,project:d,unproject:g}}return Ie({},n,a,h)}return Ie({},n,a)}(t,e):t},u.getRTLTextPluginStatus=fr,u.getReferrer=tr,u.getTilePoint=function(e,{x:t,y:n},a=0){return new jt(((t-a)*e.scale-e.x)*ai,(n*e.scale-e.y)*ai)},u.getTileVec3=function(e,t,n=0){return we(((t.x-n)*e.scale-e.x)*ai,(t.y*e.scale-e.y)*ai,Ql(t.z,t.y))},u.getVideo=function(e,t){const n=Pt.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let a=0;a<e.length;a++){const h=Pt.document.createElement("source");wc(e[a])||(n.crossOrigin="Anonymous"),h.src=e[a],n.appendChild(h)}return{cancel:()=>{}}},u.globeBuffersForTileMesh=function(e,t,n,a){const h=e.context,d=e.transform;let g=t.globeGridBuffer,v=t.globePoleBuffer;if(!g){const w=id.createGridVertices(n.canonical);g=t.globeGridBuffer=h.createVertexBuffer(w,td,!1)}if(!v){const w=id.createPoleTriangleVertices(a,d.tileSize*a,0===n.canonical.y);v=t.globePoleBuffer=h.createVertexBuffer(w,td,!1)}return[g,v]},u.globeDenormalizeECEF=Bp,u.globeMatrixForTile=function(e,t){const n=Bp(Oh(e)),a=((h=new Float64Array(16))[0]=(d=t)[0],h[1]=d[1],h[2]=d[2],h[3]=d[3],h[4]=d[4],h[5]=d[5],h[6]=d[6],h[7]=d[7],h[8]=d[8],h[9]=d[9],h[10]=d[10],h[11]=d[11],h[12]=d[12],h[13]=d[13],h[14]=d[14],h[15]=d[15],h);var h,d;return ke(a,a,n),a},u.globePoleMatrixForTile=function(e,t,n){const a=Oe(new Float64Array(16)),h=Math.pow(2,e.z),d=(e.x-h/2)/h*Math.PI*2,g=n.point,v=n.worldSize/(n.tileSize*h);return de(a,a,[g.x,g.y,-n.worldSize/Math.PI/2]),ei(a,a,[v,v,v]),zi(a,a,Ve(-n._center.lat)),Ke(a,a,Ve(-n._center.lng)),Ke(a,a,d),t&&ei(a,a,[1,-1,1]),a},u.globeTileBounds=Oh,u.globeToMercatorTransition=function(e){return Yi(5,6,e)},u.identity=Oe,u.identity$1=ra,u.invert=function(e,t){var n=t[0],a=t[1],h=t[2],d=t[3],g=t[4],v=t[5],w=t[6],C=t[7],k=t[8],I=t[9],P=t[10],U=t[11],G=t[12],H=t[13],Y=t[14],nt=t[15],ct=n*v-a*g,yt=n*w-h*g,vt=n*C-d*g,bt=a*w-h*v,Mt=a*C-d*v,Vt=h*C-d*w,Ot=k*H-I*G,ne=k*Y-P*G,Ht=k*nt-U*G,Ft=I*Y-P*H,Qt=I*nt-U*H,Jt=P*nt-U*Y,$t=ct*Jt-yt*Qt+vt*Ft+bt*Ht-Mt*ne+Vt*Ot;return $t?(e[0]=(v*Jt-w*Qt+C*Ft)*($t=1/$t),e[1]=(h*Qt-a*Jt-d*Ft)*$t,e[2]=(H*Vt-Y*Mt+nt*bt)*$t,e[3]=(P*Mt-I*Vt-U*bt)*$t,e[4]=(w*Ht-g*Jt-C*ne)*$t,e[5]=(n*Jt-h*Ht+d*ne)*$t,e[6]=(Y*vt-G*Vt-nt*yt)*$t,e[7]=(k*Vt-P*vt+U*yt)*$t,e[8]=(g*Qt-v*Ht+C*Ot)*$t,e[9]=(a*Ht-n*Qt-d*Ot)*$t,e[10]=(G*Mt-H*vt+nt*ct)*$t,e[11]=(I*vt-k*Mt-U*ct)*$t,e[12]=(v*ne-g*Ft-w*Ot)*$t,e[13]=(n*Ft-a*ne+h*Ot)*$t,e[14]=(H*yt-G*bt-Y*ct)*$t,e[15]=(k*bt-I*yt+P*ct)*$t,e):null},u.isMapAuthenticated=function(e){return ht.has(e)},u.isMapboxURL=Bt,u.latFromMercatorY=Ir,u.len=_i,u.length=re,u.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},u.loadVectorTile=jp,u.makeRequest=un,u.mercatorXfromLng=ul,u.mercatorYfromLat=yo,u.mercatorZfromAltitude=Dr,u.mul=ke,u.mul$1=Ai,u.multiply=function(e,t,n){var a=t[0],h=t[1],d=t[2],g=t[3],v=t[4],w=t[5],C=t[6],k=t[7],I=t[8],P=n[0],U=n[1],G=n[2],H=n[3],Y=n[4],nt=n[5],ct=n[6],yt=n[7],vt=n[8];return e[0]=P*a+U*g+G*C,e[1]=P*h+U*v+G*k,e[2]=P*d+U*w+G*I,e[3]=H*a+Y*g+nt*C,e[4]=H*h+Y*v+nt*k,e[5]=H*d+Y*w+nt*I,e[6]=ct*a+yt*g+vt*C,e[7]=ct*h+yt*v+vt*k,e[8]=ct*d+yt*w+vt*I,e},u.multiply$1=ui,u.multiply$2=an,u.nextPowerOfTwo=Me,u.normalize=qn,u.normalize$1=function(e,t){var n=t[0],a=t[1],h=t[2],d=t[3],g=n*n+a*a+h*h+d*d;return g>0&&(g=1/Math.sqrt(g)),e[0]=n*g,e[1]=a*g,e[2]=h*g,e[3]=d*g,e},u.number=xi,u.ortho=function(e,t,n,a,h,d,g){var v=1/(t-n),w=1/(a-h),C=1/(d-g);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*w,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*C,e[11]=0,e[12]=(t+n)*v,e[13]=(h+a)*w,e[14]=(g+d)*C,e[15]=1,e},u.pbf=bo,u.perspective=function(e,t,n,a,h){var d,g=1/Math.tan(t/2);return e[0]=g/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=h&&h!==1/0?(e[10]=(h+a)*(d=1/(a-h)),e[14]=2*h*a*d):(e[10]=-1,e[14]=-2*a),e},u.pick=function(e,t){const n={};for(let a=0;a<t.length;a++){const h=t[a];h in e&&(n[h]=e[h])}return n},u.plugin=hi,u.pointGeometry=jt,u.polygonIntersectsBox=Ed,u.polygonIntersectsPolygon=Md,u.polygonizeBounds=function(e,t,n=0,a=!0){const h=new jt(n,n),d=e.sub(h),g=t.add(h),v=[d,new jt(g.x,d.y),g,new jt(d.x,g.y)];return a&&v.push(d),v},u.posAttributes=Xi,u.postMapLoadEvent=yi,u.postTurnstileEvent=wi,u.potpack=Ru,u.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},u.radToDeg=ln,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(e){return e({pluginStatus:Ge,pluginURL:ti}),Dn.on("pluginStateChange",e),e},u.removeAuthState=function(e){ht.delete(e)},u.renderColorRamp=vu,u.rotateX=zi,u.rotateX$1=Ci,u.rotateY=Ke,u.rotateZ=function(e,t,n){var a=Math.sin(n),h=Math.cos(n),d=t[0],g=t[1],v=t[2],w=t[3],C=t[4],k=t[5],I=t[6],P=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=d*h+C*a,e[1]=g*h+k*a,e[2]=v*h+I*a,e[3]=w*h+P*a,e[4]=C*h-d*a,e[5]=k*h-g*a,e[6]=I*h-v*a,e[7]=P*h-w*a,e},u.rotateZ$1=function(e,t,n){n*=.5;var a=t[0],h=t[1],d=t[2],g=t[3],v=Math.sin(n),w=Math.cos(n);return e[0]=a*w+h*v,e[1]=h*w-a*v,e[2]=d*w+g*v,e[3]=g*w-d*v,e},u.scale=ei,u.scale$1=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},u.scale$2=nn,u.scaleAndAdd=fn,u.setCacheLimits=function(e,t){it=e,xt=t},u.setColumn=function(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},u.setRTLTextPlugin=function(e,t,n=!1){if(Ge===Pe||Ge===$e||Ge===si)throw new Error("setRTLTextPlugin cannot be called multiple times.");ti=xn.resolveURL(e),Ge=Pe,ki=t,cn(),n||Ar()},u.smoothstep=Yi,u.spec=Rt,u.storeAuthState=function(e,t){t?ht.add(e):ht.delete(e)},u.sub=Rr,u.subtract=Ti,u.symbolSize=If,u.tileAABB=function(e,t,n,a,h,d,g,v,w){if("globe"===w.name){const U=Oh(new Yu(d,new Ph(n,a,h)).canonical).getCorners(),G=Number.MAX_VALUE,H=[-G,-G,-G],Y=[G,G,G],nt=Vp(e,t);for(let ct=0;ct<U.length;ct++)Ne(U[ct],U[ct],nt),k=Y,I=U[ct],(C=Y)[0]=Math.min(k[0],I[0]),C[1]=Math.min(k[1],I[1]),C[2]=Math.min(k[2],I[2]),nr(H,H,U[ct]);return new Pr(Y,H)}var C,k,I;const P=Ao({z:n,x:a,y:h},w);return new Pr([(d+P.x/P.scale)*t,t*(P.y/P.scale),g],[(d+P.x2/P.scale)*t,t*(P.y2/P.scale),v])},u.tileTransform=Ao,u.transformMat3=function(e,t,n){var a=t[0],h=t[1],d=t[2];return e[0]=a*n[0]+h*n[3]+d*n[6],e[1]=a*n[1]+h*n[4]+d*n[7],e[2]=a*n[2]+h*n[5]+d*n[8],e},u.transformMat4=Ne,u.transformMat4$1=Wn,u.transformQuat=hn,u.translate=de,u.transpose=function(e,t){if(e===t){var n=t[1],a=t[2],h=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=a,e[7]=h}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},u.triggerPluginCompletionEvent=Bi,u.uniqueId=le,u.validateCustomStyleLayer=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},u.validateFog=En,u.validateLight=Us,u.validateStyle=Jr,u.values=he,u.vectorTile=is,u.version=B,u.warnOnce=bi,u.window=Pt,u.wrap=zn}),Si(0,function(u){function B(tt){const F=typeof tt;if("number"===F||"boolean"===F||"string"===F||null==tt)return JSON.stringify(tt);if(Array.isArray(tt)){let rt="[";for(const ft of tt)rt+=`${B(ft)},`;return`${rt}]`}const Z=Object.keys(tt).sort();let Q="{";for(let rt=0;rt<Z.length;rt++)Q+=`${JSON.stringify(Z[rt])}:${B(tt[Z[rt]])},`;return`${Q}}`}function $i(tt){let F="";for(const Z of u.refProperties)F+=`/${B(tt[Z])}`;return F}class mi{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,Z){for(const rt of F)this._layerConfigs[rt.id]=rt,(this._layers[rt.id]=u.createStyleLayer(rt)).compileFilter(),this.keyCache[rt.id]&&delete this.keyCache[rt.id];for(const rt of Z)delete this.keyCache[rt],delete this._layerConfigs[rt],delete this._layers[rt];this.familiesBySource={};const Q=function(rt,ft){const Tt={};for(let gt=0;gt<rt.length;gt++){const St=ft&&ft[rt[gt].id]||$i(rt[gt]);ft&&(ft[rt[gt].id]=St);let Bt=Tt[St];Bt||(Bt=Tt[St]=[]),Bt.push(rt[gt])}const Ct=[];for(const gt in Tt)Ct.push(Tt[gt]);return Ct}(u.values(this._layerConfigs),this.keyCache);for(const rt of Q){const ft=rt.map(Nt=>this._layers[Nt.id]),Tt=ft[0];if("none"===Tt.visibility)continue;const Ct=Tt.source||"";let gt=this.familiesBySource[Ct];gt||(gt=this.familiesBySource[Ct]={});const St=Tt.sourceLayer||"_geojsonTileLayer";let Bt=gt[St];Bt||(Bt=gt[St]=[]),Bt.push(ft)}}}const{ImageBitmap:jt}=u.window;class Te{loadTile(F,Z){const{uid:Q,encoding:rt,rawImageData:ft,padding:Tt,buildQuadTree:Ct}=F,gt=jt&&ft instanceof jt?this.getImageData(ft,Tt):ft;Z(null,new u.DEMData(Q,gt,rt,Tt<1,Ct))}getImageData(F,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(F.width,F.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=F.width,this.offscreenCanvas.height=F.height,this.offscreenCanvasContext.drawImage(F,0,0,F.width,F.height);const Q=this.offscreenCanvasContext.getImageData(-Z,-Z,F.width+2*Z,F.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new u.RGBAImage({width:Q.width,height:Q.height},Q.data)}}var Pt=function tt(F,Z){var Q,rt=F&&F.type;if("FeatureCollection"===rt)for(Q=0;Q<F.features.length;Q++)tt(F.features[Q],Z);else if("GeometryCollection"===rt)for(Q=0;Q<F.geometries.length;Q++)tt(F.geometries[Q],Z);else if("Feature"===rt)tt(F.geometry,Z);else if("Polygon"===rt)Le(F.coordinates,Z);else if("MultiPolygon"===rt)for(Q=0;Q<F.coordinates.length;Q++)Le(F.coordinates[Q],Z);return F};function Le(tt,F){if(0!==tt.length){ze(tt[0],F);for(var Z=1;Z<tt.length;Z++)ze(tt[Z],!F)}}function ze(tt,F){for(var Z=0,Q=0,rt=0,ft=tt.length,Tt=ft-1;rt<ft;Tt=rt++){var Ct=(tt[rt][0]-tt[Tt][0])*(tt[Tt][1]+tt[rt][1]),gt=Z+Ct;Q+=Math.abs(Z)>=Math.abs(Ct)?Z-gt+Ct:Ct-gt+Z,Z=gt}Z+Q>=0!=!!F&&tt.reverse()}const ie=u.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Oe{constructor(F){this._feature=F,this.extent=u.EXTENT,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(1===this._feature.type){const F=[];for(const Z of this._feature.geometry)F.push([new u.pointGeometry(Z[0],Z[1])]);return F}{const F=[];for(const Z of this._feature.geometry){const Q=[];for(const rt of Z)Q.push(new u.pointGeometry(rt[0],rt[1]));F.push(Q)}return F}}toGeoJSON(F,Z,Q){return ie.call(this,F,Z,Q)}}class ui{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=F.length,this._features=F}feature(F){return new Oe(this._features[F])}}var de=u.vectorTile.VectorTileFeature,ei=zi;function zi(tt,F){this.options=F||{},this.features=tt,this.length=tt.length}function Ke(tt,F){this.id="number"==typeof tt.id?tt.id:void 0,this.type=tt.type,this.rawGeometry=1===tt.type?[tt.geometry]:tt.geometry,this.properties=tt.tags,this.extent=F||4096}zi.prototype.feature=function(tt){return new Ke(this.features[tt],this.options.extent)},Ke.prototype.loadGeometry=function(){var tt=this.rawGeometry;this.geometry=[];for(var F=0;F<tt.length;F++){for(var Z=tt[F],Q=[],rt=0;rt<Z.length;rt++)Q.push(new u.pointGeometry(Z[rt][0],Z[rt][1]));this.geometry.push(Q)}return this.geometry},Ke.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var tt=this.geometry,F=1/0,Z=-1/0,Q=1/0,rt=-1/0,ft=0;ft<tt.length;ft++)for(var Tt=tt[ft],Ct=0;Ct<Tt.length;Ct++){var gt=Tt[Ct];F=Math.min(F,gt.x),Z=Math.max(Z,gt.x),Q=Math.min(Q,gt.y),rt=Math.max(rt,gt.y)}return[F,Q,Z,rt]},Ke.prototype.toGeoJSON=de.prototype.toGeoJSON;var ke=vi,De=ei;function vi(tt){var F=new u.pbf;return function(Z,Q){for(var rt in Z.layers)Q.writeMessage(3,re,Z.layers[rt])}(tt,F),F.finish()}function re(tt,F){var Z;F.writeVarintField(15,tt.version||1),F.writeStringField(1,tt.name||""),F.writeVarintField(5,tt.extent||4096);var Q={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<tt.length;Z++)Q.feature=tt.feature(Z),F.writeMessage(2,we,Q);var rt=Q.keys;for(Z=0;Z<rt.length;Z++)F.writeStringField(3,rt[Z]);var ft=Q.values;for(Z=0;Z<ft.length;Z++)F.writeMessage(4,nn,ft[Z])}function we(tt,F){var Z=tt.feature;void 0!==Z.id&&F.writeVarintField(1,Z.id),F.writeMessage(2,di,tt),F.writeVarintField(3,Z.type),F.writeMessage(4,nr,Z)}function di(tt,F){var Z=tt.feature,Q=tt.keys,rt=tt.values,ft=tt.keycache,Tt=tt.valuecache;for(var Ct in Z.properties){var gt=Z.properties[Ct],St=ft[Ct];if(null!==gt){void 0===St&&(Q.push(Ct),ft[Ct]=St=Q.length-1),F.writeVarint(St);var Bt=typeof gt;"string"!==Bt&&"boolean"!==Bt&&"number"!==Bt&&(gt=JSON.stringify(gt));var Nt=Bt+":"+gt,Xt=Tt[Nt];void 0===Xt&&(rt.push(gt),Tt[Nt]=Xt=rt.length-1),F.writeVarint(Xt)}}}function Ti(tt,F){return(F<<3)+(7&tt)}function an(tt){return tt<<1^tt>>31}function nr(tt,F){for(var Z=tt.loadGeometry(),Q=tt.type,rt=0,ft=0,Tt=Z.length,Ct=0;Ct<Tt;Ct++){var gt=Z[Ct],St=1;1===Q&&(St=gt.length),F.writeVarint(Ti(1,St));for(var Bt=3===Q?gt.length-1:gt.length,Nt=0;Nt<Bt;Nt++){1===Nt&&1!==Q&&F.writeVarint(Ti(2,Bt-1));var Xt=gt[Nt].x-rt,be=gt[Nt].y-ft;F.writeVarint(an(Xt)),F.writeVarint(an(be)),rt+=Xt,ft+=be}3===Q&&F.writeVarint(Ti(7,1))}}function nn(tt,F){var Z=typeof tt;"string"===Z?F.writeStringField(1,tt):"boolean"===Z?F.writeBooleanField(7,tt):"number"===Z&&(tt%1!=0?F.writeDoubleField(3,tt):tt<0?F.writeSVarintField(6,tt):F.writeVarintField(5,tt))}function fn(tt,F,Z,Q,rt,ft){if(rt-Q<=Z)return;const Tt=Q+rt>>1;qn(tt,F,Tt,Q,rt,ft%2),fn(tt,F,Z,Q,Tt-1,ft+1),fn(tt,F,Z,Tt+1,rt,ft+1)}function qn(tt,F,Z,Q,rt,ft){for(;rt>Q;){if(rt-Q>600){const St=rt-Q+1,Bt=Z-Q+1,Nt=Math.log(St),Xt=.5*Math.exp(2*Nt/3),be=.5*Math.sqrt(Nt*Xt*(St-Xt)/St)*(Bt-St/2<0?-1:1);qn(tt,F,Z,Math.max(Q,Math.floor(Z-Bt*Xt/St+be)),Math.min(rt,Math.floor(Z+(St-Bt)*Xt/St+be)),ft)}const Tt=F[2*Z+ft];let Ct=Q,gt=rt;for(Ki(tt,F,Q,Z),F[2*rt+ft]>Tt&&Ki(tt,F,Q,rt);Ct<gt;){for(Ki(tt,F,Ct,gt),Ct++,gt--;F[2*Ct+ft]<Tt;)Ct++;for(;F[2*gt+ft]>Tt;)gt--}F[2*Q+ft]===Tt?Ki(tt,F,Q,gt):(gt++,Ki(tt,F,gt,rt)),gt<=Z&&(Q=gt+1),Z<=gt&&(rt=gt-1)}}function Ki(tt,F,Z,Q){Mn(tt,Z,Q),Mn(F,2*Z,2*Q),Mn(F,2*Z+1,2*Q+1)}function Mn(tt,F,Z){const Q=tt[F];tt[F]=tt[Z],tt[Z]=Q}function Ne(tt,F,Z,Q){const rt=tt-Z,ft=F-Q;return rt*rt+ft*ft}ke.fromVectorTileJs=vi,ke.fromGeojsonVt=function(tt,F){F=F||{};var Z={};for(var Q in tt)Z[Q]=new ei(tt[Q].features,F),Z[Q].name=Q,Z[Q].version=F.version,Z[Q].extent=F.extent;return vi({layers:Z})},ke.GeoJSONWrapper=De;const hn=tt=>tt[0],on=tt=>tt[1];class Rr{constructor(F,Z=hn,Q=on,rt=64,ft=Float64Array){this.nodeSize=rt,this.points=F;const Tt=F.length<65536?Uint16Array:Uint32Array,Ct=this.ids=new Tt(F.length),gt=this.coords=new ft(2*F.length);for(let St=0;St<F.length;St++)Ct[St]=St,gt[2*St]=Z(F[St]),gt[2*St+1]=Q(F[St]);fn(Ct,gt,rt,0,Ct.length-1,0)}range(F,Z,Q,rt){return function(ft,Tt,Ct,gt,St,Bt,Nt){const Xt=[0,ft.length-1,0],be=[];let Ce,Se;for(;Xt.length;){const Fe=Xt.pop(),Je=Xt.pop(),wi=Xt.pop();if(Je-wi<=Nt){for(let Li=wi;Li<=Je;Li++)Ce=Tt[2*Li],Se=Tt[2*Li+1],Ce>=Ct&&Ce<=St&&Se>=gt&&Se<=Bt&&be.push(ft[Li]);continue}const Ri=Math.floor((wi+Je)/2);Ce=Tt[2*Ri],Se=Tt[2*Ri+1],Ce>=Ct&&Ce<=St&&Se>=gt&&Se<=Bt&&be.push(ft[Ri]);const yi=(Fe+1)%2;(0===Fe?Ct<=Ce:gt<=Se)&&(Xt.push(wi),Xt.push(Ri-1),Xt.push(yi)),(0===Fe?St>=Ce:Bt>=Se)&&(Xt.push(Ri+1),Xt.push(Je),Xt.push(yi))}return be}(this.ids,this.coords,F,Z,Q,rt,this.nodeSize)}within(F,Z,Q){return function(rt,ft,Tt,Ct,gt,St){const Bt=[0,rt.length-1,0],Nt=[],Xt=gt*gt;for(;Bt.length;){const be=Bt.pop(),Ce=Bt.pop(),Se=Bt.pop();if(Ce-Se<=St){for(let yi=Se;yi<=Ce;yi++)Ne(ft[2*yi],ft[2*yi+1],Tt,Ct)<=Xt&&Nt.push(rt[yi]);continue}const Fe=Math.floor((Se+Ce)/2),Je=ft[2*Fe],wi=ft[2*Fe+1];Ne(Je,wi,Tt,Ct)<=Xt&&Nt.push(rt[Fe]);const Ri=(be+1)%2;(0===be?Tt-gt<=Je:Ct-gt<=wi)&&(Bt.push(Se),Bt.push(Fe-1),Bt.push(Ri)),(0===be?Tt+gt>=Je:Ct+gt>=wi)&&(Bt.push(Fe+1),Bt.push(Ce),Bt.push(Ri))}return Nt}(this.ids,this.coords,F,Z,Q,this.nodeSize)}}const Ai={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:tt=>tt},_i=Math.fround||(Wn=new Float32Array(1),tt=>(Wn[0]=+tt,Wn[0]));var Wn;class rr{constructor(F){this.options=Bn(Object.create(Ai),F),this.trees=new Array(this.options.maxZoom+1)}load(F){const{log:Z,minZoom:Q,maxZoom:rt,nodeSize:ft}=this.options;Z&&console.time("total time");const Tt=`prepare ${F.length} points`;Z&&console.time(Tt),this.points=F;let Ct=[];for(let gt=0;gt<F.length;gt++)F[gt].geometry&&Ct.push(Ci(F[gt],gt));this.trees[rt+1]=new Rr(Ct,Pn,Ei,ft,Float32Array),Z&&console.timeEnd(Tt);for(let gt=rt;gt>=Q;gt--){const St=+Date.now();Ct=this._cluster(Ct,gt),this.trees[gt]=new Rr(Ct,Pn,Ei,ft,Float32Array),Z&&console.log("z%d: %d clusters in %dms",gt,Ct.length,+Date.now()-St)}return Z&&console.timeEnd("total time"),this}getClusters(F,Z){let Q=((F[0]+180)%360+360)%360-180;const rt=Math.max(-90,Math.min(90,F[1]));let ft=180===F[2]?180:((F[2]+180)%360+360)%360-180;const Tt=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)Q=-180,ft=180;else if(Q>ft){const Bt=this.getClusters([Q,rt,180,Tt],Z),Nt=this.getClusters([-180,rt,ft,Tt],Z);return Bt.concat(Nt)}const Ct=this.trees[this._limitZoom(Z)],gt=Ct.range(Vi(Q),Ve(Tt),Vi(ft),Ve(rt)),St=[];for(const Bt of gt){const Nt=Ct.points[Bt];St.push(Nt.numPoints?gn(Nt):this.points[Nt.index])}return St}getChildren(F){const Z=this._getOriginId(F),Q=this._getOriginZoom(F),rt="No cluster with the specified id.",ft=this.trees[Q];if(!ft)throw new Error(rt);const Tt=ft.points[Z];if(!Tt)throw new Error(rt);const Ct=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),gt=ft.within(Tt.x,Tt.y,Ct),St=[];for(const Bt of gt){const Nt=ft.points[Bt];Nt.parentId===F&&St.push(Nt.numPoints?gn(Nt):this.points[Nt.index])}if(0===St.length)throw new Error(rt);return St}getLeaves(F,Z,Q){const rt=[];return this._appendLeaves(rt,F,Z=Z||10,Q=Q||0,0),rt}getTile(F,Z,Q){const rt=this.trees[this._limitZoom(F)],ft=Math.pow(2,F),{extent:Tt,radius:Ct}=this.options,gt=Ct/Tt,St=(Q-gt)/ft,Bt=(Q+1+gt)/ft,Nt={features:[]};return this._addTileFeatures(rt.range((Z-gt)/ft,St,(Z+1+gt)/ft,Bt),rt.points,Z,Q,ft,Nt),0===Z&&this._addTileFeatures(rt.range(1-gt/ft,St,1,Bt),rt.points,ft,Q,ft,Nt),Z===ft-1&&this._addTileFeatures(rt.range(0,St,gt/ft,Bt),rt.points,-1,Q,ft,Nt),Nt.features.length?Nt:null}getClusterExpansionZoom(F){let Z=this._getOriginZoom(F)-1;for(;Z<=this.options.maxZoom;){const Q=this.getChildren(F);if(Z++,1!==Q.length)break;F=Q[0].properties.cluster_id}return Z}_appendLeaves(F,Z,Q,rt,ft){const Tt=this.getChildren(Z);for(const Ct of Tt){const gt=Ct.properties;if(gt&&gt.cluster?ft+gt.point_count<=rt?ft+=gt.point_count:ft=this._appendLeaves(F,gt.cluster_id,Q,rt,ft):ft<rt?ft++:F.push(Ct),F.length===Q)break}return ft}_addTileFeatures(F,Z,Q,rt,ft,Tt){for(const Ct of F){const gt=Z[Ct],St=gt.numPoints;let Bt,Nt,Xt;if(St)Bt=vr(gt),Nt=gt.x,Xt=gt.y;else{const Se=this.points[gt.index];Bt=Se.properties,Nt=Vi(Se.geometry.coordinates[0]),Xt=Ve(Se.geometry.coordinates[1])}const be={type:1,geometry:[[Math.round(this.options.extent*(Nt*ft-Q)),Math.round(this.options.extent*(Xt*ft-rt))]],tags:Bt};let Ce;St?Ce=gt.id:this.options.generateId?Ce=gt.index:this.points[gt.index].id&&(Ce=this.points[gt.index].id),void 0!==Ce&&(be.id=Ce),Tt.features.push(be)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(+F,this.options.maxZoom+1))}_cluster(F,Z){const Q=[],{radius:rt,extent:ft,reduce:Tt,minPoints:Ct}=this.options,gt=rt/(ft*Math.pow(2,Z));for(let St=0;St<F.length;St++){const Bt=F[St];if(Bt.zoom<=Z)continue;Bt.zoom=Z;const Nt=this.trees[Z+1],Xt=Nt.within(Bt.x,Bt.y,gt),be=Bt.numPoints||1;let Ce=be;for(const Se of Xt){const Fe=Nt.points[Se];Fe.zoom>Z&&(Ce+=Fe.numPoints||1)}if(Ce>be&&Ce>=Ct){let Se=Bt.x*be,Fe=Bt.y*be,Je=Tt&&be>1?this._map(Bt,!0):null;const wi=(St<<5)+(Z+1)+this.points.length;for(const Ri of Xt){const yi=Nt.points[Ri];if(yi.zoom<=Z)continue;yi.zoom=Z;const Li=yi.numPoints||1;Se+=yi.x*Li,Fe+=yi.y*Li,yi.parentId=wi,Tt&&(Je||(Je=this._map(Bt,!0)),Tt(Je,this._map(yi)))}Bt.parentId=wi,Q.push(ra(Se/Ce,Fe/Ce,wi,Ce,Je))}else if(Q.push(Bt),Ce>1)for(const Se of Xt){const Fe=Nt.points[Se];Fe.zoom<=Z||(Fe.zoom=Z,Q.push(Fe))}}return Q}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,Z){if(F.numPoints)return Z?Bn({},F.properties):F.properties;const Q=this.points[F.index].properties,rt=this.options.map(Q);return Z&&rt===Q?Bn({},rt):rt}}function ra(tt,F,Z,Q,rt){return{x:_i(tt),y:_i(F),zoom:1/0,id:Z,parentId:-1,numPoints:Q,properties:rt}}function Ci(tt,F){const[Z,Q]=tt.geometry.coordinates;return{x:_i(Vi(Z)),y:_i(Ve(Q)),zoom:1/0,index:F,parentId:-1}}function gn(tt){return{type:"Feature",id:tt.id,properties:vr(tt),geometry:{type:"Point",coordinates:[(F=tt.x,360*(F-.5)),ln(tt.y)]}};var F}function vr(tt){const F=tt.numPoints,Z=F>=1e4?`${Math.round(F/1e3)}k`:F>=1e3?Math.round(F/100)/10+"k":F;return Bn(Bn({},tt.properties),{cluster:!0,cluster_id:tt.id,point_count:F,point_count_abbreviated:Z})}function Vi(tt){return tt/360+.5}function Ve(tt){const F=Math.sin(tt*Math.PI/180),Z=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Z<0?0:Z>1?1:Z}function ln(tt){const F=(180-360*tt)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Bn(tt,F){for(const Z in F)tt[Z]=F[Z];return tt}function Pn(tt){return tt.x}function Ei(tt){return tt.y}function Tn(tt,F,Z,Q){for(var rt,ft=Q,Tt=Z-F>>1,Ct=Z-F,gt=tt[F],St=tt[F+1],Bt=tt[Z],Nt=tt[Z+1],Xt=F+3;Xt<Z;Xt+=3){var be=pi(tt[Xt],tt[Xt+1],gt,St,Bt,Nt);if(be>ft)rt=Xt,ft=be;else if(be===ft){var Ce=Math.abs(Xt-Tt);Ce<Ct&&(rt=Xt,Ct=Ce)}}ft>Q&&(rt-F>3&&Tn(tt,F,rt,Q),tt[rt+2]=ft,Z-rt>3&&Tn(tt,rt,Z,Q))}function pi(tt,F,Z,Q,rt,ft){var Tt=rt-Z,Ct=ft-Q;if(0!==Tt||0!==Ct){var gt=((tt-Z)*Tt+(F-Q)*Ct)/(Tt*Tt+Ct*Ct);gt>1?(Z=rt,Q=ft):gt>0&&(Z+=Tt*gt,Q+=Ct*gt)}return(Tt=tt-Z)*Tt+(Ct=F-Q)*Ct}function Yi(tt,F,Z,Q){var rt={id:void 0===tt?null:tt,type:F,geometry:Z,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ft){var Tt=ft.geometry,Ct=ft.type;if("Point"===Ct||"MultiPoint"===Ct||"LineString"===Ct)zn(ft,Tt);else if("Polygon"===Ct||"MultiLineString"===Ct)for(var gt=0;gt<Tt.length;gt++)zn(ft,Tt[gt]);else if("MultiPolygon"===Ct)for(gt=0;gt<Tt.length;gt++)for(var St=0;St<Tt[gt].length;St++)zn(ft,Tt[gt][St])}(rt),rt}function zn(tt,F){for(var Z=0;Z<F.length;Z+=3)tt.minX=Math.min(tt.minX,F[Z]),tt.minY=Math.min(tt.minY,F[Z+1]),tt.maxX=Math.max(tt.maxX,F[Z]),tt.maxY=Math.max(tt.maxY,F[Z+1])}function Yn(tt,F,Z,Q){if(F.geometry){var rt=F.geometry.coordinates,ft=F.geometry.type,Tt=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Ct=[],gt=F.id;if(Z.promoteId?gt=F.properties[Z.promoteId]:Z.generateId&&(gt=Q||0),"Point"===ft)he(rt,Ct);else if("MultiPoint"===ft)for(var St=0;St<rt.length;St++)he(rt[St],Ct);else if("LineString"===ft)Ie(rt,Ct,Tt,!1);else if("MultiLineString"===ft){if(Z.lineMetrics){for(St=0;St<rt.length;St++)Ie(rt[St],Ct=[],Tt,!1),tt.push(Yi(gt,"LineString",Ct,F.properties));return}Wt(rt,Ct,Tt,!1)}else if("Polygon"===ft)Wt(rt,Ct,Tt,!0);else{if("MultiPolygon"!==ft){if("GeometryCollection"===ft){for(St=0;St<F.geometry.geometries.length;St++)Yn(tt,{id:gt,geometry:F.geometry.geometries[St],properties:F.properties},Z,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(St=0;St<rt.length;St++){var Bt=[];Wt(rt[St],Bt,Tt,!0),Ct.push(Bt)}}tt.push(Yi(gt,ft,Ct,F.properties))}}function he(tt,F){F.push(le(tt[0])),F.push(ii(tt[1])),F.push(0)}function Ie(tt,F,Z,Q){for(var rt,ft,Tt=0,Ct=0;Ct<tt.length;Ct++){var gt=le(tt[Ct][0]),St=ii(tt[Ct][1]);F.push(gt),F.push(St),F.push(0),Ct>0&&(Tt+=Q?(rt*St-gt*ft)/2:Math.sqrt(Math.pow(gt-rt,2)+Math.pow(St-ft,2))),rt=gt,ft=St}var Bt=F.length-3;F[2]=1,Tn(F,0,Bt,Z),F[Bt+2]=1,F.size=Math.abs(Tt),F.start=0,F.end=F.size}function Wt(tt,F,Z,Q){for(var rt=0;rt<tt.length;rt++){var ft=[];Ie(tt[rt],ft,Z,Q),F.push(ft)}}function le(tt){return tt/360+.5}function ii(tt){var F=Math.sin(tt*Math.PI/180),Z=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Z<0?0:Z>1?1:Z}function Me(tt,F,Z,Q,rt,ft,Tt,Ct){if(Q/=F,ft>=(Z/=F)&&Tt<Q)return tt;if(Tt<Z||ft>=Q)return null;for(var gt=[],St=0;St<tt.length;St++){var Bt=tt[St],Nt=Bt.geometry,Xt=Bt.type,be=0===rt?Bt.minX:Bt.minY,Ce=0===rt?Bt.maxX:Bt.maxY;if(be>=Z&&Ce<Q)gt.push(Bt);else if(!(Ce<Z||be>=Q)){var Se=[];if("Point"===Xt||"MultiPoint"===Xt)Xn(Nt,Se,Z,Q,rt);else if("LineString"===Xt)Ji(Nt,Se,Z,Q,rt,!1,Ct.lineMetrics);else if("MultiLineString"===Xt)Cn(Nt,Se,Z,Q,rt,!1);else if("Polygon"===Xt)Cn(Nt,Se,Z,Q,rt,!0);else if("MultiPolygon"===Xt)for(var Fe=0;Fe<Nt.length;Fe++){var Je=[];Cn(Nt[Fe],Je,Z,Q,rt,!0),Je.length&&Se.push(Je)}if(Se.length){if(Ct.lineMetrics&&"LineString"===Xt){for(Fe=0;Fe<Se.length;Fe++)gt.push(Yi(Bt.id,Xt,Se[Fe],Bt.tags));continue}"LineString"!==Xt&&"MultiLineString"!==Xt||(1===Se.length?(Xt="LineString",Se=Se[0]):Xt="MultiLineString"),"Point"!==Xt&&"MultiPoint"!==Xt||(Xt=3===Se.length?"Point":"MultiPoint"),gt.push(Yi(Bt.id,Xt,Se,Bt.tags))}}}return gt.length?gt:null}function Xn(tt,F,Z,Q,rt){for(var ft=0;ft<tt.length;ft+=3){var Tt=tt[ft+rt];Tt>=Z&&Tt<=Q&&(F.push(tt[ft]),F.push(tt[ft+1]),F.push(tt[ft+2]))}}function Ji(tt,F,Z,Q,rt,ft,Tt){for(var Ct,gt,St=Pi(tt),Bt=0===rt?Ni:ji,Nt=tt.start,Xt=0;Xt<tt.length-3;Xt+=3){var be=tt[Xt],Ce=tt[Xt+1],Se=tt[Xt+2],Fe=tt[Xt+3],Je=tt[Xt+4],wi=0===rt?be:Ce,Ri=0===rt?Fe:Je,yi=!1;Tt&&(Ct=Math.sqrt(Math.pow(be-Fe,2)+Math.pow(Ce-Je,2))),wi<Z?Ri>Z&&(gt=Bt(St,be,Ce,Fe,Je,Z),Tt&&(St.start=Nt+Ct*gt)):wi>Q?Ri<Q&&(gt=Bt(St,be,Ce,Fe,Je,Q),Tt&&(St.start=Nt+Ct*gt)):Ui(St,be,Ce,Se),Ri<Z&&wi>=Z&&(gt=Bt(St,be,Ce,Fe,Je,Z),yi=!0),Ri>Q&&wi<=Q&&(gt=Bt(St,be,Ce,Fe,Je,Q),yi=!0),!ft&&yi&&(Tt&&(St.end=Nt+Ct*gt),F.push(St),St=Pi(tt)),Tt&&(Nt+=Ct)}var Li=tt.length-3;be=tt[Li],Ce=tt[Li+1],Se=tt[Li+2],(wi=0===rt?be:Ce)>=Z&&wi<=Q&&Ui(St,be,Ce,Se),Li=St.length-3,ft&&Li>=3&&(St[Li]!==St[0]||St[Li+1]!==St[1])&&Ui(St,St[0],St[1],St[2]),St.length&&F.push(St)}function Pi(tt){var F=[];return F.size=tt.size,F.start=tt.start,F.end=tt.end,F}function Cn(tt,F,Z,Q,rt,ft){for(var Tt=0;Tt<tt.length;Tt++)Ji(tt[Tt],F,Z,Q,rt,ft,!1)}function Ui(tt,F,Z,Q){tt.push(F),tt.push(Z),tt.push(Q)}function Ni(tt,F,Z,Q,rt,ft){var Tt=(ft-F)/(Q-F);return tt.push(ft),tt.push(Z+(rt-Z)*Tt),tt.push(1),Tt}function ji(tt,F,Z,Q,rt,ft){var Tt=(ft-Z)/(rt-Z);return tt.push(F+(Q-F)*Tt),tt.push(ft),tt.push(1),Tt}function bi(tt,F){for(var Z=[],Q=0;Q<tt.length;Q++){var rt,ft=tt[Q],Tt=ft.type;if("Point"===Tt||"MultiPoint"===Tt||"LineString"===Tt)rt=mn(ft.geometry,F);else if("MultiLineString"===Tt||"Polygon"===Tt){rt=[];for(var Ct=0;Ct<ft.geometry.length;Ct++)rt.push(mn(ft.geometry[Ct],F))}else if("MultiPolygon"===Tt)for(rt=[],Ct=0;Ct<ft.geometry.length;Ct++){for(var gt=[],St=0;St<ft.geometry[Ct].length;St++)gt.push(mn(ft.geometry[Ct][St],F));rt.push(gt)}Z.push(Yi(ft.id,Tt,rt,ft.tags))}return Z}function mn(tt,F){var Z=[];Z.size=tt.size,void 0!==tt.start&&(Z.start=tt.start,Z.end=tt.end);for(var Q=0;Q<tt.length;Q+=3)Z.push(tt[Q]+F,tt[Q+1],tt[Q+2]);return Z}function Kn(tt,F){if(tt.transformed)return tt;var Z,Q,rt,ft=1<<tt.z,Tt=tt.x,Ct=tt.y;for(Z=0;Z<tt.features.length;Z++){var gt=tt.features[Z],St=gt.geometry,Bt=gt.type;if(gt.geometry=[],1===Bt)for(Q=0;Q<St.length;Q+=2)gt.geometry.push(Rn(St[Q],St[Q+1],F,ft,Tt,Ct));else for(Q=0;Q<St.length;Q++){var Nt=[];for(rt=0;rt<St[Q].length;rt+=2)Nt.push(Rn(St[Q][rt],St[Q][rt+1],F,ft,Tt,Ct));gt.geometry.push(Nt)}}return tt.transformed=!0,tt}function Rn(tt,F,Z,Q,rt,ft){return[Math.round(Z*(tt*Q-rt)),Math.round(Z*(F*Q-ft))]}function rs(tt,F,Z,Q,rt){for(var ft=F===rt.maxZoom?0:rt.tolerance/((1<<F)*rt.extent),Tt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:Q,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ct=0;Ct<tt.length;Ct++){Tt.numFeatures++,br(Tt,tt[Ct],ft,rt);var gt=tt[Ct].minX,St=tt[Ct].minY,Bt=tt[Ct].maxX,Nt=tt[Ct].maxY;gt<Tt.minX&&(Tt.minX=gt),St<Tt.minY&&(Tt.minY=St),Bt>Tt.maxX&&(Tt.maxX=Bt),Nt>Tt.maxY&&(Tt.maxY=Nt)}return Tt}function br(tt,F,Z,Q){var rt=F.geometry,ft=F.type,Tt=[];if("Point"===ft||"MultiPoint"===ft)for(var Ct=0;Ct<rt.length;Ct+=3)Tt.push(rt[Ct]),Tt.push(rt[Ct+1]),tt.numPoints++,tt.numSimplified++;else if("LineString"===ft)sr(Tt,rt,tt,Z,!1,!1);else if("MultiLineString"===ft||"Polygon"===ft)for(Ct=0;Ct<rt.length;Ct++)sr(Tt,rt[Ct],tt,Z,"Polygon"===ft,0===Ct);else if("MultiPolygon"===ft)for(var gt=0;gt<rt.length;gt++){var St=rt[gt];for(Ct=0;Ct<St.length;Ct++)sr(Tt,St[Ct],tt,Z,!0,0===Ct)}if(Tt.length){var Bt=F.tags||null;if("LineString"===ft&&Q.lineMetrics){for(var Nt in Bt={},F.tags)Bt[Nt]=F.tags[Nt];Bt.mapbox_clip_start=rt.start/rt.size,Bt.mapbox_clip_end=rt.end/rt.size}var Xt={geometry:Tt,type:"Polygon"===ft||"MultiPolygon"===ft?3:"LineString"===ft||"MultiLineString"===ft?2:1,tags:Bt};null!==F.id&&(Xt.id=F.id),tt.features.push(Xt)}}function sr(tt,F,Z,Q,rt,ft){var Tt=Q*Q;if(Q>0&&F.size<(rt?Tt:Q))Z.numPoints+=F.length/3;else{for(var Ct=[],gt=0;gt<F.length;gt+=3)(0===Q||F[gt+2]>Tt)&&(Z.numSimplified++,Ct.push(F[gt]),Ct.push(F[gt+1])),Z.numPoints++;rt&&function(St,Bt){for(var Nt=0,Xt=0,be=St.length,Ce=be-2;Xt<be;Ce=Xt,Xt+=2)Nt+=(St[Xt]-St[Ce])*(St[Xt+1]+St[Ce+1]);if(Nt>0===Bt)for(Xt=0,be=St.length;Xt<be/2;Xt+=2){var Se=St[Xt],Fe=St[Xt+1];St[Xt]=St[be-2-Xt],St[Xt+1]=St[be-1-Xt],St[be-2-Xt]=Se,St[be-1-Xt]=Fe}}(Ct,ft),tt.push(Ct)}}function yn(tt,F){var Z=(F=this.options=function(rt,ft){for(var Tt in ft)rt[Tt]=ft[Tt];return rt}(Object.create(this.options),F)).debug;if(Z&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var rt,ft,Tt,Ct,gt,St,Q=function(rt,ft){var Tt=[];if("FeatureCollection"===rt.type)for(var Ct=0;Ct<rt.features.length;Ct++)Yn(Tt,rt.features[Ct],ft,Ct);else Yn(Tt,"Feature"===rt.type?rt:{geometry:rt},ft);return Tt}(tt,F);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(rt=Q,ft=F,Tt=ft.buffer/ft.extent,Ct=rt,gt=Me(rt,1,-1-Tt,Tt,0,-1,2,ft),St=Me(rt,1,1-Tt,2+Tt,0,-1,2,ft),(gt||St)&&(Ct=Me(rt,1,-Tt,1+Tt,0,-1,2,ft)||[],gt&&(Ct=bi(gt,1).concat(Ct)),St&&(Ct=Ct.concat(bi(St,-1)))),Q=Ct).length&&this.splitTile(Q,0,0,0),Z&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Vn(tt,F,Z){return 32*((1<<tt)*Z+F)+tt}function Sn(tt,F){const Z=tt.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);const Q=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!Q)return F(null,null);const rt=new ui(Q.features);let ft=ke(rt);0===ft.byteOffset&&ft.byteLength===ft.buffer.byteLength||(ft=new Uint8Array(ft)),F(null,{vectorTile:rt,rawData:ft.buffer})}yn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yn.prototype.splitTile=function(tt,F,Z,Q,rt,ft,Tt){for(var Ct=[tt,F,Z,Q],gt=this.options,St=gt.debug;Ct.length;){Q=Ct.pop(),Z=Ct.pop(),F=Ct.pop(),tt=Ct.pop();var Bt=1<<F,Nt=Vn(F,Z,Q),Xt=this.tiles[Nt];if(!Xt&&(St>1&&console.time("creation"),Xt=this.tiles[Nt]=rs(tt,F,Z,Q,gt),this.tileCoords.push({z:F,x:Z,y:Q}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,Z,Q,Xt.numFeatures,Xt.numPoints,Xt.numSimplified),console.timeEnd("creation"));var be="z"+F;this.stats[be]=(this.stats[be]||0)+1,this.total++}if(Xt.source=tt,rt){if(F===gt.maxZoom||F===rt)continue;var Ce=1<<rt-F;if(Z!==Math.floor(ft/Ce)||Q!==Math.floor(Tt/Ce))continue}else if(F===gt.indexMaxZoom||Xt.numPoints<=gt.indexMaxPoints)continue;if(Xt.source=null,0!==tt.length){St>1&&console.time("clipping");var Se,Fe,Je,wi,Ri,yi,Li=.5*gt.buffer/gt.extent,Jn=.5-Li,ht=.5+Li,kt=1+Li;Se=Fe=Je=wi=null,Ri=Me(tt,Bt,Z-Li,Z+ht,0,Xt.minX,Xt.maxX,gt),yi=Me(tt,Bt,Z+Jn,Z+kt,0,Xt.minX,Xt.maxX,gt),tt=null,Ri&&(Se=Me(Ri,Bt,Q-Li,Q+ht,1,Xt.minY,Xt.maxY,gt),Fe=Me(Ri,Bt,Q+Jn,Q+kt,1,Xt.minY,Xt.maxY,gt),Ri=null),yi&&(Je=Me(yi,Bt,Q-Li,Q+ht,1,Xt.minY,Xt.maxY,gt),wi=Me(yi,Bt,Q+Jn,Q+kt,1,Xt.minY,Xt.maxY,gt),yi=null),St>1&&console.timeEnd("clipping"),Ct.push(Se||[],F+1,2*Z,2*Q),Ct.push(Fe||[],F+1,2*Z,2*Q+1),Ct.push(Je||[],F+1,2*Z+1,2*Q),Ct.push(wi||[],F+1,2*Z+1,2*Q+1)}}},yn.prototype.getTile=function(tt,F,Z){var Q=this.options,rt=Q.extent,ft=Q.debug;if(tt<0||tt>24)return null;var Tt=1<<tt,Ct=Vn(tt,F=(F%Tt+Tt)%Tt,Z);if(this.tiles[Ct])return Kn(this.tiles[Ct],rt);ft>1&&console.log("drilling down to z%d-%d-%d",tt,F,Z);for(var gt,St=tt,Bt=F,Nt=Z;!gt&&St>0;)St--,Bt=Math.floor(Bt/2),Nt=Math.floor(Nt/2),gt=this.tiles[Vn(St,Bt,Nt)];return gt&&gt.source?(ft>1&&console.log("found parent tile z%d-%d-%d",St,Bt,Nt),ft>1&&console.time("drilling down"),this.splitTile(gt.source,St,Bt,Nt,tt,F,Z),ft>1&&console.timeEnd("drilling down"),this.tiles[Ct]?Kn(this.tiles[Ct],rt):null):null};class ar extends u.VectorTileWorkerSource{constructor(F,Z,Q,rt,ft){super(F,Z,Q,rt,Sn),ft&&(this.loadGeoJSON=ft)}loadData(F,Z){const Q=F&&F.request,rt=Q&&Q.collectResourceTiming;this.loadGeoJSON(F,(ft,Tt)=>{if(ft||!Tt)return Z(ft);if("object"!=typeof Tt)return Z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{Pt(Tt,!0);try{if(F.filter){const gt=u.createExpression(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===gt.result)throw new Error(gt.value.map(Bt=>`${Bt.key}: ${Bt.message}`).join(", "));const St=Tt.features.filter(Bt=>gt.value.evaluate({zoom:0},Bt));Tt={type:"FeatureCollection",features:St}}this._geoJSONIndex=F.cluster?new rr(function({superclusterOptions:gt,clusterProperties:St}){if(!St||!gt)return gt;const Bt={},Nt={},Xt={accumulated:null,zoom:0},be={properties:null},Ce=Object.keys(St);for(const Se of Ce){const[Fe,Je]=St[Se],wi=u.createExpression(Je),Ri=u.createExpression("string"==typeof Fe?[Fe,["accumulated"],["get",Se]]:Fe);Bt[Se]=wi.value,Nt[Se]=Ri.value}return gt.map=Se=>{be.properties=Se;const Fe={};for(const Je of Ce)Fe[Je]=Bt[Je].evaluate(Xt,be);return Fe},gt.reduce=(Se,Fe)=>{be.properties=Fe;for(const Je of Ce)Xt.accumulated=Se[Je],Se[Je]=Nt[Je].evaluate(Xt,be)},gt}(F)).load(Tt.features):new yn(gt=Tt,F.geojsonVtOptions)}catch(gt){return Z(gt)}this.loaded={};const Ct={};if(rt){const gt=u.getPerformanceMeasurement(Q);gt&&(Ct.resourceTiming={},Ct.resourceTiming[F.source]=JSON.parse(JSON.stringify(gt)))}Z(null,Ct)}var gt})}reloadTile(F,Z){const Q=this.loaded;return Q&&Q[F.uid]?super.reloadTile(F,Z):this.loadTile(F,Z)}loadGeoJSON(F,Z){if(F.request)u.getJSON(F.request,Z);else{if("string"!=typeof F.data)return Z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(F.data))}catch(Q){return Z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(F,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(Q){Z(Q)}}getClusterChildren(F,Z){try{Z(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(Q){Z(Q)}}getClusterLeaves(F,Z){try{Z(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(Q){Z(Q)}}}class xn{constructor(F){this.self=F,this.actor=new u.Actor(F,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:ar},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,Q)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=Q},this.self.registerRTLTextPlugin=Z=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=Z.applyArabicShaping,u.plugin.processBidirectionalText=Z.processBidirectionalText,u.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(F,Z,Q){delete this.layerIndexes[F],delete this.availableImages[F],delete this.workerSources[F],delete this.demWorkerSources[F],Q()}checkIfReady(F,Z,Q){Q()}setReferrer(F,Z){this.referrer=Z}spriteLoaded(F,Z){this.isSpriteLoaded[F]=Z;for(const Q in this.workerSources[F]){const rt=this.workerSources[F][Q];for(const ft in rt)rt[ft]instanceof u.VectorTileWorkerSource&&(rt[ft].isSpriteLoaded=Z,rt[ft].fire(new u.Event("isSpriteLoaded")))}}setImages(F,Z,Q){this.availableImages[F]=Z;for(const rt in this.workerSources[F]){const ft=this.workerSources[F][rt];for(const Tt in ft)ft[Tt].availableImages=Z}Q()}enableTerrain(F,Z,Q){this.terrain=Z,Q()}setProjection(F,Z){this.projections[F]=u.getProjection(Z)}setLayers(F,Z,Q){this.getLayerIndex(F).replace(Z),Q()}updateLayers(F,Z,Q){this.getLayerIndex(F).update(Z.layers,Z.removedIds),Q()}loadTile(F,Z,Q){const rt=this.enableTerrain?u.extend({enableTerrain:this.terrain},Z):Z;rt.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,Z.type,Z.source).loadTile(rt,Q)}loadDEMTile(F,Z,Q){const rt=this.enableTerrain?u.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(F,Z.source).loadTile(rt,Q)}reloadTile(F,Z,Q){const rt=this.enableTerrain?u.extend({enableTerrain:this.terrain},Z):Z;rt.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,Z.type,Z.source).reloadTile(rt,Q)}abortTile(F,Z,Q){this.getWorkerSource(F,Z.type,Z.source).abortTile(Z,Q)}removeTile(F,Z,Q){this.getWorkerSource(F,Z.type,Z.source).removeTile(Z,Q)}removeSource(F,Z,Q){if(!this.workerSources[F]||!this.workerSources[F][Z.type]||!this.workerSources[F][Z.type][Z.source])return;const rt=this.workerSources[F][Z.type][Z.source];delete this.workerSources[F][Z.type][Z.source],void 0!==rt.removeSource?rt.removeSource(Z,Q):Q()}loadWorkerSource(F,Z,Q){try{this.self.importScripts(Z.url),Q()}catch(rt){Q(rt.toString())}}syncRTLPluginState(F,Z,Q){try{u.plugin.setState(Z);const rt=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=rt){this.self.importScripts(rt);const ft=u.plugin.isParsed();Q(ft?void 0:new Error(`RTL Text Plugin failed to import scripts from ${rt}`),ft)}}catch(rt){Q(rt.toString())}}getAvailableImages(F){let Z=this.availableImages[F];return Z||(Z=[]),Z}getLayerIndex(F){let Z=this.layerIndexes[F];return Z||(Z=this.layerIndexes[F]=new mi),Z}getWorkerSource(F,Z,Q){return this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][Z]||(this.workerSources[F][Z]={}),this.workerSources[F][Z][Q]||(this.workerSources[F][Z][Q]=new this.workerSourceTypes[Z]({send:(rt,ft,Tt,Ct,gt,St)=>{this.actor.send(rt,ft,Tt,F,gt,St)},scheduler:this.actor.scheduler},this.getLayerIndex(F),this.getAvailableImages(F),this.isSpriteLoaded[F])),this.workerSources[F][Z][Q]}getDEMWorkerSource(F,Z){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][Z]||(this.demWorkerSources[F][Z]=new Te),this.demWorkerSources[F][Z]}enforceCacheSizeLimit(F,Z){u.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(F,Z,Q){Q(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xn(self)),xn}),Si(0,function(u){var B=$i;function $i(p){return i=p,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,b=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(b);try{y=new Worker(T),m=!0}catch(A){m=!1}return y&&y.terminate(),URL.revokeObjectURL(T),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var b=y.getImageData(0,0,1,1);return b&&b.width===m.width}()||(void 0===mi[l=i&&i.failIfMajorPerformanceCaveat]&&(mi[l]=function(m){var y,T,A,z,b=(T=m,A=document.createElement("canvas"),(z=Object.create($i.webGLContextAttributes)).failIfMajorPerformanceCaveat=T,A.getContext("webgl",z)||A.getContext("experimental-webgl",z));if(!b)return!1;try{y=b.createShader(b.VERTEX_SHADER)}catch(T){return!1}return!(!y||b.isContextLost())&&(b.shaderSource(y,"void main() {}"),b.compileShader(y),!0===b.getShaderParameter(y,b.COMPILE_STATUS))}(l)),!mi[l]||document.documentMode));var i,l}var mi={};function jt(p,i){var l=i[0],m=i[1],y=i[2],b=i[3],T=l*b-y*m;return T?(p[0]=b*(T=1/T),p[1]=-m*T,p[2]=-y*T,p[3]=l*T,p):null}function Te(p,i){if(Array.isArray(p)){if(!Array.isArray(i)||p.length!==i.length)return!1;for(let l=0;l<p.length;l++)if(!Te(p[l],i[l]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==i){if("object"!=typeof i||Object.keys(p).length!==Object.keys(i).length)return!1;for(const l in p)if(!Te(p[l],i[l]))return!1;return!0}return p===i}$i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Pt={create:function(p,i,l){const m=u.window.document.createElement(p);return void 0!==i&&(m.className=i),l&&l.appendChild(m),m},createSVG:function(p,i,l){const m=u.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const y of Object.keys(i))m.setAttributeNS(null,y,i[y]);return l&&l.appendChild(m),m}},Le=u.window.document&&u.window.document.documentElement.style,ze=Le&&void 0!==Le.userSelect?"userSelect":"WebkitUserSelect";let ie;Pt.disableDrag=function(){Le&&ze&&(ie=Le[ze],Le[ze]="none")},Pt.enableDrag=function(){Le&&ze&&(Le[ze]=ie)};const Oe=function(p){p.preventDefault(),p.stopPropagation(),u.window.removeEventListener("click",Oe,!0)};function ui(p,i,l){const m=p.offsetWidth===i.width?1:p.offsetWidth/i.width;return new u.pointGeometry((l.clientX-i.left)*m,(l.clientY-i.top)*m)}function de(p){const{userImage:i}=p;return!!(i&&i.render&&i.render())&&(p.data.replace(new Uint8Array(i.data.buffer)),!0)}Pt.suppressClick=function(){u.window.addEventListener("click",Oe,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",Oe,!0)},0)},Pt.mousePos=function(p,i){const l=p.getBoundingClientRect();return ui(p,l,i)},Pt.touchPos=function(p,i){const l=p.getBoundingClientRect(),m=[];for(let y=0;y<i.length;y++)m.push(ui(p,l,i[y]));return m},Pt.mouseButton=function(p){return void 0!==u.window.InstallTrigger&&2===p.button&&p.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button};class ei extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:l,callback:m}of this.requestors)this._notify(l,m);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,l){this._validate(i,l)&&(this.images[i]=l)}_validate(i,l){let m=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(l.content,l)||(this.fire(new u.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,l){if(!i)return!0;let m=0;for(const y of i){if(y[0]<m||y[1]<y[0]||l<y[1])return!1;m=y[1]}return!0}_validateContent(i,l){return!(i&&(4!==i.length||i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,l){l.version=this.images[i].version+1,this.images[i]=l,this.updatedImages[i]=!0}removeImage(i){const l=this.images[i];delete this.images[i],delete this.patterns[i],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,l){let m=!0;if(!this.isLoaded())for(const y of i)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(i,l):this.requestors.push({ids:i,callback:l})}_notify(i,l){const m={};for(const y of i){this.images[y]||this.fire(new u.Event("styleimagemissing",{id:y}));const b=this.images[y];b?m[y]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:u.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,m)}getPixelSize(){const{width:i,height:l}=this.atlasImage;return{width:i,height:l}}getPattern(i){const l=this.patterns[i],m=this.getImage(i);if(!m)return null;if(l&&l.position.version===m.version)return l.position;if(l)l.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new u.ImagePosition(y,m);this.patterns[i]={bin:y,position:b}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const l=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(i,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const b in this.patterns)i.push(this.patterns[b].bin);const{w:l,h:m}=u.potpack(i),y=this.atlasImage;y.resize({width:l||1,height:m||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],A=T.x+1,z=T.y+1,R=this.images[b].data,O=R.width,N=R.height;u.RGBAImage.copy(R,y,{x:0,y:0},{x:A,y:z},{width:O,height:N}),u.RGBAImage.copy(R,y,{x:0,y:N-1},{x:A,y:z-1},{width:O,height:1}),u.RGBAImage.copy(R,y,{x:0,y:0},{x:A,y:z+N},{width:O,height:1}),u.RGBAImage.copy(R,y,{x:O-1,y:0},{x:A-1,y:z},{width:1,height:N}),u.RGBAImage.copy(R,y,{x:0,y:0},{x:A+O,y:z},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const l of i){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const m=this.images[l];de(m)&&this.updateImage(l,m)}}}const zi=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(p,i){return function([l,m,y]){const b=u.degToRad(m+90),T=u.degToRad(y);return{x:l*Math.cos(b)*Math.sin(T),y:l*Math.sin(b)*Math.sin(T),z:l*Math.cos(T),azimuthal:m,polar:y}}(p.expression.evaluate(i))}interpolate(p,i,l){return{x:u.number(p.x,i.x,l),y:u.number(p.y,i.y,l),z:u.number(p.z,i.z,l),azimuthal:u.number(p.azimuthal,i.azimuthal,l),polar:u.number(p.polar,i.polar,l)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)}),Ke="-transition";class ke extends u.Evented{constructor(i){super(),this._transitionable=new u.Transitionable(zi),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l={}){if(!this._validate(u.validateLight,i,l))for(const m in i){const y=i[m];u.endsWith(m,Ke)?this._transitionable.setTransition(m.slice(0,-Ke.length),y):this._transitionable.setValue(m,y)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,m){return(!m||!1!==m.validate)&&u.emitValidationErrors(this,i.call(u.validateStyle,u.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const De=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)}),vi="-transition";class re extends u.Evented{constructor(i,l){super(),this._transitionable=new u.Transitionable(De),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(i){for(const l in i){const m=i[l];u.endsWith(l,vi)?this._transitionable.setTransition(l.slice(0,-vi.length),m):this._transitionable.setValue(l,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function we(p,i,l,m){const y=u.smoothstep(45,65,l),[b,T]=di(p,m),A=u.length(i);let z=1-Math.min(1,Math.exp((A-b)/(T-b)*-6));return z*=z*z,z=Math.min(1,1.00747*z),z*y*p.alpha}function di(p,i){const l=.5/Math.tan(.5*i);return[p.range[0]+l,p.range[1]+l]}const Ti=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"])}),an="-transition";class nr extends u.Evented{constructor(i,l){super(),this._transitionable=new u.Transitionable(Ti),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,l={}){if(!this._validate(u.validateFog,i,l))for(const m in i){const y=i[m];u.endsWith(m,an)?this._transitionable.setTransition(m.slice(0,-an.length),y):this._transitionable.setValue(m,y)}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return u.smoothstep(45,65,i)*l.a}getOpacityAtLatLng(i,l){return this._transform.projection.supportsFog?function(m,y,b){const T=u.MercatorCoordinate.fromLngLat(y),A=b.elevation?b.elevation.getAtPointOrZero(T):0,z=[T.x,T.y,A];return u.transformMat4(z,z,b.mercatorFogMatrix),we(m,z,b.pitch,b._fov)}(this.state,i,l):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?di(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,m){return(!m||!1!==m.validate)&&u.emitValidationErrors(this,i.call(u.validateStyle,u.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class nn{constructor(i,l){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){const b=new nn.Actor(m[y],l,this.id);b.name=`Worker ${y}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,l,m){u.asyncAll(this.actors,(y,b)=>{y.send(i,l,b)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function fn(p,i,l){return i*(u.EXTENT/(p.tileSize*Math.pow(2,l-p.tileID.overscaledZ)))}nn.Actor=u.Actor;class qn{constructor(i,l,m){this.context=i;const y=i.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ki={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Mn{constructor(i,l,m,y){this.length=l.length,this.attributes=m,this.itemSize=l.bytesPerElement,this.dynamicDraw=y,this.context=i;const b=i.gl;this.buffer=b.createBuffer(),i.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let m=0;m<this.attributes.length;m++){const y=l.attributes[this.attributes[m].name];void 0!==y&&i.enableVertexAttribArray(y)}}setVertexAttribPointers(i,l,m){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],T=l.attributes[b.name];void 0!==T&&i.vertexAttribPointer(T,b.components,i[Ki[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ne{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hn extends Ne{getDefault(){return u.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class on extends Ne{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Rr extends Ne{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Ai extends Ne{getDefault(){return[!0,!0,!0,!0]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class _i extends Ne{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Wn extends Ne{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class rr extends Ne{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class ra extends Ne{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ci extends Ne{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class gn extends Ne{getDefault(){return[0,1]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class vr extends Ne{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class Vi extends Ne{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Ve extends Ne{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class ln extends Ne{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Bn extends Ne{getDefault(){return u.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Pn extends Ne{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Ei extends Ne{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class Tn extends Ne{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class pi extends Ne{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Yi extends Ne{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class zn extends Ne{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Yn extends Ne{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class he extends Ne{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ie extends Ne{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Wt extends Ne{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class le extends Ne{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ii extends Ne{getDefault(){return null}set(i){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Me extends Ne{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Xn extends Ne{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Ji extends Ne{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Pi extends Ne{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Cn extends Ne{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class Ui extends Cn{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ni extends Cn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ji extends Ni{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class bi{constructor(i,l,m,y){this.context=i,this.width=l,this.height=m;const b=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Ui(i,b),y&&(this.depthAttachment=new Ni(i,b))}destroy(){const i=this.context.gl,l=this.colorAttachment.get();if(l&&i.deleteTexture(l),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class mn{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new hn(this),this.clearDepth=new on(this),this.clearStencil=new Rr(this),this.colorMask=new Ai(this),this.depthMask=new _i(this),this.stencilMask=new Wn(this),this.stencilFunc=new rr(this),this.stencilOp=new ra(this),this.stencilTest=new Ci(this),this.depthRange=new gn(this),this.depthTest=new vr(this),this.depthFunc=new Vi(this),this.blend=new Ve(this),this.blendFunc=new ln(this),this.blendColor=new Bn(this),this.blendEquation=new Pn(this),this.cullFace=new Ei(this),this.cullFaceSide=new Tn(this),this.frontFace=new pi(this),this.program=new Yi(this),this.activeTexture=new zn(this),this.viewport=new Yn(this),this.bindFramebuffer=new he(this),this.bindRenderbuffer=new Ie(this),this.bindTexture=new Wt(this),this.bindVertexBuffer=new le(this),this.bindElementBuffer=new ii(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Me(this),this.pixelStoreUnpack=new Xn(this),this.pixelStoreUnpackPremultiplyAlpha=new Ji(this),this.pixelStoreUnpackFlipY=new Pi(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l){return new qn(this,i,l)}createVertexBuffer(i,l,m){return new Mn(this,i,l,m)}createRenderbuffer(i,l,m){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,i,l,m),this.bindRenderbuffer.set(null),b}createFramebuffer(i,l,m){return new bi(this,i,l,m)}clear({color:i,depth:l,stencil:m}){const y=this.gl;let b=0;i&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==m&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(b)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){Te(i.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Kn{constructor(i,l,m,y){this.screenBounds=i,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>y.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,l){let m,y;if(i instanceof u.pointGeometry||"number"==typeof i[0]){const b=u.pointGeometry.convert(i);m=[u.pointGeometry.convert(i)],y=l.isPointAboveHorizon(b)}else{const b=u.pointGeometry.convert(i[0]),T=u.pointGeometry.convert(i[1]);m=[b,T],y=u.polygonizeBounds(b,T).every(A=>l.isPointAboveHorizon(A))}return new Kn(m,l.getCameraPoint(),y,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const l=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],y=u.polygonizeBounds(l,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(y[3]=this.cameraPoint)),u.bufferConvexPolygon(y,i)}containsTile(i,l,m){const y=i.queryPadding+1,b=i.tileID.wrap,T=m?this._bufferedCameraMercator(y,l).map(W=>u.getTilePoint(i.tileTransform,W,b)):this._bufferedScreenMercator(y,l).map(W=>u.getTilePoint(i.tileTransform,W,b)),A=this.screenGeometryMercator.map(W=>u.getTileVec3(i.tileTransform,W,b)),z=A.map(W=>new u.pointGeometry(W[0],W[1])),R=l.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),O=u.getTileVec3(i.tileTransform,R,b),N=A.map(W=>{const J=u.sub(W,W,O);return u.normalize(J,J),new u.Ray(O,J)}),$=fn(i,1,l.zoom);if(u.polygonIntersectsBox(T,0,0,u.EXTENT,u.EXTENT))return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:N,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(X=u.getBounds(T),X.min.x=u.clamp(X.min.x,0,u.EXTENT),X.min.y=u.clamp(X.min.y,0,u.EXTENT),X.max.x=u.clamp(X.max.x,0,u.EXTENT),X.max.y=u.clamp(X.max.y,0,u.EXTENT),X),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:$};var X}_bufferedScreenMercator(i,l){const m=Rn(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{const y=this.bufferedScreenGeometry(i).map(b=>l.pointCoordinate3D(b));return this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(i,l){const m=Rn(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{const y=this.bufferedCameraGeometry(i).map(b=>l.pointCoordinate3D(b));return this._cameraRaycastCache[m]=y,y}}}function Rn(p){return 100*p|0}function rs(p,i,l){const m=function(y,b){if(y)return l(y);if(b){const T=u.pick(u.extend(b,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(T.vectorLayers=b.vector_layers,T.vectorLayerIds=T.vectorLayers.map(A=>A.id)),T.tiles=i.canonicalizeTileset(T,p.url),l(null,T)}};return p.url?u.getJSON(i.transformRequest(i.normalizeSourceURL(p.url),u.ResourceType.Source),m):u.exported.frame(()=>m(null,p))}class br{constructor(i,l,m){this.bounds=u.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=l||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const l=Math.pow(2,i.z),m=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*l),y=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*l),b=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*l),T=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*l);return i.x>=m&&i.x<b&&i.y>=y&&i.y<T}}class sr extends u.Evented{constructor(i,l,m,y){super(),this.id=i,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},l),u.extend(this,u.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=rs(this._options,this.map._requestManager,(i,l)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new u.ErrorEvent(i)):l&&(u.extend(this,l),l.bounds&&(this.tileBounds=new br(l.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(l.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){const m=u.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=u.getImage(this.map._requestManager.transformRequest(y,u.ResourceType.Tile),(b,T,A,z)=>{if(delete i.request,i.aborted)i.state="unloaded",l(null);else if(b)i.state="errored",l(b);else if(T){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:A,expires:z});const R=this.map.painter.context,O=R.gl;i.texture=this.map.painter.getTileTexture(T.width),i.texture?i.texture.update(T,{useMipmap:!0}):(i.texture=new u.Texture(R,T,O.RGBA,{useMipmap:!0}),i.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE),R.extTextureFilterAnisotropic&&O.texParameterf(O.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax)),i.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l()}unloadTile(i,l){i.texture&&this.map.painter.saveTileTexture(i.texture),l()}hasTransition(){return!1}}let yn;function Vn(p,i,l,m,y,b,T,A){const z=[p,l,y,i,m,b,1,1,1],R=[T,A,1],O=u.adjoint([],z),[N,$,X]=u.transformMat3(R,R,u.transpose(O,O));return u.multiply(z,[N,0,0,0,$,0,0,0,X],z)}class Sn extends u.Evented{constructor(i,l,m,y){super(),this.id=i,this.dispatcher=m,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=l}load(i,l){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(m,y)=>{this._loaded=!0,m?this.fire(new u.ErrorEvent(m)):y&&(this.image=u.exported.getImageData(y),this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(i){this.coordinates=i,delete this._boundsArray;const l=i.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,b=1/0,T=-1/0,A=-1/0;for(const N of m)y=Math.min(y,N.x),b=Math.min(b,N.y),T=Math.max(T,N.x),A=Math.max(A,N.y);const z=Math.max(T-y,A-b),R=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),O=Math.pow(2,R);return new u.CanonicalTileID(R,Math.floor((y+T)/2*O),Math.floor((b+A)/2*O))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const i=u.tileTransform(this.tileID,this.map.transform.projection),[l,m,y,b]=this.coordinates.map(T=>{const A=i.projection.project(T[0],T[1]);return u.getTilePoint(i,A)._round()});return this.perspectiveTransform=function(T,A,z,R,O,N,$,X,W,J){const dt=Vn(0,0,T,0,0,A,T,A),K=Vn(z,R,O,N,$,X,W,J);return u.multiply(K,u.adjoint(dt,dt),K),[K[6]/K[8]*T/u.EXTENT,K[7]/K[8]*A/u.EXTENT]}(this.width,this.height,l.x,l.y,m.x,m.y,b.x,b.y,y.x,y.y),this._boundsArray=new u.StructArrayLayout4i8,this._boundsArray.emplaceBack(l.x,l.y,0,0),this._boundsArray.emplaceBack(m.x,m.y,u.EXTENT,0),this._boundsArray.emplaceBack(b.x,b.y,0,u.EXTENT),this._boundsArray.emplaceBack(y.x,y.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,l=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,u.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new u.Texture(i,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(i,l){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},l(null)):(i.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ar={vector:class extends u.Evented{constructor(p,i,l,m){if(super(),this.id=p,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(i,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=rs(this._options,this.map._requestManager,(p,i)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new u.ErrorEvent(p)):i&&(u.extend(this,i),i.bounds&&(this.tileBounds=new br(i.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const i=this.map.style._getSourceCaches(this.id);for(const l of i)l.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}loadTile(p,i){const l=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(l,u.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=i:p.request=p.actor.send("reloadTile",m,y.bind(this));else if(p.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",m,y.bind(this),void 0,!0);else{const b=u.loadVectorTile.call({deduped:this._deduped},m,(T,A)=>{T||!A?y.call(this,T):(m.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},p.actor&&p.actor.send("loadTile",m,y.bind(this),void 0,!0))},!0);p.request={cancel:b}}function y(b,T){return delete p.request,p.aborted?i(null):b&&404!==b.status?i(b):(T&&T.resourceTiming&&(p.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&p.setExpiryData(T),p.loadVectorData(T,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:sr,"raster-dem":class extends sr{constructor(p,i,l,m){super(p,i,l,m),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(p,i){const l=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,b){y&&(p.state="errored",i(y)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",i(null))}p.request=u.getImage(this.map._requestManager.transformRequest(l,u.ResourceType.Tile),function(y,b,T,A){if(delete p.request,p.aborted)p.state="unloaded",i(null);else if(y)p.state="errored",i(y);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:T,expires:A});const z=u.window.ImageBitmap&&b instanceof u.window.ImageBitmap&&(null==yn&&(yn=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),yn),R=1-(b.width-u.prevPowerOfTwo(b.width))/2;R<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const O=z?b:u.exported.getImageData(b,R),N={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:R};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",N,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const i=p.canonical,l=Math.pow(2,i.z),m=(i.x-1+l)%l,y=0===i.x?p.wrap-1:p.wrap,b=(i.x+1+l)%l,T=i.x+1===l?p.wrap+1:p.wrap,A={};return A[new u.OverscaledTileID(p.overscaledZ,y,i.z,m,i.y).key]={backfilled:!1},A[new u.OverscaledTileID(p.overscaledZ,T,i.z,b,i.y).key]={backfilled:!1},i.y>0&&(A[new u.OverscaledTileID(p.overscaledZ,y,i.z,m,i.y-1).key]={backfilled:!1},A[new u.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},A[new u.OverscaledTileID(p.overscaledZ,T,i.z,b,i.y-1).key]={backfilled:!1}),i.y+1<l&&(A[new u.OverscaledTileID(p.overscaledZ,y,i.z,m,i.y+1).key]={backfilled:!1},A[new u.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},A[new u.OverscaledTileID(p.overscaledZ,T,i.z,b,i.y+1).key]={backfilled:!1}),A}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends u.Evented{constructor(p,i,l,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(m),this._data=i.data,this._options=u.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const y=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*y,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*y,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*y,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},i),this}getClusterChildren(p,i){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},i),this}getClusterLeaves(p,i,l,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:i,offset:l},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=u.extend({},this.workerOptions),i=this._data;"string"==typeof i?(p.request=this.map._requestManager.transformRequest(u.exported.resolveURL(i),u.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(l,m)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new u.ErrorEvent(l));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new u.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,i){const l=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(l,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete p.request,p.unloadVectorData(),p.aborted?i(null):m?i(m):(p.loadVectorData(y,this.map.painter,"reloadTile"===l),i(null))),void 0,"loadTile"===l)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Sn{constructor(p,i,l,m){super(p,i,l,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const i of p.urls)this.urls.push(this.map._requestManager.transformRequest(i,u.ResourceType.Source).url);u.getVideo(this.urls,(i,l)=>{this._loaded=!0,i?this.fire(new u.ErrorEvent(i)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const i=this.video.seekable;p<i.start(0)||p>i.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,i=p.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(p,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,u.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2));for(const l in this.tiles){const m=this.tiles[l];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Sn,canvas:class extends Sn{constructor(p,i,l,m){super(p,i,l,m),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(b=>"number"!=typeof b))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,l=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,u.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(i,this.canvas,l.RGBA,{premultiply:!0});for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}}},xn=function(p,i,l,m){const y=new ar[i.type](p,i,l,m);if(y.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${y.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],y),y};function tt(p,i){const l=u.identity([]);return u.scale(l,l,[.5*p.width,.5*-p.height,1]),u.translate(l,l,[1,-1,0]),u.multiply$1(l,l,p.calculateProjMatrix(i.toUnwrapped()))}function F(p,i,l,m,y,b,T,A=!1){const z=p.tilesIn(m,T,A);z.sort(Q);const R=[];for(const N of z)R.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(i,l,p._state,N,y,b,tt(p.transform,N.tile.tileID),A)});const O=function(N){const $={},X={};for(const W of N){const J=W.queryResults,dt=W.wrappedTileID,K=X[dt]=X[dt]||{};for(const lt in J){const ot=J[lt],st=K[lt]=K[lt]||{},at=$[lt]=$[lt]||[];for(const pt of ot)st[pt.featureIndex]||(st[pt.featureIndex]=!0,at.push(pt))}}return $}(R);for(const N in O)O[N].forEach($=>{const X=$.feature,W=p.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=W});return O}function Z(p,i){const l=p.getRenderableIds().map(b=>p.getTileByID(b)),m=[],y={};for(let b=0;b<l.length;b++){const T=l[b],A=T.tileID.canonical.key;y[A]||(y[A]=!0,T.querySourceFeatures(m,i))}return m}function Q(p,i){const l=p.tileID,m=i.tileID;return l.overscaledZ-m.overscaledZ||l.canonical.y-m.canonical.y||l.wrap-m.wrap||l.canonical.x-m.canonical.x}function rt(){return null!=xs.workerClass?new xs.workerClass:new u.window.Worker(xs.workerUrl)}const ft="mapboxgl_preloaded_worker_pool";class Tt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Tt.workerCount;)this.workers.push(new rt);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ft]}numActive(){return Object.keys(this.active).length}}let Ct;function gt(){return Ct||(Ct=new Tt),Ct}function St(p,i){const l={};for(const m in p)"ref"!==m&&(l[m]=p[m]);return u.refProperties.forEach(m=>{m in i&&(l[m]=i[m])}),l}function Bt(p){p=p.slice();const i=Object.create(null);for(let l=0;l<p.length;l++)i[p[l].id]=p[l];for(let l=0;l<p.length;l++)"ref"in p[l]&&(p[l]=St(p[l],i[p[l].ref]));return p}Tt.workerCount=2;const Nt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Xt(p,i,l){l.push({command:Nt.addSource,args:[p,i[p]]})}function be(p,i,l){i.push({command:Nt.removeSource,args:[p]}),l[p]=!0}function Ce(p,i,l,m){be(p,l,m),Xt(p,i,l)}function Se(p,i,l){let m;for(m in p[l])if(p[l].hasOwnProperty(m)&&"data"!==m&&!Te(p[l][m],i[l][m]))return!1;for(m in i[l])if(i[l].hasOwnProperty(m)&&"data"!==m&&!Te(p[l][m],i[l][m]))return!1;return!0}function Fe(p,i,l,m,y,b){let T;for(T in i=i||{},p=p||{})p.hasOwnProperty(T)&&(Te(p[T],i[T])||l.push({command:b,args:[m,T,i[T],y]}));for(T in i)i.hasOwnProperty(T)&&!p.hasOwnProperty(T)&&(Te(p[T],i[T])||l.push({command:b,args:[m,T,i[T],y]}))}function Je(p){return p.id}function wi(p,i){return p[i.id]=i,p}class Ri{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=u.clamp(i,0,1);let l=1,m=this._distances[l];const y=i*this.paddedLength+this.padding;for(;m<y&&l<this._distances.length;)m=this._distances[++l];const b=l-1,T=this._distances[b],A=m-T,z=A>0?(y-T)/A:0;return this.points[b].mult(1-z).add(this.points[l].mult(z))}}class yi{constructor(i,l,m){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(l/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,m,y,b){this._forEachCell(l,m,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(i,l,m,y){this._forEachCell(l-y,m-y,l+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(m),this.circles.push(y)}_insertBoxCell(i,l,m,y,b,T){this.boxCells[b].push(T)}_insertCircleCell(i,l,m,y,b,T){this.circleCells[b].push(T)}_query(i,l,m,y,b,T){if(m<0||i>this.width||y<0||l>this.height)return!b&&[];const A=[];if(i<=0&&l<=0&&this.width<=m&&this.height<=y){if(b)return!0;for(let z=0;z<this.boxKeys.length;z++)A.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const R=this.circles[3*z],O=this.circles[3*z+1],N=this.circles[3*z+2];A.push({key:this.circleKeys[z],x1:R-N,y1:O-N,x2:R+N,y2:O+N})}return T?A.filter(T):A}return this._forEachCell(i,l,m,y,this._queryCell,A,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?A.length>0:A}_queryCircle(i,l,m,y,b){const T=i-m,A=i+m,z=l-m,R=l+m;if(A<0||T>this.width||R<0||z>this.height)return!y&&[];const O=[];return this._forEachCell(T,z,A,R,this._queryCellCircle,O,{hitTest:y,circle:{x:i,y:l,radius:m},seenUids:{box:{},circle:{}}},b),y?O.length>0:O}query(i,l,m,y,b){return this._query(i,l,m,y,!1,b)}hitTest(i,l,m,y,b){return this._query(i,l,m,y,!0,b)}hitTestCircle(i,l,m,y){return this._queryCircle(i,l,m,!0,y)}_queryCell(i,l,m,y,b,T,A,z){const R=A.seenUids,O=this.boxCells[b];if(null!==O){const $=this.bboxes;for(const X of O)if(!R.box[X]){R.box[X]=!0;const W=4*X;if(i<=$[W+2]&&l<=$[W+3]&&m>=$[W+0]&&y>=$[W+1]&&(!z||z(this.boxKeys[X]))){if(A.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[X],x1:$[W],y1:$[W+1],x2:$[W+2],y2:$[W+3]})}}}const N=this.circleCells[b];if(null!==N){const $=this.circles;for(const X of N)if(!R.circle[X]){R.circle[X]=!0;const W=3*X;if(this._circleAndRectCollide($[W],$[W+1],$[W+2],i,l,m,y)&&(!z||z(this.circleKeys[X]))){if(A.hitTest)return T.push(!0),!0;{const J=$[W],dt=$[W+1],K=$[W+2];T.push({key:this.circleKeys[X],x1:J-K,y1:dt-K,x2:J+K,y2:dt+K})}}}}}_queryCellCircle(i,l,m,y,b,T,A,z){const R=A.circle,O=A.seenUids,N=this.boxCells[b];if(null!==N){const X=this.bboxes;for(const W of N)if(!O.box[W]){O.box[W]=!0;const J=4*W;if(this._circleAndRectCollide(R.x,R.y,R.radius,X[J+0],X[J+1],X[J+2],X[J+3])&&(!z||z(this.boxKeys[W])))return T.push(!0),!0}}const $=this.circleCells[b];if(null!==$){const X=this.circles;for(const W of $)if(!O.circle[W]){O.circle[W]=!0;const J=3*W;if(this._circlesCollide(X[J],X[J+1],X[J+2],R.x,R.y,R.radius)&&(!z||z(this.circleKeys[W])))return T.push(!0),!0}}}_forEachCell(i,l,m,y,b,T,A,z){const R=this._convertToXCellCoord(i),O=this._convertToYCellCoord(l),N=this._convertToXCellCoord(m),$=this._convertToYCellCoord(y);for(let X=R;X<=N;X++)for(let W=O;W<=$;W++)if(b.call(this,i,l,m,y,this.xCellCount*W+X,T,A,z))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,m,y,b,T){const A=y-i,z=b-l,R=m+T;return R*R>A*A+z*z}_circleAndRectCollide(i,l,m,y,b,T,A){const z=(T-y)/2,R=Math.abs(i-(y+z));if(R>z+m)return!1;const O=(A-b)/2,N=Math.abs(l-(b+O));if(N>O+m)return!1;if(R<=z||N<=O)return!0;const $=R-z,X=N-O;return $*$+X*X<=m*m}}const Li=Math.tan(85*Math.PI/180);function Jn(p,i,l,m,y,b){let T=u.create();if(l){if("globe"===y.projection.name)T=u.calculateGlobeMatrix(y,y.worldSize/y._projectionScaler,[0,0]),u.multiply$1(T,T,u.globeDenormalizeECEF(u.globeTileBounds(i)));else{const A=jt([],b);T[0]=A[0],T[1]=A[1],T[4]=A[2],T[5]=A[3]}m||u.rotateZ(T,T,y.angle)}else u.multiply$1(T,y.labelPlaneMatrix,p);return T}function ht(p,i,l,m,y,b){if(l){if("globe"===y.projection.name){const T=Jn(p,i,l,m,y,b);return u.invert(T,T),u.multiply$1(T,p,T),T}{const T=u.clone(p),A=u.identity([]);return A[0]=b[0],A[1]=b[1],A[4]=b[2],A[5]=b[3],u.multiply$1(T,T,A),m||u.rotateZ(T,T,-y.angle),T}}return y.glCoordMatrix}function kt(p,i,l=0){const m=[p.x,p.y,l,1];l?u.transformMat4$1(m,m,i):ri(m,m,i);const y=m[3];return{point:new u.pointGeometry(m[0]/y,m[1]/y),signedDistanceFromCamera:y}}function E(p,i){return Math.min(.5+p/i*.5,1.5)}function V(p,i){const l=p[0]/p[3],m=p[1]/p[3];return l>=-i[0]&&l<=i[0]&&m>=-i[1]&&m<=i[1]}function it(p,i,l,m,y,b,T,A,z,R){const O=l.transform,N=m?p.textSizeData:p.iconSizeData,$=u.evaluateSizeForZoom(N,l.transform.zoom),X=[256/l.width*2+1,256/l.height*2+1],W=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;W.clear();const J=p.lineVertexArray,dt=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,K=l.transform.width/l.transform.height;let lt=!1;for(let ot=0;ot<dt.length;ot++){const st=dt.get(ot);if(st.writingMode!==u.WritingMode.vertical||lt||0!==ot&&dt.get(ot-1).writingMode===u.WritingMode.horizontal||(lt=!0),st.hidden||st.writingMode===u.WritingMode.vertical&&!lt){un(st.numGlyphs,W);continue}lt=!1;const at=new u.pointGeometry(st.tileAnchorX,st.tileAnchorY),pt=z?z(at):[0,0,0],At=O.projection.projectTilePoint(at.x,at.y,R.canonical),It=[At.x+pt[0],At.y+pt[1],At.z+pt[2]],ee=[...It,1];if(u.transformMat4$1(ee,ee,i),!V(ee,X)){un(st.numGlyphs,W);continue}const qt=E(l.transform.cameraToCenterDistance,ee[3]),Yt=u.evaluateSizeForFeature(N,$,st),Lt=T?Yt/qt:Yt*qt,Dt=kt(new u.pointGeometry(It[0],It[1]),y,It[2]);if(Dt.signedDistanceFromCamera<=0){un(st.numGlyphs,W);continue}let Zt={};const Ut=T?null:z,xe=ni(st,Lt,!1,A,i,y,b,p.glyphOffsetArray,J,W,Dt.point,at,Zt,K,Ut,O.projection,R);lt=xe.useVertical,Ut&&xe.needsFlipping&&(Zt={}),(xe.notEnoughRoom||lt||xe.needsFlipping&&ni(st,Lt,!0,A,i,y,b,p.glyphOffsetArray,J,W,Dt.point,at,Zt,K,Ut,O.projection,R).notEnoughRoom)&&un(st.numGlyphs,W)}m?p.text.dynamicLayoutVertexBuffer.updateData(W):p.icon.dynamicLayoutVertexBuffer.updateData(W)}function xt(p,i,l,m,y,b,T,A,z,R,O,N,$,X,W){const J=A.glyphStartIndex+A.numGlyphs,dt=A.lineStartIndex,K=A.lineStartIndex+A.lineLength,lt=i.getoffsetX(A.glyphStartIndex),ot=i.getoffsetX(J-1),st=Qn(p*lt,l,m,y,b,T,A.segment,dt,K,z,R,O,N,$,!0,X,W);if(!st)return null;const at=Qn(p*ot,l,m,y,b,T,A.segment,dt,K,z,R,O,N,$,!0,X,W);return at?{first:st,last:at}:null}function ye(p,i,l,m){return p.writingMode===u.WritingMode.horizontal&&Math.abs(l.y-i.y)>Math.abs(l.x-i.x)*m?{useVertical:!0}:p.writingMode===u.WritingMode.vertical?i.y<l.y?{needsFlipping:!0}:null:0!==p.flipState&&function(y,b,T){const A=(b.x-y.x)*T;return 0===A||Math.abs((b.y-y.y)/A)>Li}(i,l,m)?1===p.flipState?{needsFlipping:!0}:null:i.x>l.x?{needsFlipping:!0}:null}function ni(p,i,l,m,y,b,T,A,z,R,O,N,$,X,W,J,dt){const K=i/24,lt=p.lineOffsetX*K,ot=p.lineOffsetY*K;let st;if(p.numGlyphs>1){const at=p.glyphStartIndex+p.numGlyphs,pt=p.lineStartIndex,At=p.lineStartIndex+p.lineLength,It=xt(K,A,lt,ot,l,O,N,p,z,b,$,W,!1,J,dt);if(!It)return{notEnoughRoom:!0};const ee=kt(It.first.point,T).point,qt=kt(It.last.point,T).point;if(m&&!l){const Yt=ye(p,ee,qt,X);if(p.flipState=Yt&&Yt.needsFlipping?1:2,Yt)return Yt}st=[It.first];for(let Yt=p.glyphStartIndex+1;Yt<at-1;Yt++)st.push(Qn(K*A.getoffsetX(Yt),lt,ot,l,O,N,p.segment,pt,At,z,b,$,W,!1,!1,J,dt));st.push(It.last)}else{if(m&&!l){const pt=kt(N,y).point,At=p.lineStartIndex+p.segment+1,It=new u.pointGeometry(z.getx(At),z.gety(At)),ee=kt(It,y),qt=ye(p,pt,ee.signedDistanceFromCamera>0?ee.point:Un(N,It,pt,1,y,void 0,J,dt.canonical),X);if(p.flipState=qt&&qt.needsFlipping?1:2,qt)return qt}const at=Qn(K*A.getoffsetX(p.glyphStartIndex),lt,ot,l,O,N,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,z,b,$,W,!1,!1,J,dt);if(!at)return{notEnoughRoom:!0};st=[at]}for(const at of st)u.addDynamicAttributes(R,at.point,at.angle);return{}}function Hi(p,i,l,m,y){const b=m.projectTilePoint(p.x,p.y,i);if(!y)return kt(b,l,b.z);const T=y(p);return kt(new u.pointGeometry(b.x+T[0],b.y+T[1]),l,b.z+T[2])}function Un(p,i,l,m,y,b,T,A){const z=Hi(p.add(p.sub(i)._unit()),A,y,T,b).point,R=l.sub(z);return l.add(R._mult(m/R.mag()))}function Qn(p,i,l,m,y,b,T,A,z,R,O,N,$,X,W,J,dt){const K=m?p-i:p+i;let lt=K>0?1:-1,ot=0;m&&(lt*=-1,ot=Math.PI),lt<0&&(ot+=Math.PI);let st=lt>0?A+T:A+T+1,at=y,pt=y,At=0,It=0;const ee=Math.abs(K),qt=[],Yt=[];let Lt=b;const Dt=()=>{const te=st-lt;return 0===At?b:new u.pointGeometry(R.getx(te),R.gety(te))},Zt=()=>Un(Dt(),Lt,pt,ee-At+1,O,$,J,dt.canonical);for(;At+It<=ee;){if(st+=lt,st<A||st>=z)return null;if(pt=at,qt.push(at),X&&Yt.push(Lt||Dt()),at=N[st],void 0===at){Lt=new u.pointGeometry(R.getx(st),R.gety(st));const te=Hi(Lt,dt.canonical,O,J,$);at=te.signedDistanceFromCamera>0?N[st]=te.point:Zt()}else Lt=null;At+=It,It=pt.dist(at)}W&&$&&(Lt=Lt||new u.pointGeometry(R.getx(st),R.gety(st)),N[st]=at=void 0===N[st]?at:Zt(),It=pt.dist(at));const Ut=(ee-At)/It,xe=at.sub(pt),Ae=xe.mult(Ut)._add(pt);l&&Ae._add(xe._unit()._perp()._mult(l*lt));const Qe=ot+Math.atan2(at.y-pt.y,at.x-pt.x);return qt.push(Ae),X&&(Lt=Lt||new u.pointGeometry(R.getx(st),R.gety(st)),Yt.push(function(te,Pe,$e){const si=1-$e;return new u.pointGeometry(te.x*si+Pe.x*$e,te.y*si+Pe.y*$e)}(Yt.length>0?Yt[Yt.length-1]:Lt,Lt,Ut))),{point:Ae,angle:Qe,path:qt,tilePath:Yt}}const tr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function un(p,i){for(let l=0;l<p;l++){const m=i.length;i.resize(m+4),i.float32.set(tr,3*m)}}function ri(p,i,l){const m=i[0],y=i[1];return p[0]=l[0]*m+l[4]*y+l[12],p[1]=l[1]*m+l[5]*y+l[13],p[3]=l[3]*m+l[7]*y+l[15],p}const Lr=100;class ko{constructor(i,l,m=new yi(i.width+200,i.height+200,25),y=new yi(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Lr,this.screenBottomBoundary=i.height+Lr,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=l}placeCollisionBox(i,l,m,y,b,T,A){let z=l.projectedAnchorX,R=l.projectedAnchorY,O=l.projectedAnchorZ;const N=l.elevation,$=l.tileID;if(N&&$){const st=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),at=st.upVector($.canonical,l.tileAnchorX,l.tileAnchorY),pt=st.upVectorScale($.canonical);z+=at[0]*N*pt,R+=at[1]*N*pt,O+=at[2]*N*pt}const X=this.projectAndGetPerspectiveRatio(T,z,R,O,l.tileID),W=b*X.perspectiveRatio,J=(l.x1*i+m.x-l.padding)*W+X.point.x,dt=(l.y1*i+m.y-l.padding)*W+X.point.y,K=(l.x2*i+m.x+l.padding)*W+X.point.x,lt=(l.y2*i+m.y+l.padding)*W+X.point.y,ot=X.perspectiveRatio<=.55||X.aboveHorizon;return!this.isInsideGrid(J,dt,K,lt)||!y&&this.grid.hitTest(J,dt,K,lt,A)||ot?{box:[],offscreen:!1}:{box:[J,dt,K,lt],offscreen:this.isOffscreen(J,dt,K,lt)}}placeCollisionCircles(i,l,m,y,b,T,A,z,R,O,N,$,X,W){const J=[],dt=this.transform.elevation,K=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),lt=dt?dt.getAtTileOffsetFunc(W,K):Ut=>[0,0,0],ot=new u.pointGeometry(l.tileAnchorX,l.tileAnchorY),st=this.transform.projection.projectTilePoint(l.tileAnchorX,l.tileAnchorY,W.canonical),at=lt(ot),pt=[st.x+at[0],st.y+at[1],st.z+at[2]],At=this.projectAndGetPerspectiveRatio(T,pt[0],pt[1],pt[2],W),{perspectiveRatio:It}=At,ee=(O?b/It:b*It)/u.ONE_EM,qt=kt(new u.pointGeometry(pt[0],pt[1]),A,pt[2]).point,Yt=At.signedDistanceFromCamera>0?xt(ee,y,l.lineOffsetX*ee,l.lineOffsetY*ee,!1,qt,ot,l,m,A,{},dt&&!O?lt:null,O&&!!dt,this.transform.projection,W):null;let Lt=!1,Dt=!1,Zt=!0;if(Yt&&!At.aboveHorizon){const Ut=.5*$*It+X,xe=new u.pointGeometry(-100,-100),Ae=new u.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Qe=new Ri,te=Yt.first,Pe=Yt.last;let $e=[];for(let Ge=te.path.length-1;Ge>=1;Ge--)$e.push(te.path[Ge]);for(let Ge=1;Ge<Pe.path.length;Ge++)$e.push(Pe.path[Ge]);const si=2.5*Ut;if(z){const Ge=$e.map(dt?(ti,Bi)=>{const cn=lt(Bi<te.path.length-1?te.tilePath[te.path.length-1-Bi]:Pe.tilePath[Bi-te.path.length+2]);return kt(ti,z,cn[2])}:ti=>kt(ti,z));$e=Ge.some(ti=>ti.signedDistanceFromCamera<=0)?[]:Ge.map(ti=>ti.point)}let ki=[];if($e.length>0){const Ge=$e[0].clone(),ti=$e[0].clone();for(let Bi=1;Bi<$e.length;Bi++)Ge.x=Math.min(Ge.x,$e[Bi].x),Ge.y=Math.min(Ge.y,$e[Bi].y),ti.x=Math.max(ti.x,$e[Bi].x),ti.y=Math.max(ti.y,$e[Bi].y);ki=Ge.x>=xe.x&&ti.x<=Ae.x&&Ge.y>=xe.y&&ti.y<=Ae.y?[$e]:ti.x<xe.x||Ge.x>Ae.x||ti.y<xe.y||Ge.y>Ae.y?[]:u.clipLine([$e],xe.x,xe.y,Ae.x,Ae.y)}for(const Ge of ki){Qe.reset(Ge,.25*Ut);let ti=0;ti=Qe.length<=.5*Ut?1:Math.ceil(Qe.paddedLength/si)+1;for(let Bi=0;Bi<ti;Bi++){const cn=Bi/Math.max(ti-1,1),Dn=Qe.lerp(cn),fr=Dn.x+Lr,Ar=Dn.y+Lr;J.push(fr,Ar,Ut,0);const hi=fr-Ut,Ze=Ar-Ut,li=fr+Ut,qi=Ar+Ut;if(Zt=Zt&&this.isOffscreen(hi,Ze,li,qi),Dt=Dt||this.isInsideGrid(hi,Ze,li,qi),!i&&this.grid.hitTestCircle(fr,Ar,Ut,N)&&(Lt=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Lt}}}}return{circles:!R&&Lt||!Dt?[]:J,offscreen:Zt,collisionDetected:Lt}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let m=1/0,y=1/0,b=-1/0,T=-1/0;for(const O of i){const N=new u.pointGeometry(O.x+Lr,O.y+Lr);m=Math.min(m,N.x),y=Math.min(y,N.y),b=Math.max(b,N.x),T=Math.max(T,N.y),l.push(N)}const A=this.grid.query(m,y,b,T).concat(this.ignoredGrid.query(m,y,b,T)),z={},R={};for(const O of A){const N=O.key;if(void 0===z[N.bucketInstanceId]&&(z[N.bucketInstanceId]={}),z[N.bucketInstanceId][N.featureIndex])continue;const $=[new u.pointGeometry(O.x1,O.y1),new u.pointGeometry(O.x2,O.y1),new u.pointGeometry(O.x2,O.y2),new u.pointGeometry(O.x1,O.y2)];u.polygonIntersectsPolygon(l,$)&&(z[N.bucketInstanceId][N.featureIndex]=!0,void 0===R[N.bucketInstanceId]&&(R[N.bucketInstanceId]=[]),R[N.bucketInstanceId].push(N.featureIndex))}return R}insertCollisionBox(i,l,m,y,b){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:b},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,m,y,b){const T=l?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:y,collisionGroupID:b};for(let z=0;z<i.length;z+=4)T.insertCircle(A,i[z],i[z+1],i[z+2])}projectAndGetPerspectiveRatio(i,l,m,y,b){const T=[l,m,y||0,1];let A=!1;if(y||this.transform.pitch>0){u.transformMat4$1(T,T,i);let z=!1;this.fogState&&b&&(z=function(R,O,N,$,X,W){const J=W.calculateFogTileMatrix(X),dt=[O,N,$];return u.transformMat4(dt,dt,J),we(R,dt,W.pitch,W._fov)}(this.fogState,l,m,y||0,b.toUnwrapped(),this.transform)>.9),A=T[2]>T[3]||z}else ri(T,T,i);return{point:new u.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+Lr,(-T[1]/T[3]+1)/2*this.transform.height+Lr),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/T[3]*.5,1.5),signedDistanceFromCamera:T[3],aboveHorizon:A}}isOffscreen(i,l,m,y){return m<Lr||i>=this.screenRightBoundary||y<Lr||l>this.screenBottomBoundary}isInsideGrid(i,l,m,y){return m>=0&&i<this.gridRightBoundary&&y>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const i=u.identity([]);return u.translate(i,i,[-100,-100,0]),i}}class wc{constructor(i,l,m,y){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):y&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class or{constructor(i,l,m,y,b,T=!1){this.text=new wc(i?i.text:null,l,m,b),this.icon=new wc(i?i.icon:null,l,y,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Is{constructor(i,l,m,y=!1){this.text=i,this.icon=l,this.skipFade=m,this.clipped=y}}class ss{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class as{constructor(i,l,m,y,b){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=b}}class Ia{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:m=>m.collisionGroupID===l}}return this.collisionGroups[i]}}function Ps(p,i,l,m,y){const{horizontalAlign:b,verticalAlign:T}=u.getAnchorAlignment(p),A=-(b-.5)*i,z=-(T-.5)*l,R=u.evaluateVariableOffset(p,m);return new u.pointGeometry(A+R[0]*y,z+R[1]*y)}function os(p,i,l,m,y){const b=new u.pointGeometry(p,i);return l&&b._rotate(m?y:-y),b}class Do{constructor(i,l,m,y,b){this.transform=i.clone(),this.collisionIndex=new ko(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Ia(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,m,y){const b=m.getBucket(l),T=m.latestFeatureIndex;if(!b||!T||l.id!==b.layerIds[0])return;const A=b.layers[0].layout,z=m.collisionBoxArray,R=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),O=m.tileSize/u.EXTENT,N=m.tileID.toUnwrapped(),$=this.transform.calculateProjMatrix(N),X="map"===A.get("text-pitch-alignment"),W="map"===A.get("text-rotation-alignment");l.compileFilter();const J=l.dynamicFilter(),dt=l.dynamicFilterNeedsFeature(),K=this.transform.calculatePixelsToTileUnitsMatrix(m),lt=Jn($,m.tileID.canonical,X,W,this.transform,K);let ot=null;if(X){const pt=ht($,m.tileID.canonical,X,W,this.transform,K);ot=u.multiply$1([],this.transform.labelPlaneMatrix,pt)}let st=null;J&&m.latestFeatureIndex&&(st={unwrappedTileID:N,dynamicFilter:J,dynamicFilterNeedsFeature:dt,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new as(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,m.tileID);const at={bucket:b,layout:A,posMatrix:$,textLabelPlaneMatrix:lt,labelToScreenMatrix:ot,clippingData:st,scale:R,textPixelRatio:O,holdingForFade:m.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(y)for(const pt of b.sortKeyRanges){const{sortKey:At,symbolInstanceStart:It,symbolInstanceEnd:ee}=pt;i.push({sortKey:At,symbolInstanceStart:It,symbolInstanceEnd:ee,parameters:at})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:at})}attemptAnchorPlacement(i,l,m,y,b,T,A,z,R,O,N,$,X,W,J,dt,K,lt){const ot=[$.textOffset0,$.textOffset1],st=Ps(i,m,y,ot,b),at=this.collisionIndex.placeCollisionBox(b,l,os(st.x,st.y,T,A,this.transform.angle),N,z,R,O.predicate);if((!dt||0!==this.collisionIndex.placeCollisionBox(W.getSymbolInstanceIconSize(lt,this.transform.zoom,X),dt,os(st.x,st.y,T,A,this.transform.angle),N,z,R,O.predicate).box.length)&&at.box.length>0){let pt;return this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(pt=this.prevPlacement.variableOffsets[$.crossTileID].anchor),this.variableOffsets[$.crossTileID]={textOffset:ot,width:m,height:y,anchor:i,textScale:b,prevAnchor:pt},this.markUsedJustification(W,i,$,J),W.allowVerticalPlacement&&(this.markUsedOrientation(W,J,$),this.placedOrientations[$.crossTileID]=J),{shift:st,placedGlyphBoxes:at}}}placeLayerBucketPart(i,l,m,y){const{bucket:b,layout:T,posMatrix:A,textLabelPlaneMatrix:z,labelToScreenMatrix:R,clippingData:O,textPixelRatio:N,holdingForFade:$,collisionBoxArray:X,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:J,collisionGroup:dt}=i.parameters,K=T.get("text-optional"),lt=T.get("icon-optional"),ot=T.get("text-allow-overlap"),st=T.get("icon-allow-overlap"),at="map"===T.get("text-rotation-alignment"),pt="map"===T.get("text-pitch-alignment"),At="none"!==T.get("icon-text-fit"),It="viewport-y"===T.get("symbol-z-order"),ee=ot&&(st||!b.hasIconData()||lt),qt=st&&(ot||!b.hasTextData()||K);!b.collisionArrays&&X&&b.deserializeCollisionBoxes(X),m&&y&&b.updateCollisionDebugBuffers(this.transform.zoom,X);const Yt=(Lt,Dt,Zt)=>{if(O){const hi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ze=null;if(O.dynamicFilterNeedsFeature){const li=this.retainedQueryData[b.bucketInstanceId];Ze=O.featureIndex.loadFeature({featureIndex:Lt.featureIndex,bucketIndex:li.bucketIndex,sourceLayerIndex:li.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(hi,Ze,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new u.pointGeometry(Lt.tileAnchorX,Lt.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Lt.crossTileID]=new Is(!1,!1,!1,!0),void(l[Lt.crossTileID]=!0)}if(l[Lt.crossTileID])return;if($)return void(this.placements[Lt.crossTileID]=new Is(!1,!1,!1));let Ut=!1,xe=!1,Ae=!0,Qe=null,te={box:null,offscreen:null},Pe={box:null,offscreen:null},$e=null,si=null,ki=null,Ge=0,ti=0,Bi=0;Zt.textFeatureIndex?Ge=Zt.textFeatureIndex:Lt.useRuntimeCollisionCircles&&(Ge=Lt.featureIndex),Zt.verticalTextFeatureIndex&&(ti=Zt.verticalTextFeatureIndex);const cn=hi=>{hi.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||hi.elevation)&&(hi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,hi.tileAnchorX,hi.tileAnchorY):0)},Dn=Zt.textBox;if(Dn){cn(Dn);const hi=li=>{let qi=u.WritingMode.horizontal;if(b.allowVerticalPlacement&&!li&&this.prevPlacement){const Zn=this.prevPlacement.placedOrientations[Lt.crossTileID];Zn&&(this.placedOrientations[Lt.crossTileID]=Zn,qi=Zn,this.markUsedOrientation(b,qi,Lt))}return qi},Ze=(li,qi)=>{if(b.allowVerticalPlacement&&Lt.numVerticalGlyphVertices>0&&Zt.verticalTextBox){for(const Zn of b.writingModes)if(Zn===u.WritingMode.vertical?(te=qi(),Pe=te):te=li(),te&&te.box&&te.box.length)break}else te=li()};if(T.get("text-variable-anchor")){let li=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lt.crossTileID]){const Oi=this.prevPlacement.variableOffsets[Lt.crossTileID];li.indexOf(Oi.anchor)>0&&(li=li.filter($n=>$n!==Oi.anchor),li.unshift(Oi.anchor))}const qi=(Oi,$n,ya)=>{const bn=b.getSymbolInstanceTextSize(W,Lt,this.transform.zoom,Dt),Er=(Oi.x2-Oi.x1)*bn+2*Oi.padding,ve=(Oi.y2-Oi.y1)*bn+2*Oi.padding,Ee=At&&!st?$n:null;Ee&&cn(Ee);let _n={box:[],offscreen:!1};const js=ot?2*li.length:li.length;for(let vs=0;vs<js;++vs){const wn=this.attemptAnchorPlacement(li[vs%li.length],Oi,Er,ve,bn,at,pt,N,A,dt,vs>=li.length,Lt,Dt,b,ya,Ee,W,J);if(wn&&(_n=wn.placedGlyphBoxes,_n&&_n.box&&_n.box.length)){Ut=!0,Qe=wn.shift;break}}return _n};Ze(()=>qi(Dn,Zt.iconBox,u.WritingMode.horizontal),()=>{const Oi=Zt.verticalTextBox;return Oi&&cn(Oi),b.allowVerticalPlacement&&!(te&&te.box&&te.box.length)&&Lt.numVerticalGlyphVertices>0&&Oi?qi(Oi,Zt.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null}}),te&&(Ut=te.box,Ae=te.offscreen);const Zn=hi(te&&te.box);if(!Ut&&this.prevPlacement){const Oi=this.prevPlacement.variableOffsets[Lt.crossTileID];Oi&&(this.variableOffsets[Lt.crossTileID]=Oi,this.markUsedJustification(b,Oi.anchor,Lt,Zn))}}else{const li=(qi,Zn)=>{const Oi=b.getSymbolInstanceTextSize(W,Lt,this.transform.zoom,Dt),$n=this.collisionIndex.placeCollisionBox(Oi,qi,new u.pointGeometry(0,0),ot,N,A,dt.predicate);return $n&&$n.box&&$n.box.length&&(this.markUsedOrientation(b,Zn,Lt),this.placedOrientations[Lt.crossTileID]=Zn),$n};Ze(()=>li(Dn,u.WritingMode.horizontal),()=>{const qi=Zt.verticalTextBox;return b.allowVerticalPlacement&&Lt.numVerticalGlyphVertices>0&&qi?(cn(qi),li(qi,u.WritingMode.vertical)):{box:null,offscreen:null}}),hi(te&&te.box&&te.box.length)}}if($e=te,Ut=$e&&$e.box&&$e.box.length>0,Ae=$e&&$e.offscreen,Lt.useRuntimeCollisionCircles){const hi=b.text.placedSymbolArray.get(Lt.centerJustifiedTextSymbolIndex>=0?Lt.centerJustifiedTextSymbolIndex:Lt.verticalPlacedTextSymbolIndex),Ze=u.evaluateSizeForFeature(b.textSizeData,W,hi),li=T.get("text-padding");si=this.collisionIndex.placeCollisionCircles(ot,hi,b.lineVertexArray,b.glyphOffsetArray,Ze,A,z,R,m,pt,dt.predicate,Lt.collisionCircleDiameter*Ze/u.ONE_EM,li,this.retainedQueryData[b.bucketInstanceId].tileID),Ut=ot||si.circles.length>0&&!si.collisionDetected,Ae=Ae&&si.offscreen}if(Zt.iconFeatureIndex&&(Bi=Zt.iconFeatureIndex),Zt.iconBox){const hi=Ze=>{cn(Ze);const li=At&&Qe?os(Qe.x,Qe.y,at,pt,this.transform.angle):new u.pointGeometry(0,0),qi=b.getSymbolInstanceIconSize(J,this.transform.zoom,Dt);return this.collisionIndex.placeCollisionBox(qi,Ze,li,st,N,A,dt.predicate)};Pe&&Pe.box&&Pe.box.length&&Zt.verticalIconBox?(ki=hi(Zt.verticalIconBox),xe=ki.box.length>0):(ki=hi(Zt.iconBox),xe=ki.box.length>0),Ae=Ae&&ki.offscreen}const fr=K||0===Lt.numHorizontalGlyphVertices&&0===Lt.numVerticalGlyphVertices,Ar=lt||0===Lt.numIconVertices;if(fr||Ar?Ar?fr||(xe=xe&&Ut):Ut=xe&&Ut:xe=Ut=xe&&Ut,Ut&&$e&&$e.box&&this.collisionIndex.insertCollisionBox($e.box,T.get("text-ignore-placement"),b.bucketInstanceId,Pe&&Pe.box&&ti?ti:Ge,dt.ID),xe&&ki&&this.collisionIndex.insertCollisionBox(ki.box,T.get("icon-ignore-placement"),b.bucketInstanceId,Bi,dt.ID),si&&(Ut&&this.collisionIndex.insertCollisionCircles(si.circles,T.get("text-ignore-placement"),b.bucketInstanceId,Ge,dt.ID),m)){const hi=b.bucketInstanceId;let Ze=this.collisionCircleArrays[hi];void 0===Ze&&(Ze=this.collisionCircleArrays[hi]=new ss);for(let li=0;li<si.circles.length;li+=4)Ze.circles.push(si.circles[li+0]),Ze.circles.push(si.circles[li+1]),Ze.circles.push(si.circles[li+2]),Ze.circles.push(si.collisionDetected?1:0)}this.placements[Lt.crossTileID]=new Is(Ut||ee,xe||qt,Ae||b.justReloaded),l[Lt.crossTileID]=!0};if(It){const Lt=b.getSortedSymbolIndexes(this.transform.angle);for(let Dt=Lt.length-1;Dt>=0;--Dt){const Zt=Lt[Dt];Yt(b.symbolInstances.get(Zt),Zt,b.collisionArrays[Zt])}}else for(let Lt=i.symbolInstanceStart;Lt<i.symbolInstanceEnd;Lt++)Yt(b.symbolInstances.get(Lt),Lt,b.collisionArrays[Lt]);if(m&&b.bucketInstanceId in this.collisionCircleArrays){const Lt=this.collisionCircleArrays[b.bucketInstanceId];u.invert(Lt.invProjMatrix,A),Lt.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(i,l,m,y){let b;b=y===u.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(l)];const T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const A of T)A>=0&&(i.text.placedSymbolArray.get(A).crossTileID=b>=0&&A!==b?0:m.crossTileID)}markUsedOrientation(i,l,m){const y=l===u.WritingMode.horizontal||l===u.WritingMode.horizontalOnly?l:0,b=l===u.WritingMode.vertical?l:0,T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const A of T)i.text.placedSymbolArray.get(A).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let m=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const y=l?l.symbolFadeChange(i):1,b=l?l.opacities:{},T=l?l.variableOffsets:{},A=l?l.placedOrientations:{};for(const z in this.placements){const R=this.placements[z],O=b[z];O?(this.opacities[z]=new or(O,y,R.text,R.icon,null,R.clipped),m=m||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[z]=new or(null,y,R.text,R.icon,R.skipFade,R.clipped),m=m||R.text||R.icon)}for(const z in b){const R=b[z];if(!this.opacities[z]){const O=new or(R,y,!1,!1);O.isHidden()||(this.opacities[z]=O,m=m||R.text.placed||R.icon.placed)}}for(const z in T)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=T[z]);for(const z in A)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=A[z]);m?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l){const m={};for(const y of l){const b=y.getBucket(i);b&&y.latestFeatureIndex&&i.id===b.layerIds[0]&&this.updateBucketOpacities(b,m,y.collisionBoxArray)}}updateBucketOpacities(i,l,m){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const y=i.layers[0].layout,b=!!i.layers[0].dynamicFilter(),T=new or(null,0,!1,!1,!0),A=y.get("text-allow-overlap"),z=y.get("icon-allow-overlap"),R=y.get("text-variable-anchor"),O="map"===y.get("text-rotation-alignment"),N="map"===y.get("text-pitch-alignment"),$="none"!==y.get("icon-text-fit"),X=new or(null,0,A&&(z||!i.hasIconData()||y.get("icon-optional")),z&&(A||!i.hasTextData()||y.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const W=(dt,K,lt)=>{for(let ot=0;ot<K/4;ot++)dt.opacityVertexArray.emplaceBack(lt)};let J=0;for(let dt=0;dt<i.symbolInstances.length;dt++){const K=i.symbolInstances.get(dt),{numHorizontalGlyphVertices:lt,numVerticalGlyphVertices:ot,crossTileID:st}=K;let at=this.opacities[st];l[st]?at=T:at||(at=X,this.opacities[st]=at),l[st]=!0;const pt=lt>0||ot>0,At=K.numIconVertices>0,It=this.placedOrientations[K.crossTileID],ee=It===u.WritingMode.vertical,qt=It===u.WritingMode.horizontal||It===u.WritingMode.horizontalOnly;if(!pt&&!At||at.isHidden()||J++,pt){const Yt=sa(at.text);W(i.text,lt,ee?$r:Yt),W(i.text,ot,qt?$r:Yt);const Lt=at.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(Ut=>{Ut>=0&&(i.text.placedSymbolArray.get(Ut).hidden=Lt||ee?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=Lt||qt?1:0);const Dt=this.variableOffsets[K.crossTileID];Dt&&this.markUsedJustification(i,Dt.anchor,K,It);const Zt=this.placedOrientations[K.crossTileID];Zt&&(this.markUsedJustification(i,"left",K,Zt),this.markUsedOrientation(i,Zt,K))}if(At){const Yt=sa(at.icon);K.placedIconSymbolIndex>=0&&(W(i.icon,K.numIconVertices,ee?$r:Yt),i.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=at.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(W(i.icon,K.numVerticalIconVertices,qt?$r:Yt),i.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=at.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Yt=i.collisionArrays[dt];if(Yt){let Lt=new u.pointGeometry(0,0),Dt=!0;if(Yt.textBox||Yt.verticalTextBox){if(R){const Ut=this.variableOffsets[st];Ut?(Lt=Ps(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textScale),O&&Lt._rotate(N?this.transform.angle:-this.transform.angle)):Dt=!1}b&&(Dt=!at.clipped),Yt.textBox&&Nn(i.textCollisionBox.collisionVertexArray,at.text.placed,!Dt||ee,Lt.x,Lt.y),Yt.verticalTextBox&&Nn(i.textCollisionBox.collisionVertexArray,at.text.placed,!Dt||qt,Lt.x,Lt.y)}const Zt=Dt&&Boolean(!qt&&Yt.verticalIconBox);Yt.iconBox&&Nn(i.iconCollisionBox.collisionVertexArray,at.icon.placed,Zt,$?Lt.x:0,$?Lt.y:0),Yt.verticalIconBox&&Nn(i.iconCollisionBox.collisionVertexArray,at.icon.placed,!Zt,$?Lt.x:0,$?Lt.y:0)}}}if(i.fullyClipped=0===J,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const dt=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=dt.invProjMatrix,i.placementViewportMatrix=dt.viewportMatrix,i.collisionCircleArray=dt.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){const m=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function Nn(p,i,l,m,y){p.emplaceBack(i?1:0,l?1:0,m||0,y||0),p.emplaceBack(i?1:0,l?1:0,m||0,y||0),p.emplaceBack(i?1:0,l?1:0,m||0,y||0),p.emplaceBack(i?1:0,l?1:0,m||0,y||0)}const Rt=Math.pow(2,25),ue=Math.pow(2,24),Pa=Math.pow(2,17),ls=Math.pow(2,16),Qi=Math.pow(2,9),Zr=Math.pow(2,8),Or=Math.pow(2,1);function sa(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const i=p.placed?1:0,l=Math.floor(127*p.opacity);return l*Rt+i*ue+l*Pa+i*ls+l*Qi+i*Zr+l*Or+i}const $r=0;class oe{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,l,m,y,b){const T=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(T,y,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((A,z)=>A.sortKey-z.sortKey));this._currentPartIndex<T.length;){const A=T[this._currentPartIndex];if(l.placeLayerBucketPart(A,this._seenCrossTileIDs,m,0===A.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class je{constructor(i,l,m,y,b,T,A,z){this.placement=new Do(i,b,T,A,z),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(i,l,m){const y=u.exported.now(),b=()=>{const T=u.exported.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=l[i[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===T.type&&(!T.minzoom||T.minzoom<=A)&&(!T.maxzoom||T.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new oe(T)),this._inProgressLayer.continuePlacement(m[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Re=512/u.EXTENT/2;class jn{constructor(i,l,m){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let y=0;y<l.length;y++){const b=l.get(y),T=b.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,i)})}}getScaledCoordinates(i,l){const m=Re/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*u.EXTENT+i.tileAnchorX)*m),y:Math.floor((l.canonical.y*u.EXTENT+i.tileAnchorY)*m)}}findMatches(i,l,m){const y=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let b=0;b<i.length;b++){const T=i.get(b);if(T.crossTileID)continue;const A=this.indexedSymbolInstances[T.key];if(!A)continue;const z=this.getScaledCoordinates(T,l);for(const R of A)if(Math.abs(R.coord.x-z.x)<=y&&Math.abs(R.coord.y-z.y)<=y&&!m[R.crossTileID]){m[R.crossTileID]=!0,T.crossTileID=R.crossTileID;break}}}}class aa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qe{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const l=Math.round((i-this.lng)/360);if(0!==l)for(const m in this.indexes){const y=this.indexes[m],b={};for(const T in y){const A=y[T];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+l),b[A.tileID.key]=A}this.indexes[m]=b}this.lng=i}addBucket(i,l,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let b=0;b<l.symbolInstances.length;b++)l.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const y=this.usedCrossTileIDs[i.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>i.overscaledZ)for(const A in T){const z=T[A];z.tileID.isChildOf(i)&&z.findMatches(l.symbolInstances,i,y)}else{const A=T[i.scaledTo(Number(b)).key];A&&A.findMatches(l.symbolInstances,i,y)}}for(let b=0;b<l.symbolInstances.length;b++){const T=l.symbolInstances.get(b);T.crossTileID||(T.crossTileID=m.generate(),y[T.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new jn(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(const m in l.indexedSymbolInstances)for(const y of l.indexedSymbolInstances[m])delete this.usedCrossTileIDs[i][y.crossTileID]}removeStaleBuckets(i){let l=!1;for(const m in this.indexes){const y=this.indexes[m];for(const b in y)i[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[b]),delete y[b],l=!0)}return l}}class zs{constructor(){this.layerIndexes={},this.crossTileIDs=new aa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,m,y){let b=this.layerIndexes[i.id];void 0===b&&(b=this.layerIndexes[i.id]=new qe);let T=!1;const A={};"globe"!==y.name&&b.handleWrapJump(m);for(const z of l){const R=z.getBucket(i);R&&i.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(z.tileID,R,this.crossTileIDs)&&(T=!0),A[R.bucketInstanceId]=!0)}return b.removeStaleBuckets(A)&&(T=!0),T}pruneUnusedLayers(i){const l={};i.forEach(m=>{l[m]=!0});for(const m in this.layerIndexes)l[m]||delete this.layerIndexes[m]}}const An=(p,i)=>u.emitValidationErrors(p,i&&i.filter(l=>"source.canvas"!==l.identifier)),za=u.pick(Nt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),lr=u.pick(Nt,["setCenter","setZoom","setBearing","setPitch"]),Gi=function(){const p={},i=u.spec.$version;for(const l in u.spec.$root){const m=u.spec.$root[l];if(m.required){let y=null;y="version"===l?i:"array"===m.type?[]:{},null!=y&&(p[l]=y)}}return p}(),Nh={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ln extends u.Evented{constructor(i,l={}){super(),this.map=i,this.dispatcher=new nn(gt(),this),this.imageManager=new ei,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(i._requestManager,l.localFontFamily?u.LocalGlyphMode.all:l.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new u.LineAtlas(256,512),this.crossTileSymbolIndex=new zs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const m=this;this._rtlTextPluginCallback=Ln.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,T)=>{if(u.triggerPluginCompletionEvent(b),T&&T.every(A=>A))for(const A in m._sourceCaches){const z=m._sourceCaches[A],R=z.getSource().type;"vector"!==R&&"geojson"!==R||z.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const b=this.getSource(y.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const A=this._layers[T];A.source===b.id&&this._validateLayer(A)}})}loadURL(i,l={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof l.validate?l.validate:!u.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,l.accessToken);const y=this.map._requestManager.transformRequest(i,u.ResourceType.Style);this._request=u.getJSON(y,(b,T)=>{this._request=null,b?this.fire(new u.ErrorEvent(b)):T&&this._load(T,m)})}loadJSON(i,l={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(i,!1!==l.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(Gi,!1)}_updateLayerCount(i,l){const m=l?1:-1;i.is3D()&&(this._num3DLayers+=m),"circle"===i.type&&(this._numCircleLayers+=m),"symbol"===i.type&&(this._numSymbolLayers+=m)}_load(i,l){if(l&&An(this,u.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this.updateProjection();for(const y in i.sources)this.addSource(y,i.sources[y],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const m=Bt(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of m)y=u.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ke(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const i=this.map.transform.projection,l=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),m=this.map.transform.projection;if(this._loaded&&(m.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),l){if(m.isReprojectedInTileSpace||i.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(i){this._spriteRequest=function(l,m,y){let b,T,A;const z=u.exported.devicePixelRatio>1?"@2x":"";let R=u.getJSON(m.transformRequest(m.normalizeSpriteURL(l,z,".json"),u.ResourceType.SpriteJSON),($,X)=>{R=null,A||(A=$,b=X,N())}),O=u.getImage(m.transformRequest(m.normalizeSpriteURL(l,z,".png"),u.ResourceType.SpriteImage),($,X)=>{O=null,A||(A=$,T=X,N())});function N(){if(A)y(A);else if(b&&T){const $=u.exported.getImageData(T),X={};for(const W in b){const{width:J,height:dt,x:K,y:lt,sdf:ot,pixelRatio:st,stretchX:at,stretchY:pt,content:At}=b[W],It=new u.RGBAImage({width:J,height:dt});u.RGBAImage.copy($,It,{x:K,y:lt},{x:0,y:0},{width:J,height:dt}),X[W]={data:It,pixelRatio:st,sdf:ot,stretchX:at,stretchY:pt,content:At}}y(null,X)}}return{cancel(){R&&(R.cancel(),R=null),O&&(O.cancel(),O=null)}}}(i,this.map._requestManager,(l,m)=>{if(this._spriteRequest=null,l)this.fire(new u.ErrorEvent(l));else if(m)for(const y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(i){const l=this.getSource(i.source);if(!l)return;const m=i.sourceLayer;m&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(m))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${l.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const l=[];for(const m of i){const y=this._layers[m];"custom"!==y.type&&l.push(y.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&Nh[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const l=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(y.length||b.length)&&this._updateWorkerLayers(y,b);for(const T in this._updatedSources){const A=this._updatedSources[T];"reload"===A?this._reloadSource(T):"clear"===A&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const m={};for(const y in this._sourceCaches){const b=this._sourceCaches[y];m[y]=b.used,b.used=!1}for(const y of this._order){const b=this._layers[y];if(b.recalculate(i,this._availableImages),!b.isHidden(i.zoom)){const A=this._getLayerSourceCache(b);A&&(A.used=!0)}const T=this.map.painter;if(T){const A=b.getProgramIds();if(!A)continue;const z=b.getProgramConfiguration(i.zoom);for(const R of A)T.useProgram(R,z)}}for(const y in m){const b=this._sourceCaches[y];m[y]!==b.used&&b.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),An(this,u.validateStyle(i)))return!1;(i=u.clone$1(i)).layers=Bt(i.layers);const l=function(y,b){if(!y)return[{command:Nt.setStyle,args:[b]}];let T=[];try{if(!Te(y.version,b.version))return[{command:Nt.setStyle,args:[b]}];Te(y.center,b.center)||T.push({command:Nt.setCenter,args:[b.center]}),Te(y.zoom,b.zoom)||T.push({command:Nt.setZoom,args:[b.zoom]}),Te(y.bearing,b.bearing)||T.push({command:Nt.setBearing,args:[b.bearing]}),Te(y.pitch,b.pitch)||T.push({command:Nt.setPitch,args:[b.pitch]}),Te(y.sprite,b.sprite)||T.push({command:Nt.setSprite,args:[b.sprite]}),Te(y.glyphs,b.glyphs)||T.push({command:Nt.setGlyphs,args:[b.glyphs]}),Te(y.transition,b.transition)||T.push({command:Nt.setTransition,args:[b.transition]}),Te(y.light,b.light)||T.push({command:Nt.setLight,args:[b.light]}),Te(y.fog,b.fog)||T.push({command:Nt.setFog,args:[b.fog]}),Te(y.projection,b.projection)||T.push({command:Nt.setProjection,args:[b.projection]});const A={},z=[];!function(N,$,X,W){let J;for(J in $=$||{},N=N||{})N.hasOwnProperty(J)&&($.hasOwnProperty(J)||be(J,X,W));for(J in $)$.hasOwnProperty(J)&&(N.hasOwnProperty(J)?Te(N[J],$[J])||("geojson"===N[J].type&&"geojson"===$[J].type&&Se(N,$,J)?X.push({command:Nt.setGeoJSONSourceData,args:[J,$[J].data]}):Ce(J,$,X,W)):Xt(J,$,X))}(y.sources,b.sources,z,A);const R=[];y.layers&&y.layers.forEach(N=>{A[N.source]?T.push({command:Nt.removeLayer,args:[N.id]}):R.push(N)});let O=y.terrain;O&&A[O.source]&&(T.push({command:Nt.setTerrain,args:[void 0]}),O=void 0),T=T.concat(z),Te(O,b.terrain)||T.push({command:Nt.setTerrain,args:[b.terrain]}),function(N,$,X){$=$||[];const W=(N=N||[]).map(Je),J=$.map(Je),dt=N.reduce(wi,{}),K=$.reduce(wi,{}),lt=W.slice(),ot=Object.create(null);let st,at,pt,At,It,ee,qt;for(st=0,at=0;st<W.length;st++)pt=W[st],K.hasOwnProperty(pt)?at++:(X.push({command:Nt.removeLayer,args:[pt]}),lt.splice(lt.indexOf(pt,at),1));for(st=0,at=0;st<J.length;st++)pt=J[J.length-1-st],lt[lt.length-1-st]!==pt&&(dt.hasOwnProperty(pt)?(X.push({command:Nt.removeLayer,args:[pt]}),lt.splice(lt.lastIndexOf(pt,lt.length-at),1)):at++,ee=lt[lt.length-st],X.push({command:Nt.addLayer,args:[K[pt],ee]}),lt.splice(lt.length-st,0,pt),ot[pt]=!0);for(st=0;st<J.length;st++)if(pt=J[st],At=dt[pt],It=K[pt],!ot[pt]&&!Te(At,It))if(Te(At.source,It.source)&&Te(At["source-layer"],It["source-layer"])&&Te(At.type,It.type)){for(qt in Fe(At.layout,It.layout,X,pt,null,Nt.setLayoutProperty),Fe(At.paint,It.paint,X,pt,null,Nt.setPaintProperty),Te(At.filter,It.filter)||X.push({command:Nt.setFilter,args:[pt,It.filter]}),Te(At.minzoom,It.minzoom)&&Te(At.maxzoom,It.maxzoom)||X.push({command:Nt.setLayerZoomRange,args:[pt,It.minzoom,It.maxzoom]}),At)At.hasOwnProperty(qt)&&"layout"!==qt&&"paint"!==qt&&"filter"!==qt&&"metadata"!==qt&&"minzoom"!==qt&&"maxzoom"!==qt&&(0===qt.indexOf("paint.")?Fe(At[qt],It[qt],X,pt,qt.slice(6),Nt.setPaintProperty):Te(At[qt],It[qt])||X.push({command:Nt.setLayerProperty,args:[pt,qt,It[qt]]}));for(qt in It)It.hasOwnProperty(qt)&&!At.hasOwnProperty(qt)&&"layout"!==qt&&"paint"!==qt&&"filter"!==qt&&"metadata"!==qt&&"minzoom"!==qt&&"maxzoom"!==qt&&(0===qt.indexOf("paint.")?Fe(At[qt],It[qt],X,pt,qt.slice(6),Nt.setPaintProperty):Te(At[qt],It[qt])||X.push({command:Nt.setLayerProperty,args:[pt,qt,It[qt]]}))}else X.push({command:Nt.removeLayer,args:[pt]}),ee=lt[lt.lastIndexOf(pt)+1],X.push({command:Nt.addLayer,args:[It,ee]})}(R,b.layers,T)}catch(A){console.warn("Unable to compute style diff:",A),T=[{command:Nt.setStyle,args:[b]}]}return T}(this.serialize(),i).filter(y=>!(y.command in lr));if(0===l.length)return!1;const m=l.filter(y=>!(y.command in za));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return l.forEach(y=>{"setTransition"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=i,this.updateProjection(),!0}addImage(i,l){if(this.getImage(i))return this.fire(new u.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,l),this._afterImageUpdated(i)}updateImage(i,l){this.imageManager.updateImage(i,l)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new u.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,l,m={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(u.validateStyle.source,`sources.${i}`,l,null,m))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const y=xn(i,l,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:i}));const b=T=>{const A=(T?"symbol:":"other:")+i,z=this._sourceCaches[A]=new u.SourceCache(A,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[i]=z,z.style=this,z.onAdd(this.map)};b(!1),"vector"!==l.type&&"geojson"!==l.type||b(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const l=this.getSource(i);if(void 0===l)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===i)return this.fire(new u.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new u.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(i);for(const y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,l){this._checkLoaded(),this.getSource(i).setData(l),this._changed=!0}getSource(i){const l=this._getSourceCache(i);return l&&l.getSource()}addLayer(i,l,m={}){this._checkLoaded();const y=i.id;if(this.getLayer(y))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let b;if("custom"===i.type){if(An(this,u.validateCustomStyleLayer(i)))return;b=u.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(y,i.source),i=u.clone$1(i),i=u.extend(i,{source:y})),this._validate(u.validateStyle.layer,`layers.${y}`,i,{arrayIndex:-1},m))return;b=u.createStyleLayer(i),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const T=l?this._order.indexOf(l):this._order.length;if(l&&-1===T)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const A=this._getLayerSourceCache(b);if(this._removedLayers[y]&&b.source&&A&&"custom"!==b.type){const z=this._removedLayers[y];delete this._removedLayers[y],z.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",A.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,l){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new u.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===l)return;const m=this._order.indexOf(i);this._order.splice(m,1);const y=l?this._order.indexOf(l):this._order.length;l&&-1===y?this.fire(new u.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(y,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const l=this._layers[i];if(!l)return void this.fire(new u.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=l,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const l in this._layers)if(this._layers[l].type===i)return!0;return!1}setLayerZoomRange(i,l,m){this._checkLoaded();const y=this.getLayer(i);y?y.minzoom===l&&y.maxzoom===m||(null!=l&&(y.minzoom=l),null!=m&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new u.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,l,m={}){this._checkLoaded();const y=this.getLayer(i);if(y){if(!Te(y.filter,l))return null==l?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(u.validateStyle.filter,`layers.${y.id}.filter`,l,{layerType:y.type},m)||(y.filter=u.clone$1(l),this._updateLayer(y)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){return u.clone$1(this.getLayer(i).filter)}setLayoutProperty(i,l,m,y={}){this._checkLoaded();const b=this.getLayer(i);b?Te(b.getLayoutProperty(l),m)||(b.setLayoutProperty(l,m,y),this._updateLayer(b)):this.fire(new u.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,l){const m=this.getLayer(i);if(m)return m.getLayoutProperty(l);this.fire(new u.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,l,m,y={}){this._checkLoaded();const b=this.getLayer(i);b?Te(b.getPaintProperty(l),m)||(b.setPaintProperty(l,m,y)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,l){return this.getLayer(i).getPaintProperty(l)}setFeatureState(i,l){this._checkLoaded();const m=i.source,y=i.sourceLayer,b=this.getSource(m);if(void 0===b)return void this.fire(new u.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const T=b.type;if("geojson"===T&&y)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===T&&!y)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(m);for(const z of A)z.setFeatureState(y,i.id,l)}removeFeatureState(i,l){this._checkLoaded();const m=i.source,y=this.getSource(m);if(void 0===y)return void this.fire(new u.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const b=y.type,T="vector"===b?i.sourceLayer:void 0;if("vector"===b&&!T)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(m);for(const z of A)z.removeFeatureState(T,i.id,l)}getFeatureState(i){this._checkLoaded();const l=i.source,m=i.sourceLayer,y=this.getSource(l);if(void 0!==y){if("vector"!==y.type||m)return void 0===i.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(m,i.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const l in this._sourceCaches){const m=this._sourceCaches[l].getSource();i[m.id]||(i[m.id]=m.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(i){this._updatedLayers[i.id]=!0;const l=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[i.source]="reload",l.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const l=T=>"fill-extrusion"===this._layers[T].type,m={},y=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(l(A)){m[A]=T;for(const z of i){const R=z[A];if(R)for(const O of R)y.push(O)}}}y.sort((T,A)=>A.intersectionZ-T.intersectionZ);const b=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(l(A))for(let z=y.length-1;z>=0;z--){const R=y[z].feature;if(m[R.layer.id]<T)break;b.push(R),y.pop()}else for(const z of i){const R=z[A];if(R)for(const O of R)b.push(O.feature)}}return b}queryRenderedFeatures(i,l,m){l&&l.filter&&this._validate(u.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const y={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const z of l.layers){const R=this._layers[z];if(!R)return this.fire(new u.ErrorEvent(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];y[R.source]=!0}}const b=[];l.availableImages=this._availableImages;const T=l&&l.layers?l.layers.some(z=>{const R=this.getLayer(z);return R&&R.is3D()}):this.has3DLayers(),A=Kn.createFromScreenPoints(i,m);for(const z in this._sourceCaches){const R=this._sourceCaches[z].getSource().id;l.layers&&!y[R]||b.push(F(this._sourceCaches[z],this._layers,this._serializedLayers,A,l,m,T,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(z,R,O,N,$,X,W){const J={},dt=X.queryRenderedSymbols(N),K=[];for(const lt of Object.keys(dt).map(Number))K.push(W[lt]);K.sort(Q);for(const lt of K){const ot=lt.featureIndex.lookupSymbolFeatures(dt[lt.bucketInstanceId],R,lt.bucketIndex,lt.sourceLayerIndex,$.filter,$.layers,$.availableImages,z);for(const st in ot){const at=J[st]=J[st]||[],pt=ot[st];pt.sort((At,It)=>{const ee=lt.featureSortOrder;if(ee){const qt=ee.indexOf(At.featureIndex);return ee.indexOf(It.featureIndex)-qt}return It.featureIndex-At.featureIndex});for(const At of pt)at.push(At)}}for(const lt in J)J[lt].forEach(ot=>{const st=ot.feature,at=O(z[lt]).getFeatureState(st.layer["source-layer"],st.id);st.source=st.layer.source,st.layer["source-layer"]&&(st.sourceLayer=st.layer["source-layer"]),st.state=at});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(i,l){l&&l.filter&&this._validate(u.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const m=this._getSourceCaches(i);let y=[];for(const b of m)y=y.concat(Z(b,l));return y}addSourceType(i,l,m){return Ln.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(Ln.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(i,l={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const T in i)if(!Te(i[T],m[T])){y=!0;break}if(!y)return;const b={now:u.exported.now(),transition:u.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,l),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,l=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===l){if("object"==typeof i.source){const m="terrain-dem-src";this.addSource(m,i.source),i=u.clone$1(i),i=u.extend(i,{source:m})}if(this._validate(u.validateStyle.terrain,"terrain",i))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(i,l);else{const m=this.terrain,y=m.get();for(const b in i)if(!Te(i[b],y[b])){m.set(i),this.stylesheet.terrain=i;const T={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const l=this.fog=new nr(i,this.map.transform);this.stylesheet.fog=i;const m={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,m=l.get();for(const y in i)if(!Te(i[y],m[y])){l.set(i),this.stylesheet.fog=i;const b={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(b);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(m=>this.isLayerDraped(this._layers[m])),l=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...l)}_createTerrain(i,l){const m=this.terrain=new re(i,l);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const y={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(y)}_force3DLayerUpdate(){for(const i in this._layers){const l=this._layers[i];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const l=this._layers[i];"symbol"===l.type&&this._updateLayer(l)}}_validate(i,l,m,y,b={}){return(!b||!1!==b.validate)&&An(this,i.call(u.validateStyle,u.extend({key:l,style:this.serialize(),value:m,styleSpec:u.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const l=this._getSourceCaches(i);for(const m of l)m.clearTiles()}_reloadSource(i){const l=this._getSourceCaches(i);for(const m of l)m.resume(),m.reload()}_updateSources(i){for(const l in this._sourceCaches)this._sourceCaches[l].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const l=this._sourceCaches[i];l.resume(),l.reload()}}_updatePlacement(i,l,m,y,b=!1){let T=!1,A=!1;const z={};for(const R of this._order){const O=this._layers[R];if("symbol"!==O.type)continue;if(!z[O.source]){const $=this._getLayerSourceCache(O);if(!$)continue;z[O.source]=$.getRenderableIds(!0).map(X=>$.getTileByID(X)).sort((X,W)=>W.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(W.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(O,z[O.source],i.center.lng,i.projection);T=T||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),i.zoom))&&(this.pauseablePlacement=new je(i,this._order,b,l,m,y,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),A=!0),T&&this.pauseablePlacement.placement.setStale()),A||T)for(const R of this._order){const O=this._layers[R];"symbol"===O.type&&this.placement.updateLayerOpacities(O,z[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,l,m){this.imageManager.getImages(l.icons,m),this._updateTilesForChangedImages();const y=b=>{b&&b.setDependencies(l.tileID.key,l.type,l.icons)};y(this._otherSourceCaches[l.source]),y(this._symbolSourceCaches[l.source])}getGlyphs(i,l,m){this.glyphManager.getGlyphs(l.stacks,m)}getResource(i,l,m){return u.makeRequest(l,m)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const l=[];return this._otherSourceCaches[i]&&l.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&l.push(this._symbolSourceCaches[i]),l}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ln.getSourceType=function(p){return ar[p]},Ln.setSourceType=function(p,i){ar[p]=i},Ln.registerForPluginStateChange=u.registerForPluginStateChange;var Ra="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",cs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let wr={},Rs={};wr=Ye("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Rs=Ye("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const fi=Ye("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),oa=Ra;var Io={background:Ye("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ye("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ye("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ye("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ye("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ye("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ye("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ye("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ye("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ye("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ye("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ye("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ye("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ye("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ye("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ye("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ye("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ye("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ye("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ye("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ye("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ye("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ye("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ye("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Ye("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ye("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",cs),skyboxGradient:Ye("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",cs),skyboxCapture:Ye("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ye("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Ye("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function Ye(p,i,l){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=p.match(y),A=i.match(y),z=Ra.match(y);let R=A?A.concat(T):T;l||(wr.staticUniforms&&(R=wr.staticUniforms.concat(R)),Rs.staticUniforms&&(R=Rs.staticUniforms.concat(R))),R&&(R=R.concat(z));const O={};return{fragmentSource:p=p.replace(m,(N,$,X,W,J)=>(O[J]=!0,"define"===$?`\n#ifndef HAS_UNIFORM_u_${J}\nvarying ${X} ${W} ${J};\n#else\nuniform ${X} ${W} u_${J};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${J}\n    ${X} ${W} ${J} = u_${J};\n#endif\n`)),vertexSource:i=i.replace(m,(N,$,X,W,J)=>{const dt="float"===W?"vec2":"vec4",K=J.match(/color/)?"color":dt;return O[J]?"define"===$?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nattribute ${X} ${dt} a_${J};\nvarying ${X} ${W} ${J};\n#else\nuniform ${X} ${W} u_${J};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = a_${J};\n#else\n    ${X} ${W} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = unpack_mix_${K}(a_${J}, u_${J}_t);\n#else\n    ${X} ${W} ${J} = u_${J};\n#endif\n`:"define"===$?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nattribute ${X} ${dt} a_${J};\n#else\nuniform ${X} ${W} u_${J};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${X} ${W} ${J} = a_${J};\n#else\n    ${X} ${W} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${X} ${W} ${J} = unpack_mix_${K}(a_${J}, u_${J}_t);\n#else\n    ${X} ${W} ${J} = u_${J};\n#endif\n`}),staticAttributes:b,staticUniforms:R}}class cr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,l,m,y,b,T,A,z){this.context=i;let R=this.boundPaintVertexBuffers.length!==y.length;for(let O=0;!R&&O<y.length;O++)this.boundPaintVertexBuffers[O]!==y[O]&&(R=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===m&&!R&&this.boundIndexBuffer===b&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===z?(i.bindVertexArrayOES.set(this.vao),A&&A.bind(),b&&b.dynamicDraw&&b.bind(),z&&z.bind()):this.freshBind(l,m,y,b,T,A,z)}freshBind(i,l,m,y,b,T,A){let z;const R=i.numAttributes,O=this.context,N=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=A;else{z=O.currentNumAttributes||0;for(let $=R;$<z;$++)N.disableVertexAttribArray($)}l.enableAttributes(N,i);for(const $ of m)$.enableAttributes(N,i);T&&T.enableAttributes(N,i),A&&A.enableAttributes(N,i),l.bind(),l.setVertexAttribPointers(N,i,b);for(const $ of m)$.bind(),$.setVertexAttribPointers(N,i,b);T&&(T.bind(),T.setVertexAttribPointers(N,i,b)),y&&y.bind(),A&&(A.bind(),A.setVertexAttribPointers(N,i,b)),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Mc(p,i){const l=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new u.MercatorCoordinate(0,m/l).toLngLat().lat,new u.MercatorCoordinate(0,(m+1)/l).toLngLat().lat]}function La(p,i,l,m,y,b,T){const A=p.context,z=A.gl,R=l.fbo;if(!R)return;p.prepareDrawTile(i);const O=p.useProgram("hillshade");A.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,R.colorAttachment.get());const N=((J,dt,K,lt)=>{const ot=K.paint.get("hillshade-shadow-color"),st=K.paint.get("hillshade-highlight-color"),at=K.paint.get("hillshade-accent-color");let pt=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===K.paint.get("hillshade-illumination-anchor")&&(pt-=J.transform.angle);const At=!J.options.moving;return{u_matrix:lt||J.transform.calculateProjMatrix(dt.tileID.toUnwrapped(),At),u_image:0,u_latrange:Mc(0,dt.tileID),u_light:[K.paint.get("hillshade-exaggeration"),pt],u_shadow:ot,u_highlight:st,u_accent:at}})(p,l,m,p.terrain?i.projMatrix:null);p.prepareDrawProgram(A,O,i.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:X,tileBoundsSegments:W}=p.getTileBoundsBuffers(l);O.draw(A,z.TRIANGLES,y,b,T,u.CullFaceMode.disabled,N,m.id,$,X,W)}function rn(p,i,l){if(!i.needsDEMTextureUpload)return;const m=p.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||p.getTileTexture(l.stride);const b=l.getPixels();i.demTexture?i.demTexture.update(b,{premultiply:!1}):i.demTexture=new u.Texture(m,b,y.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Oa(p,i,l,m,y,b){const T=p.context,A=T.gl;if(!i.dem)return;const z=i.dem;if(T.activeTexture.set(A.TEXTURE1),rn(p,i,z),!i.demTexture)return;i.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const R=z.dim;T.activeTexture.set(A.TEXTURE0);let O=i.fbo;if(!O){const W=new u.Texture(T,{width:R,height:R,data:null},A.RGBA);W.bind(A.LINEAR,A.CLAMP_TO_EDGE),O=i.fbo=T.createFramebuffer(R,R,!0),O.colorAttachment.set(W.texture)}T.bindFramebuffer.set(O.framebuffer),T.viewport.set([0,0,R,R]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:$,tileBoundsSegments:X}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(T,A.TRIANGLES,m,y,b,u.CullFaceMode.disabled,((W,J)=>{const dt=J.stride,K=u.create();return u.ortho(K,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(K,K,[0,-u.EXTENT,0]),{u_matrix:K,u_image:1,u_dimension:[dt,dt],u_zoom:W.overscaledZ,u_unpack:J.unpackVector}})(i.tileID,z),l.id,N,$,X),i.needsHillshadePrepare=!1}const Fr=(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_image0:new u.Uniform1i(p,i.u_image0),u_skirt_height:new u.Uniform1f(p,i.u_skirt_height)}),dn=(p,i)=>({u_matrix:p,u_image0:0,u_skirt_height:i}),Po=(p,i,l,m,y)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:i,u_merc_matrix:l,u_zoom_transition:m,u_merc_center:y,u_image0:0});function hr(p,i){return null!=p&&null!=i&&!(!p.hasData()||!i.hasData())&&null!=p.demTexture&&null!=i.demTexture&&p.tileID.key!==i.tileID.key}const Mr=new class{constructor(){this.operations={}}newMorphing(p,i,l,m,y){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==l.tileID.key&&(b.queued=l)}else this.operations[p]={startTime:m,phase:0,duration:y,from:i,to:l,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const i=this.operations[p];return{from:i.from,to:i.to,phase:i.phase}}update(p){for(const i in this.operations){const l=this.operations[i];for(l.phase=(p-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,p)){delete this.operations[i];break}}}_nextOp(p,i){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=i,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},hs={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function jh(p,i){const l=1<<p.z;return!i&&(0===p.x||p.x===l-1)||0===p.y||p.y===l-1}const Br=p=>({u_matrix:p});function Ls(p,i,l,m,y){if(y>0){const b=u.exported.now(),T=(b-p.timeAdded)/y,A=i?(b-i.timeAdded)/y:-1,z=l.getSource(),R=m.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),O=!i||Math.abs(i.tileID.overscaledZ-R)>Math.abs(p.tileID.overscaledZ-R),N=O&&p.refreshedUponExpiration?1:u.clamp(O?T:1-A,0,1);return p.refreshedUponExpiration&&T>=1&&(p.refreshedUponExpiration=!1),i?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Pl extends u.SourceCache{constructor(i){const l={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new nn(gt(),null),y=xn("mock-dem",l,m,i.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,l){i.state="loaded",l(null)}}class er extends u.SourceCache{constructor(i){const l=xn("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new nn(gt(),null),i.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,l,m){if(i.freezeTileCoverage)return;this.transform=i;const y=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const A=new u.Tile(T,this._source.tileSize*T.overscaleFactor(),i.tileZoom);A.state="loaded",this._tiles[T.key]=A}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(i){const l=this.proxyCachedFBO[i];if(void 0!==l){const m=Object.values(l);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Fa extends u.OverscaledTileID{constructor(i,l,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=l,this.projMatrix=m}}class us extends u.Elevation{constructor(i,l){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,b]=function(z){const R=new u.StructArrayLayout4i8,O=new u.StructArrayLayout3ui6,N=131;R.reserve(17161),O.reserve(33800);const $=u.EXTENT/128,X=u.EXTENT+$/2,W=X+$;for(let dt=-$;dt<W;dt+=$)for(let K=-$;K<W;K+=$){const lt=K<0||K>X||dt<0||dt>X?24575:0,ot=u.clamp(Math.round(K),0,u.EXTENT),st=u.clamp(Math.round(dt),0,u.EXTENT);R.emplaceBack(ot+lt,st,ot,st)}const J=(dt,K)=>{const lt=K*N+dt;O.emplaceBack(lt+1,lt,lt+N),O.emplaceBack(lt+N,lt+N+1,lt+1)};for(let dt=1;dt<129;dt++)for(let K=1;K<129;K++)J(K,dt);return[0,129].forEach(dt=>{for(let K=0;K<130;K++)J(K,dt),J(dt,K)}),[R,O,32768]}(),T=i.context;this.gridBuffer=T.createVertexBuffer(m,u.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=u.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,m.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new er(l.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,0,u.EXTENT,0,u.EXTENT,0,1);const A=T.gl;this._overlapStencilMode=new u.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Pl(l.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,l,m){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const y=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const b=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(l,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),l.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=l.getIds().map(z=>{const R=l.getTileByID(z).tileID;return R.projMatrix=m.calculateProjMatrix(R.toUnwrapped()),R});(function(z,R){const O=R.transform.pointCoordinate(R.transform.getCameraPoint()),N=new u.pointGeometry(O.x,O.y);z.sort(($,X)=>{if(X.overscaledZ-$.overscaledZ)return X.overscaledZ-$.overscaledZ;const W=new u.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),J=new u.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),dt=N.mult(1<<$.canonical.z);return dt.x-=.5,dt.y-=.5,dt.distSqr(W)-dt.distSqr(J)})})(y,this.painter),this._previousZoom=m.zoom;const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const z in T){const R=T[z];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,i[z],b),R.usedForTerrain))continue;const O=i[z];R.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[l.id]=y.map(z=>new Fa(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const A={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const R=this.terrainTileForTile[z.key];if(!R)continue;const O=R.tileID.key;O in A||(this._visibleDemTiles.push(R),A[O]=O)}}_assignTerrainTiles(i){this._initializing||i.forEach(l=>{if(this.terrainTileForTile[l.key])return;const m=this._findTileCoveringTileID(l,this.sourceCache);m&&(this.terrainTileForTile[l.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,l=i.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(i.activeTexture.set(l.TEXTURE1),rn(this.painter,y,b))}}_prepareDemTileUniforms(i,l,m,y){if(!l||null==l.demTexture)return!1;const b=i.tileID.canonical,T=Math.pow(2,l.tileID.canonical.z-b.z),A=y||"";return m[`u_dem_tl${A}`]=[b.x*T%1,b.y*T%1],m[`u_dem_scale${A}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,l=i.gl;if(!this._emptyDepthBufferTexture){const m={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new u.Texture(i,m,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const l=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const b=y.dem.tree.minimums[0];return b>0&&i++,m+b},0);return i?l/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,l=i.gl;i.activeTexture.set(l.TEXTURE2);const m=this._getLoadedAreaMinimum(),y={width:1,height:1,data:new Uint8Array(u.DEMData.pack(m,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new u.Texture(i,y,l.RGBA,{premultiply:!1}),b}setupElevationDraw(i,l,m){const y=this.painter.context,b=y.gl,T=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();const z=this.painter.transform,R=z.projection.createTileTransform(z,z.worldSize),O=i.tileID.canonical;T.u_tile_tl_up=R.upVector(O,0,0),T.u_tile_tr_up=R.upVector(O,u.EXTENT,0),T.u_tile_br_up=R.upVector(O,u.EXTENT,u.EXTENT),T.u_tile_bl_up=R.upVector(O,0,u.EXTENT),T.u_tile_up_scale=R.upVectorScale(O);let N=null,$=null,X=1;if(m&&m.morphing&&this._useVertexMorphing){const W=m.morphing.srcDemTile,J=m.morphing.dstDemTile;X=m.morphing.phase,W&&J&&(this._prepareDemTileUniforms(i,W,T,"_prev")&&($=W),this._prepareDemTileUniforms(i,J,T)&&(N=J))}if($&&N?(y.activeTexture.set(b.TEXTURE2),N.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),y.activeTexture.set(b.TEXTURE4),$.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),T.u_dem_lerp=X):(N=this.terrainTileForTile[i.tileID.key],y.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(i,N,T)?N.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),y.activeTexture.set(b.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&N){const W=(1<<N.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=W}m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),l.setTerrainUniformValues(y,T)}renderToBackBuffer(i){const l=this.painter,m=this.painter.context;0!==i.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),this.renderingToTexture=!1,function(y,b,T,A,z){if("globe"===y.transform.projection.name)!function(R,O,N,$,X){const W=R.context,J=W.gl;let dt,K;const lt=R.options.showTerrainWireframe?2:0,ot=(Yt,Lt)=>{if(K===Yt)return;const Dt=[];Lt&&Dt.push(hs[lt]),Dt.push(hs[Yt]),Dt.push("PROJECTION_GLOBE_VIEW"),dt=R.useProgram("globeRaster",null,Dt),K=Yt},st=R.colorModeForRenderPass(),at=new u.DepthMode(J.LEQUAL,u.DepthMode.ReadWrite,R.depthRangeFor3D);Mr.update(X);const pt=R.transform,At=u.calculateGlobeMatrix(pt,pt.worldSize),It=u.calculateGlobeMercatorMatrix(pt),ee=[u.mercatorXfromLng(pt.center.lng),u.mercatorYfromLat(pt.center.lat)],qt=R.globeSharedBuffers;(lt?[!1,!0]:[!1]).forEach(Yt=>{K=-1;const Lt=Yt?J.LINES:J.TRIANGLES;for(const Dt of $){const Zt=N.getTile(Dt),Ut=Math.pow(2,Dt.canonical.z),[xe,Ae]=u.globeBuffersForTileMesh(R,Zt,Dt,Ut),Qe=u.StencilMode.disabled,te=O.prevTerrainTileForTile[Dt.key],Pe=O.terrainTileForTile[Dt.key];hr(te,Pe)&&Mr.newMorphing(Dt.key,te,Pe,X,250),W.activeTexture.set(J.TEXTURE0),Zt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const $e=Mr.getMorphValuesForProxy(Dt.key),si=$e?1:0,ki={};$e&&u.extend$1(ki,{morphing:{srcDemTile:$e.from,dstDemTile:$e.to,phase:u.easeCubicInOut($e.phase)}});const Ge=u.globeMatrixForTile(Dt.canonical,At),ti=Po(pt.projMatrix,Ge,It,u.globeToMercatorTransition(pt.zoom),ee);if(ot(si,Yt),O.setupElevationDraw(Zt,dt,ki),R.prepareDrawProgram(W,dt,Dt.toUnwrapped()),qt){const[Bi,cn]=Yt?qt.getWirefameBuffer(R.context):[qt.gridIndexBuffer,qt.gridSegments];dt.draw(W,Lt,at,Qe,st,u.CullFaceMode.backCCW,ti,"globe_raster",xe,Bi,cn)}if(!Yt){const Bi=[0===Dt.canonical.y?u.globePoleMatrixForTile(Dt.canonical,!1,pt):null,Dt.canonical.y===Ut-1?u.globePoleMatrixForTile(Dt.canonical,!0,pt):null];for(const cn of Bi){if(!cn)continue;const Dn=Po(pt.projMatrix,cn,cn,0,ee);qt&&dt.draw(W,Lt,at,Qe,st,u.CullFaceMode.disabled,Dn,"globe_pole_raster",Ae,qt.poleIndexBuffer,qt.poleSegments)}}}})}(y,b,T,A,z);else{const R=y.context,O=R.gl;let N,$;const X=y.options.showTerrainWireframe?2:0,W=(ot,st)=>{if($===ot)return;const at=[hs[ot]];st&&at.push(hs[X]),N=y.useProgram("terrainRaster",null,at),$=ot},J=y.colorModeForRenderPass(),dt=new u.DepthMode(O.LEQUAL,u.DepthMode.ReadWrite,y.depthRangeFor3D);Mr.update(z);const K=y.transform,lt=6*Math.pow(1.5,22-K.zoom)*b.exaggeration();(X?[!1,!0]:[!1]).forEach(ot=>{$=-1;const st=ot?O.LINES:O.TRIANGLES,[at,pt]=ot?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const At of A){const It=T.getTile(At),ee=u.StencilMode.disabled,qt=b.prevTerrainTileForTile[At.key],Yt=b.terrainTileForTile[At.key];hr(qt,Yt)&&Mr.newMorphing(At.key,qt,Yt,z,250),R.activeTexture.set(O.TEXTURE0),It.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const Lt=Mr.getMorphValuesForProxy(At.key),Dt=Lt?1:0;let Zt;Lt&&(Zt={morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:u.easeCubicInOut(Lt.phase)}});const Ut=dn(At.projMatrix,jh(At.canonical,K.renderWorldCopies)?lt/10:lt);W(Dt,ot),b.setupElevationDraw(It,N,Zt),y.prepareDrawProgram(R,N,At.toUnwrapped()),N.draw(R,st,dt,ee,J,u.CullFaceMode.backCCW,Ut,"terrain_raster",b.gridBuffer,at,pt)}})}}(l,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const l=this.painter,m=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),A=[],z=l.style.order;let R=0;for(const O of b){const N=y.getTileByID(O.proxyTileKey),$=y.proxyCachedFBO[O.key]?y.proxyCachedFBO[O.key][i]:void 0,X=void 0!==$?y.renderCache[$]:this.pool[R++],W=void 0!==$;if(N.texture=X.tex,W&&!X.dirty){A.push(N.tileID);continue}let J;m.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(m.clear({color:u.Color.transparent,stencil:0}),X.dirty=!1);for(let dt=T.start;dt<=T.end;++dt){const K=l.style._layers[z[dt]];if(K.isHidden(l.transform.zoom))continue;const lt=l.style._getLayerSourceCache(K),ot=lt?this.proxyToSource[O.key][lt.id]:[O];if(!ot)continue;const st=ot;m.viewport.set([0,0,X.fb.width,X.fb.height]),J!==(lt?lt.id:null)&&(this._setupStencil(X,ot,K,lt),J=lt?lt.id:null),l.renderLayer(l,lt,K,st)}this.renderedToTile?(X.dirty=!0,A.push(N.tileID)):W||--R,5===R&&(R=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),T.end+1}postRender(){}renderCacheEfficiency(i){const l=i.order.length;if(0===l)return{efficiency:100};let m,y=0,b=0,T=!1;for(let A=0;A<l;++A){const z=i._layers[i.order[A]];this._style.isLayerDraped(z)?(T&&++y,++b):T||(T=!0,m=z.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-y/b),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{i=Math.min(i,l.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,l,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,A=Math.pow(2,T.overscaledZ),{x:z,y:R}=T.canonical,O=z/A,N=(z+1)/A,$=R/A,X=(R+1)/A;return{minx:O,miny:$,maxx:N,maxy:X,t:b.dem.tree.raycastRoot(O,$,N,X,i,l,m),tile:b}});y.sort((b,T)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==T.t?T.t:Number.MAX_VALUE));for(const b of y){if(null==b.t)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,i,l,m);if(null!=T)return T}return null}_createFBO(){const i=this.painter.context,l=i.gl,m=this.drapeBufferSize;i.activeTexture.set(l.TEXTURE0);const y=new u.Texture(i,{width:m[0],height:m[1],data:null},l.RGBA);y.bind(l.LINEAR,l.CLAMP_TO_EDGE);const b=i.createFramebuffer(m[0],m[1],!1);return b.colorAttachment.set(y.texture),b.depthAttachment=new ji(i,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const l=this._style._layers[i],m=l.isHidden(this.painter.transform.zoom),y=l.getCrossfadeParameters(),b=!!y&&1!==y.t,T=l.hasTransition();return"custom"!==l.type&&!m&&(b||T)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof sr){i=!0;break}if(i)for(let l=0;l<this._style.order.length;++l){const m=this._style._layers[this._style.order[l]],y=m.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(m);if("raster"!==m.type||y||!b)continue;const T=m.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const z=this.proxyToSource[A.key][b.id];if(z)for(const R of z){const O=Ls(b.getTile(R),b.findLoadedParent(R,0),b,this.painter.transform,T);(1!==O.opacity||0!==O.mix)&&this._clearRenderCacheForTile(b.id,R)}}}}_setupDrapedRenderBatches(){const i=this._style.order,l=i.length;if(0===l)return;const m=[];let y,b=0,T=this._style._layers[i[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<l;)T=this._style._layers[i[b]];for(;b<l;++b){const A=this._style._layers[i[b]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===y&&(y=b):void 0!==y&&(m.push({start:y,end:b-1}),y=void 0))}void 0!==y&&m.push({start:y,end:b-1}),this._drapedRenderBatches=m}_setupRenderCache(i){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const T=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let A=0;A<T.length;++A){const z=Object.values(T[A]);l.renderCachePool.push(...z)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let T=m.length-1;T>=0;T--){const A=m[T];if(l.getTileByID(A.key),void 0!==l.proxyCachedFBO[A.key]){const z=i[A.key],R=this.proxyToSource[A.key];let O=0;for(const N in R){const $=R[N],X=z[N];if(!X||X.length!==$.length||$.some((W,J)=>W!==X[J]||y[N]&&y[N].hasOwnProperty(W.key))){O=-1;break}++O}for(const N in l.proxyCachedFBO[A.key])l.renderCache[l.proxyCachedFBO[A.key][N]].dirty=O<0||O!==Object.values(z).length}}const b=[...this._drapedRenderBatches];b.sort((T,A)=>A.end-A.start-(T.end-T.start));for(const T of b)for(const A of m){if(l.proxyCachedFBO[A.key])continue;let z=l.renderCachePool.pop();void 0===z&&l.renderCache.length<50&&(z=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==z&&(l.proxyCachedFBO[A.key]={},l.proxyCachedFBO[A.key][T.start]=z,l.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(i,l,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let A;if(m.isTileClipped())A=l.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(i,l){const m=this.painter,y=this.painter.context,b=y.gl;m._tileClippingMaskIDs={},y.setColorMode(u.ColorMode.disabled),y.setDepthMode(u.DepthMode.disabled);const T=m.useProgram("clippingMask");for(const A of i){const z=m._tileClippingMaskIDs[A.key]=--l;T.draw(y,b.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Br(A.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const l=this.painter.transform;if(i.x<0||i.x>l.width||i.y<0||i.y>l.height)return null;const m=[i.x,i.y,1,1];u.transformMat4$1(m,m,l.pixelMatrixInverse),u.scale$1(m,m,1/m[3]),m[0]/=l.worldSize,m[1]/=l.worldSize;const y=l._camera.position,b=u.mercatorZfromAltitude(1,l.center.lat),T=[y[0],y[1],y[2]/b,0],A=u.subtract([],m.slice(0,3),T);u.normalize(A,A);const z=this.raycast(T,A,this._exaggeration);return null!==z&&z?(u.scaleAndAdd(T,T,A,z),T[3]=T[2],T[2]*=b,T):null}drawDepth(){const i=this.painter,l=i.context,m=this.proxySourceCache,y=Math.ceil(i.width),b=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===b||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const T=l.gl,A=l.createFramebuffer(y,b,!0);l.activeTexture.set(T.TEXTURE0);const z=new u.Texture(l,{width:y,height:b,data:null},T.RGBA);z.bind(T.NEAREST,T.CLAMP_TO_EDGE),A.colorAttachment.set(z.texture);const R=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,y,b);A.depthAttachment.set(R),this._depthFBO=A,this._depthTexture=z}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,y,b]),function(T,A,z,R){if("globe"===T.transform.projection.name)return;const O=T.context,N=O.gl;O.clear({depth:1});const $=T.useProgram("terrainDepth"),X=new u.DepthMode(N.LESS,u.DepthMode.ReadWrite,T.depthRangeFor3D);for(const W of R){const J=z.getTile(W),dt=dn(W.projMatrix,0);A.setupElevationDraw(J,$),$.draw(O,N.TRIANGLES,X,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,dt,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(i,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,l,m){if(i.getSource()instanceof Sn)return this._setupProxiedCoordsForImageSource(i,l,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const y=this.proxiedCoords[i.id]=[],b=this.proxyCoords;for(let A=0;A<b.length;A++){const z=b[A],R=this._findTileCoveringTileID(z,i);if(R){const O=this._createProxiedId(z,R,m[z.key]&&m[z.key][i.id]);y.push(O),this.proxyToSource[z.key][i.id]=[O]}}let T=!1;for(let A=0;A<l.length;A++){const z=i.getTile(l[A]);if(!z||!z.hasData())continue;const R=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==z.tileID.canonical.z){const O=this.proxyToSource[R.tileID.key][i.id],N=this._createProxiedId(R.tileID,z,m[R.tileID.key]&&m[R.tileID.key][i.id]);O?O.splice(O.length-1,0,N):this.proxyToSource[R.tileID.key][i.id]=[N],y.push(N),T=!0}}this._sourceTilesOverlap[i.id]=T}_setupProxiedCoordsForImageSource(i,l,m){if(!i.getSource().loaded())return;const y=this.proxiedCoords[i.id]=[],b=this.proxyCoords,T=i.getSource(),A=new u.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),z=T.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((O,N)=>(O.min.x=Math.min(O.min.x,N.x-A.x),O.min.y=Math.min(O.min.y,N.y-A.y),O.max.x=Math.max(O.max.x,N.x-A.x),O.max.y=Math.max(O.max.y,N.y-A.y),O),{min:new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(O,N)=>{const $=O.wrap+O.canonical.x/(1<<O.canonical.z),X=O.canonical.y/(1<<O.canonical.z),W=u.EXTENT/(1<<O.canonical.z),J=N.wrap+N.canonical.x/(1<<N.canonical.z),dt=N.canonical.y/(1<<N.canonical.z);return $+W<J+z.min.x||$>J+z.max.x||X+W<dt+z.min.y||X>dt+z.max.y};for(let O=0;O<b.length;O++){const N=b[O];for(let $=0;$<l.length;$++){const X=i.getTile(l[$]);if(!X||!X.hasData()||R(N,X.tileID))continue;const W=this._createProxiedId(N,X,m[N.key]&&m[N.key][i.id]),J=this.proxyToSource[N.key][i.id];J?J.push(W):this.proxyToSource[N.key][i.id]=[W],y.push(W)}}}_createProxiedId(i,l,m){let y=this.orthoMatrix;if(m){const b=m.find(T=>T.key===l.tileID.key);if(b)return b}if(l.tileID.key!==i.key){const b=i.canonical.z-l.tileID.canonical.z;let T,A,z;y=u.create();const R=l.tileID.wrap-i.wrap<<i.overscaledZ;b>0?(T=u.EXTENT>>b,A=T*((l.tileID.canonical.x<<b)-i.canonical.x+R),z=T*((l.tileID.canonical.y<<b)-i.canonical.y)):(T=u.EXTENT<<-b,A=u.EXTENT*(l.tileID.canonical.x-(i.canonical.x+R<<-b)),z=u.EXTENT*(l.tileID.canonical.y-(i.canonical.y<<-b))),u.ortho(y,0,T,0,T,0,1),u.translate(y,y,[A,z,0])}return new Fa(l.tileID,i.key,y)}_findTileCoveringTileID(i,l){let m=l.getTile(i);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[l.id],b=y[i.key];if(m=b?l.getTileByID(b):null,m&&m.hasData()||null===b)return m;let T=m?m.tileID:i,A=T.overscaledZ;const z=l.getSource().minzoom,R=[];if(!b){const N=l.getSource().maxzoom;if(i.canonical.z>=N){const $=i.canonical.z-N;l.getSource().reparseOverscaled?(A=Math.max(i.canonical.z+2,l.transform.tileZoom),T=new u.OverscaledTileID(A,i.wrap,N,i.canonical.x>>$,i.canonical.y>>$)):0!==$&&(A=N,T=new u.OverscaledTileID(A,i.wrap,N,i.canonical.x>>$,i.canonical.y>>$))}T.key!==i.key&&(R.push(T.key),m=l.getTile(T))}const O=N=>{R.forEach($=>{y[$]=N}),R.length=0};for(A-=1;A>=z&&(!m||!m.hasData());A--){m&&O(m.tileID.key);const N=T.calculateScaledKey(A);if(m=l.getTileByID(N),m&&m.hasData())break;const $=y[N];if(null===$)break;void 0===$?R.push(N):m=l.getTileByID($)}return O(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(i){this.renderedToTile=!0}_clearRenderCacheForTile(i,l){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(l){let m,y,b;const T=new u.StructArrayLayout2ui4,A=131;for(y=1;y<129;y++){for(m=1;m<129;m++)b=y*A+m,T.emplaceBack(b,b+1),T.emplaceBack(b,b+A),T.emplaceBack(b+1,b+A),128===y&&T.emplaceBack(b+A,b+A+1);T.emplaceBack(b+1,b+1+A)}return T}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function zo(p){const i=[];for(let l=0;l<p.length;l++){if(null===p[l])continue;const m=p[l].split(" ");i.push(m.pop())}return i}class ds{static cacheKey(i,l,m){let y=`${i}${m?m.cacheKey:""}`;for(const b of l)y+=`/${b}`;return y}constructor(i,l,m,y,b,T){const A=i.gl;this.program=A.createProgram();const z=zo(m.staticAttributes),R=y?y.getBinderAttributes():[],O=z.concat(R),N=m.staticUniforms?zo(m.staticUniforms):[],$=y?y.getBinderUniforms():[],X=N.concat($),W=[];for(const at of X)W.indexOf(at)<0&&W.push(at);let J=y?y.defines():[];J=J.concat(T.map(at=>`#define ${at}`));const dt=J.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",oa,fi.fragmentSource,Rs.fragmentSource,m.fragmentSource).join("\n"),K=J.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",oa,fi.vertexSource,Rs.vertexSource,wr.vertexSource,m.vertexSource).join("\n"),lt=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(lt,dt),A.compileShader(lt),A.attachShader(this.program,lt);const ot=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ot,K),A.compileShader(ot),A.attachShader(this.program,ot),this.attributes={};const st={};this.numAttributes=O.length;for(let at=0;at<this.numAttributes;at++)O[at]&&(A.bindAttribLocation(this.program,at,O[at]),this.attributes[O[at]]=at);A.linkProgram(this.program),A.deleteShader(ot),A.deleteShader(lt);for(let at=0;at<W.length;at++){const pt=W[at];if(pt&&!st[pt]){const At=A.getUniformLocation(this.program,pt);At&&(st[pt]=At)}}var at,pt;this.fixedUniforms=b(i,st),this.binderUniforms=y?y.getUniforms(i,st):[],-1!==T.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(at=i,(pt=st).u_dem),u_dem_prev:new u.Uniform1i(at,pt.u_dem_prev),u_dem_unpack:new u.Uniform4f(at,pt.u_dem_unpack),u_dem_tl:new u.Uniform2f(at,pt.u_dem_tl),u_dem_scale:new u.Uniform1f(at,pt.u_dem_scale),u_dem_tl_prev:new u.Uniform2f(at,pt.u_dem_tl_prev),u_dem_scale_prev:new u.Uniform1f(at,pt.u_dem_scale_prev),u_dem_size:new u.Uniform1f(at,pt.u_dem_size),u_dem_lerp:new u.Uniform1f(at,pt.u_dem_lerp),u_exaggeration:new u.Uniform1f(at,pt.u_exaggeration),u_depth:new u.Uniform1i(at,pt.u_depth),u_depth_size_inv:new u.Uniform2f(at,pt.u_depth_size_inv),u_meter_to_dem:new u.Uniform1f(at,pt.u_meter_to_dem),u_label_plane_matrix_inv:new u.UniformMatrix4f(at,pt.u_label_plane_matrix_inv),u_tile_tl_up:new u.Uniform3f(at,pt.u_tile_tl_up),u_tile_tr_up:new u.Uniform3f(at,pt.u_tile_tr_up),u_tile_br_up:new u.Uniform3f(at,pt.u_tile_br_up),u_tile_bl_up:new u.Uniform3f(at,pt.u_tile_bl_up),u_tile_up_scale:new u.Uniform1f(at,pt.u_tile_up_scale)}),-1!==T.indexOf("FOG")&&(this.fogUniforms=((at,pt)=>({u_fog_matrix:new u.UniformMatrix4f(at,pt.u_fog_matrix),u_fog_range:new u.Uniform2f(at,pt.u_fog_range),u_fog_color:new u.Uniform4f(at,pt.u_fog_color),u_fog_horizon_blend:new u.Uniform1f(at,pt.u_fog_horizon_blend),u_fog_temporal_offset:new u.Uniform1f(at,pt.u_fog_temporal_offset)}))(i,st))}setTerrainUniformValues(i,l){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const y in l)m[y].set(l[y])}}setFogUniformValues(i,l){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const y in l)m[y].location&&m[y].set(l[y])}}draw(i,l,m,y,b,T,A,z,R,O,N,$,X,W,J,dt){const K=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(y),i.setColorMode(b),i.setCullFace(T);for(const ot of Object.keys(this.fixedUniforms))this.fixedUniforms[ot].set(A[ot]);W&&W.setUniforms(i,this.binderUniforms,$,{zoom:X});const lt={[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[l];for(const ot of N.get()){const st=ot.vaos||(ot.vaos={});(st[z]||(st[z]=new cr)).bind(i,this,R,W?W.getPaintVertexBuffers():[],O,ot.vertexOffset,J,dt),K.drawElements(l,ot.primitiveLength*lt,K.UNSIGNED_SHORT,ot.primitiveOffset*lt*2)}}}function Tc(p,i,l){const m=1/fn(l,1,i.transform.tileZoom),y=Math.pow(2,l.tileID.overscaledZ),b=l.tileSize*Math.pow(2,i.transform.tileZoom)/y,T=b*(l.tileID.canonical.x+l.tileID.wrap*y),A=b*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[m,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[T>>16,A>>16],u_pixel_coord_lower:[65535&T,65535&A]}}const Cc=(p,i,l,m)=>{const y=i.style.light,b=y.properties.get("position"),T=[b.x,b.y,b.z],A=u.create$1();"viewport"===y.properties.get("anchor")&&(u.fromRotation(A,-i.transform.angle),u.transformMat3(T,T,A));const z=y.properties.get("color");return{u_matrix:p,u_lightpos:T,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+l,u_opacity:m}},Ro=(p,i,l,m,y,b,T)=>u.extend(Cc(p,i,l,m),Tc(b,i,T),{u_height_factor:-Math.pow(2,y.overscaledZ)/T.tileSize/8}),Lo=p=>({u_matrix:p}),la=(p,i,l,m)=>u.extend(Lo(p),Tc(l,i,m)),Oo=(p,i)=>({u_matrix:p,u_world:i}),Sc=(p,i,l,m,y)=>u.extend(la(p,i,l,m),{u_world:y}),Gh=(p,i,l,m)=>{const y=p.transform;let b;return b="map"===m.paint.get("circle-pitch-alignment")?y.calculatePixelsToTileUnitsMatrix(l):new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]),{u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:p.translatePosMatrix(i.projMatrix,l,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:b}},Hr=p=>{const i=[];return"map"===p.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},Ac=(p,i,l)=>{const m=u.EXTENT/l.tileSize;return{u_matrix:p,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/m,i.pixelsToGLUnits[1]/m]}},zl=(p,i,l=1)=>({u_matrix:p,u_color:i,u_overlay:0,u_overlay_scale:l}),Rl=(p,i,l,m)=>({u_matrix:p,u_extrude_scale:fn(i,1,l),u_intensity:m}),Ec=(p,i,l,m,y,b)=>{const T=p.transform,A=T.calculatePixelsToTileUnitsMatrix(i),z={u_matrix:ha(p,i,l,y),u_pixels_to_tile_units:A,u_device_pixel_ratio:u.exported.devicePixelRatio,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Ba(l)){const R=ca(i,p.transform);z.u_texsize=i.lineAtlasTexture.size,z.u_scale=[R,m.fromScale,m.toScale],z.u_mix=m.t}return z},qr=(p,i,l,m,y)=>{const b=p.transform,T=ca(i,b);return{u_matrix:ha(p,i,l,y),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:u.exported.devicePixelRatio,u_image:0,u_scale:[T,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ca(p,i){return 1/fn(p,1,i.tileZoom)}function ha(p,i,l,m){return p.translatePosMatrix(m||i.tileID.projMatrix,i,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Ba(p){const i=p.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const Va=(p,i,l,m,y,b)=>{return{u_matrix:p,u_tl_parent:i,u_scale_parent:l,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(A=y.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(T=y.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Vr(y.paint.get("raster-hue-rotate")),u_perspective_transform:b};var T,A};function Vr(p){p*=Math.PI/180;const i=Math.sin(p),l=Math.cos(p);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}const Fo=(p,i,l,m,y,b,T,A,z,R,O,N,$,X)=>{const W=y.transform;return{u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:W.cameraToCenterDistance,u_pitch:W.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:W.width/W.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:A,u_is_text:+z,u_pitch_with_map:+m,u_texsize:R,u_tile_id:O,u_zoom_transition:N,u_inv_rot_matrix:$,u_merc_center:X,u_texture:0}},Ua=(p,i,l,m,y,b,T,A,z,R,O,N,$,X,W)=>{const{cameraToCenterDistance:J,_pitch:dt}=y.transform;return u.extend(Fo(p,i,l,m,y,b,T,A,z,R,N,$,X,W),{u_gamma_scale:m?J*Math.cos(y.terrain?0:dt):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+O})},ua=(p,i,l,m,y,b,T,A,z,R,O,N,$,X)=>u.extend(Ua(p,i,l,m,y,b,T,A,!0,z,!0,O,N,$,X),{u_texsize_icon:R,u_texture_icon:1}),xi=(p,i,l)=>({u_matrix:p,u_opacity:i,u_color:l}),ps=(p,i,l,m,y,b)=>u.extend(function(T,A,z,R){const O=z.imageManager.getPattern(T.from.toString()),N=z.imageManager.getPattern(T.to.toString()),{width:$,height:X}=z.imageManager.getPixelSize(),W=Math.pow(2,R.tileID.overscaledZ),J=R.tileSize*Math.pow(2,z.transform.tileZoom)/W,dt=J*(R.tileID.canonical.x+R.tileID.wrap*W),K=J*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[$,X],u_mix:A.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/fn(R,1,z.transform.tileZoom),u_pixel_coord_upper:[dt>>16,K>>16],u_pixel_coord_lower:[65535&dt,65535&K]}}(m,b,l,y),{u_matrix:p,u_opacity:i}),kc={fillExtrusion:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_lightpos:new u.Uniform3f(p,i.u_lightpos),u_lightintensity:new u.Uniform1f(p,i.u_lightintensity),u_lightcolor:new u.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new u.Uniform1f(p,i.u_vertical_gradient),u_opacity:new u.Uniform1f(p,i.u_opacity)}),fillExtrusionPattern:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_lightpos:new u.Uniform3f(p,i.u_lightpos),u_lightintensity:new u.Uniform1f(p,i.u_lightintensity),u_lightcolor:new u.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new u.Uniform1f(p,i.u_vertical_gradient),u_height_factor:new u.Uniform1f(p,i.u_height_factor),u_image:new u.Uniform1i(p,i.u_image),u_texsize:new u.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new u.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new u.Uniform3f(p,i.u_scale),u_fade:new u.Uniform1f(p,i.u_fade),u_opacity:new u.Uniform1f(p,i.u_opacity)}),fill:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix)}),fillPattern:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_image:new u.Uniform1i(p,i.u_image),u_texsize:new u.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new u.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new u.Uniform3f(p,i.u_scale),u_fade:new u.Uniform1f(p,i.u_fade)}),fillOutline:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_world:new u.Uniform2f(p,i.u_world)}),fillOutlinePattern:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_world:new u.Uniform2f(p,i.u_world),u_image:new u.Uniform1i(p,i.u_image),u_texsize:new u.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new u.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new u.Uniform3f(p,i.u_scale),u_fade:new u.Uniform1f(p,i.u_fade)}),circle:(p,i)=>({u_camera_to_center_distance:new u.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new u.UniformMatrix2f(p,i.u_extrude_scale),u_device_pixel_ratio:new u.Uniform1f(p,i.u_device_pixel_ratio),u_matrix:new u.UniformMatrix4f(p,i.u_matrix)}),collisionBox:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_camera_to_center_distance:new u.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new u.Uniform2f(p,i.u_extrude_scale)}),collisionCircle:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_inv_matrix:new u.UniformMatrix4f(p,i.u_inv_matrix),u_camera_to_center_distance:new u.Uniform1f(p,i.u_camera_to_center_distance),u_viewport_size:new u.Uniform2f(p,i.u_viewport_size)}),debug:(p,i)=>({u_color:new u.UniformColor(p,i.u_color),u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_overlay:new u.Uniform1i(p,i.u_overlay),u_overlay_scale:new u.Uniform1f(p,i.u_overlay_scale)}),clippingMask:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix)}),heatmap:(p,i)=>({u_extrude_scale:new u.Uniform1f(p,i.u_extrude_scale),u_intensity:new u.Uniform1f(p,i.u_intensity),u_matrix:new u.UniformMatrix4f(p,i.u_matrix)}),heatmapTexture:(p,i)=>({u_image:new u.Uniform1i(p,i.u_image),u_color_ramp:new u.Uniform1i(p,i.u_color_ramp),u_opacity:new u.Uniform1f(p,i.u_opacity)}),hillshade:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_image:new u.Uniform1i(p,i.u_image),u_latrange:new u.Uniform2f(p,i.u_latrange),u_light:new u.Uniform2f(p,i.u_light),u_shadow:new u.UniformColor(p,i.u_shadow),u_highlight:new u.UniformColor(p,i.u_highlight),u_accent:new u.UniformColor(p,i.u_accent)}),hillshadePrepare:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_image:new u.Uniform1i(p,i.u_image),u_dimension:new u.Uniform2f(p,i.u_dimension),u_zoom:new u.Uniform1f(p,i.u_zoom),u_unpack:new u.Uniform4f(p,i.u_unpack)}),line:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_pixels_to_tile_units:new u.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new u.Uniform1f(p,i.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(p,i.u_units_to_pixels),u_dash_image:new u.Uniform1i(p,i.u_dash_image),u_gradient_image:new u.Uniform1i(p,i.u_gradient_image),u_image_height:new u.Uniform1f(p,i.u_image_height),u_texsize:new u.Uniform2f(p,i.u_texsize),u_scale:new u.Uniform3f(p,i.u_scale),u_mix:new u.Uniform1f(p,i.u_mix),u_alpha_discard_threshold:new u.Uniform1f(p,i.u_alpha_discard_threshold)}),linePattern:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_texsize:new u.Uniform2f(p,i.u_texsize),u_pixels_to_tile_units:new u.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new u.Uniform1f(p,i.u_device_pixel_ratio),u_image:new u.Uniform1i(p,i.u_image),u_units_to_pixels:new u.Uniform2f(p,i.u_units_to_pixels),u_scale:new u.Uniform3f(p,i.u_scale),u_fade:new u.Uniform1f(p,i.u_fade),u_alpha_discard_threshold:new u.Uniform1f(p,i.u_alpha_discard_threshold)}),raster:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_tl_parent:new u.Uniform2f(p,i.u_tl_parent),u_scale_parent:new u.Uniform1f(p,i.u_scale_parent),u_fade_t:new u.Uniform1f(p,i.u_fade_t),u_opacity:new u.Uniform1f(p,i.u_opacity),u_image0:new u.Uniform1i(p,i.u_image0),u_image1:new u.Uniform1i(p,i.u_image1),u_brightness_low:new u.Uniform1f(p,i.u_brightness_low),u_brightness_high:new u.Uniform1f(p,i.u_brightness_high),u_saturation_factor:new u.Uniform1f(p,i.u_saturation_factor),u_contrast_factor:new u.Uniform1f(p,i.u_contrast_factor),u_spin_weights:new u.Uniform3f(p,i.u_spin_weights),u_perspective_transform:new u.Uniform2f(p,i.u_perspective_transform)}),symbolIcon:(p,i)=>({u_is_size_zoom_constant:new u.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new u.Uniform1f(p,i.u_size_t),u_size:new u.Uniform1f(p,i.u_size),u_camera_to_center_distance:new u.Uniform1f(p,i.u_camera_to_center_distance),u_pitch:new u.Uniform1f(p,i.u_pitch),u_rotate_symbol:new u.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new u.Uniform1f(p,i.u_fade_change),u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new u.Uniform1i(p,i.u_is_text),u_pitch_with_map:new u.Uniform1i(p,i.u_pitch_with_map),u_texsize:new u.Uniform2f(p,i.u_texsize),u_tile_id:new u.Uniform3f(p,i.u_tile_id),u_zoom_transition:new u.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new u.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(p,i.u_merc_center),u_texture:new u.Uniform1i(p,i.u_texture)}),symbolSDF:(p,i)=>({u_is_size_zoom_constant:new u.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new u.Uniform1f(p,i.u_size_t),u_size:new u.Uniform1f(p,i.u_size),u_camera_to_center_distance:new u.Uniform1f(p,i.u_camera_to_center_distance),u_pitch:new u.Uniform1f(p,i.u_pitch),u_rotate_symbol:new u.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new u.Uniform1f(p,i.u_fade_change),u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new u.Uniform1i(p,i.u_is_text),u_pitch_with_map:new u.Uniform1i(p,i.u_pitch_with_map),u_texsize:new u.Uniform2f(p,i.u_texsize),u_texture:new u.Uniform1i(p,i.u_texture),u_gamma_scale:new u.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(p,i.u_device_pixel_ratio),u_tile_id:new u.Uniform3f(p,i.u_tile_id),u_zoom_transition:new u.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new u.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(p,i.u_merc_center),u_is_halo:new u.Uniform1i(p,i.u_is_halo)}),symbolTextAndIcon:(p,i)=>({u_is_size_zoom_constant:new u.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new u.Uniform1f(p,i.u_size_t),u_size:new u.Uniform1f(p,i.u_size),u_camera_to_center_distance:new u.Uniform1f(p,i.u_camera_to_center_distance),u_pitch:new u.Uniform1f(p,i.u_pitch),u_rotate_symbol:new u.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new u.Uniform1f(p,i.u_fade_change),u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new u.Uniform1i(p,i.u_is_text),u_pitch_with_map:new u.Uniform1i(p,i.u_pitch_with_map),u_texsize:new u.Uniform2f(p,i.u_texsize),u_texsize_icon:new u.Uniform2f(p,i.u_texsize_icon),u_texture:new u.Uniform1i(p,i.u_texture),u_texture_icon:new u.Uniform1i(p,i.u_texture_icon),u_gamma_scale:new u.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(p,i.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(p,i.u_is_halo)}),background:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_opacity:new u.Uniform1f(p,i.u_opacity),u_color:new u.UniformColor(p,i.u_color)}),backgroundPattern:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_opacity:new u.Uniform1f(p,i.u_opacity),u_image:new u.Uniform1i(p,i.u_image),u_pattern_tl_a:new u.Uniform2f(p,i.u_pattern_tl_a),u_pattern_br_a:new u.Uniform2f(p,i.u_pattern_br_a),u_pattern_tl_b:new u.Uniform2f(p,i.u_pattern_tl_b),u_pattern_br_b:new u.Uniform2f(p,i.u_pattern_br_b),u_texsize:new u.Uniform2f(p,i.u_texsize),u_mix:new u.Uniform1f(p,i.u_mix),u_pattern_size_a:new u.Uniform2f(p,i.u_pattern_size_a),u_pattern_size_b:new u.Uniform2f(p,i.u_pattern_size_b),u_scale_a:new u.Uniform1f(p,i.u_scale_a),u_scale_b:new u.Uniform1f(p,i.u_scale_b),u_pixel_coord_upper:new u.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(p,i.u_pixel_coord_lower),u_tile_units_to_pixels:new u.Uniform1f(p,i.u_tile_units_to_pixels)}),terrainRaster:Fr,terrainDepth:Fr,skybox:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_sun_direction:new u.Uniform3f(p,i.u_sun_direction),u_cubemap:new u.Uniform1i(p,i.u_cubemap),u_opacity:new u.Uniform1f(p,i.u_opacity),u_temporal_offset:new u.Uniform1f(p,i.u_temporal_offset)}),skyboxGradient:(p,i)=>({u_matrix:new u.UniformMatrix4f(p,i.u_matrix),u_color_ramp:new u.Uniform1i(p,i.u_color_ramp),u_center_direction:new u.Uniform3f(p,i.u_center_direction),u_radius:new u.Uniform1f(p,i.u_radius),u_opacity:new u.Uniform1f(p,i.u_opacity),u_temporal_offset:new u.Uniform1f(p,i.u_temporal_offset)}),skyboxCapture:(p,i)=>({u_matrix_3f:new u.UniformMatrix3f(p,i.u_matrix_3f),u_sun_direction:new u.Uniform3f(p,i.u_sun_direction),u_sun_intensity:new u.Uniform1f(p,i.u_sun_intensity),u_color_tint_r:new u.Uniform4f(p,i.u_color_tint_r),u_color_tint_m:new u.Uniform4f(p,i.u_color_tint_m),u_luminance:new u.Uniform1f(p,i.u_luminance)}),globeRaster:(p,i)=>({u_proj_matrix:new u.UniformMatrix4f(p,i.u_proj_matrix),u_globe_matrix:new u.UniformMatrix4f(p,i.u_globe_matrix),u_merc_matrix:new u.UniformMatrix4f(p,i.u_merc_matrix),u_zoom_transition:new u.Uniform1f(p,i.u_zoom_transition),u_merc_center:new u.Uniform2f(p,i.u_merc_center),u_image0:new u.Uniform1i(p,i.u_image0)}),globeAtmosphere:(p,i)=>({u_center:new u.Uniform2f(p,i.u_center),u_radius:new u.Uniform1f(p,i.u_radius),u_screen_size:new u.Uniform2f(p,i.u_screen_size),u_pixel_ratio:new u.Uniform1f(p,i.u_pixel_ratio),u_opacity:new u.Uniform1f(p,i.u_opacity),u_fadeout_range:new u.Uniform1f(p,i.u_fadeout_range),u_start_color:new u.Uniform3f(p,i.u_start_color),u_end_color:new u.Uniform3f(p,i.u_end_color)})};let Na;function fs(p,i,l,m,y,b,T){const A=p.context,z=A.gl,R=p.useProgram("collisionBox"),O=[];let N=0,$=0;for(let ot=0;ot<m.length;ot++){const st=m[ot],at=i.getTile(st),pt=at.getBucket(l);if(!pt)continue;let At=st.projMatrix;0===y[0]&&0===y[1]||(At=p.translatePosMatrix(st.projMatrix,at,y,b));const It=T?pt.textCollisionBox:pt.iconCollisionBox,ee=pt.collisionCircleArray;if(ee.length>0){const qt=u.create(),Yt=At;u.mul(qt,pt.placementInvProjMatrix,p.transform.glCoordMatrix),u.mul(qt,qt,pt.placementViewportMatrix),O.push({circleArray:ee,circleOffset:$,transform:Yt,invTransform:qt}),N+=ee.length/4,$=N}It&&(p.terrain&&p.terrain.setupElevationDraw(at,R),R.draw(A,z.LINES,u.DepthMode.disabled,u.StencilMode.disabled,p.colorModeForRenderPass(),u.CullFaceMode.disabled,Ac(At,p.transform,at),l.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,null,p.transform.zoom,null,It.collisionVertexBuffer,It.collisionVertexBufferExt))}if(!T||!O.length)return;const X=p.useProgram("collisionCircle"),W=new u.StructArrayLayout2f1f2i16;W.resize(4*N),W._trim();let J=0;for(const ot of O)for(let st=0;st<ot.circleArray.length/4;st++){const at=4*st,pt=ot.circleArray[at+0],At=ot.circleArray[at+1],It=ot.circleArray[at+2],ee=ot.circleArray[at+3];W.emplace(J++,pt,At,It,ee,0),W.emplace(J++,pt,At,It,ee,1),W.emplace(J++,pt,At,It,ee,2),W.emplace(J++,pt,At,It,ee,3)}(!Na||Na.length<2*N)&&(Na=function(ot){const st=2*ot,at=new u.StructArrayLayout3ui6;at.resize(st),at._trim();for(let pt=0;pt<st;pt++){const At=6*pt;at.uint16[At+0]=4*pt+0,at.uint16[At+1]=4*pt+1,at.uint16[At+2]=4*pt+2,at.uint16[At+3]=4*pt+2,at.uint16[At+4]=4*pt+3,at.uint16[At+5]=4*pt+0}return at}(N));const dt=A.createIndexBuffer(Na,!0),K=A.createVertexBuffer(W,u.collisionCircleLayout.members,!0);for(const ot of O){const st={u_matrix:ot.transform,u_inv_matrix:ot.invTransform,u_camera_to_center_distance:(lt=p.transform).cameraToCenterDistance,u_viewport_size:[lt.width,lt.height]};X.draw(A,z.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,p.colorModeForRenderPass(),u.CullFaceMode.disabled,st,l.id,K,dt,u.SegmentVector.simpleSegment(0,2*ot.circleOffset,ot.circleArray.length,ot.circleArray.length/2),null,p.transform.zoom,null,null,null)}var lt;K.destroy(),dt.destroy()}const ja=u.identity(new Float32Array(16));function Ll(p,i,l,m,y,b){const{horizontalAlign:T,verticalAlign:A}=u.getAnchorAlignment(p),z=-(T-.5)*i,R=-(A-.5)*l,O=u.evaluateVariableOffset(p,m);return new u.pointGeometry((z/y+O[0])*b,(R/y+O[1])*b)}function Dc(p,i,l,m,y,b,T,A,z,R,O,N){const $=p.text.placedSymbolArray,X=p.text.dynamicLayoutVertexArray,W=p.icon.dynamicLayoutVertexArray,J={},dt=A.projMatrix,K=b.elevation,lt=K?K.getAtTileOffsetFunc(A,N):ot=>[0,0,0];X.clear();for(let ot=0;ot<$.length;ot++){const st=$.get(ot),at=p.allowVerticalPlacement&&!st.placedOrientation,pt=st.hidden||!st.crossTileID||at?null:m[st.crossTileID];if(pt){const At=new u.pointGeometry(st.tileAnchorX,st.tileAnchorY),It=lt(At),ee=kt(At,l?dt:T,It[2]),qt=E(b.cameraToCenterDistance,ee.signedDistanceFromCamera);let Yt=y.evaluateSizeForFeature(p.textSizeData,R,st)*qt/u.ONE_EM;l&&(Yt*=p.tilePixelRatio/z);const{width:Lt,height:Dt,anchor:Zt,textOffset:Ut,textScale:xe}=pt,Ae=Ll(Zt,Lt,Dt,Ut,xe,Yt),Qe=l?kt(At.add(Ae),T,It[2]).point:ee.point.add(i?Ae.rotate(-b.angle):Ae),te=p.allowVerticalPlacement&&st.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let Pe=0;Pe<st.numGlyphs;Pe++)u.addDynamicAttributes(X,Qe,te);O&&st.associatedIconIndex>=0&&(J[st.associatedIconIndex]={shiftedAnchor:Qe,angle:te})}else un(st.numGlyphs,X)}if(O){W.clear();const ot=p.icon.placedSymbolArray;for(let st=0;st<ot.length;st++){const at=ot.get(st);if(at.hidden)un(at.numGlyphs,W);else{const pt=J[st];if(pt)for(let At=0;At<at.numGlyphs;At++)u.addDynamicAttributes(W,pt.shiftedAnchor,pt.angle);else un(at.numGlyphs,W)}}p.icon.dynamicLayoutVertexBuffer.updateData(W)}p.text.dynamicLayoutVertexBuffer.updateData(X)}function Ic(p,i,l){return l.iconsInText&&i?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Bo(p,i,l,m,y,b,T,A,z,R,O,N){const $=p.context,X=$.gl,W=p.transform,J=W.projection.createTileTransform(W,W.worldSize),dt="map"===A,K="map"===z,lt=dt&&"point"!==l.layout.get("symbol-placement"),ot=dt&&!K&&!lt,st=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let at=!1;const pt=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),At=[u.mercatorXfromLng(W.center.lng),u.mercatorYfromLat(W.center.lat)],It=l.layout.get("text-variable-anchor"),ee="globe"===W.projection.name,qt=ee?u.globeToMercatorTransition(W.zoom):0,Yt=[],Lt=[];p.terrain&&K&&Lt.push("PITCH_WITH_MAP_TERRAIN"),ee&&Lt.push("PROJECTION_GLOBE_VIEW"),lt&&Lt.push("PROJECTED_POS_ON_VIEWPORT");for(const Dt of m){const Zt=i.getTile(Dt),Ut=Zt.getBucket(l);if(!Ut||Ut.projection!==W.projection.name)continue;const xe=y?Ut.text:Ut.icon;if(!xe||Ut.fullyClipped||!xe.segments.get().length)continue;const Ae=xe.programConfigurations.get(l.id),Qe=y||Ut.sdfIcons,te=y?Ut.textSizeData:Ut.iconSizeData,Pe=K||0!==W.pitch,$e=p.useProgram(Ic(Qe,y,Ut),Ae,Lt),si=u.evaluateSizeForZoom(te,W.zoom),ki=[Dt.canonical.x,Dt.canonical.y,1<<Dt.canonical.z];let Ge,ti,Bi,cn,Dn=[0,0],fr=null;if(y){if(ti=Zt.glyphAtlasTexture,Bi=X.LINEAR,Ge=Zt.glyphAtlasTexture.size,Ut.iconsInText){Dn=Zt.imageAtlasTexture.size,fr=Zt.imageAtlasTexture;const _n="composite"===te.kind||"camera"===te.kind;cn=Pe||p.options.rotating||p.options.zooming||_n?X.LINEAR:X.NEAREST}}else{const _n=1!==l.layout.get("icon-size").constantOr(0)||Ut.iconsNeedLinear;ti=Zt.imageAtlasTexture,Bi=Qe||p.options.rotating||p.options.zooming||_n||Pe?X.LINEAR:X.NEAREST,Ge=Zt.imageAtlasTexture.size}const Ar=p.transform.calculatePixelsToTileUnitsMatrix(Zt),hi=Jn(Dt.projMatrix,Zt.tileID.canonical,K,dt,p.transform,Ar),Ze=p.terrain&&K&&lt?u.invert(new Float32Array(16),hi):ja,li=ht(Dt.projMatrix,Zt.tileID.canonical,K,dt,p.transform,Ar),qi=It&&Ut.hasTextData(),Zn="none"!==l.layout.get("icon-text-fit")&&qi&&Ut.hasIconData();if(lt){const _n=W.elevation,js=_n?_n.getAtTileOffsetFunc(Dt,J):vs=>[0,0,0];it(Ut,Dt.projMatrix,p,y,hi,li,K,R,js,Dt)}const Oi=p.translatePosMatrix(Dt.projMatrix,Zt,b,T),$n=lt||y&&It||Zn?ja:hi,ya=p.translatePosMatrix(li,Zt,b,T,!0),bn=Qe&&0!==l.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let Er;const ve=J.createInversionMatrix(Dt.toUnwrapped());Er=Qe?Ut.iconsInText?ua(te.kind,si,ot,K,p,Oi,$n,ya,Ge,Dn,ki,qt,ve,At):Ua(te.kind,si,ot,K,p,Oi,$n,ya,y,Ge,!0,ki,qt,ve,At):Fo(te.kind,si,ot,K,p,Oi,$n,ya,y,Ge,ki,qt,ve,At);const Ee={program:$e,buffers:xe,uniformValues:Er,atlasTexture:ti,atlasTextureIcon:fr,atlasInterpolation:Bi,atlasInterpolationIcon:cn,isSDF:Qe,hasHalo:bn,tile:Zt,labelPlaneMatrixInv:Ze};if(st&&Ut.canOverlap){at=!0;const _n=xe.segments.get();for(const js of _n)Yt.push({segments:new u.SegmentVector([js]),sortKey:js.sortKey,state:Ee})}else Yt.push({segments:xe.segments,sortKey:0,state:Ee})}at&&Yt.sort((Dt,Zt)=>Dt.sortKey-Zt.sortKey);for(const Dt of Yt){const Zt=Dt.state;if(p.terrain&&p.terrain.setupElevationDraw(Zt.tile,Zt.program,{useDepthForOcclusion:!ee,labelPlaneMatrixInv:Zt.labelPlaneMatrixInv}),$.activeTexture.set(X.TEXTURE0),Zt.atlasTexture.bind(Zt.atlasInterpolation,X.CLAMP_TO_EDGE),Zt.atlasTextureIcon&&($.activeTexture.set(X.TEXTURE1),Zt.atlasTextureIcon&&Zt.atlasTextureIcon.bind(Zt.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Zt.isSDF){const Ut=Zt.uniformValues;Zt.hasHalo&&(Ut.u_is_halo=1,Ga(Zt.buffers,Dt.segments,l,p,Zt.program,pt,O,N,Ut)),Ut.u_is_halo=0}Ga(Zt.buffers,Dt.segments,l,p,Zt.program,pt,O,N,Zt.uniformValues)}}function Ga(p,i,l,m,y,b,T,A,z){const R=m.context;y.draw(R,R.gl.TRIANGLES,b,T,A,u.CullFaceMode.disabled,z,l.id,p.layoutVertexBuffer,p.indexBuffer,i,l.paint,m.transform.zoom,p.programConfigurations.get(l.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Za(p,i,l,m,y,b,T){const A=p.context.gl,z=l.paint.get("fill-pattern"),R=z&&z.constantOr(1),O=l.getCrossfadeParameters();let N,$,X,W,J;T?($=R&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=A.LINES):($=R?"fillPattern":"fill",N=A.TRIANGLES);for(const dt of m){const K=i.getTile(dt);if(R&&!K.patternsLoaded())continue;const lt=K.getBucket(l);if(!lt)continue;p.prepareDrawTile(dt);const ot=lt.programConfigurations.get(l.id),st=p.useProgram($,ot);R&&(p.context.activeTexture.set(A.TEXTURE0),K.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ot.updatePaintBuffers(O));const at=z.constantOr(null);if(at&&K.imageAtlas){const At=K.imageAtlas,It=At.patternPositions[at.to.toString()],ee=At.patternPositions[at.from.toString()];It&&ee&&ot.setConstantPatternPositions(It,ee)}const pt=p.translatePosMatrix(dt.projMatrix,K,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){W=lt.indexBuffer2,J=lt.segments2;const At=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];X="fillOutlinePattern"===$&&R?Sc(pt,p,O,K,At):Oo(pt,At)}else W=lt.indexBuffer,J=lt.segments,X=R?la(pt,p,O,K):Lo(pt);p.prepareDrawProgram(p.context,st,dt.toUnwrapped()),st.draw(p.context,N,y,p.stencilModeForClipping(dt),b,u.CullFaceMode.disabled,X,l.id,lt.layoutVertexBuffer,W,J,l.paint,p.transform.zoom,ot)}}function $a(p,i,l,m,y,b,T){const A=p.context,z=A.gl,R=l.paint.get("fill-extrusion-pattern"),O=R.constantOr(1),N=l.getCrossfadeParameters(),$=l.paint.get("fill-extrusion-opacity");for(const X of m){const W=i.getTile(X),J=W.getBucket(l);if(!J)continue;const dt=J.programConfigurations.get(l.id),K=p.useProgram(O?"fillExtrusionPattern":"fillExtrusion",dt);if(p.terrain){const pt=p.terrain;if(!J.enableTerrain)continue;if(pt.setupElevationDraw(W,K,{useMeterToDem:!0}),Pc(A,i,X,J,l,pt),!J.centroidVertexBuffer){const At=K.attributes.a_centroid_pos;void 0!==At&&z.vertexAttrib2f(At,0,0)}}O&&(p.context.activeTexture.set(z.TEXTURE0),W.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),dt.updatePaintBuffers(N));const lt=R.constantOr(null);if(lt&&W.imageAtlas){const pt=W.imageAtlas,At=pt.patternPositions[lt.to.toString()],It=pt.patternPositions[lt.from.toString()];At&&It&&dt.setConstantPatternPositions(At,It)}const ot=p.translatePosMatrix(X.projMatrix,W,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),st=l.paint.get("fill-extrusion-vertical-gradient"),at=O?Ro(ot,p,st,$,X,N,W):Cc(ot,p,st,$);p.prepareDrawProgram(A,K,X.toUnwrapped()),K.draw(A,A.gl.TRIANGLES,y,b,T,u.CullFaceMode.backCCW,at,l.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,l.paint,p.transform.zoom,dt,p.terrain?J.centroidVertexBuffer:null)}}function Pc(p,i,l,m,y,b){const T=[K=>{let lt=K.canonical.x-1,ot=K.wrap;return lt<0&&(lt=(1<<K.canonical.z)-1,ot--),new u.OverscaledTileID(K.overscaledZ,ot,K.canonical.z,lt,K.canonical.y)},K=>{let lt=K.canonical.x+1,ot=K.wrap;return lt===1<<K.canonical.z&&(lt=0,ot++),new u.OverscaledTileID(K.overscaledZ,ot,K.canonical.z,lt,K.canonical.y)},K=>new u.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,(0===K.canonical.y?1<<K.canonical.z:K.canonical.y)-1),K=>new u.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y===(1<<K.canonical.z)-1?0:K.canonical.y+1)],A=K=>{const lt=i.getSource().maxzoom,ot=At=>{const It=i.getTileByID(At);if(It&&It.hasData())return It.getBucket(y)};let st,at,pt;return(K.overscaledZ===K.canonical.z||K.overscaledZ>=lt)&&(st=ot(K.key)),K.overscaledZ>=lt&&(at=ot(K.calculateScaledKey(K.overscaledZ+1))),K.overscaledZ>lt&&(pt=ot(K.calculateScaledKey(K.overscaledZ-1))),st||at||pt},z=[0,0,0],R=(K,lt)=>(z[0]=Math.min(K.min.y,lt.min.y),z[1]=Math.max(K.max.y,lt.max.y),z[2]=u.EXTENT-lt.min.x>K.max.x?lt.min.x-u.EXTENT:K.max.x,z),O=(K,lt)=>(z[0]=Math.min(K.min.x,lt.min.x),z[1]=Math.max(K.max.x,lt.max.x),z[2]=u.EXTENT-lt.min.y>K.max.y?lt.min.y-u.EXTENT:K.max.y,z),N=[(K,lt)=>R(K,lt),(K,lt)=>R(lt,K),(K,lt)=>O(K,lt),(K,lt)=>O(lt,K)],$=new u.pointGeometry(0,0);let X,W,J;const dt=(K,lt,ot,st,at)=>{const pt=[[st?ot:K,st?K:ot,0],[st?ot:lt,st?lt:ot,0]],At=at<0?u.EXTENT+at:at,It=[st?At:(K+lt)/2,st?(K+lt)/2:At,0];return 0===ot&&at<0||0!==ot&&at>0?b.getForTilePoints(J,[It],!0,W):pt.push(It),b.getForTilePoints(l,pt,!0,X),Math.max(pt[0][2],pt[1][2],It[2])/b.exaggeration()};for(let K=0;K<4;K++){const lt=m.borders[K];if(0===lt.length&&(m.borderDone[K]=!0),m.borderDone[K])continue;const ot=J=T[K](l),st=A(ot);if(!(st&&st.enableTerrain&&(W=b.findDEMTileFor(ot),W&&W.dem)))continue;if(!X){const It=b.findDEMTileFor(l);if(!It||!It.dem)return;X=It}const at=(K<2?1:5)-K,pt=st.borders[at];let At=0;for(let It=0;It<lt.length;It++){const ee=m.featuresOnBorder[lt[It]],qt=ee.borders[K];let Yt;for(;At<pt.length&&(Yt=st.featuresOnBorder[pt[At]],!(Yt.borders[at][1]>qt[0]+3));)st.borderDone[at]||st.encodeCentroid(void 0,Yt,!1),At++;if(Yt&&At<pt.length){const Lt=At;let Dt=0;for(;!(Yt.borders[at][0]>qt[1]-3)&&(Dt++,++At!==pt.length);)Yt=st.featuresOnBorder[pt[At]];if(Yt=st.featuresOnBorder[pt[Lt]],ee.intersectsCount()>1||Yt.intersectsCount()>1||1!==Dt){1!==Dt&&(At=Lt),m.encodeCentroid(void 0,ee,!1),st.borderDone[at]||st.encodeCentroid(void 0,Yt,!1);continue}const Zt=N[K](ee,Yt),Ut=K%2?u.EXTENT-1:0;$.x=dt(Zt[0],Math.min(u.EXTENT-1,Zt[1]),Ut,K<2,Zt[2]),$.y=0,m.encodeCentroid($,ee,!1),st.borderDone[at]||st.encodeCentroid($,Yt,!1)}else m.encodeCentroid(void 0,ee,!1)}m.borderDone[K]=m.needsCentroidUpdate=!0,st.borderDone[at]||(st.borderDone[at]=st.needsCentroidUpdate=!0)}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(p)}const zc=new u.Color(1,0,0,1),Rc=new u.Color(0,1,0,1),Ha=new u.Color(0,0,1,1),da=new u.Color(1,0,1,1),Lc=new u.Color(0,1,1,1);function Gn(p,i,l,m){ms(p,0,i+l/2,p.transform.width,l,m)}function ur(p,i,l,m){ms(p,i-l/2,0,l,p.transform.height,m)}function ms(p,i,l,m,y,b){const T=p.context,A=T.gl;A.enable(A.SCISSOR_TEST),A.scissor(i*u.exported.devicePixelRatio,l*u.exported.devicePixelRatio,m*u.exported.devicePixelRatio,y*u.exported.devicePixelRatio),T.clear({color:b}),A.disable(A.SCISSOR_TEST)}function Vo(p,i,l){const m=p.context,y=m.gl,b=l.projMatrix,T=p.useProgram("debug"),A=i.getTileByID(l.key);p.terrain&&p.terrain.setupElevationDraw(A,T);const z=u.DepthMode.disabled,R=u.StencilMode.disabled,O=p.colorModeForRenderPass(),N="$debug";m.activeTexture.set(y.TEXTURE0),p.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),A._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const $=A._tileDebugBuffer||p.debugBuffer,X=A._tileDebugIndexBuffer||p.debugIndexBuffer,W=A._tileDebugSegments||p.debugSegments;T.draw(m,y.LINE_STRIP,z,R,O,u.CullFaceMode.disabled,zl(b,u.Color.red),N,$,X,W);const J=A.latestRawTileData,dt=Math.floor((J&&J.byteLength||0)/1024),K=i.getTile(l).tileSize,lt=512/Math.min(K,512)*(l.overscaledZ/p.transform.zoom)*.5;let ot=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ot+=` => ${l.overscaledZ}`),function(st,at){st.initDebugOverlayCanvas();const pt=st.debugOverlayCanvas,At=st.context.gl,It=st.debugOverlayCanvas.getContext("2d");It.clearRect(0,0,pt.width,pt.height),It.shadowColor="white",It.shadowBlur=2,It.lineWidth=1.5,It.strokeStyle="white",It.textBaseline="top",It.font="bold 36px Open Sans, sans-serif",It.fillText(at,5,5),It.strokeText(at,5,5),st.debugOverlayTexture.update(pt),st.debugOverlayTexture.bind(At.LINEAR,At.CLAMP_TO_EDGE)}(p,`${ot} ${dt}kb`),T.draw(m,y.TRIANGLES,z,R,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,zl(b,u.Color.transparent,lt),N,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments)}const Ol=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Fl}=Ol;function Tr(p,i,l,m){p.emplaceBack(i,l,m)}class Uo{constructor(i){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,Tr(this.vertexArray,-1,-1,1),Tr(this.vertexArray,1,-1,1),Tr(this.vertexArray,-1,1,1),Tr(this.vertexArray,1,1,1),Tr(this.vertexArray,-1,-1,-1),Tr(this.vertexArray,1,-1,-1),Tr(this.vertexArray,-1,1,-1),Tr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Fl),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function Wr(p,i,l,m,y,b){const T=p.gl,A=i.paint.get("sky-atmosphere-color"),z=i.paint.get("sky-atmosphere-halo-color"),R=i.paint.get("sky-atmosphere-sun-intensity"),O={u_matrix_3f:u.fromMat4([],m),u_sun_direction:y,u_sun_intensity:R,u_color_tint_r:[(W=A).r,W.g,W.b,W.a],u_color_tint_m:[(J=z).r,J.g,J.b,J.a],u_luminance:5e-5};var W,J;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,i.skyboxTexture,0),l.draw(p,T.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,O,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const qa={symbol:function(p,i,l,m,y){if("translucent"!==p.renderPass)return;const b=u.StencilMode.disabled,T=p.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(A,z,R,O,N,$,X){const W=z.transform,J="map"===N,dt="map"===$,K=W.projection.createTileTransform(W,W.worldSize);for(const lt of A){const ot=O.getTile(lt),st=ot.getBucket(R);if(!st||st.projection!==W.projection.name||!st.text||!st.text.segments.get().length)continue;const at=u.evaluateSizeForZoom(st.textSizeData,W.zoom),pt=z.transform.calculatePixelsToTileUnitsMatrix(ot),At=Jn(lt.projMatrix,ot.tileID.canonical,dt,J,z.transform,pt),It="none"!==R.layout.get("icon-text-fit")&&st.hasIconData();if(at){const ee=Math.pow(2,W.zoom-ot.tileID.overscaledZ);Dc(st,J,dt,X,u.symbolSize,W,At,lt,ee,at,It,K)}}}(m,p,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),y),0!==l.paint.get("icon-opacity").constantOr(1)&&Bo(p,i,l,m,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),b,T),0!==l.paint.get("text-opacity").constantOr(1)&&Bo(p,i,l,m,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),b,T),i.map.showCollisionBoxes&&(fs(p,i,l,m,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),fs(p,i,l,m,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(p,i,l,m){if("translucent"!==p.renderPass)return;const y=l.paint.get("circle-opacity"),b=l.paint.get("circle-stroke-width"),T=l.paint.get("circle-stroke-opacity"),A=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===b.constantOr(1)||0===T.constantOr(1)))return;const z=p.context,R=z.gl,O=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),N=u.StencilMode.disabled,$=p.colorModeForRenderPass(),X=[];for(let J=0;J<m.length;J++){const dt=m[J],K=i.getTile(dt),lt=K.getBucket(l);if(!lt)continue;const ot=lt.programConfigurations.get(l.id),st=Hr(l),at={programConfiguration:ot,program:p.useProgram("circle",ot,st),layoutVertexBuffer:lt.layoutVertexBuffer,indexBuffer:lt.indexBuffer,uniformValues:Gh(p,dt,K,l),tile:K};if(A){const pt=lt.segments.get();for(const At of pt)X.push({segments:new u.SegmentVector([At]),sortKey:At.sortKey,state:at})}else X.push({segments:lt.segments,sortKey:0,state:at})}A&&X.sort((J,dt)=>J.sortKey-dt.sortKey);const W={useDepthForOcclusion:"globe"!==p.transform.projection.name};for(const J of X){const{programConfiguration:dt,program:K,layoutVertexBuffer:lt,indexBuffer:ot,uniformValues:st,tile:at}=J.state,pt=J.segments;p.terrain&&p.terrain.setupElevationDraw(at,K,W),p.prepareDrawProgram(z,K,at.tileID.toUnwrapped()),K.draw(z,R.TRIANGLES,O,N,$,u.CullFaceMode.disabled,st,l.id,lt,ot,pt,l.paint,p.transform.zoom,dt)}},heatmap:function(p,i,l,m){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const y=p.context,b=y.gl,T=u.StencilMode.disabled,A=new u.ColorMode([b.ONE,b.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(z,R,O){const N=z.gl;z.activeTexture.set(N.TEXTURE1),z.viewport.set([0,0,R.width/4,R.height/4]);let $=O.heatmapFbo;if($)N.bindTexture(N.TEXTURE_2D,$.colorAttachment.get()),z.bindFramebuffer.set($.framebuffer);else{const X=N.createTexture();N.bindTexture(N.TEXTURE_2D,X),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),$=O.heatmapFbo=z.createFramebuffer(R.width/4,R.height/4,!1),function(W,J,dt,K){const lt=W.gl;lt.texImage2D(lt.TEXTURE_2D,0,lt.RGBA,J.width/4,J.height/4,0,lt.RGBA,W.extRenderToTextureHalfFloat?W.extTextureHalfFloat.HALF_FLOAT_OES:lt.UNSIGNED_BYTE,null),K.colorAttachment.set(dt)}(z,R,X,$)}})(y,p,l),y.clear({color:u.Color.transparent});for(let z=0;z<m.length;z++){const R=m[z];if(i.hasRenderableParent(R))continue;const O=i.getTile(R),N=O.getBucket(l);if(!N)continue;const $=N.programConfigurations.get(l.id),X=p.useProgram("heatmap",$),{zoom:W}=p.transform;p.terrain&&p.terrain.setupElevationDraw(O,X),p.prepareDrawProgram(y,X,R.toUnwrapped()),X.draw(y,b.TRIANGLES,u.DepthMode.disabled,T,A,u.CullFaceMode.disabled,Rl(R.projMatrix,O,W,l.paint.get("heatmap-intensity")),l.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,l.paint,p.transform.zoom,$)}y.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(y,b){const T=y.context,A=T.gl,z=b.heatmapFbo;if(!z)return;T.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,z.colorAttachment.get()),T.activeTexture.set(A.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new u.Texture(T,b.colorRamp,A.RGBA)),R.bind(A.LINEAR,A.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(T,A.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,y.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(p,l))},line:function(p,i,l,m){if("translucent"!==p.renderPass)return;const y=l.paint.get("line-opacity"),b=l.paint.get("line-width");if(0===y.constantOr(1)||0===b.constantOr(1))return;const T=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),A=p.colorModeForRenderPass(),z=l.paint.get("line-dasharray"),R=z.constantOr(1),O=l.layout.get("line-cap"),N=l.paint.get("line-pattern"),$=N.constantOr(1),X=l.paint.get("line-gradient"),W=l.getCrossfadeParameters(),J=$?"linePattern":"line",dt=p.context,K=dt.gl,lt=(st=>{const at=[];Ba(st)&&at.push("RENDER_LINE_DASH"),st.paint.get("line-gradient")&&at.push("RENDER_LINE_GRADIENT");const pt=st.paint.get("line-pattern").constantOr(1),At=1!==st.paint.get("line-opacity").constantOr(1);return!pt&&At&&at.push("RENDER_LINE_ALPHA_DISCARD"),at})(l);let ot=lt.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ot=!1);for(const st of m){const at=i.getTile(st);if($&&!at.patternsLoaded())continue;const pt=at.getBucket(l);if(!pt)continue;p.prepareDrawTile(st);const At=pt.programConfigurations.get(l.id),It=p.useProgram(J,At,lt),ee=N.constantOr(null);if(ee&&at.imageAtlas){const Ut=at.imageAtlas,xe=Ut.patternPositions[ee.to.toString()],Ae=Ut.patternPositions[ee.from.toString()];xe&&Ae&&At.setConstantPatternPositions(xe,Ae)}const qt=z.constantOr(null),Yt=O.constantOr(null);if(!$&&qt&&Yt&&at.lineAtlas){const Ut=at.lineAtlas,xe=Ut.getDash(qt.to,Yt),Ae=Ut.getDash(qt.from,Yt);xe&&Ae&&At.setConstantPatternPositions(xe,Ae)}const Lt=p.terrain?st.projMatrix:null,Dt=$?qr(p,at,l,W,Lt):Ec(p,at,l,W,Lt,pt.lineClipsArray.length);if(X){const Ut=pt.gradients[l.id];let xe=Ut.texture;if(l.gradientVersion!==Ut.version){let Ae=256;if(l.stepInterpolant){const Qe=i.getSource().maxzoom,te=st.canonical.z===Qe?Math.ceil(1<<p.transform.maxZoom-st.canonical.z):1;Ae=u.clamp(u.nextPowerOfTwo(pt.maxLineLength/u.EXTENT*1024*te),256,dt.maxTextureSize)}Ut.gradient=u.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Ae,image:Ut.gradient||void 0,clips:pt.lineClipsArray}),Ut.texture?Ut.texture.update(Ut.gradient):Ut.texture=new u.Texture(dt,Ut.gradient,K.RGBA),Ut.version=l.gradientVersion,xe=Ut.texture}dt.activeTexture.set(K.TEXTURE1),xe.bind(l.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}R&&(dt.activeTexture.set(K.TEXTURE0),at.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),At.updatePaintBuffers(W)),$&&(dt.activeTexture.set(K.TEXTURE0),at.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),At.updatePaintBuffers(W)),p.prepareDrawProgram(dt,It,st.toUnwrapped());const Zt=Ut=>{It.draw(dt,K.TRIANGLES,T,Ut,A,u.CullFaceMode.disabled,Dt,l.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,l.paint,p.transform.zoom,At,pt.layoutVertexBuffer2)};if(ot){const Ut=p.stencilModeForClipping(st).ref;0===Ut&&p.terrain&&dt.clear({stencil:0});const xe={func:K.EQUAL,mask:255};Dt.u_alpha_discard_threshold=.8,Zt(new u.StencilMode(xe,Ut,255,K.KEEP,K.KEEP,K.INVERT)),Dt.u_alpha_discard_threshold=0,Zt(new u.StencilMode(xe,Ut,255,K.KEEP,K.KEEP,K.KEEP))}else Zt(p.stencilModeForClipping(st))}ot&&(p.resetStencilClippingMasks(),p.terrain&&dt.clear({stencil:0}))},fill:function(p,i,l,m){const y=l.paint.get("fill-color"),b=l.paint.get("fill-opacity");if(0===b.constantOr(1))return;const T=p.colorModeForRenderPass(),A=l.paint.get("fill-pattern"),z=p.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===y.constantOr(u.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(p.renderPass===z){const R=p.depthModeForSublayer(1,"opaque"===p.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);Za(p,i,l,m,R,T,!1)}if("translucent"===p.renderPass&&l.paint.get("fill-antialias")){const R=p.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);Za(p,i,l,m,R,T,!0)}},"fill-extrusion":function(p,i,l,m){const y=l.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===p.renderPass){const b=new u.DepthMode(p.context.gl.LEQUAL,u.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==y||l.paint.get("fill-extrusion-pattern").constantOr(1))$a(p,i,l,m,b,u.StencilMode.disabled,u.ColorMode.disabled),$a(p,i,l,m,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const T=p.colorModeForRenderPass();$a(p,i,l,m,b,u.StencilMode.disabled,T)}}},hillshade:function(p,i,l,m){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const y=p.context,b=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),T=p.colorModeForRenderPass(),A=p.terrain&&p.terrain.renderingToTexture,[z,R]="translucent"!==p.renderPass||A?[{},m]:p.stencilConfigForOverlap(m);for(const O of R){const N=i.getTile(O);if(N.needsHillshadePrepare&&"offscreen"===p.renderPass)Oa(p,N,l,b,u.StencilMode.disabled,T);else if("translucent"===p.renderPass){const $=A&&p.terrain?p.terrain.stencilModeForRTTOverlap(O):z[O.overscaledZ];La(p,O,N,l,b,$,T)}}y.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,i,l,m,y,b){if("translucent"!==p.renderPass||0===l.paint.get("raster-opacity")||!m.length)return;const T=p.context,A=T.gl,z=i.getSource(),R=p.useProgram("raster"),O=p.colorModeForRenderPass(),N=p.terrain&&p.terrain.renderingToTexture,[$,X]=z instanceof Sn||N?[{},m]:p.stencilConfigForOverlap(m),W=X[X.length-1].overscaledZ,J=!p.options.moving;for(const dt of X){const K=N?u.DepthMode.disabled:p.depthModeForSublayer(dt.overscaledZ-W,1===l.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,A.LESS),lt=dt.toUnwrapped(),ot=i.getTile(dt);if(N&&(!ot||!ot.hasData()))continue;const st=N?dt.projMatrix:p.transform.calculateProjMatrix(lt,J),at=p.terrain&&N?p.terrain.stencilModeForRTTOverlap(dt):$[dt.overscaledZ],pt=b?0:l.paint.get("raster-fade-duration");ot.registerFadeDuration(pt);const At=i.findLoadedParent(dt,0),It=Ls(ot,At,i,p.transform,pt);let ee,qt;p.terrain&&p.terrain.prepareDrawTile(dt);const Yt="nearest"===l.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;T.activeTexture.set(A.TEXTURE0),ot.texture.bind(Yt,A.CLAMP_TO_EDGE),T.activeTexture.set(A.TEXTURE1),At?(At.texture.bind(Yt,A.CLAMP_TO_EDGE),ee=Math.pow(2,At.tileID.overscaledZ-ot.tileID.overscaledZ),qt=[ot.tileID.canonical.x*ee%1,ot.tileID.canonical.y*ee%1]):ot.texture.bind(Yt,A.CLAMP_TO_EDGE);const Lt=Va(st,qt||[0,0],ee||1,It,l,z instanceof Sn?z.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(T,R,lt),z instanceof Sn)R.draw(T,A.TRIANGLES,K,u.StencilMode.disabled,O,u.CullFaceMode.disabled,Lt,l.id,z.boundsBuffer,p.quadTriangleIndexBuffer,z.boundsSegments);else{const{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:Zt,tileBoundsSegments:Ut}=p.getTileBoundsBuffers(ot);R.draw(T,A.TRIANGLES,K,at,O,u.CullFaceMode.disabled,Lt,l.id,Dt,Zt,Ut)}}p.resetStencilClippingMasks()},background:function(p,i,l,m){const y=l.paint.get("background-color"),b=l.paint.get("background-opacity");if(0===b)return;const T=p.context,A=T.gl,z=p.transform,R=z.tileSize,O=l.paint.get("background-pattern");if(p.isPatternMissing(O))return;const N=!O&&1===y.a&&1===b&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==N)return;const $=u.StencilMode.disabled,X=p.depthModeForSublayer(0,"opaque"===N?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),W=p.colorModeForRenderPass(),J=p.useProgram(O?"backgroundPattern":"background");let dt,K=m;K||(dt=p.getBackgroundTiles(),K=Object.values(dt).map(ot=>ot.tileID)),O&&(T.activeTexture.set(A.TEXTURE0),p.imageManager.bind(p.context));const lt=l.getCrossfadeParameters();for(const ot of K){const st=ot.toUnwrapped(),at=m?ot.projMatrix:p.transform.calculateProjMatrix(st);p.prepareDrawTile(ot);const pt=i?i.getTile(ot):dt?dt[ot.key]:new u.Tile(ot,R,z.zoom,p),At=O?ps(at,b,p,O,{tileID:ot,tileSize:R},lt):xi(at,b,y);p.prepareDrawProgram(T,J,st);const{tileBoundsBuffer:It,tileBoundsIndexBuffer:ee,tileBoundsSegments:qt}=p.getTileBoundsBuffers(pt);J.draw(T,A.TRIANGLES,X,$,W,u.CullFaceMode.disabled,At,l.id,It,ee,qt)}},sky:function(p,i,l){const m=p.transform,y="mercator"===m.projection.name||"globe"===m.projection.name?1:u.smoothstep(7,8,m.zoom),b=l.paint.get("sky-opacity")*y;if(0===b)return;const T=p.context,A=l.paint.get("sky-type"),z=new u.DepthMode(T.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),R=p.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===p.renderPass?l.needsSkyboxCapture(p)&&(function(O,N,$,X){const W=O.context,J=W.gl;let dt=N.skyboxFbo;if(!dt){dt=N.skyboxFbo=W.createFramebuffer(32,32,!1),N.skyboxGeometry=new Uo(W),N.skyboxTexture=W.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,N.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let st=0;st<6;++st)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+st,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(dt.framebuffer),W.viewport.set([0,0,32,32]);const K=N.getCenter(O,!0),lt=O.useProgram("skyboxCapture"),ot=new Float64Array(16);u.identity(ot),u.rotateY(ot,ot,.5*-Math.PI),Wr(W,N,lt,ot,K,0),u.identity(ot),u.rotateY(ot,ot,.5*Math.PI),Wr(W,N,lt,ot,K,1),u.identity(ot),u.rotateX(ot,ot,.5*-Math.PI),Wr(W,N,lt,ot,K,2),u.identity(ot),u.rotateX(ot,ot,.5*Math.PI),Wr(W,N,lt,ot,K,3),u.identity(ot),Wr(W,N,lt,ot,K,4),u.identity(ot),u.rotateY(ot,ot,Math.PI),Wr(W,N,lt,ot,K,5),W.viewport.set([0,0,O.width,O.height])}(p,l),l.markSkyboxValid(p)):"sky"===p.renderPass&&function(O,N,$,X,W){const J=O.context,dt=J.gl,K=O.transform,lt=O.useProgram("skybox");J.activeTexture.set(dt.TEXTURE0),dt.bindTexture(dt.TEXTURE_CUBE_MAP,N.skyboxTexture);const ot={u_matrix:K.skyboxMatrix,u_sun_direction:N.getCenter(O,!1),u_cubemap:0,u_opacity:X,u_temporal_offset:W};O.prepareDrawProgram(J,lt),lt.draw(J,dt.TRIANGLES,$,u.StencilMode.disabled,O.colorModeForRenderPass(),u.CullFaceMode.backCW,ot,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,l,z,b,R):"gradient"===A&&"sky"===p.renderPass&&function(O,N,$,X,W){const J=O.context,dt=J.gl,K=O.transform,lt=O.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new Uo(J)),J.activeTexture.set(dt.TEXTURE0);let ot=N.colorRampTexture;ot||(ot=N.colorRampTexture=new u.Texture(J,N.colorRamp,dt.RGBA)),ot.bind(dt.LINEAR,dt.CLAMP_TO_EDGE);const st=(at=K.skyboxMatrix,pt=N.getCenter(O,!1),At=N.paint.get("sky-gradient-radius"),It=X,ee=W,{u_matrix:at,u_color_ramp:0,u_center_direction:pt,u_radius:u.degToRad(At),u_opacity:It,u_temporal_offset:ee});var at,pt,At,It,ee;O.prepareDrawProgram(J,lt),lt.draw(J,dt.TRIANGLES,$,u.StencilMode.disabled,O.colorModeForRenderPass(),u.CullFaceMode.backCW,st,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,l,z,b,R)},debug:function(p,i,l){for(let m=0;m<l.length;m++)Vo(p,i,l[m])},custom:function(p,i,l){const m=p.context,y=l.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))u.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const b=y.prerender;b&&(p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),b.call(y,m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),m.setStencilMode(u.StencilMode.disabled);const b="3d"===y.renderingMode?new u.DepthMode(p.context.gl.LEQUAL,u.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,u.DepthMode.ReadOnly);m.setDepthMode(b),y.render(m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState(),m.bindFramebuffer.set(null)}}};class Oc{constructor(i,l){this.context=new mn(i),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zs,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,l){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new us(this,i));const y=this._terrain;this.transform.elevation=m?y:null,y.update(i,this.transform,l)}_updateFog(i){const l=i.fog;if(!l||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=l.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const b=m+.78*(y-m);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,l){if(this.width=i*u.exported.devicePixelRatio,this.height=l*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const i=this.context,l=new u.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(u.EXTENT,0),l.emplaceBack(0,u.EXTENT),l.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(l,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const m=new u.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(u.EXTENT,0),m.emplaceBack(0,u.EXTENT),m.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=i.createVertexBuffer(m,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const y=new u.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(y,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const b=new u.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(u.EXTENT,0,u.EXTENT,0),b.emplaceBack(0,u.EXTENT,0,u.EXTENT),b.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(b,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const T=new u.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T);const A=new u.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])A.emplaceBack(R);this.debugIndexBuffer=i.createIndexBuffer(A),this.emptyTexture=new u.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA),this.identityMat=u.create();const z=this.context.gl;this.stencilClearMode=new u.StencilMode({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(u.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,l=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,l.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,Br(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,l,m){if(!l||this.currentStencilSource===l.id||!i.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const z of m)if(void 0===this._tileClippingMaskIDs[z.key]){A=!0;break}if(!A)return}this.currentStencilSource=l.id;const y=this.context,b=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(u.ColorMode.disabled),y.setDepthMode(u.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of m){const z=l.getTile(A),R=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:N,tileBoundsSegments:$}=this.getTileBoundsBuffers(z);T.draw(y,b.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:b.ALWAYS,mask:0},R,255,b.KEEP,b.KEEP,b.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Br(A.projMatrix),"$clipping",O,N,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,l=this.context.gl;return new u.StencilMode({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const l=this.context.gl;return new u.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){const l=this.context.gl,m=i.sort((T,A)=>A.overscaledZ-T.overscaledZ),y=m[m.length-1].overscaledZ,b=m[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let A=0;A<b;A++)T[A+y]=new u.StencilMode({func:l.GEQUAL,mask:255},A+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=b,[T,m]}return[{[y]:u.StencilMode.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;if(this._showOverdrawInspector){const l=1/8;return new u.ColorMode([i.CONSTANT_COLOR,i.ONE],new u.Color(l,l,l,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(i,l,m){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new u.DepthMode(m||this.context.gl.LEQUAL,l,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,l){this.style=i,this.options=l,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const m=this.style.order,y=this.style._sourceCaches;for(const R in y){const O=y[R];O.used&&O.prepare(this.context)}const b={},T={},A={};for(const R in y){const O=y[R];b[R]=O.getVisibleCoordinates(),T[R]=b[R].slice().reverse(),A[R]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<m.length;R++)if(this.style._layers[m[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),!u.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of m){const O=this.style._layers[R],N=i._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const $=N?T[N.id]:void 0;("custom"===O.type||O.isSky()||$&&$.length)&&this.renderLayer(this,N,O,$)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let z=u.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(z=this.style.fog.properties.get("color")),this.context.clear({color:l.showOverdrawInspector?u.Color.black:z,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[m[this.currentLayer]],O=i._getLayerSourceCache(R);if(R.isSky())continue;const N=O?T[O.id]:void 0;this._renderTileClippingMasks(R,O,N),this.renderLayer(this,O,R,N)}if(this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const R=this.style._layers[m[this.currentLayer]],O=i._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,O,R,O?T[O.id]:void 0)}for("globe"===this.transform.projection.name&&function(R){const O=R.context,N=O.gl,$=R.transform,X=new u.DepthMode(N.LEQUAL,u.DepthMode.ReadOnly,[0,1]),W=R.useProgram("globeAtmosphere"),J=$._camera.getWorldToCamera($.worldSize,1),dt=$._camera.getCameraToClipPerspective($._fov,$.width/$.height,$._nearZ,$._farZ),K=u.mul([],J,u.calculateGlobeMatrix($,$.worldSize)),lt=u.mul([],$.labelPlaneMatrix,dt),ot=u.transformMat4([],[0,0,0],K),st=u.add([],ot,[$.worldSize/Math.PI/2,0,0]),at=u.transformMat4([],ot,lt),pt=u.transformMat4([],st,lt),At=u.length(u.sub([],pt,at)),It=1-u.globeToMercatorTransition($.zoom),ee={u_center:at,u_radius:At,u_screen_size:[$.width,$.height],u_pixel_ratio:u.exported.devicePixelRatio,u_opacity:It,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};R.prepareDrawProgram(O,W);const qt=R.globeSharedBuffers;qt&&W.draw(O,N.TRIANGLES,X,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,ee,"skybox",qt.atmosphereVertexBuffer,qt.atmosphereIndexBuffer,qt.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const R=this.style._layers[m[this.currentLayer]],O=i._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const N=O?("symbol"===R.type?A:T)[O.id]:void 0;this._renderTileClippingMasks(R,O,O?b[O.id]:void 0),this.renderLayer(this,O,R,N),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;u.values(this.style._layers).forEach(O=>{const N=i._getLayerSourceCache(O);N&&!O.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<N.getSource().maxzoom)&&(R=N)}),R&&this.options.showTileBoundaries&&qa.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const O=R.transform.padding;Gn(R,R.transform.height-(O.top||0),3,zc),Gn(R,O.bottom||0,3,Rc),ur(R,O.left||0,3,Ha),ur(R,R.transform.width-(O.right||0),3,da);const N=R.transform.centerPoint;var $,X,W,J;ms($=R,(X=N.x)-1,(W=R.transform.height-N.y)-10,2,20,J=Lc),ms($,X-10,W-1,20,2,J)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,l,m,y){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(m.type)||qa[m.type](i,l,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),m.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const l={};for(const m in i){const y=i[m],b=this.context.extTimerQuery,T=b.getQueryObjectEXT(y.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(y.query),l[m]=T}return l}translatePosMatrix(i,l,m,y,b){if(!m[0]&&!m[1])return i;const T=b?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(T){const R=Math.sin(T),O=Math.cos(T);m=[m[0]*O-m[1]*R,m[0]*R+m[1]*O]}const A=[b?m[0]:fn(l,m[0],this.transform.zoom),b?m[1]:fn(l,m[1],this.transform.zoom),0],z=new Float32Array(16);return u.translate(z,i,A),z}saveTileTexture(i){const l=this._tileTextures[i.size[0]];l?l.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const l=this._tileTextures[i];return l&&l.length>0?l.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const l=this.imageManager.getPattern(i.from.toString()),m=this.imageManager.getPattern(i.to.toString());return!l||!m}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),l&&!i&&0!==l.getOpacity(this.transform.pitch)&&m.push("FOG"),i&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(i,l,m){this.cache=this.cache||{};const y=m||[],b=this.currentGlobalDefines().concat(y),T=ds.cacheKey(i,b,l);return this.cache[T]||(this.cache[T]=new ds(this.context,i,Io[i],l,kc[i],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(i){this.terrain&&this.terrain.prepareDrawTile(i)}prepareDrawProgram(i,l,m){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const b=y.getOpacity(this.transform.pitch);0!==b&&l.setFogUniformValues(i,((T,A,z,R)=>{const O=A.properties.get("color"),N=T.frameCounter/1e3%1,$=[O.r/O.a,O.g/O.a,O.b/O.a,R];return{u_fog_matrix:z?T.transform.calculateFogTileMatrix(z):T.identityMat,u_fog_range:A.getFovAdjustedRange(T.transform._fov),u_fog_color:$,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:N}})(this,y,m,b))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,l=i.createTexture();return i.bindTexture(i.TEXTURE_2D,l),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,l=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)l[y.key]=i[y.key]||new u.Tile(y,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Wa{constructor(i=0,l=0,m=0,y=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=m,this.right=y}interpolate(i,l,m){return null!=l.top&&null!=i.top&&(this.top=u.number(i.top,l.top,m)),null!=l.bottom&&null!=i.bottom&&(this.bottom=u.number(i.bottom,l.bottom,m)),null!=l.left&&null!=i.left&&(this.left=u.number(i.left,l.left,m)),null!=l.right&&null!=i.right&&(this.right=u.number(i.right,l.right,m)),this}getCenter(i,l){const m=u.clamp((this.left+i-this.right)/2,0,i),y=u.clamp((this.top+l-this.bottom)/2,0,l);return new u.pointGeometry(m,y)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Wa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function _s(p,i){const l=u.getColumn(p,3);u.fromQuat(p,i),u.setColumn(p,3,l)}function Fc(p,i){u.setColumn(p,3,[i[0],i[1],i[2],1])}function No(p,i){const l=u.identity$1([]);return u.rotateZ$1(l,l,-i),u.rotateX$1(l,l,-p),l}function jo(p,i){const l=[p[0],p[1],0],m=[i[0],i[1],0];if(u.length(l)>=1e-15){const T=u.normalize([],l);u.scale$2(m,T,u.dot(m,T)),i[0]=m[0],i[1]=m[1]}const y=u.cross([],i,p);if(u.len(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return No(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class Bc{constructor(i,l){this.position=i,this.orientation=l}get position(){return this._position}set position(i){this._position=this._renderWorldCopies?function(l){if(!l)return;const m=Array.isArray(l)?new u.MercatorCoordinate(l[0],l[1],l[2]):l;return m.x=u.wrap(m.x,0,1),m}(i):i}lookAtPoint(i,l){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(i)):0,y=this.position,b=u.MercatorCoordinate.fromLngLat(i,m),T=[b.x-y.x,b.y-y.y,b.z-y.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=jo(T,l)}setPitchBearing(i,l){this.orientation=No(u.degToRad(i),u.degToRad(-l))}}class Go{constructor(i,l){this._transform=u.identity([]),this._orientation=u.identity$1([]),l&&(this._orientation=l,_s(this._transform,this._orientation)),i&&Fc(this._transform,i)}get mercatorPosition(){const i=this.position;return new u.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=u.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){Fc(this._transform,i)}get orientation(){return this._orientation}set orientation(i){this._orientation=i,_s(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,l){this._orientation=No(i,l),_s(this._transform,this._orientation)}forward(){const i=u.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=u.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=u.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,l){const m=new Float64Array(16);return u.invert(m,this.getWorldToCamera(i,l)),m}getWorldToCameraPosition(i,l,m){const y=this.position;u.scale$2(y,y,-i);const b=new Float64Array(16);return u.fromScaling(b,[m,m,m]),u.translate(b,b,y),b[10]*=l,b}getWorldToCamera(i,l){const m=new Float64Array(16),y=new Float64Array(4),b=this.position;return u.conjugate(y,this._orientation),u.scale$2(b,b,-i),u.fromQuat(m,y),u.translate(m,m,b),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=l,m[9]*=l,m[10]*=l,m[11]*=l,m}getCameraToClipPerspective(i,l,m,y){const b=new Float64Array(16);return u.perspective(b,i,l,m,y),b}getDistanceToElevation(i){const l=0===i?0:u.mercatorZfromAltitude(i,this.position[1]),m=this.forward();return(l-this.position[2])/m[2]}clone(){return new Go([...this.position],[...this.orientation])}}function Vc(p,i){const l=$o(p),m=function(b,T,A,z,R){const O=new u.LngLat(A.lng-180*dr,A.lat),N=new u.LngLat(A.lng+180*dr,A.lat),$=b.project(O.lng,O.lat),X=b.project(N.lng,N.lat),W=-Math.atan2(X.y-$.y,X.x-$.x),J=u.MercatorCoordinate.fromLngLat(A);J.y=u.clamp(J.y,-.999975,.999975);const dt=J.toLngLat(),K=b.project(dt.lng,dt.lat),lt=u.MercatorCoordinate.fromLngLat(dt);lt.x+=dr;const ot=lt.toLngLat(),st=b.project(ot.lng,ot.lat),at=Ya(st.x-K.x,st.y-K.y,W),pt=u.MercatorCoordinate.fromLngLat(dt);pt.y+=dr;const At=pt.toLngLat(),It=b.project(At.lng,At.lat),ee=Ya(It.x-K.x,It.y-K.y,W),qt=Math.abs(at.x)/Math.abs(ee.y),Yt=u.identity([]);u.rotateZ(Yt,Yt,-W*(1-(R?0:z)));const Lt=u.identity([]);return u.scale(Lt,Lt,[1,1-(1-qt)*z,1]),Lt[4]=-ee.x/ee.y*z,u.rotateZ(Lt,Lt,W),u.multiply$1(Lt,Yt,Lt),Lt}(p.projection,0,p.center,l,i),y=Zo(p);return u.scale(m,m,[y,y,1]),m}function Zo(p){const i=p.projection,l=$o(p),m=Ho(i,p.center),y=Ho(i,u.LngLat.convert(i.center));return Math.pow(2,m*l+(1-l)*y)}function $o(p){const i=p.projection.range;if(!i)return 0;const l=Math.max(p.width,p.height),m=Math.log(l/1024)/Math.LN2;return u.smoothstep(i[0]+m,i[1]+m,p.zoom)}const dr=1/4e4;function Ho(p,i){const l=u.clamp(i.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),m=new u.LngLat(i.lng-180*dr,l),y=new u.LngLat(i.lng+180*dr,l),b=p.project(m.lng,l),T=p.project(y.lng,l),A=u.MercatorCoordinate.fromLngLat(m),z=u.MercatorCoordinate.fromLngLat(y),R=T.x-b.x,O=T.y-b.y,N=z.x-A.x,$=z.y-A.y,X=Math.sqrt((N*N+$*$)/(R*R+O*O));return Math.log(X)/Math.LN2}function Ya(p,i,l){const m=Math.cos(l),y=Math.sin(l);return{x:p*m-i*y,y:p*y+i*m}}class Xa{constructor(i,l,m,y,b){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=null==m?0:m,this._maxPitch=null==y?60:y,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Go,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const i=new Xa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.setProjection(this.getProjection()),i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i.tileSize=this.tileSize,i.setMaxBounds(this.getMaxBounds()),i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._cameraZoom=this._cameraZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,i?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(i){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),i&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(i){null==i&&(i={name:"mercator"}),this.projectionOptions=i;const l=this.projection?this.getProjection():void 0;return this.projection=u.getProjection(i),!Te(l,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.pointGeometry(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const l=-i*Math.PI/180;var m,y,b,T,A,z,R,O,N,$;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(m=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),y=this.rotationMatrix,T=this.angle,A=(b=this.rotationMatrix)[0],z=b[1],R=b[2],O=b[3],N=Math.sin(T),$=Math.cos(T),y[0]=A*$+R*N,y[1]=z*$+O*N,y[2]=A*-N+R*$,y[3]=z*-N+O*$)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const l=u.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(i){const l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===i?(this._cameraZoom=null,!1):(this._centerAltitude=i,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,b=0;for(let T=0;T<l.length;T++){const A=new u.pointGeometry(l[T][0]*this.width,m+l[T][1]*(this.height-m)),z=i.pointCoordinate(A);if(!z)continue;const R=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);y+=z[3]*R,b+=R}return 0===b?NaN:y/b}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const i=this._cameraZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*l,y=this._mercatorZfromZoom(i),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-m,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[l.x,l.y,l.z]:[i.x,i.y,i.z];const y=u.length(u.sub([],this._camera.position,m));return u.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let l=!1;if(i.orientation&&!u.exactEquals(i.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];u.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,l=new Bc;return l.position=new u.MercatorCoordinate(i[0],i[1],i[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(i){if(!u.length$1(i))return!1;u.normalize$1(i,i);const l=u.transformQuat([],[0,0,-1],i),m=u.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const y=jo(l,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(i){const l=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;i[2]=u.clamp(i[2],y/m,y/l),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,m){this._unmodified=!1,this._edgeInsets.interpolate(i,l,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){const l=[new u.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new u.pointGeometry(0,0)),y=this.pointCoordinate(new u.pointGeometry(this.width,0)),b=this.pointCoordinate(new u.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new u.pointGeometry(0,this.height)),A=Math.floor(Math.min(m.x,y.x,b.x,T.x)),z=Math.floor(Math.max(m.x,y.x,b.x,T.x)),R=1;for(let O=A-R;O<=z+R;O++)0!==O&&l.push(new u.UnwrappedTileID(O,i))}return l}coveringTiles(i){let l=this.coveringZoomLevel(i);const m=l,y=this.elevation&&!i.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==i.minzoom&&l<i.minzoom)return[];void 0!==i.maxzoom&&l>i.maxzoom&&(l=i.maxzoom);const T=this.locationCoordinate(this.center),A=1<<l,z=[A*T.x,A*T.y,0],R=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,"globe"!==this.projection.name),O=this.pointCoordinate(this.getCameraPoint()),N=A*u.mercatorZfromAltitude(1,this.center.lat),$=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),X=[A*O.x,A*O.y,$],W=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,dt=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,K=i.isTerrainDEM?-dt:this._elevation?this._elevation.getMinElevationBelowMSL():0,lt=this.projection.isReprojectedInTileSpace?Zo(this):1,ot=Dt=>{const Zt=1/4e4,Ut=new u.MercatorCoordinate(Dt.x+Zt,Dt.y,Dt.z),xe=new u.MercatorCoordinate(Dt.x,Dt.y+Zt,Dt.z),Ae=Dt.toLngLat(),Qe=Ut.toLngLat(),te=xe.toLngLat(),Pe=this.locationCoordinate(Ae),$e=this.locationCoordinate(Qe),si=this.locationCoordinate(te),ki=Math.hypot($e.x-Pe.x,$e.y-Pe.y),Ge=Math.hypot(si.x-Pe.x,si.y-Pe.y);return Math.sqrt(ki*Ge)*lt/Zt},st=Dt=>{const Zt=dt,Ut=K;return{aabb:u.tileAABB(this,A,0,0,0,Dt,Ut,Zt,this.projection),zoom:0,x:0,y:0,minZ:Ut,maxZ:Zt,wrap:Dt,fullyVisible:!1}},at=[];let pt=[];const At=l,It=i.reparseOverscaled?m:l,ee=Dt=>Dt*Dt,qt=ee(($-this._centerAltitude)*N),Yt=Dt=>{if(!this._elevation||!Dt.tileID||!b)return;const Zt=this._elevation.getMinMaxForTile(Dt.tileID),Ut=Dt.aabb;Zt?(Ut.min[2]=Zt.min,Ut.max[2]=Zt.max,Ut.center[2]=(Ut.min[2]+Ut.max[2])/2):(Dt.shouldSplit=Lt(Dt),Dt.shouldSplit||(Ut.min[2]=Ut.max[2]=Ut.center[2]=this._centerAltitude))},Lt=Dt=>{if(Dt.zoom<J)return!0;if(Dt.zoom===At)return!1;if(null!=Dt.shouldSplit)return Dt.shouldSplit;const Zt=Dt.aabb.distanceX(X),Ut=Dt.aabb.distanceY(X);let xe=qt;y&&(xe=ee(Dt.aabb.distanceZ(X)*N));let Ae=1;if(this.projection.isReprojectedInTileSpace&&m<=5){const te=Math.pow(2,Dt.zoom),Pe=ot(new u.MercatorCoordinate((Dt.x+.5)/te,(Dt.y+.5)/te));Ae=Pe>.85?1:Pe}const Qe=Zt*Zt+Ut*Ut+xe;return Qe<ee((1<<At-Dt.zoom)*W*Ae*((te,Pe)=>{if(Pe*ee(.707)<te)return 1;const $e=Math.sqrt(Pe/te);return $e/(1.4144271570014144+(Math.pow(1.1,$e-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(xe,qt),Qe))};if(this.renderWorldCopies)for(let Dt=1;Dt<=3;Dt++)at.push(st(-Dt)),at.push(st(Dt));for(at.push(st(0));at.length>0;){const Dt=at.pop(),Zt=Dt.x,Ut=Dt.y;let xe=Dt.fullyVisible;if(!xe){const Ae=Dt.aabb.intersects(R);if(0===Ae)continue;xe=2===Ae}if(Dt.zoom!==At&&Lt(Dt))for(let Ae=0;Ae<4;Ae++){const Qe=(Zt<<1)+Ae%2,te=(Ut<<1)+(Ae>>1),Pe={aabb:b?Dt.aabb.quadrant(Ae):u.tileAABB(this,A,Dt.zoom+1,Qe,te,Dt.wrap,Dt.minZ,Dt.maxZ,this.projection),zoom:Dt.zoom+1,x:Qe,y:te,wrap:Dt.wrap,fullyVisible:xe,tileID:void 0,shouldSplit:void 0,minZ:Dt.minZ,maxZ:Dt.maxZ};y&&(Pe.tileID=new u.OverscaledTileID(Dt.zoom+1===At?It:Dt.zoom+1,Dt.wrap,Dt.zoom+1,Qe,te),Yt(Pe)),at.push(Pe)}else{const Ae=Dt.zoom===At?It:Dt.zoom;if(i.minzoom&&i.minzoom>Ae)continue;const Qe=z[0]-(.5+Zt+(Dt.wrap<<Dt.zoom))*(1<<l-Dt.zoom),te=z[1]-.5-Ut,Pe=Dt.tileID?Dt.tileID:new u.OverscaledTileID(Ae,Dt.wrap,Dt.zoom,Zt,Ut);pt.push({tileID:Pe,distanceSq:Qe*Qe+te*te})}}if(this.fogCullDistSq){const Dt=this.fogCullDistSq,Zt=this.horizonLineFromTop();pt=pt.filter(Ut=>{const xe=[0,0,0,1],Ae=[u.EXTENT,u.EXTENT,0,1],Qe=this.calculateFogTileMatrix(Ut.tileID.toUnwrapped());u.transformMat4$1(xe,xe,Qe),u.transformMat4$1(Ae,Ae,Qe);const te=u.getAABBPointSquareDist(xe,Ae);if(0===te)return!0;let Pe=!1;const $e=this._elevation;if($e&&te>Dt&&0!==Zt){const si=this.calculateProjMatrix(Ut.tileID.toUnwrapped());let ki;i.isTerrainDEM||(ki=$e.getMinMaxForTile(Ut.tileID)),ki||(ki={min:K,max:dt});const Ge=u.furthestTileCorner(this.rotation),ti=[Ge[0]*u.EXTENT,Ge[1]*u.EXTENT,ki.max];u.transformMat4(ti,ti,si),Pe=(1-ti[1])*this.height*.5<Zt}return te<Dt||Pe})}return pt.sort((Dt,Zt)=>Dt.distanceSq-Zt.distanceSq).map(Dt=>Dt.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const l=u.clamp(i.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),m=this.projection.project(i.lng,l);return new u.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,l){const m=this.pointCoordinate(l),y=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(i);this.setLocation(new u.MercatorCoordinate(b.x-(m.x-y.x),b.y-(m.y-y.y)))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,l){const m=l?u.mercatorZfromAltitude(l,i.lat):void 0,y=this.projection.project(i.lng,i.lat);return new u.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,l){const m=null!=l?l:this._centerAltitude,y=[i.x,i.y,0,1],b=[i.x,i.y,1,1];u.transformMat4$1(y,y,this.pixelMatrixInverse),u.transformMat4$1(b,b,this.pixelMatrixInverse);const T=b[3];u.scale$1(y,y,1/y[3]),u.scale$1(b,b,1/T);const A=y[2],z=b[2];return{p0:y,p1:b,t:A===z?0:(m-A)/(z-A)}}screenPointToMercatorRay(i){const l=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return u.transformMat4$1(l,l,this.pixelMatrixInverse),u.transformMat4$1(m,m,this.pixelMatrixInverse),u.scale$1(l,l,1/l[3]),u.scale$1(m,m,1/m[3]),l[2]=u.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,m[2]=u.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,u.scale$1(l,l,1/this.worldSize),u.scale$1(m,m,1/this.worldSize),new u.Ray([l[0],l[1],l[2]],u.normalize([],u.sub([],m,l)))}rayIntersectionCoordinate(i){const{p0:l,p1:m,t:y}=i,b=u.mercatorZfromAltitude(l[2],this._center.lat),T=u.mercatorZfromAltitude(m[2],this._center.lat);return new u.MercatorCoordinate(u.number(l[0],m[0],y)/this.worldSize,u.number(l[1],m[1],y)/this.worldSize,u.number(b,T,y))}pointCoordinate(i,l=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(i.x,i.y,l)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const l=this.elevation;let m=this.elevation.pointCoordinate(i);if(m)return new u.MercatorCoordinate(m[0],m[1],m[2]);let y=0,b=this.horizonLineFromTop();if(i.y>b)return this.pointCoordinate(i);const T=.02*b,A=i.clone();for(let z=0;z<10&&b-y>T;z++){A.y=u.number(y,b,.66);const R=l.pointCoordinate(A);R?(b=A.y,m=R):y=A.y}return m?new u.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const l=this.horizonLineFromTop();return i.y<l}}_coordinatePoint(i,l){const m=l&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,y=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return u.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new u.pointGeometry(y[0]/y[3],y[1]/y[3]):new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,l){const m=new u.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new u.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new u.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new u.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(m,i),z=this.pointCoordinate(y,i);const R=this.pointCoordinate(b,l),O=this.pointCoordinate(T,l),N=($,X)=>(X.y-$.y)/(X.x-$.x);return A.y>1&&z.y>=0?A=new u.MercatorCoordinate((1-O.y)/N(O,A)+O.x,1):A.y<0&&z.y<=1&&(A=new u.MercatorCoordinate(-O.y/N(O,A)+O.x,0)),z.y>1&&A.y>=0?z=new u.MercatorCoordinate((1-R.y)/N(R,z)+R.x,1):z.y<0&&A.y<=1&&(z=new u.MercatorCoordinate(-R.y/N(R,z)+R.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(R))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const l=i.visibleDemTiles.reduce((m,y)=>{if(y.dem){const b=y.dem.tree;m.min=Math.min(m.min,b.minimums[0]),m.max=Math.max(m.max,b.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*i.exaggeration(),l.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-l*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,l){return this.projection.createTileTransform(this,l).createTileMatrix(i)}calculateDistanceTileData(i){const l=i.key,m=this._distanceTileDataCache;if(m[l])return m[l];const y=i.canonical,b=1/this.height,T=this.cameraWorldSize/this.zoomScale(y.z),A=(y.x+Math.pow(2,y.z)*i.wrap)*T,z=y.y*T,R=this.point,O=this.angle,N=Math.sin(-O),$=-Math.cos(-O);return m[l]={bearing:[N,$],center:[(R.x-A)*b,(R.y-z)*b],scale:T/u.EXTENT*b},m[l]}calculateFogTileMatrix(i){const l=i.key,m=this._fogTileMatrixCache;if(m[l])return m[l];const y=this.calculatePosMatrix(i,this.cameraWorldSize);return u.multiply$1(y,this.worldToFogMatrix,y),m[l]=new Float32Array(y),m[l]}calculateProjMatrix(i,l=!1){const m=i.key,y=l?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];const b=this.calculatePosMatrix(i,this.worldSize);return u.multiply$1(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,b),y[m]=new Float32Array(b),y[m]}calculatePixelsToTileUnitsMatrix(i){const l=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[l])return m[l];const y=function(b,T){const{scale:A}=b.tileTransform,z=A*u.EXTENT/(b.tileSize*Math.pow(2,T.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return R=new Float32Array(4),$=(O=T.inverseAdjustmentMatrix)[1],X=O[2],W=O[3],dt=(N=[z,z])[1],R[0]=O[0]*(J=N[0]),R[1]=$*J,R[2]=X*dt,R[3]=W*dt,R;var R,O,N,$,X,W,J,dt}(i,this);return m[l]=y,m[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const l=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),y=this._camera.forward(),b=u.mercatorZfromAltitude(1,this._center.lat);m[2]/=b,y[2]/=b,u.normalize(y,y);const T=i.raycast(m,y,i.exaggeration());if(T){const A=u.scaleAndAdd([],m,y,T),z=new u.MercatorCoordinate(A[0],A[1],u.mercatorZfromAltitude(A[2],u.latFromMercatorY(A[1]))),R=(z.z+u.length([z.x-m[0],z.y-m[1],z.z-m[2]*b]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(R),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const l=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),y=i.getAtPointOrZero(new u.MercatorCoordinate(...m)),b=this._minimumHeightOverTerrain()*Math.cos(u.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*y;if(T<b){const A=this.locationCoordinate(this._center,this._centerAltitude),z=[A.x-m[0],A.y-m[1],A.z-m[2]],R=u.length(z);z[2]-=(b-T)/this._projectionScaler;const O=u.length(z);if(0===O)return;u.scale$2(z,z,R/O*this._projectionScaler),this._camera.position=[A.x-z[0],A.y-z[1],A.z*this._projectionScaler-z[2]],this._camera.orientation=jo(z,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const N=this.center;return N.lat=u.clamp(N.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(N.lng=u.clamp(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}const i=this._unmodified,{x:l,y:m}=this.point;let y=0,b=l,T=m;const A=this.width/2,z=this.height/2,R=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(m-z<R&&(T=R+z),m+z>O&&(T=O-z),O-R<this.height&&(y=Math.max(y,this.height/(O-R)),T=(O+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const N=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,X=this.worldSize/2-(N+$)/2;b=(l+X+this.worldSize)%this.worldSize-X,b-A<N&&(b=N+A),b+A>$&&(b=$-A),$-N<this.width&&(y=Math.max(y,this.width/($-N)),b=($+N)/2)}b===l&&T===m||(this.center=this.unproject(new u.pointGeometry(b,T))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this._fov/2,l=this.centerOffset,m=this.pixelsPerMeter;this._projectionScaler=m/(u.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(i)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?m:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-l.x/this.width,b[9]=2*l.y/this.height;let T=u.mul([],b,y);if(this.projection.isReprojectedInTileSpace){const st=this.locationCoordinate(this.center),at=u.identity([]);u.translate(at,at,[st.x*this.worldSize,st.y*this.worldSize,0]),u.multiply$1(at,at,Vc(this)),u.translate(at,at,[-st.x*this.worldSize,-st.y*this.worldSize,0]),u.multiply$1(T,T,at),this.inverseAdjustmentMatrix=function(pt){const At=Vc(pt,!0);return jt([],[At[0],At[1],At[4],At[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],T,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=T,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const A=new Float32Array(16);u.identity(A),u.scale(A,A,[1,-1,1]),u.rotateX(A,A,this._pitch),u.rotateZ(A,A,this.angle);const z=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-l.x/this.width,z[9]=2*(l.y+R)/this.height,this.skyboxMatrix=u.multiply$1(A,z,A);const O=this.point,N=O.x,$=O.y,X=this.width%2/2,W=this.height%2/2,J=Math.cos(this.angle),dt=Math.sin(this.angle),K=N-Math.round(N)+J*X+dt*W,lt=$-Math.round($)+J*W+dt*X,ot=new Float64Array(T);if(u.translate(ot,ot,[K>.5?K-1:K,lt>.5?lt-1:lt,0]),this.alignedProjMatrix=ot,T=u.create(),u.scale(T,T,[this.width/2,-this.height/2,1]),u.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=u.create(),u.scale(T,T,[1,-1,1]),u.translate(T,T,[-1,-1,0]),u.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=u.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=u.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");this.pixelMatrixInverse=T,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,l=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height,b=[i,i,l];u.scale$2(b,b,y),u.scale$2(m,m,-1),u.multiply$2(m,m,b);const T=u.create();u.translate(T,T,m),u.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,l,y)}_computeCameraPosition(i){const l=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*l-i/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*b,y.y/this.worldSize-m[1]*b,i/this.worldSize*this._centerAltitude-m[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=i[2];let y=1;m>0&&(y=Math.min((l-this._camera.position[2])/m,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,i,y),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,l=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),b=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),A=Math.max((i[2]-b)/Math.cos(m),T),z=this._zoomFromMercatorZ(A);u.scaleAndAdd(i,i,l,A),this._pitch=u.clamp(m,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(y,-Math.PI,Math.PI),this._setZoom(u.clamp(z,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new u.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,l){const m=Math.min(i.x,l.x),y=Math.max(i.x,l.x),b=Math.min(i.y,l.y),T=Math.max(i.y,l.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new u.pointGeometry(m,b),new u.pointGeometry(y,T),new u.pointGeometry(m,T),new u.pointGeometry(y,b)],z=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const O of A){const N=this.pointRayIntersection(O);if(N.t<0)return!0;const $=this.rayIntersectionCoordinate(N);if($.x<z||$.y<0||$.x>R||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.pointGeometry(0,0),new u.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,l){const m=u.length(u.sub([],this._camera.position,i)),y=this._zoomFromMercatorZ(m)+l;return m-this._mercatorZfromZoom(y)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.pointGeometry(0,i))}}function gs(p,i){let l=!1,m=null;const y=()=>{m=null,l&&(p(),m=setTimeout(y,i),l=!1)};return()=>(l=!0,m||y(),m)}class pa{constructor(i){this._hashName=i&&encodeURIComponent(i),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=gs(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,u.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return u.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const l=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),T=Math.round(l.lng*b)/b,A=Math.round(l.lat*b)/b,z=this._map.getBearing(),R=this._map.getPitch();let O="";if(O+=i?`/${T}/${A}/${m}`:`${m}/${A}/${T}`,(z||R)&&(O+="/"+Math.round(10*z)/10),R&&(O+=`/${Math.round(R)}`),this._hashName){const N=this._hashName;let $=!1;const X=u.window.location.hash.slice(1).split("&").map(W=>{const J=W.split("=")[0];return J===N?($=!0,`${J}=${O}`):W}).filter(W=>W);return $||X.push(`${N}=${O}`),`#${X.join("&")}`}return`#${O}`}_getCurrentHash(){const i=u.window.location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(l=m)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:l,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,i)}}const Cr={linearity:.3,easing:u.bezier(0,0,.3,1)},Os=u.extend({deceleration:2500,maxSpeed:1400},Cr),Uc=u.extend({deceleration:20,maxSpeed:1400},Cr),Sr=u.extend({deceleration:1e3,maxSpeed:360},Cr),gi=u.extend({deceleration:1e3,maxSpeed:90},Cr);class qo{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,l=u.exported.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new u.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)l.zoom+=b.zoomDelta||0,l.bearing+=b.bearingDelta||0,l.pitch+=b.pitchDelta||0,b.panDelta&&l.pan._add(b.panDelta),b.around&&(l.around=b.around),b.pinchAround&&(l.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(l.pan.mag()){const b=Ka(l.pan.mag(),m,u.extend({},Os,i||{}));y.offset=l.pan.mult(b.amount/l.pan.mag()),y.center=this._map.transform.center,Wo(y,b)}if(l.zoom){const b=Ka(l.zoom,m,Uc);y.zoom=this._map.transform.zoom+b.amount,Wo(y,b)}if(l.bearing){const b=Ka(l.bearing,m,Sr);y.bearing=this._map.transform.bearing+u.clamp(b.amount,-179,179),Wo(y,b)}if(l.pitch){const b=Ka(l.pitch,m,gi);y.pitch=this._map.transform.pitch+b.amount,Wo(y,b)}if(y.zoom||y.bearing){const b=void 0===l.pinchAround?l.around:l.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),u.extend(y,{noMoveStart:!0})}}function Wo(p,i){(!p.duration||p.duration<i.duration)&&(p.duration=i.duration,p.easing=i.easing)}function Ka(p,i,l){const{maxSpeed:m,linearity:y,deceleration:b}=l,T=u.clamp(p*y/(i/1e3),-m,m),A=Math.abs(T)/(b*y);return{easing:l.easing,duration:1e3*A,amount:T*(A/2)}}class vn extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,m,y={}){const b=Pt.mousePos(l.getCanvasContainer(),m),T=l.unproject(b);super(i,u.extend({point:b,lngLat:T,originalEvent:m},y)),this._defaultPrevented=!1,this.target=l}}class Ja extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,m){const y="touchend"===i?m.changedTouches:m.touches,b=Pt.touchPos(l.getCanvasContainer(),y),T=b.map(z=>l.unproject(z)),A=b.reduce((z,R,O,N)=>z.add(R.div(N.length)),new u.pointGeometry(0,0));super(i,{points:b,point:A,lngLats:T,lngLat:l.unproject(A),originalEvent:m}),this._defaultPrevented=!1}}class Nc extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class Yo{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Nc(i.type,this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new vn(i.type,this._map,i))}mouseup(i){this._map.fire(new vn(i.type,this._map,i))}preclick(i){const l=u.extend({},i);l.type="preclick",this._map.fire(new vn(l.type,this._map,l))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(i),this._map.fire(new vn(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new vn(i.type,this._map,i))}mouseover(i){this._map.fire(new vn(i.type,this._map,i))}mouseout(i){this._map.fire(new vn(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Ja(i.type,this._map,i))}touchmove(i){this._map.fire(new Ja(i.type,this._map,i))}touchend(i){this._map.fire(new Ja(i.type,this._map,i))}touchcancel(i){this._map.fire(new Ja(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zh{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(i){this._map.fire(new vn(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new vn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new vn(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bl{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&0===i.button&&(Pt.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;const m=l;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=Pt.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const b=Math.min(y.x,m.x),T=Math.max(y.x,m.x),A=Math.min(y.y,m.y),z=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=T-b+"px",this._box.style.height=z-A+"px")})}mouseupWindow(i,l){if(!this._active||0!==i.button)return;const m=this._startPos,y=l;if(this.reset(),Pt.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:b=>b.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Pt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new u.Event(i,{originalEvent:l}))}}function fa(p,i){const l={};for(let m=0;m<p.length;m++)l[p[m].identifier]=i[m];return l}class ma{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,l,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const b=new u.pointGeometry(0,0);for(const T of y)b._add(T);return b.div(y.length)}(l),this.touches=fa(m,l)))}touchmove(i,l,m){if(this.aborted||!this.centroid)return;const y=fa(m,l);for(const b in this.touches){const T=this.touches[b],A=y[b];(!A||A.dist(T)>30)&&(this.aborted=!0)}}touchend(i,l,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Qa{constructor(i){this.singleTap=new ma(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,l,m){this.singleTap.touchstart(i,l,m)}touchmove(i,l,m){this.singleTap.touchmove(i,l,m)}touchend(i,l,m){const y=this.singleTap.touchend(i,l,m);if(y){const b=i.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(b&&T||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Xo{constructor(){this._zoomIn=new Qa({numTouches:1,numTaps:2}),this._zoomOut=new Qa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,m){this._zoomIn.touchstart(i,l,m),this._zoomOut.touchstart(i,l,m)}touchmove(i,l,m){this._zoomIn.touchmove(i,l,m),this._zoomOut.touchmove(i,l,m)}touchend(i,l,m){const y=this._zoomIn.touchend(i,l,m),b=this._zoomOut.touchend(i,l,m);return y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:i})}):b?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const jc={0:1,2:2};class Fs{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;const m=Pt.mouseButton(i);this._correctButton(i,m)&&(this._lastPoint=l,this._eventButton=m)}mousemoveWindow(i,l){const m=this._lastPoint;if(m)if(i.preventDefault(),function(y,b){const T=jc[b];return void 0===y.buttons||(y.buttons&T)!==T}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(m,l)}mouseupWindow(i){this._lastPoint&&Pt.mouseButton(i)===this._eventButton&&(this._moved&&Pt.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class to extends Fs{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return 0===l&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class pr extends Fs{_correctButton(i,l){return 0===l&&i.ctrlKey||2===l}_move(i,l){const m=.8*(l.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class eo extends Fs{_correctButton(i,l){return 0===l&&i.ctrlKey||2===l}_move(i,l){const m=-.5*(l.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class Ko{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.pointGeometry(0,0)}touchstart(i,l,m){return this._calculateTransform(i,l,m)}touchmove(i,l,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,l,m)}}touchend(i,l,m){this._calculateTransform(i,l,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,m){m.length>0&&(this._active=!0);const y=fa(m,l),b=new u.pointGeometry(0,0),T=new u.pointGeometry(0,0);let A=0;for(const R in y){const O=y[R],N=this._touches[R];N&&(b._add(O),T._add(O.sub(N)),A++,y[R]=O)}if(this._touches=y,A<this._minTouches||!T.mag())return;const z=T.div(A);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(A),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pt.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Jo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,l,m){return{}}touchstart(i,l,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,m){if(!this._firstTwoTouches)return;i.preventDefault();const[y,b]=this._firstTwoTouches,T=Yr(m,l,y),A=Yr(m,l,b);if(!T||!A)return;const z=this._aroundCenter?null:T.add(A).div(2);return this._move([T,A],z,i)}touchend(i,l,m){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,T=Yr(m,l,y),A=Yr(m,l,b);T&&A||(this._active&&Pt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Yr(p,i,l){for(let m=0;m<p.length;m++)if(p[m].identifier===l)return i[m]}function Qo(p,i){return Math.log(p/i)/Math.LN2}class io extends Jo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Qo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qo(this._distance,m),pinchAround:l}}}function no(p,i){return 180*p.angleWith(i)/Math.PI}class ro extends Jo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){const m=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:no(this._vector,m),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const l=25/(Math.PI*this._minDiameter)*360,m=no(i,this._startVector);return Math.abs(m)<l}}function tl(p){return Math.abs(p.y)>Math.abs(p.x)}class ys extends Jo{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(i){this._lastPoints=i,tl(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,m){const y=i[0].sub(this._lastPoints[0]),b=i[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&m.touches.length<3)&&(this._valid=this.gestureBeginsVertically(y,b,m.timeStamp),this._valid))return this._lastPoints=i,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5}}gestureBeginsVertically(i,l,m){if(void 0!==this._valid)return this._valid;const y=i.mag()>=2,b=l.mag()>=2;if(!y&&!b)return;if(!y||!b)return void 0===this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const T=i.y>0==l.y>0;return tl(i)&&tl(l)&&T}}const so={panStep:100,bearingStep:15,pitchStep:10};class $h{constructor(){const i=so;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,m=0,y=0,b=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),b=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),b=1);break;case 38:i.shiftKey?y=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?y=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:A=>{const z=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:ao,zoom:l?Math.round(z)+l*(i.shiftKey?2:1):z,bearing:A.getBearing()+m*this._bearingStep,pitch:A.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:A.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ao(p){return p*(2-p)}const Vl=4.000244140625;class el{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=i.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=u.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==l&&l%Vl==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(y*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Pt.mousePos(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,l=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const z="wheel"===this._type&&Math.abs(this._delta)>Vl?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&0!==R&&(R=1/R);const O=l(),N=Math.pow(2,O),$="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom($*R))),"wheel"===this._type&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:l(),y=this._startZoom,b=this._easing;let T,A=!1;if("wheel"===this._type&&y&&b){const z=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),R=b(z);T=u.number(y,m,R),z<1?this._frameId||(this._frameId=!0):A=!0}else T=m,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:T-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=u.ease;if(this._prevEase){const m=this._prevEase,y=(u.exported.now()-m.start)/m.duration,b=m.easing(y+.01)-m.easing(y),T=.27/Math.sqrt(b*b+1e-4)*.01,A=Math.sqrt(.0729-T*T);l=u.bezier(T,A,.25,1)}return this._prevEase={start:u.exported.now(),duration:i,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pt.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!u.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class oo{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,l){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class il{constructor(){this._tap=new Qa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,l,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=l[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,l,m))}touchmove(i,l,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=l[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,i.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(i,l,m)}touchend(i,l,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(i,l,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nl{constructor(i,l,m){this._el=i,this._mousePan=l,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ul{constructor(i,l,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rl{constructor(i,l,m,y){this._el=i,this._touchZoom=l,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _a=p=>p.zoom||p.drag||p.pitch||p.rotate;class Zc extends u.Event{}class Nl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,l){const m=u.sub([],l,i);this.radius=u.length(m[2]<0?u.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){u.div(i,i,this.constants),u.normalize(i,i),u.mul$1(i,i,this.constants);const l=u.scale$2([],i,this.radius);if(l[2]>0){const m=u.scale$2([],[0,0,1],u.dot(l,[0,0,1])),y=u.scale$2([],u.normalize([],[l[0],l[1],0]),this.radius),b=u.add([],l,u.scale$2([],u.sub([],u.add([],y,m),l),2));l[0]=b[0],l[1]=b[1]}return l}}function Xr(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Bs{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qo(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Nl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),u.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[y,b,T]of this._listeners)y.addEventListener(b,y===u.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[i,l,m]of this._listeners)i.removeEventListener(l,i===u.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const l=this._map,m=l.getCanvasContainer();this._add("mapEvent",new Yo(l,i));const y=l.boxZoom=new Bl(l,i);this._add("boxZoom",y);const b=new Xo,T=new Gc;l.doubleClickZoom=new oo(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const A=new il;this._add("tapDragZoom",A);const z=l.touchPitch=new ys(l);this._add("touchPitch",z);const R=new pr(i),O=new eo(i);l.dragRotate=new Ul(i,R,O),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const N=new to(i),$=new Ko(l,i);l.dragPan=new nl(m,N,$),this._add("mousePan",N),this._add("touchPan",$,["touchZoom","touchRotate"]);const X=new ro,W=new io;l.touchZoomRotate=new rl(m,W,X,A),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Zh(l));const J=l.scrollZoom=new el(l,this);this._add("scrollZoom",J,["mousePan"]);const dt=l.keyboard=new $h;this._add("keyboard",dt);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[K]&&l[K].enable(i[K])}_add(i,l,m){this._handlers.push({handlerName:i,handler:l,allowed:m}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(_a(this._eventsInProgress))||this.isZooming()}_blockedByActive(i,l,m){for(const y in i)if(y!==m&&(!l||l.indexOf(y)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const l=[];for(const m of i)this._el.contains(m.target)&&l.push(m);return l}handleEvent(i,l){this._updatingCamera=!0;const m="renderFrame"===i.type,y=m?void 0:i,b={needsRenderFrame:!1},T={},A={},z=i.touches?this._getMapTouches(i.touches):void 0,R=z?Pt.touchPos(this._el,z):m?void 0:Pt.mousePos(this._el,i);for(const{handlerName:$,handler:X,allowed:W}of this._handlers){if(!X.isEnabled())continue;let J;this._blockedByActive(A,W,$)?X.reset():X[l||i.type]&&(J=X[l||i.type](i,R,z),this.mergeHandlerResult(b,T,J,$,y),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||X.isActive())&&(A[$]=X)}const O={};for(const $ in this._previousActiveHandlers)A[$]||(O[$]=y);this._previousActiveHandlers=A,(Object.keys(O).length||Xr(b))&&(this._changes.push([b,T,O]),this._triggerRenderFrame()),(Object.keys(A).length||Xr(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=b;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(i,l,m,y,b){if(!m)return;u.extend(i,m);const T={handlerName:y,originalEvent:m.originalEvent||b};void 0!==m.zoomDelta&&(l.zoom=T),void 0!==m.panDelta&&(l.drag=T),void 0!==m.pitchDelta&&(l.pitch=T),void 0!==m.bearingDelta&&(l.rotate=T)}_applyChanges(){const i={},l={},m={};for(const[y,b,T]of this._changes)y.panDelta&&(i.panDelta=(i.panDelta||new u.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(i.around=y.around),void 0!==y.aroundCoord&&(i.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(i.pinchAround=y.pinchAround),y.noInertia&&(i.noInertia=y.noInertia),u.extend(l,b),u.extend(m,T);this._updateMapTransform(i,l,m),this._changes=[]}_updateMapTransform(i,l,m){const y=this._map,b=y.transform,T=lt=>[lt.x,lt.y,lt.z];if((lt=>{const ot=this._eventsInProgress.drag;return ot&&!this._handlersById[ot.handlerName].isActive()})()&&!Xr(i)){const lt=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",lt!==b.zoom&&this._map._update(!0)}if(!Xr(i))return this._fireEvents(l,m,!0);let{panDelta:A,zoomDelta:z,bearingDelta:R,pitchDelta:O,around:N,aroundCoord:$,pinchAround:X}=i;void 0!==X&&(N=X),(lt=>l.drag&&!this._eventsInProgress.drag)()&&N&&(this._dragOrigin=T(b.pointCoordinate3D(N)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),N=N||y.transform.centerPoint,R&&(b.bearing+=R),O&&(b.pitch+=O),b._updateCameraState();const W=[0,0,0];if(A){const lt=b.pointCoordinate(N),ot=b.pointCoordinate(N.sub(A));lt&&ot&&(W[0]=ot.x-lt.x,W[1]=ot.y-lt.y)}const J=b.zoom,dt=[0,0,0];if(z){const lt=T($||b.pointCoordinate3D(N)),ot={dir:u.normalize([],u.sub([],lt,b._camera.position))};if(ot.dir[2]<0){const st=b.zoomDeltaToMovement(lt,z);u.scale$2(dt,ot.dir,st)}}const K=u.add(W,W,dt);b._translateCameraConstrained(K),z&&Math.abs(b.zoom-J)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,m,!0)}_fireEvents(i,l,m){const y=_a(this._eventsInProgress),b=_a(i),T={};for(const O in i){const{originalEvent:N}=i[O];this._eventsInProgress[O]||(T[`${O}start`]=N),this._eventsInProgress[O]=i[O]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const O in T)this._fireEvent(O,T[O]);b&&this._fireEvent("move",b.originalEvent);for(const O in i){const{originalEvent:N}=i[O];this._fireEvent(O,N)}const A={};let z;for(const O in this._eventsInProgress){const{handlerName:N,originalEvent:$}=this._eventsInProgress[O];this._handlersById[N].isActive()||(delete this._eventsInProgress[O],z=l[N]||$,A[`${O}end`]=z)}for(const O in A)this._fireEvent(O,A[O]);const R=_a(this._eventsInProgress);if(m&&(y||b)&&!R){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=$=>0!==$&&-this._bearingSnap<$&&$<this._bearingSnap;O?(N(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:z})):(this._map.fire(new u.Event("moveend",{originalEvent:z})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new u.Event(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Zc("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Vs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $c extends u.Evented{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,m){return i=u.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,u.extend({offset:i},l),m)}panTo(i,l,m){return this.easeTo(u.extend({center:i},l),m)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,m){return this.easeTo(u.extend({zoom:i},l),m)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,m){return this.easeTo(u.extend({bearing:i},l),m)}resetNorth(i,l){return this.rotateTo(0,u.extend({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){i=u.LngLatBounds.convert(i);const m=l&&l.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),m,l)}_extendCameraOptions(i){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=u.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const m=i.padding;i.padding={top:m,bottom:m,right:m,left:m}}return i.padding=u.extend(l,i.padding),i}_cameraForBoxAndBearing(i,l,m,y){const b=this._extendCameraOptions(y),T=this.transform,A=T.padding,z=T.project(u.LngLat.convert(i)),R=T.project(u.LngLat.convert(l)),O=z.rotate(-u.degToRad(m)),N=R.rotate(-u.degToRad(m)),$=new u.pointGeometry(Math.max(O.x,N.x),Math.max(O.y,N.y)),X=new u.pointGeometry(Math.min(O.x,N.x),Math.min(O.y,N.y)),W=$.sub(X),J=(T.width-(A.left+A.right+b.padding.left+b.padding.right))/W.x,dt=(T.height-(A.top+A.bottom+b.padding.top+b.padding.bottom))/W.y;if(dt<0||J<0)return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const K=Math.min(T.scaleZoom(T.scale*Math.min(J,dt)),b.maxZoom),lt="number"==typeof b.offset.x?new u.pointGeometry(b.offset.x,b.offset.y):u.pointGeometry.convert(b.offset),ot=new u.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(m*Math.PI/180),st=lt.add(ot).mult(T.scale/T.zoomScale(K));return{center:T.unproject(z.add(R).div(2).sub(st)),zoom:K,bearing:m}}_cameraForBox(i,l,m,y,b){const T=this._extendCameraOptions(b);m=m||0,y=y||0,i=u.LngLat.convert(i),l=u.LngLat.convert(l);const A=this.transform.clone();A.padding=T.padding;const z=this.getFreeCameraOptions(),R=new u.LngLat(.5*(i.lng+l.lng),.5*(i.lat+l.lat)),O=.5*(m+y);if(A._camera.position[2]<u.mercatorZfromAltitude(O,R.lat))return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");z.lookAtPoint(R),A.setFreeCameraOptions(z);const N=u.MercatorCoordinate.fromLngLat(i),$=u.MercatorCoordinate.fromLngLat(l),X=A.pointRayIntersection(A.centerPoint,O),W=[(J=A.rayIntersectionCoordinate(X)).x,J.y,J.z];var J;const dt=A.screenPointToMercatorRay(A.centerPoint),K="globe"!==A.projection.name;let lt,ot=0;do{const st=Math.floor(A.zoom),at=1<<st,pt=Math.min(at*N.x,at*$.x),At=Math.min(at*N.y,at*$.y),It=Math.max(at*N.x,at*$.x),ee=Math.max(at*N.y,at*$.y),qt=new u.Aabb([pt,At,m],[It,ee,y]),Yt=u.Frustum.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,st,K);if(2!==qt.intersects(Yt)){lt&&(A._camera.position=u.scaleAndAdd([],A._camera.position,dt.dir,-lt),A._updateStateFromCamera());break}const Lt=u.sub([],A._camera.position,W);lt=.5*u.length(Lt),A._camera.position=u.scaleAndAdd([],A._camera.position,dt.dir,lt);try{A._updateStateFromCamera()}catch(Dt){return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ot<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(i,l,m){return this._fitInternal(this.cameraForBounds(i,l),l,m)}_raycastElevationBox(i,l){const m=this.transform.elevation;if(!m)return;const y=new u.pointGeometry(i.x,l.y),b=new u.pointGeometry(l.x,i.y),T=m.pointCoordinate(i);if(!T)return;const A=m.pointCoordinate(l);if(!A)return;const z=m.pointCoordinate(y);if(!z)return;const R=m.pointCoordinate(b);if(!R)return;const O=new u.MercatorCoordinate(T[0],T[1]).toLngLat(),N=new u.MercatorCoordinate(A[0],A[1]).toLngLat(),$=new u.MercatorCoordinate(z[0],z[1]).toLngLat(),X=new u.MercatorCoordinate(R[0],R[1]).toLngLat(),W=Math.min(O.lng,Math.min(N.lng,Math.min($.lng,X.lng))),J=Math.min(O.lat,Math.min(N.lat,Math.min($.lat,X.lat))),dt=Math.max(O.lng,Math.max(N.lng,Math.max($.lng,X.lng))),K=Math.max(O.lat,Math.max(N.lat,Math.max($.lat,X.lat))),lt=Math.min(T[3],Math.min(A[3],Math.min(z[3],R[3]))),ot=Math.max(T[3],Math.max(A[3],Math.max(z[3],R[3])));return{minLngLat:new u.LngLat(W,J),maxLngLat:new u.LngLat(dt,K),minAltitude:lt,maxAltitude:ot}}fitScreenCoordinates(i,l,m,y,b){let T,A,z,R;const O=u.pointGeometry.convert(i),N=u.pointGeometry.convert(l),$=this._raycastElevationBox(O,N);if($)T=$.minLngLat,A=$.maxLngLat,z=$.minAltitude,R=$.maxAltitude;else{if(this.transform.anyCornerOffEdge(O,N))return this;T=this.transform.pointLocation(O),A=this.transform.pointLocation(N)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(u.pointGeometry.convert(i)),this.transform.pointLocation(u.pointGeometry.convert(l)),m,y):this._cameraForBox(T,A,z,R,y),y,b)}_fitInternal(i,l,m){return i?(delete(l=u.extend(i,l)).padding,l.linear?this.easeTo(l,m):this.flyTo(l,m)):this}jumpTo(i,l){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,T=!1;return"zoom"in i&&m.zoom!==+i.zoom&&(y=!0,m.zoom=+i.zoom),void 0!==i.center&&(m.center=u.LngLat.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(b=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(T=!0,m.pitch=+i.pitch),null==i.padding||m.isPaddingEqual(i.padding)||(m.padding=i.padding),i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new u.Event("movestart",l)).fire(new u.Event("move",l)),y&&this.fire(new u.Event("zoomstart",l)).fire(new u.Event("zoom",l)).fire(new u.Event("zoomend",l)),b&&this.fire(new u.Event("rotatestart",l)).fire(new u.Event("rotate",l)).fire(new u.Event("rotateend",l)),T&&this.fire(new u.Event("pitchstart",l)).fire(new u.Event("pitch",l)).fire(new u.Event("pitchend",l)),this.fire(new u.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce(Vs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,l){const m=this.transform;if(!m.projection.supportsFreeCamera)return void u.warnOnce(Vs);this.stop();const y=m.zoom,b=m.pitch,T=m.bearing;m.setFreeCameraOptions(i);const A=y!==m.zoom,z=b!==m.pitch,R=T!==m.bearing;return this.fire(new u.Event("movestart",l)).fire(new u.Event("move",l)),A&&this.fire(new u.Event("zoomstart",l)).fire(new u.Event("zoom",l)).fire(new u.Event("zoomend",l)),R&&this.fire(new u.Event("rotatestart",l)).fire(new u.Event("rotate",l)).fire(new u.Event("rotateend",l)),z&&this.fire(new u.Event("pitchstart",l)).fire(new u.Event("pitch",l)).fire(new u.Event("pitchend",l)),this.fire(new u.Event("moveend",l)),this}easeTo(i,l){this._stop(!1,i.easeId),(!1===(i=u.extend({offset:[0,0],duration:500,easing:u.ease},i)).animate||!i.essential&&u.exported.prefersReducedMotion)&&(i.duration=0);const m=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),A=this.getPadding(),z="zoom"in i?+i.zoom:y,R="bearing"in i?this._normalizeBearing(i.bearing,b):b,O="pitch"in i?+i.pitch:T,N="padding"in i?i.padding:m.padding,$=u.pointGeometry.convert(i.offset);let X=m.centerPoint.add($);const W="globe"===m.projection.name?m.pointCoordinate(X).toLngLat():m.pointLocation(X),J=u.LngLat.convert(i.center||W);this._normalizeCenter(J);const dt=m.project(W),K=m.project(J).sub(dt),lt=m.zoomScale(z-y);let ot,st;i.around&&(ot=u.LngLat.convert(i.around),st=m.locationPoint(ot));const at=this._zooming||z!==y,pt=this._rotating||b!==R,At=this._pitching||O!==T,It=!m.isPaddingEqual(N),ee=Yt=>Lt=>{if(at&&(Yt.zoom=u.number(y,z,Lt)),pt&&(Yt.bearing=u.number(b,R,Lt)),At&&(Yt.pitch=u.number(T,O,Lt)),It&&(Yt.interpolatePadding(A,N,Lt),X=Yt.centerPoint.add($)),ot)Yt.setLocationAtPoint(ot,st);else{const Dt=Yt.zoomScale(Yt.zoom-y),Zt=z>y?Math.min(2,lt):Math.max(.5,lt),Ut=Math.pow(Zt,1-Lt),xe=Yt.unproject(dt.add(K.mult(Lt*Ut)).mult(Dt));Yt.setLocationAtPoint(Yt.renderWorldCopies?xe.wrap():xe,X)}return i.preloadOnly||this._fireMoveEvents(l),Yt};if(i.preloadOnly){const Yt=this._emulate(ee,i.duration,m);return this._preloadTiles(Yt),this}const qt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=at,this._rotating=pt,this._pitching=At,this._padding=It,this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,qt),this._ease(ee(m),Yt=>{m.recenterOnTerrain(),this._afterEase(l,Yt)},i),this}_prepareEase(i,l,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||m.moving||this.fire(new u.Event("movestart",i)),this._zooming&&!m.zooming&&this.fire(new u.Event("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new u.Event("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new u.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new u.Event("move",i)),this._zooming&&this.fire(new u.Event("zoom",i)),this._rotating&&this.fire(new u.Event("rotate",i)),this._pitching&&this.fire(new u.Event("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new u.Event("zoomend",i)),y&&this.fire(new u.Event("rotateend",i)),b&&this.fire(new u.Event("pitchend",i)),this.fire(new u.Event("moveend",i))}flyTo(i,l){if(!i.essential&&u.exported.prefersReducedMotion){const te=u.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(te,l)}this.stop(),i=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},i);const m=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),A=this.getPadding(),z="zoom"in i?u.clamp(+i.zoom,m.minZoom,m.maxZoom):y,R="bearing"in i?this._normalizeBearing(i.bearing,b):b,O="pitch"in i?+i.pitch:T,N="padding"in i?i.padding:m.padding,$=m.zoomScale(z-y),X=u.pointGeometry.convert(i.offset);let W=m.centerPoint.add(X);const J=m.pointLocation(W),dt=u.LngLat.convert(i.center||J);this._normalizeCenter(dt);const K=m.project(J),lt=m.project(dt).sub(K);let ot=i.curve;const st=Math.max(m.width,m.height),at=st/$,pt=lt.mag();if("minZoom"in i){const te=u.clamp(Math.min(i.minZoom,y,z),m.minZoom,m.maxZoom),Pe=st/m.zoomScale(te-y);ot=Math.sqrt(Pe/pt*2)}const At=ot*ot;function It(te){const Pe=(at*at-st*st+(te?-1:1)*At*At*pt*pt)/(2*(te?at:st)*At*pt);return Math.log(Math.sqrt(Pe*Pe+1)-Pe)}function ee(te){return(Math.exp(te)-Math.exp(-te))/2}function qt(te){return(Math.exp(te)+Math.exp(-te))/2}const Yt=It(0);let Lt=function(te){return qt(Yt)/qt(Yt+ot*te)},Dt=function(te){return st*((qt(Yt)*(ee(Pe=Yt+ot*te)/qt(Pe))-ee(Yt))/At)/pt;var Pe},Zt=(It(1)-Yt)/ot;if(Math.abs(pt)<1e-6||!isFinite(Zt)){if(Math.abs(st-at)<1e-6)return this.easeTo(i,l);const te=at<st?-1:1;Zt=Math.abs(Math.log(at/st))/ot,Dt=function(){return 0},Lt=function(Pe){return Math.exp(te*ot*Pe)}}i.duration="duration"in i?+i.duration:1e3*Zt/("screenSpeed"in i?+i.screenSpeed/ot:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Ut=b!==R,xe=O!==T,Ae=!m.isPaddingEqual(N),Qe=te=>Pe=>{const $e=Pe*Zt,si=1/Lt($e);te.zoom=1===Pe?z:y+te.scaleZoom(si),Ut&&(te.bearing=u.number(b,R,Pe)),xe&&(te.pitch=u.number(T,O,Pe)),Ae&&(te.interpolatePadding(A,N,Pe),W=te.centerPoint.add(X));const ki=1===Pe?dt:te.unproject(K.add(lt.mult(Dt($e))).mult(si));return te.setLocationAtPoint(te.renderWorldCopies?ki.wrap():ki,W),te._updateCenterElevation(),i.preloadOnly||this._fireMoveEvents(l),te};if(i.preloadOnly){const te=this._emulate(Qe,i.duration,m);return this._preloadTiles(te),this}return this._zooming=!0,this._rotating=Ut,this._pitching=xe,this._padding=Ae,this._prepareEase(l,!1),this._ease(Qe(m),()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,l)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,l,m){!1===m.animate||0===m.duration?(i(1),l()):(this._easeStart=u.exported.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=u.wrap(i,-180,180);const m=Math.abs(i-l);return Math.abs(i-360-l)<m&&(i-=360),Math.abs(i+360-l)<m&&(i+=360),i}_normalizeCenter(i){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const m=i.lng-l.center.lng;i.lng+=m>180?-360:m<-180?360:0}_emulate(i,l,m){const y=Math.ceil(15*l/1e3),b=[],T=i(m.clone());for(let A=0;A<=y;A++){const z=T(A/y);b.push(z.clone())}return b}}class jl{constructor(i={}){this.options=i,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const l=this.options&&this.options.compact;return this._map=i,this._container=Pt.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Pt.create("button","mapboxgl-ctrl-attrib-button",this._container),Pt.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Pt.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,l){const m=this._map._getUIString(`AttributionControl.${l}`);i.setAttribute("aria-label",m),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(i){const m=l.reduce((y,b,T)=>(b.value&&(y+=`${b.key}=${b.value}${T<l.length-1?"&":""}`),y),"?");i.href=`${u.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const l=this._map.style._sourceCaches;for(const y in l){const b=l[y];if(b.used){const T=b.getSource();T.attribution&&i.indexOf(T.attribution)<0&&i.push(T.attribution)}}i.sort((y,b)=>y.length-b.length),i=i.filter((y,b)=>{for(let T=b+1;T<i.length;T++)if(i[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gl{constructor(){u.bindAll(["_updateLogo"],this),u.bindAll(["_updateCompact"],this)}onAdd(i){this._map=i,this._container=Pt.create("div","mapboxgl-ctrl");const l=Pt.create("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const l in i){const m=i[l].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Zl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){const l=this._currentlyRunning,m=l?this._queue.concat(l):this._queue;for(const y of m)if(y.id===i)return void(y.cancelled=!0)}run(i=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const m of l)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sl(p,i,l){if(p=new u.LngLat(p.lng,p.lat),i){const m=new u.LngLat(p.lng-360,p.lat),y=new u.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-l.center.lng)/360),T=l.locationPoint(p).distSqr(i),A=i.x<0||i.y<0||i.x>l.width||i.y>l.height;l.locationPoint(m).distSqr(i)<T&&(A||Math.abs(m.lng-l.center.lng)<b)?p=m:l.locationPoint(y).distSqr(i)<T&&(A||Math.abs(y.lng-l.center.lng)<b)&&(p=y)}for(;Math.abs(p.lng-l.center.lng)>180;){const m=l.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=l.width&&m.y<=l.height)break;p.lng>l.center.lng?p.lng-=360:p.lng+=360}return p}const pn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class $l extends u.Evented{constructor(i,l){if(super(),(i instanceof u.window.HTMLElement||l)&&(i=u.extend({element:i},l)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=u.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Pt.create("div");const y=41,b=27,T=Pt.createSVG("svg",{display:"block",height:y*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${y}`},this._element),A=Pt.createSVG("radialGradient",{id:"shadowGradient"},Pt.createSVG("defs",{},T));Pt.createSVG("stop",{offset:"10%","stop-opacity":.4},A),Pt.createSVG("stop",{offset:"100%","stop-opacity":.05},A),Pt.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),Pt.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),Pt.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),Pt.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=u.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const m=this._element.classList;for(const y in pn)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=u.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const l=38.1,m=13.5,y=Math.sqrt(Math.pow(m,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-l],"bottom-left":[y,-1*(l-m+y)],"bottom-right":[-y,-1*(l-m+y)],left:[m,-1*(l-m)],right:[-m,-1*(l-m)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const l=i.code,m=i.charCode||i.keyCode;"Space"!==l&&"Enter"!==l&&32!==m&&13!==m||this.togglePopup()}_onMapClick(i){const l=i.originalEvent.target,m=this._element;this._popup&&(l===m||m.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(i))return void this._clearFadeTimer();const l=this._map.unproject(i);let m=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const b=this._map.getFreeCameraOptions();if(b.position){const T=b.position.toLngLat();m=T.distanceTo(l)<.9*T.distanceTo(this._lngLat)}}const y=(1-this._map._queryFogOpacity(l))*(m?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(i){const l=this._map.transform;return!!i&&i.x>=0&&i.x<l.width&&i.y>=0&&i.y<l.height}_updateDOM(){const i=this._pos||new u.pointGeometry(0,0),l=this._calculatePitch(),m=this._calculateRotation();this._element.style.transform=`${pn[this._anchor]} translate(${i.x}px, ${i.y}px) rotateX(${l}deg) rotateZ(${m}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(i){u.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=sl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===i?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const i=this._map.transform,l=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&l._rotate(i.angle),"map"===this._pitchAlignment&&(l.y*=Math.cos(i._pitch)),l}getOffset(){return this._offset}setOffset(i){return this._offset=u.pointGeometry.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&"auto"!==i?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Kr{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const l=u.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,l,m){this._start=this.getValue(l),this._end=i,this._startTime=l,this._endTime=l+m}}const Hc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:On,HTMLElement:Jr,ImageBitmap:Us}=u.window,En={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function al(p){p.parentNode&&p.parentNode.removeChild(p)}const Hh={showCompass:!0,showZoom:!0,visualizePitch:!1};class lo{constructor(i,l,m=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new pr({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new eo({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),Pt.disableDrag()}move(i,l){const m=this.map,y=this.mouseRotate.mousemoveWindow(i,l);if(y&&y.bearingDelta&&m.setBearing(m.getBearing()+y.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(i,l);b&&b.pitchDelta&&m.setPitch(m.getPitch()+b.pitchDelta)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Pt.enableDrag(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(u.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Pt.mousePos(this.element,i)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Pt.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=Pt.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=Pt.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const co={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let kn,ho=0,Ns=!1;const uo={maxWidth:100,unit:"metric"};function _e(p,i,l){const m=l&&l.maxWidth||100,y=p._containerHeight/2,b=p.unproject([0,y]),T=p.unproject([m,y]),A=b.distanceTo(T);if(l&&"imperial"===l.unit){const z=3.2808*A;z>5280?ga(i,m,z/5280,p._getUIString("ScaleControl.Miles"),p):ga(i,m,z,p._getUIString("ScaleControl.Feet"),p)}else l&&"nautical"===l.unit?ga(i,m,A/1852,p._getUIString("ScaleControl.NauticalMiles"),p):A>=1e3?ga(i,m,A/1e3,p._getUIString("ScaleControl.Kilometers"),p):ga(i,m,A,p._getUIString("ScaleControl.Meters"),p)}function ga(p,i,l,m,y){const b=function(A){const z=Math.pow(10,`${Math.floor(A)}`.length-1);let R=A/z;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(O){const N=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*N)/N}(R),z*R}(l),T=b/l;y._requestDomTask(()=>{p.style.width=i*T+"px",p.innerHTML=`${b}&nbsp;${m}`})}const po={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},fo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),xs={version:u.version,supported:B,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends $c{constructor(p){if(null!=(p=u.extend({},En,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Xa(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new Zl,this._domRenderTaskQueue=new Zl,this._controls=[],this._markers=[],this._mapId=u.uniqueId(),this._locale=u.extend({},Hc,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Kr(0),this._requestManager=new u.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=u.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof Jr))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Bs(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new pa("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,u.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new jl({customAttribution:p.customAttribution})),this._logoControl=new Gl,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new u.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new u.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(p,i){if(void 0===i&&(i=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[i];return-1!==i.indexOf("bottom")?m.insertBefore(l,m.firstChild):m.appendChild(l),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(p);return i>-1&&this._controls.splice(i,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new u.Event("movestart",p)).fire(new u.Event("move",p)),this.fire(new u.Event("resize",p)),i&&this.fire(new u.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(u.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=null==p?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=null==p?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=null==p?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=null==p?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getProjection(){return this.transform.getProjection()}setProjection(p){return this._lazyInitEmptyStyle(),"string"==typeof p&&(p={name:p}),this._runtimeProjection=p,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(p){return this.transform.locationPoint3D(u.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(u.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(p,i,l){if("mouseenter"===p||"mouseover"===p){let m=!1;const y=T=>{const A=i.filter(R=>this.getLayer(R)),z=A.length?this.queryRenderedFeatures(T.point,{layers:A}):[];z.length?m||(m=!0,l.call(this,new vn(p,this,T.originalEvent,{features:z}))):m=!1},b=()=>{m=!1};return{layers:new Set(i),listener:l,delegates:{mousemove:y,mouseout:b}}}if("mouseleave"===p||"mouseout"===p){let m=!1;const y=T=>{const A=i.filter(z=>this.getLayer(z));(A.length?this.queryRenderedFeatures(T.point,{layers:A}):[]).length?m=!0:m&&(m=!1,l.call(this,new vn(p,this,T.originalEvent)))},b=T=>{m&&(m=!1,l.call(this,new vn(p,this,T.originalEvent)))};return{layers:new Set(i),listener:l,delegates:{mousemove:y,mouseout:b}}}{const m=y=>{const b=i.filter(A=>this.getLayer(A)),T=b.length?this.queryRenderedFeatures(y.point,{layers:b}):[];T.length&&(y.features=T,l.call(this,y),delete y.features)};return{layers:new Set(i),listener:l,delegates:{[p]:m}}}}on(p,i,l){if(void 0===l)return super.on(p,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(p,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(p,i,l){if(void 0===l)return super.once(p,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(p,i,l);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(p,i,l){if(void 0===l)return super.off(p,i);i=new Set(Array.isArray(i)?i:[i]);const m=(b,T)=>{if(b.size!==T.size)return!1;for(const A of b)if(!T.has(A))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[p]:void 0;return y&&(b=>{for(let T=0;T<b.length;T++){const A=b[T];if(A.listener===l&&m(A.layers,i)){for(const z in A.delegates)this.off(z,A.delegates[z]);return b.splice(T,1),this}}})(y),this}queryRenderedFeatures(p,i){return this.style?(void 0!==i||void 0===p||p instanceof u.pointGeometry||Array.isArray(p)||(i=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(p,i){return this.style.querySourceFeatures(p,i)}queryTerrainElevation(p,i){const l=this.transform.elevation;return l?(i=u.extend({},{exaggerated:!0},i),l.getAtPoint(u.MercatorCoordinate.fromLngLat(p),null,i.exaggerated)):null}setStyle(p,i){return!1!==(i=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(p,i))}_getUIString(p){const i=this._locale[p];if(null==i)throw new Error(`Missing UI string '${p}'`);return i}_updateStyle(p,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),p&&(this.style=new Ln(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ln(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,i){if("string"==typeof p){const l=this._requestManager.normalizeStyleURL(p),m=this._requestManager.transformRequest(l,u.ResourceType.Style);u.getJSON(m,(y,b)=>{y?this.fire(new u.ErrorEvent(y)):b&&this._updateDiff(b,i)})}else"object"==typeof p&&this._updateDiff(p,i)}_updateDiff(p,i){try{this.style.setState(p)&&this._update(!0)}catch(l){u.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(p,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.warnOnce("There is no style added to the map.")}addSource(p,i){return this._lazyInitEmptyStyle(),this.style.addSource(p,i),this._update(!0)}isSourceLoaded(p){const i=this.style&&this.style._getSourceCaches(p);if(0!==i.length)return i.every(l=>l.loaded());this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const i in p){const l=p[i]._tiles;for(const m in l){const y=l[m];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(p,i,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,i,l)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,i,{pixelRatio:l=1,sdf:m=!1,stretchX:y,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),i instanceof On||Us&&i instanceof Us){const{width:A,height:z,data:R}=u.exported.getImageData(i);this.style.addImage(p,{data:new u.RGBAImage({width:A,height:z},R),pixelRatio:l,stretchX:y,stretchY:b,content:T,sdf:m,version:0})}else{if(void 0===i.width||void 0===i.height)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:z,data:R}=i,O=i;this.style.addImage(p,{data:new u.RGBAImage({width:A,height:z},new Uint8Array(R)),pixelRatio:l,stretchX:y,stretchY:b,content:T,sdf:m,version:0,userImage:O}),O.onAdd&&O.onAdd(this,p)}}}updateImage(p,i){const l=this.style.getImage(p);if(!l)return this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof On||Us&&i instanceof Us?u.exported.getImageData(i):i,{width:y,height:b,data:T}=m;return void 0===y||void 0===b?this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==l.data.width||b!==l.data.height?this.fire(new u.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(l.data.replace(T,!(i instanceof On||Us&&i instanceof Us)),void this.style.updateImage(p,l))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,i){u.getImage(this._requestManager.transformRequest(p,u.ResourceType.Image),(l,m)=>{i(l,m instanceof On?u.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(p,i){return this._lazyInitEmptyStyle(),this.style.addLayer(p,i),this._update(!0)}moveLayer(p,i){return this.style.moveLayer(p,i),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,i,l){return this.style.setLayerZoomRange(p,i,l),this._update(!0)}setFilter(p,i,l={}){return this.style.setFilter(p,i,l),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,i,l,m={}){return this.style.setPaintProperty(p,i,l,m),this._update(!0)}getPaintProperty(p,i){return this.style.getPaintProperty(p,i)}setLayoutProperty(p,i,l,m={}){return this.style.setLayoutProperty(p,i,l,m),this._update(!0)}getLayoutProperty(p,i){return this.style.getLayoutProperty(p,i)}setLight(p,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(p),this.transform):0}setFeatureState(p,i){return this.style.setFeatureState(p,i),this._update()}removeFeatureState(p,i){return this.style.removeFeatureState(p,i),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let l,m=this._container;for(;m&&!l;){const y=u.window.getComputedStyle(m).transform;y&&"none"!==y&&(l=y.match(/matrix.*\((.+)\)/)[1].split(", ")),m=m.parentElement}l?(this._containerWidth=l[0]&&"0"!==l[0]?Math.abs(p/l[0]):p,this._containerHeight=l[3]&&"0"!==l[3]?Math.abs(i/l[3]):i):(this._containerWidth=p,this._containerHeight=i)}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=Pt.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Pt.create("div","mapboxgl-canvas-container",p);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=Pt.create("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Pt.create("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=Pt.create("div",`mapboxgl-ctrl-${y}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,i){const l=u.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(p),this._canvas.height=l*Math.ceil(i),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${i}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const i=this._markers.indexOf(p);-1!==i&&this._markers.splice(i,1)}_setupPainter(){const p=u.extend({},B.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);i?(u.storeAuthState(i,!0),this.painter=new Oc(i,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(i)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let i;const l=this.painter.context.extTimerQuery,m=u.exported.now();this.listens("gpu-timing-frame")&&(i=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,i));let y=this._updateAverageElevation(m);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjection();let b=!1;const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,R=this.transform.pitch,O=u.exported.now();this.style.zoomHistory.update(z,O);const N=new u.EvaluationParameters(z,{now:O,fadeDuration:T,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),$=N.crossFadingFactor();1===$&&$===this._crossFadingFactor||(b=!0,this._crossFadingFactor=$),this.style.update(N)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const z=u.exported.now()-m;l.endQueryEXT(l.TIME_ELAPSED_EXT,i),setTimeout(()=>{const R=l.getQueryObjectEXT(i,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(i),this.fire(new u.Event("gpu-timing-frame",{cpuTime:z,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(z);this.fire(new u.Event("gpu-timing-layer",{layerTimes:R}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(A||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(y=this._updateAverageElevation(m,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,i=!1){const l=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((i||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();isNaN(y)?y=0:this._averageElevationLastSampledAt=p;const b=Math.abs(m-y);if(b>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(y),l(y);this._averageElevation.easeTo(y,p,300)}else if(b>1e-4)return this._averageElevation.jumpTo(y),l(y)}return!!this._averageElevation.isEasing(p)&&l(this._averageElevation.getValue(p))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===u.AUTH_ERR_MSG||401===p.status)){const i=this.painter.context.gl;u.storeAuthState(i,!1),this._logoControl instanceof Gl&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const l=this.painter.context.gl,m=l.createFramebuffer();function y(b){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,b,0);const T=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,T),T}return l.bindFramebuffer(l.FRAMEBUFFER,m),this._canvasPixelComparison(y(p),i.canvasCopies.map(y),i.timeStamps)}_canvasPixelComparison(p,i,l){let m=l[1]-l[0];const y=p.length/4;for(let b=0;b<i.length;b++){const T=i[b];let A=0;for(let z=0;z<T.length;z+=4)T[z]===p[z]&&T[z+1]===p[z+1]&&T[z+2]===p[z+2]&&T[z+3]===p[z+3]&&(A+=1);m+=(l[b+2]-l[b+1])*(1-A/y)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),al(this._canvasContainer),al(this._controlContainer),al(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=u.exported.frame(i=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(i)}))}_preloadTiles(p){const i=this.style&&Object.values(this.style._sourceCaches)||[];return u.asyncAll(i,(l,m)=>l._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,i){u.setCacheLimits(p,i)}get version(){return u.version}},NavigationControl:class{constructor(p){this.options=u.extend({},Hh,p),this._container=Pt.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),Pt.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),Pt.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=Pt.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const p=this._map.getZoom(),i=p===this._map.getMaxZoom(),l=p===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const p=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=p)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,i){const l=Pt.create("button",p,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(p,i){const l=this._map._getUIString(`NavigationControl.${i}`);p.setAttribute("aria-label",l),p.firstElementChild&&p.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends u.Evented{constructor(p){super(),this.options=u.extend({},co,p),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=gs(this._updateMarkerRotation,20)}onAdd(p){var i;return this._map=p,this._container=Pt.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==kn?i(kn):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(l=>{kn="denied"!==l.state,i(kn)}):(kn=!!u.window.navigator.geolocation,i(kn)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(u.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,ho=0,Ns=!1}_isOutOfMapMaxBounds(p){const i=this._map.getMaxBounds(),l=p.coords;return i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",p)),this._finish()}}_updateCamera(p){const i=new u.LngLat(p.coords.longitude,p.coords.latitude),l=p.coords.accuracy,m=this._map.getBearing(),y=u.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),y,{geolocateSource:!0})}_updateMarker(p){if(p){const i=new u.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._containerHeight/2,i=this._map.unproject([0,p]),l=this._map.unproject([100,p]),m=i.distanceTo(l)/100,y=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&Ns)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Pt.create("button","mapboxgl-ctrl-geolocate",this._container),Pt.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===p){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Pt.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Pt.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Pt.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $l({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Pt.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $l({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ho--,Ns=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ho++,ho>1?(p={maximumAge:6e5,timeout:0},Ns=!0):(p=this.options.positionOptions,Ns=!1),this._geolocationWatchID=u.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else u.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&p()}).catch(console.error):p()}_clearWatch(){u.window.navigator.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:jl,ScaleControl:class{constructor(p){this.options=u.extend({},uo,p),u.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){_e(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=Pt.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,_e(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof u.window.HTMLElement?this._container=p.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=Pt.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=Pt.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Pt.create("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden",!0),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(p){super(),this.options=u.extend(Object.create(po),p),u.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=u.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(u.window.document.createTextNode(p))}setHTML(p){const i=u.window.document.createDocumentFragment(),l=u.window.document.createElement("body");let m;for(l.innerHTML=p;m=l.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Pt.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._container&&this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._container&&this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let i;return this._classList.delete(p)?i=!1:(this._classList.add(p),i=!0),this._container&&this._updateClassList(),i}_createCloseButton(){this.options.closeButton&&(this._closeButton=Pt.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(p){this._update(p.point)}_onMouseMove(p){this._update(p.point)}_onDrag(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const i=this._pos,l=this._container.offsetWidth,m=this._container.offsetHeight;let y;return y=i.y+p.bottom.y<m?["top"]:i.y>this._map.transform.height-m?["bottom"]:[],i.x<l/2?y.push("left"):i.x>this._map.transform.width-l/2&&y.push("right"),0===y.length?"bottom":y.join("-")}_updateClassList(){const p=[...this._classList];p.push("mapboxgl-popup"),this._anchor&&p.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&p.push("mapboxgl-popup-track-pointer"),this._container.className=p.join(" ")}_update(p){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Pt.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Pt.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p){const i=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),l=function(b){if(b||(b=new u.pointGeometry(0,0)),"number"==typeof b){const T=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new u.pointGeometry(0,0),top:new u.pointGeometry(0,b),"top-left":new u.pointGeometry(T,T),"top-right":new u.pointGeometry(-T,T),bottom:new u.pointGeometry(0,-b),"bottom-left":new u.pointGeometry(T,-T),"bottom-right":new u.pointGeometry(-T,-T),left:new u.pointGeometry(b,0),right:new u.pointGeometry(-b,0)}}if(b instanceof u.pointGeometry||Array.isArray(b)){const T=u.pointGeometry.convert(b);return{center:T,top:T,"top-left":T,"top-right":T,bottom:T,"bottom-left":T,"bottom-right":T,left:T,right:T}}return{center:u.pointGeometry.convert(b.center||[0,0]),top:u.pointGeometry.convert(b.top||[0,0]),"top-left":u.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":u.pointGeometry.convert(b["top-right"]||[0,0]),bottom:u.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":u.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":u.pointGeometry.convert(b["bottom-right"]||[0,0]),left:u.pointGeometry.convert(b.left||[0,0]),right:u.pointGeometry.convert(b.right||[0,0])}}(this.options.offset),m=this._anchor=this._getAnchor(l),y=i.add(l[m]).round();this._map._requestDomTask(()=>{this._container&&m&&(this._container.style.transform=`${pn[m]} translate(${y.x}px,${y.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(fo);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:$l,Style:Ln,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.pointGeometry,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:Bc,Evented:u.Evented,config:u.config,prewarm:function(){gt().acquire(ft)},clearPrewarmedResources:function(){const p=Ct;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(ft),Ct=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(p){u.config.ACCESS_TOKEN=p},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(p){u.config.API_URL=p},get workerCount(){return Tt.workerCount},set workerCount(p){Tt.workerCount=p},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){u.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){u.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return xs}),Ue}()},1173:(Hn,Fi,me)=>{"use strict";me.d(Fi,{D:()=>_t});var Ue=me(6019),Si=me(1514);let _t=(()=>{class u{}return u.\u0275fac=function($i){return new($i||u)},u.\u0275mod=Si.oAB({type:u}),u.\u0275inj=Si.cJS({imports:[[Ue.ez]]}),u})()},86:(Hn,Fi,me)=>{"use strict";me.d(Fi,{lW:()=>Le,ot:()=>ie});var Ue=me(1514),Si=me(6731),_t=me(3448),u=me(9555);const B=["mat-button",""],$i=["*"],Te=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],Pt=(0,Si.pj)((0,Si.Id)((0,Si.Kr)(class{constructor(Oe){this._elementRef=Oe}})));let Le=(()=>{class Oe extends Pt{constructor(de,ei,zi){super(de),this._focusMonitor=ei,this._animationMode=zi,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const Ke of Te)this._hasHostAttributes(Ke)&&this._getHostElement().classList.add(Ke);de.nativeElement.classList.add("mat-button-base"),this.isRoundButton&&(this.color="accent")}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(de,ei){de?this._focusMonitor.focusVia(this._getHostElement(),de,ei):this._getHostElement().focus(ei)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...de){return de.some(ei=>this._getHostElement().hasAttribute(ei))}}return Oe.\u0275fac=function(de){return new(de||Oe)(Ue.Y36(Ue.SBq),Ue.Y36(_t.tE),Ue.Y36(u.Qb,8))},Oe.\u0275cmp=Ue.Xpm({type:Oe,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(de,ei){if(1&de&&Ue.Gf(Si.wG,5),2&de){let zi;Ue.iGM(zi=Ue.CRH())&&(ei.ripple=zi.first)}},hostAttrs:[1,"mat-focus-indicator"],hostVars:5,hostBindings:function(de,ei){2&de&&(Ue.uIk("disabled",ei.disabled||null),Ue.ekj("_mat-animation-noopable","NoopAnimations"===ei._animationMode)("mat-button-disabled",ei.disabled))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Ue.qOj],attrs:B,ngContentSelectors:$i,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(de,ei){1&de&&(Ue.F$t(),Ue.TgZ(0,"span",0),Ue.Hsn(1),Ue.qZA(),Ue._UZ(2,"span",1),Ue._UZ(3,"span",2)),2&de&&(Ue.xp6(2),Ue.ekj("mat-button-ripple-round",ei.isRoundButton||ei.isIconButton),Ue.Q6J("matRippleDisabled",ei._isRippleDisabled())("matRippleCentered",ei.isIconButton)("matRippleTrigger",ei._getHostElement()))},directives:[Si.wG],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}.cdk-high-contrast-active .mat-button-base.cdk-keyboard-focused,.cdk-high-contrast-active .mat-button-base.cdk-program-focused{outline:solid 3px}\n"],encapsulation:2,changeDetection:0}),Oe})(),ie=(()=>{class Oe{}return Oe.\u0275fac=function(de){return new(de||Oe)},Oe.\u0275mod=Ue.oAB({type:Oe}),Oe.\u0275inj=Ue.cJS({imports:[[Si.si,Si.BQ],Si.BQ]}),Oe})()},8727:(Hn,Fi,me)=>{"use strict";me.d(Fi,{wx:()=>Je,_g:()=>wi,Mq:()=>Z,hl:()=>gt,FA:()=>Jn,nW:()=>Bt,By:()=>Se,zY:()=>Ce});var Ue=me(3448),Si=me(7219),_t=me(5711),u=me(6019),B=me(1514),$i=me(86),mi=me(5705),jt=me(6731),Te=me(273),Pt=me(7908),Le=me(3719),ze=me(2997),ie=me(1628),Oe=me(8290),ui=me(9468),de=me(3970),ei=me(461),zi=me(348),Ke=me(928),ke=me(9814),De=me(7537),vi=me(8167),re=me(138);const we=["mat-calendar-body",""];function di(ht,kt){if(1&ht&&(B.TgZ(0,"tr",2),B.TgZ(1,"td",3),B._uU(2),B.qZA(),B.qZA()),2&ht){const E=B.oxw();B.xp6(1),B.Udp("padding-top",E._cellPadding)("padding-bottom",E._cellPadding),B.uIk("colspan",E.numCols),B.xp6(1),B.hij(" ",E.label," ")}}function Ti(ht,kt){if(1&ht&&(B.TgZ(0,"td",3),B._uU(1),B.qZA()),2&ht){const E=B.oxw(2);B.Udp("padding-top",E._cellPadding)("padding-bottom",E._cellPadding),B.uIk("colspan",E._firstRowOffset),B.xp6(1),B.hij(" ",E._firstRowOffset>=E.labelMinRequiredCells?E.label:""," ")}}function an(ht,kt){if(1&ht){const E=B.EpF();B.TgZ(0,"td",7),B.TgZ(1,"button",8),B.NdJ("click",function(it){const ye=B.CHM(E).$implicit;return B.oxw(2)._cellClicked(ye,it)}),B.TgZ(2,"div",9),B._uU(3),B.qZA(),B._UZ(4,"div",10),B.qZA(),B.qZA()}if(2&ht){const E=kt.$implicit,V=kt.index,it=B.oxw().index,xt=B.oxw();B.Udp("width",xt._cellWidth)("padding-top",xt._cellPadding)("padding-bottom",xt._cellPadding),B.uIk("data-mat-row",it)("data-mat-col",V),B.xp6(1),B.ekj("mat-calendar-body-disabled",!E.enabled)("mat-calendar-body-active",xt._isActiveCell(it,V))("mat-calendar-body-range-start",xt._isRangeStart(E.compareValue))("mat-calendar-body-range-end",xt._isRangeEnd(E.compareValue))("mat-calendar-body-in-range",xt._isInRange(E.compareValue))("mat-calendar-body-comparison-bridge-start",xt._isComparisonBridgeStart(E.compareValue,it,V))("mat-calendar-body-comparison-bridge-end",xt._isComparisonBridgeEnd(E.compareValue,it,V))("mat-calendar-body-comparison-start",xt._isComparisonStart(E.compareValue))("mat-calendar-body-comparison-end",xt._isComparisonEnd(E.compareValue))("mat-calendar-body-in-comparison-range",xt._isInComparisonRange(E.compareValue))("mat-calendar-body-preview-start",xt._isPreviewStart(E.compareValue))("mat-calendar-body-preview-end",xt._isPreviewEnd(E.compareValue))("mat-calendar-body-in-preview",xt._isInPreview(E.compareValue)),B.Q6J("ngClass",E.cssClasses)("tabindex",xt._isActiveCell(it,V)?0:-1),B.uIk("aria-label",E.ariaLabel)("aria-disabled",!E.enabled||null)("aria-pressed",xt._isSelected(E.compareValue))("aria-current",xt.todayValue===E.compareValue?"date":null),B.xp6(1),B.ekj("mat-calendar-body-selected",xt._isSelected(E.compareValue))("mat-calendar-body-comparison-identical",xt._isComparisonIdentical(E.compareValue))("mat-calendar-body-today",xt.todayValue===E.compareValue),B.xp6(1),B.hij(" ",E.displayValue," ")}}function nr(ht,kt){if(1&ht&&(B.TgZ(0,"tr",4),B.YNc(1,Ti,2,6,"td",5),B.YNc(2,an,5,47,"td",6),B.qZA()),2&ht){const E=kt.$implicit,V=kt.index,it=B.oxw();B.xp6(1),B.Q6J("ngIf",0===V&&it._firstRowOffset),B.xp6(1),B.Q6J("ngForOf",E)}}function nn(ht,kt){if(1&ht&&(B.TgZ(0,"th",5),B._uU(1),B.qZA()),2&ht){const E=kt.$implicit;B.uIk("aria-label",E.long),B.xp6(1),B.hij(" ",E.narrow," ")}}const fn=["*"];function qn(ht,kt){}function Ki(ht,kt){if(1&ht){const E=B.EpF();B.TgZ(0,"mat-month-view",5),B.NdJ("activeDateChange",function(it){return B.CHM(E),B.oxw().activeDate=it})("_userSelection",function(it){return B.CHM(E),B.oxw()._dateSelected(it)}),B.qZA()}if(2&ht){const E=B.oxw();B.Q6J("activeDate",E.activeDate)("selected",E.selected)("dateFilter",E.dateFilter)("maxDate",E.maxDate)("minDate",E.minDate)("dateClass",E.dateClass)("comparisonStart",E.comparisonStart)("comparisonEnd",E.comparisonEnd)}}function Mn(ht,kt){if(1&ht){const E=B.EpF();B.TgZ(0,"mat-year-view",6),B.NdJ("activeDateChange",function(it){return B.CHM(E),B.oxw().activeDate=it})("monthSelected",function(it){return B.CHM(E),B.oxw()._monthSelectedInYearView(it)})("selectedChange",function(it){return B.CHM(E),B.oxw()._goToDateInView(it,"month")}),B.qZA()}if(2&ht){const E=B.oxw();B.Q6J("activeDate",E.activeDate)("selected",E.selected)("dateFilter",E.dateFilter)("maxDate",E.maxDate)("minDate",E.minDate)("dateClass",E.dateClass)}}function Ne(ht,kt){if(1&ht){const E=B.EpF();B.TgZ(0,"mat-multi-year-view",7),B.NdJ("activeDateChange",function(it){return B.CHM(E),B.oxw().activeDate=it})("yearSelected",function(it){return B.CHM(E),B.oxw()._yearSelectedInMultiYearView(it)})("selectedChange",function(it){return B.CHM(E),B.oxw()._goToDateInView(it,"year")}),B.qZA()}if(2&ht){const E=B.oxw();B.Q6J("activeDate",E.activeDate)("selected",E.selected)("dateFilter",E.dateFilter)("maxDate",E.maxDate)("minDate",E.minDate)("dateClass",E.dateClass)}}function hn(ht,kt){}const on=["button"];function Rr(ht,kt){1&ht&&(B.O4$(),B.TgZ(0,"svg",3),B._UZ(1,"path",4),B.qZA())}const Ai=[[["","matDatepickerToggleIcon",""]]],_i=["[matDatepickerToggleIcon]"],Wn=[[["input","matStartDate",""]],[["input","matEndDate",""]]],rr=["input[matStartDate]","input[matEndDate]"];let gn=(()=>{class ht{constructor(){this.changes=new Te.x,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year"}formatYearRange(E,V){return`${E} \u2013 ${V}`}}return ht.\u0275fac=function(E){return new(E||ht)},ht.\u0275prov=B.Yz7({token:ht,factory:ht.\u0275fac,providedIn:"root"}),ht})();class vr{constructor(kt,E,V,it,xt={},ye=kt,ni){this.value=kt,this.displayValue=E,this.ariaLabel=V,this.enabled=it,this.cssClasses=xt,this.compareValue=ye,this.rawValue=ni}}let Vi=(()=>{class ht{constructor(E,V){this._elementRef=E,this._ngZone=V,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new B.vpe,this.previewChange=new B.vpe,this._enterHandler=it=>{if(this._skipNextFocus&&"focus"===it.type)this._skipNextFocus=!1;else if(it.target&&this.isRange){const xt=this._getCellFromElement(it.target);xt&&this._ngZone.run(()=>this.previewChange.emit({value:xt.enabled?xt:null,event:it}))}},this._leaveHandler=it=>{null!==this.previewEnd&&this.isRange&&it.target&&this._getCellFromElement(it.target)&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:it}))},V.runOutsideAngular(()=>{const it=E.nativeElement;it.addEventListener("mouseenter",this._enterHandler,!0),it.addEventListener("focus",this._enterHandler,!0),it.addEventListener("mouseleave",this._leaveHandler,!0),it.addEventListener("blur",this._leaveHandler,!0)})}_cellClicked(E,V){E.enabled&&this.selectedValueChange.emit({value:E.value,event:V})}_isSelected(E){return this.startValue===E||this.endValue===E}ngOnChanges(E){const V=E.numCols,{rows:it,numCols:xt}=this;(E.rows||V)&&(this._firstRowOffset=it&&it.length&&it[0].length?xt-it[0].length:0),(E.cellAspectRatio||V||!this._cellPadding)&&(this._cellPadding=50*this.cellAspectRatio/xt+"%"),(V||!this._cellWidth)&&(this._cellWidth=100/xt+"%")}ngOnDestroy(){const E=this._elementRef.nativeElement;E.removeEventListener("mouseenter",this._enterHandler,!0),E.removeEventListener("focus",this._enterHandler,!0),E.removeEventListener("mouseleave",this._leaveHandler,!0),E.removeEventListener("blur",this._leaveHandler,!0)}_isActiveCell(E,V){let it=E*this.numCols+V;return E&&(it-=this._firstRowOffset),it==this.activeCell}_focusActiveCell(E=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe((0,ui.q)(1)).subscribe(()=>{const V=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");V&&(E||(this._skipNextFocus=!0),V.focus())})})}_isRangeStart(E){return ln(E,this.startValue,this.endValue)}_isRangeEnd(E){return Bn(E,this.startValue,this.endValue)}_isInRange(E){return Pn(E,this.startValue,this.endValue,this.isRange)}_isComparisonStart(E){return ln(E,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(E,V,it){if(!this._isComparisonStart(E)||this._isRangeStart(E)||!this._isInRange(E))return!1;let xt=this.rows[V][it-1];if(!xt){const ye=this.rows[V-1];xt=ye&&ye[ye.length-1]}return xt&&!this._isRangeEnd(xt.compareValue)}_isComparisonBridgeEnd(E,V,it){if(!this._isComparisonEnd(E)||this._isRangeEnd(E)||!this._isInRange(E))return!1;let xt=this.rows[V][it+1];if(!xt){const ye=this.rows[V+1];xt=ye&&ye[0]}return xt&&!this._isRangeStart(xt.compareValue)}_isComparisonEnd(E){return Bn(E,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(E){return Pn(E,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(E){return this.comparisonStart===this.comparisonEnd&&E===this.comparisonStart}_isPreviewStart(E){return ln(E,this.previewStart,this.previewEnd)}_isPreviewEnd(E){return Bn(E,this.previewStart,this.previewEnd)}_isInPreview(E){return Pn(E,this.previewStart,this.previewEnd,this.isRange)}_getCellFromElement(E){let V;if(Ve(E)?V=E:Ve(E.parentNode)&&(V=E.parentNode),V){const it=V.getAttribute("data-mat-row"),xt=V.getAttribute("data-mat-col");if(it&&xt)return this.rows[parseInt(it)][parseInt(xt)]}return null}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(B.SBq),B.Y36(B.R0b))},ht.\u0275cmp=B.Xpm({type:ht,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange"},exportAs:["matCalendarBody"],features:[B.TTD],attrs:we,decls:2,vars:2,consts:[["aria-hidden","true",4,"ngIf"],["role","row",4,"ngFor","ngForOf"],["aria-hidden","true"],[1,"mat-calendar-body-label"],["role","row"],["class","mat-calendar-body-label",3,"paddingTop","paddingBottom",4,"ngIf"],["role","gridcell","class","mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom",4,"ngFor","ngForOf"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"ngClass","tabindex","click"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(E,V){1&E&&(B.YNc(0,di,3,6,"tr",0),B.YNc(1,nr,3,2,"tr",1)),2&E&&(B.Q6J("ngIf",V._firstRowOffset<V.labelMinRequiredCells),B.xp6(1),B.Q6J("ngForOf",V.rows))},directives:[u.O5,u.sg,u.mk],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-label{height:0;line-height:0;text-align:left;padding-left:4.7142857143%;padding-right:4.7142857143%}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;-moz-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content,.cdk-high-contrast-active .cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content{outline:dotted 2px}.cdk-high-contrast-active .cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content.mat-calendar-body-selected,.cdk-high-contrast-active .cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content.mat-calendar-body-selected{outline:solid 3px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}[dir=rtl] .mat-calendar-body-label{text-align:right}\n'],encapsulation:2,changeDetection:0}),ht})();function Ve(ht){return"TD"===ht.nodeName}function ln(ht,kt,E){return null!==E&&kt!==E&&ht<E&&ht===kt}function Bn(ht,kt,E){return null!==kt&&kt!==E&&ht>=kt&&ht===E}function Pn(ht,kt,E,V){return V&&null!==kt&&null!==E&&kt!==E&&ht>=kt&&ht<=E}class Ei{constructor(kt,E){this.start=kt,this.end=E}}let Tn=(()=>{class ht{constructor(E,V){this.selection=E,this._adapter=V,this._selectionChanged=new Te.x,this.selectionChanged=this._selectionChanged,this.selection=E}updateSelection(E,V){const it=this.selection;this.selection=E,this._selectionChanged.next({selection:E,source:V,oldValue:it})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(E){return this._adapter.isDateInstance(E)&&this._adapter.isValid(E)}}return ht.\u0275fac=function(E){B.$Z()},ht.\u0275prov=B.Yz7({token:ht,factory:ht.\u0275fac}),ht})(),pi=(()=>{class ht extends Tn{constructor(E){super(null,E)}add(E){super.updateSelection(E,this)}isValid(){return null!=this.selection&&this._isValidDateInstance(this.selection)}isComplete(){return null!=this.selection}clone(){const E=new ht(this._adapter);return E.updateSelection(this.selection,this),E}}return ht.\u0275fac=function(E){return new(E||ht)(B.LFG(jt._A))},ht.\u0275prov=B.Yz7({token:ht,factory:ht.\u0275fac}),ht})(),Yi=(()=>{class ht extends Tn{constructor(E){super(new Ei(null,null),E)}add(E){let{start:V,end:it}=this.selection;null==V?V=E:null==it?it=E:(V=E,it=null),super.updateSelection(new Ei(V,it),this)}isValid(){const{start:E,end:V}=this.selection;return null==E&&null==V||(null!=E&&null!=V?this._isValidDateInstance(E)&&this._isValidDateInstance(V)&&this._adapter.compareDate(E,V)<=0:(null==E||this._isValidDateInstance(E))&&(null==V||this._isValidDateInstance(V)))}isComplete(){return null!=this.selection.start&&null!=this.selection.end}clone(){const E=new ht(this._adapter);return E.updateSelection(this.selection,this),E}}return ht.\u0275fac=function(E){return new(E||ht)(B.LFG(jt._A))},ht.\u0275prov=B.Yz7({token:ht,factory:ht.\u0275fac}),ht})();const Yn={provide:Tn,deps:[[new B.FiY,new B.tp0,Tn],jt._A],useFactory:function(ht,kt){return ht||new pi(kt)}},Ie={provide:Tn,deps:[[new B.FiY,new B.tp0,Tn],jt._A],useFactory:function(ht,kt){return ht||new Yi(kt)}},Wt=new B.OlP("MAT_DATE_RANGE_SELECTION_STRATEGY");let le=(()=>{class ht{constructor(E){this._dateAdapter=E}selectionFinished(E,V){let{start:it,end:xt}=V;return null==it?it=E:null==xt&&E&&this._dateAdapter.compareDate(E,it)>=0?xt=E:(it=E,xt=null),new Ei(it,xt)}createPreview(E,V){let it=null,xt=null;return V.start&&!V.end&&E&&(it=V.start,xt=E),new Ei(it,xt)}}return ht.\u0275fac=function(E){return new(E||ht)(B.LFG(jt._A))},ht.\u0275prov=B.Yz7({token:ht,factory:ht.\u0275fac}),ht})();const Me={provide:Wt,deps:[[new B.FiY,new B.tp0,Wt],jt._A],useFactory:function(ht,kt){return ht||new le(kt)}};let Ji=(()=>{class ht{constructor(E,V,it,xt,ye){this._changeDetectorRef=E,this._dateFormats=V,this._dateAdapter=it,this._dir=xt,this._rangeStrategy=ye,this._rerenderSubscription=Pt.w0.EMPTY,this.selectedChange=new B.vpe,this._userSelection=new B.vpe,this.activeDateChange=new B.vpe,this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(E){const V=this._activeDate,it=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(it,this.minDate,this.maxDate),this._hasSameMonthAndYear(V,this._activeDate)||this._init()}get selected(){return this._selected}set selected(E){this._selected=E instanceof Ei?E:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(E){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}get maxDate(){return this._maxDate}set maxDate(E){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe((0,de.O)(null)).subscribe(()=>this._init())}ngOnChanges(E){const V=E.comparisonStart||E.comparisonEnd;V&&!V.firstChange&&this._setRanges(this.selected)}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(E){const V=E.value,it=this._dateAdapter.getYear(this.activeDate),xt=this._dateAdapter.getMonth(this.activeDate),ye=this._dateAdapter.createDate(it,xt,V);let ni,Hi;this._selected instanceof Ei?(ni=this._getDateInCurrentMonth(this._selected.start),Hi=this._getDateInCurrentMonth(this._selected.end)):ni=Hi=this._getDateInCurrentMonth(this._selected),(ni!==V||Hi!==V)&&this.selectedChange.emit(ye),this._userSelection.emit({value:ye,event:E.event}),this._previewStart=this._previewEnd=null,this._changeDetectorRef.markForCheck()}_handleCalendarBodyKeydown(E){const V=this._activeDate,it=this._isRtl();switch(E.keyCode){case ie.oh:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,it?1:-1);break;case ie.SV:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,it?-1:1);break;case ie.LH:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case ie.JH:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case ie.Sd:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case ie.uR:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case ie.Ku:this.activeDate=E.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case ie.VM:this.activeDate=E.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case ie.K5:case ie.L_:return this._selectionKeyPressed=!0,void(this._canSelect(this._activeDate)&&E.preventDefault());case ie.hY:return void(null!=this._previewEnd&&!(0,ie.Vb)(E)&&(this._previewStart=this._previewEnd=null,this.selectedChange.emit(null),this._userSelection.emit({value:null,event:E}),E.preventDefault(),E.stopPropagation()));default:return}this._dateAdapter.compareDate(V,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCell(),E.preventDefault()}_handleCalendarBodyKeyup(E){(E.keyCode===ie.L_||E.keyCode===ie.K5)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:E}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let E=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(E)-this._dateAdapter.getFirstDayOfWeek())%7,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(E){this._matCalendarBody._focusActiveCell(E)}_previewChanged({event:E,value:V}){if(this._rangeStrategy){const xt=this._rangeStrategy.createPreview(V?V.rawValue:null,this.selected,E);this._previewStart=this._getCellCompareValue(xt.start),this._previewEnd=this._getCellCompareValue(xt.end),this._changeDetectorRef.detectChanges()}}_initWeekdays(){const E=this._dateAdapter.getFirstDayOfWeek(),V=this._dateAdapter.getDayOfWeekNames("narrow");let xt=this._dateAdapter.getDayOfWeekNames("long").map((ye,ni)=>({long:ye,narrow:V[ni]}));this._weekdays=xt.slice(E).concat(xt.slice(0,E))}_createWeekCells(){const E=this._dateAdapter.getNumDaysInMonth(this.activeDate),V=this._dateAdapter.getDateNames();this._weeks=[[]];for(let it=0,xt=this._firstWeekOffset;it<E;it++,xt++){7==xt&&(this._weeks.push([]),xt=0);const ye=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),it+1),ni=this._shouldEnableDate(ye),Hi=this._dateAdapter.format(ye,this._dateFormats.display.dateA11yLabel),Un=this.dateClass?this.dateClass(ye,"month"):void 0;this._weeks[this._weeks.length-1].push(new vr(it+1,V[it],Hi,ni,Un,this._getCellCompareValue(ye),ye))}}_shouldEnableDate(E){return!!E&&(!this.minDate||this._dateAdapter.compareDate(E,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(E,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(E))}_getDateInCurrentMonth(E){return E&&this._hasSameMonthAndYear(E,this.activeDate)?this._dateAdapter.getDate(E):null}_hasSameMonthAndYear(E,V){return!(!E||!V||this._dateAdapter.getMonth(E)!=this._dateAdapter.getMonth(V)||this._dateAdapter.getYear(E)!=this._dateAdapter.getYear(V))}_getCellCompareValue(E){if(E){const V=this._dateAdapter.getYear(E),it=this._dateAdapter.getMonth(E),xt=this._dateAdapter.getDate(E);return new Date(V,it,xt).getTime()}return null}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setRanges(E){E instanceof Ei?(this._rangeStart=this._getCellCompareValue(E.start),this._rangeEnd=this._getCellCompareValue(E.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(E),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(E){return!this.dateFilter||this.dateFilter(E)}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(B.sBO),B.Y36(jt.sG,8),B.Y36(jt._A,8),B.Y36(Oe.Is,8),B.Y36(Wt,8))},ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-month-view"]],viewQuery:function(E,V){if(1&E&&B.Gf(Vi,5),2&E){let it;B.iGM(it=B.CRH())&&(V._matCalendarBody=it.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],features:[B.TTD],decls:7,vars:13,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col",4,"ngFor","ngForOf"],["aria-hidden","true","colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","selectedValueChange","previewChange","keyup","keydown"],["scope","col"]],template:function(E,V){1&E&&(B.TgZ(0,"table",0),B.TgZ(1,"thead",1),B.TgZ(2,"tr"),B.YNc(3,nn,2,2,"th",2),B.qZA(),B.TgZ(4,"tr"),B._UZ(5,"th",3),B.qZA(),B.qZA(),B.TgZ(6,"tbody",4),B.NdJ("selectedValueChange",function(xt){return V._dateSelected(xt)})("previewChange",function(xt){return V._previewChanged(xt)})("keyup",function(xt){return V._handleCalendarBodyKeyup(xt)})("keydown",function(xt){return V._handleCalendarBodyKeydown(xt)}),B.qZA(),B.qZA()),2&E&&(B.xp6(3),B.Q6J("ngForOf",V._weekdays),B.xp6(3),B.Q6J("label",V._monthLabel)("rows",V._weeks)("todayValue",V._todayDate)("startValue",V._rangeStart)("endValue",V._rangeEnd)("comparisonStart",V._comparisonRangeStart)("comparisonEnd",V._comparisonRangeEnd)("previewStart",V._previewStart)("previewEnd",V._previewEnd)("isRange",V._isRange)("labelMinRequiredCells",3)("activeCell",V._dateAdapter.getDate(V.activeDate)-1))},directives:[u.sg,Vi],encapsulation:2,changeDetection:0}),ht})(),Ui=(()=>{class ht{constructor(E,V,it){this._changeDetectorRef=E,this._dateAdapter=V,this._dir=it,this._rerenderSubscription=Pt.w0.EMPTY,this.selectedChange=new B.vpe,this.yearSelected=new B.vpe,this.activeDateChange=new B.vpe,this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(E){let V=this._activeDate;const it=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(it,this.minDate,this.maxDate),Ni(this._dateAdapter,V,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(E){this._selected=E instanceof Ei?E:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E)),this._setSelectedYear(E)}get minDate(){return this._minDate}set minDate(E){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}get maxDate(){return this._maxDate}set maxDate(E){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe((0,de.O)(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());const V=this._dateAdapter.getYear(this._activeDate)-ji(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let it=0,xt=[];it<24;it++)xt.push(V+it),4==xt.length&&(this._years.push(xt.map(ye=>this._createCellForYear(ye))),xt=[]);this._changeDetectorRef.markForCheck()}_yearSelected(E){const V=E.value;this.yearSelected.emit(this._dateAdapter.createDate(V,0,1));let it=this._dateAdapter.getMonth(this.activeDate),xt=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(V,it,1));this.selectedChange.emit(this._dateAdapter.createDate(V,it,Math.min(this._dateAdapter.getDate(this.activeDate),xt)))}_handleCalendarBodyKeydown(E){const V=this._activeDate,it=this._isRtl();switch(E.keyCode){case ie.oh:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,it?1:-1);break;case ie.SV:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,it?-1:1);break;case ie.LH:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-4);break;case ie.JH:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,4);break;case ie.Sd:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-ji(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case ie.uR:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,24-ji(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case ie.Ku:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,E.altKey?-240:-24);break;case ie.VM:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,E.altKey?240:24);break;case ie.K5:case ie.L_:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(V,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCell(),E.preventDefault()}_handleCalendarBodyKeyup(E){(E.keyCode===ie.L_||E.keyCode===ie.K5)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:E}),this._selectionKeyPressed=!1)}_getActiveCell(){return ji(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_createCellForYear(E){const V=this._dateAdapter.createDate(E,0,1),it=this._dateAdapter.getYearName(V),xt=this.dateClass?this.dateClass(V,"multi-year"):void 0;return new vr(E,it,it,this._shouldEnableYear(E),xt)}_shouldEnableYear(E){if(null==E||this.maxDate&&E>this._dateAdapter.getYear(this.maxDate)||this.minDate&&E<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;for(let it=this._dateAdapter.createDate(E,0,1);this._dateAdapter.getYear(it)==E;it=this._dateAdapter.addCalendarDays(it,1))if(this.dateFilter(it))return!0;return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedYear(E){if(this._selectedYear=null,E instanceof Ei){const V=E.start||E.end;V&&(this._selectedYear=this._dateAdapter.getYear(V))}else E&&(this._selectedYear=this._dateAdapter.getYear(E))}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(B.sBO),B.Y36(jt._A,8),B.Y36(Oe.Is,8))},ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-multi-year-view"]],viewQuery:function(E,V){if(1&E&&B.Gf(Vi,5),2&E){let it;B.iGM(it=B.CRH())&&(V._matCalendarBody=it.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell","selectedValueChange","keyup","keydown"]],template:function(E,V){1&E&&(B.TgZ(0,"table",0),B.TgZ(1,"thead",1),B.TgZ(2,"tr"),B._UZ(3,"th",2),B.qZA(),B.qZA(),B.TgZ(4,"tbody",3),B.NdJ("selectedValueChange",function(xt){return V._yearSelected(xt)})("keyup",function(xt){return V._handleCalendarBodyKeyup(xt)})("keydown",function(xt){return V._handleCalendarBodyKeydown(xt)}),B.qZA(),B.qZA()),2&E&&(B.xp6(4),B.Q6J("rows",V._years)("todayValue",V._todayYear)("startValue",V._selectedYear)("endValue",V._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",V._getActiveCell()))},directives:[Vi],encapsulation:2,changeDetection:0}),ht})();function Ni(ht,kt,E,V,it){const xt=ht.getYear(kt),ye=ht.getYear(E),ni=bi(ht,V,it);return Math.floor((xt-ni)/24)===Math.floor((ye-ni)/24)}function ji(ht,kt,E,V){return function(ht,kt){return(ht%24+24)%24}(ht.getYear(kt)-bi(ht,E,V))}function bi(ht,kt,E){let V=0;return E?V=ht.getYear(E)-24+1:kt&&(V=ht.getYear(kt)),V}let Kn=(()=>{class ht{constructor(E,V,it,xt){this._changeDetectorRef=E,this._dateFormats=V,this._dateAdapter=it,this._dir=xt,this._rerenderSubscription=Pt.w0.EMPTY,this.selectedChange=new B.vpe,this.monthSelected=new B.vpe,this.activeDateChange=new B.vpe,this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(E){let V=this._activeDate;const it=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(it,this.minDate,this.maxDate),this._dateAdapter.getYear(V)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(E){this._selected=E instanceof Ei?E:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E)),this._setSelectedMonth(E)}get minDate(){return this._minDate}set minDate(E){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}get maxDate(){return this._maxDate}set maxDate(E){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe((0,de.O)(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(E){const V=E.value,it=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),V,1);this.monthSelected.emit(it);const xt=this._dateAdapter.getNumDaysInMonth(it);this.selectedChange.emit(this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),V,Math.min(this._dateAdapter.getDate(this.activeDate),xt)))}_handleCalendarBodyKeydown(E){const V=this._activeDate,it=this._isRtl();switch(E.keyCode){case ie.oh:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,it?1:-1);break;case ie.SV:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,it?-1:1);break;case ie.LH:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case ie.JH:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case ie.Sd:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case ie.uR:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case ie.Ku:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,E.altKey?-10:-1);break;case ie.VM:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,E.altKey?10:1);break;case ie.K5:case ie.L_:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(V,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCell(),E.preventDefault()}_handleCalendarBodyKeyup(E){(E.keyCode===ie.L_||E.keyCode===ie.K5)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:E}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let E=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(V=>V.map(it=>this._createCellForMonth(it,E[it]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_getMonthInCurrentYear(E){return E&&this._dateAdapter.getYear(E)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(E):null}_createCellForMonth(E,V){const it=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),E,1),xt=this._dateAdapter.format(it,this._dateFormats.display.monthYearA11yLabel),ye=this.dateClass?this.dateClass(it,"year"):void 0;return new vr(E,V.toLocaleUpperCase(),xt,this._shouldEnableMonth(E),ye)}_shouldEnableMonth(E){const V=this._dateAdapter.getYear(this.activeDate);if(null==E||this._isYearAndMonthAfterMaxDate(V,E)||this._isYearAndMonthBeforeMinDate(V,E))return!1;if(!this.dateFilter)return!0;for(let xt=this._dateAdapter.createDate(V,E,1);this._dateAdapter.getMonth(xt)==E;xt=this._dateAdapter.addCalendarDays(xt,1))if(this.dateFilter(xt))return!0;return!1}_isYearAndMonthAfterMaxDate(E,V){if(this.maxDate){const it=this._dateAdapter.getYear(this.maxDate),xt=this._dateAdapter.getMonth(this.maxDate);return E>it||E===it&&V>xt}return!1}_isYearAndMonthBeforeMinDate(E,V){if(this.minDate){const it=this._dateAdapter.getYear(this.minDate),xt=this._dateAdapter.getMonth(this.minDate);return E<it||E===it&&V<xt}return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedMonth(E){this._selectedMonth=E instanceof Ei?this._getMonthInCurrentYear(E.start)||this._getMonthInCurrentYear(E.end):this._getMonthInCurrentYear(E)}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(B.sBO),B.Y36(jt.sG,8),B.Y36(jt._A,8),B.Y36(Oe.Is,8))},ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-year-view"]],viewQuery:function(E,V){if(1&E&&B.Gf(Vi,5),2&E){let it;B.iGM(it=B.CRH())&&(V._matCalendarBody=it.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell","selectedValueChange","keyup","keydown"]],template:function(E,V){1&E&&(B.TgZ(0,"table",0),B.TgZ(1,"thead",1),B.TgZ(2,"tr"),B._UZ(3,"th",2),B.qZA(),B.qZA(),B.TgZ(4,"tbody",3),B.NdJ("selectedValueChange",function(xt){return V._monthSelected(xt)})("keyup",function(xt){return V._handleCalendarBodyKeyup(xt)})("keydown",function(xt){return V._handleCalendarBodyKeydown(xt)}),B.qZA(),B.qZA()),2&E&&(B.xp6(4),B.Q6J("label",V._yearLabel)("rows",V._months)("todayValue",V._todayMonth)("startValue",V._selectedMonth)("endValue",V._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",V._dateAdapter.getMonth(V.activeDate)))},directives:[Vi],encapsulation:2,changeDetection:0}),ht})(),Rn=0,rs=(()=>{class ht{constructor(E,V,it,xt,ye){this._intl=E,this.calendar=V,this._dateAdapter=it,this._dateFormats=xt,this._buttonDescriptionId="mat-calendar-button-"+Rn++,this.calendar.stateChanges.subscribe(()=>ye.markForCheck())}get periodButtonText(){if("month"==this.calendar.currentView)return this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase();if("year"==this.calendar.currentView)return this._dateAdapter.getYearName(this.calendar.activeDate);const V=this._dateAdapter.getYear(this.calendar.activeDate)-ji(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),it=V+24-1,xt=this._dateAdapter.getYearName(this._dateAdapter.createDate(V,0,1)),ye=this._dateAdapter.getYearName(this._dateAdapter.createDate(it,0,1));return this._intl.formatYearRange(xt,ye)}get periodButtonLabel(){return"month"==this.calendar.currentView?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView="month"==this.calendar.currentView?"multi-year":"month"}previousClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?-1:-24)}nextClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?1:24)}previousEnabled(){return!this.calendar.minDate||!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate)}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(E,V){return"month"==this.calendar.currentView?this._dateAdapter.getYear(E)==this._dateAdapter.getYear(V)&&this._dateAdapter.getMonth(E)==this._dateAdapter.getMonth(V):"year"==this.calendar.currentView?this._dateAdapter.getYear(E)==this._dateAdapter.getYear(V):Ni(this._dateAdapter,E,V,this.calendar.minDate,this.calendar.maxDate)}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(gn),B.Y36((0,B.Gpc)(()=>br)),B.Y36(jt._A,8),B.Y36(jt.sG,8),B.Y36(B.sBO))},ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],ngContentSelectors:fn,decls:11,vars:10,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],["mat-button","","type","button","cdkAriaLive","polite",1,"mat-calendar-period-button",3,"click"],["viewBox","0 0 10 5","focusable","false",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"disabled","click"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"disabled","click"]],template:function(E,V){1&E&&(B.F$t(),B.TgZ(0,"div",0),B.TgZ(1,"div",1),B.TgZ(2,"button",2),B.NdJ("click",function(){return V.currentPeriodClicked()}),B.TgZ(3,"span"),B._uU(4),B.qZA(),B.O4$(),B.TgZ(5,"svg",3),B._UZ(6,"polygon",4),B.qZA(),B.qZA(),B.kcU(),B._UZ(7,"div",5),B.Hsn(8),B.TgZ(9,"button",6),B.NdJ("click",function(){return V.previousClicked()}),B.qZA(),B.TgZ(10,"button",7),B.NdJ("click",function(){return V.nextClicked()}),B.qZA(),B.qZA(),B.qZA()),2&E&&(B.xp6(2),B.uIk("aria-label",V.periodButtonLabel)("aria-describedby",V._buttonDescriptionId),B.xp6(1),B.uIk("id",V._buttonDescriptionId),B.xp6(1),B.Oqu(V.periodButtonText),B.xp6(1),B.ekj("mat-calendar-invert","month"!==V.calendar.currentView),B.xp6(4),B.Q6J("disabled",!V.previousEnabled()),B.uIk("aria-label",V.prevButtonLabel),B.xp6(1),B.Q6J("disabled",!V.nextEnabled()),B.uIk("aria-label",V.nextButtonLabel))},directives:[$i.lW,Ue.Qr],encapsulation:2,changeDetection:0}),ht})(),br=(()=>{class ht{constructor(E,V,it,xt){this._dateAdapter=V,this._dateFormats=it,this._changeDetectorRef=xt,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new B.vpe,this.yearSelected=new B.vpe,this.monthSelected=new B.vpe,this.viewChanged=new B.vpe(!0),this._userSelection=new B.vpe,this.stateChanges=new Te.x,this._intlChanges=E.changes.subscribe(()=>{xt.markForCheck(),this.stateChanges.next()})}get startAt(){return this._startAt}set startAt(E){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}get selected(){return this._selected}set selected(E){this._selected=E instanceof Ei?E:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}get minDate(){return this._minDate}set minDate(E){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}get maxDate(){return this._maxDate}set maxDate(E){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}get activeDate(){return this._clampedActiveDate}set activeDate(E){this._clampedActiveDate=this._dateAdapter.clampDate(E,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(E){const V=this._currentView!==E?E:null;this._currentView=E,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),V&&this.viewChanged.emit(V)}ngAfterContentInit(){this._calendarHeaderPortal=new _t.C5(this.headerComponent||rs),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(E){const V=E.minDate||E.maxDate||E.dateFilter;if(V&&!V.firstChange){const it=this._getCurrentViewComponent();it&&(this._changeDetectorRef.detectChanges(),it._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(E){const V=E.value;(this.selected instanceof Ei||V&&!this._dateAdapter.sameDate(V,this.selected))&&this.selectedChange.emit(V),this._userSelection.emit(E)}_yearSelectedInMultiYearView(E){this.yearSelected.emit(E)}_monthSelectedInYearView(E){this.monthSelected.emit(E)}_goToDateInView(E,V){this.activeDate=E,this.currentView=V}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(gn),B.Y36(jt._A,8),B.Y36(jt.sG,8),B.Y36(B.sBO))},ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-calendar"]],viewQuery:function(E,V){if(1&E&&(B.Gf(Ji,5),B.Gf(Kn,5),B.Gf(Ui,5)),2&E){let it;B.iGM(it=B.CRH())&&(V.monthView=it.first),B.iGM(it=B.CRH())&&(V.yearView=it.first),B.iGM(it=B.CRH())&&(V.multiYearView=it.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection"},exportAs:["matCalendar"],features:[B._Bn([Yn]),B.TTD],decls:5,vars:5,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content",3,"ngSwitch"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","activeDateChange","_userSelection",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","activeDateChange","_userSelection"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange"]],template:function(E,V){1&E&&(B.YNc(0,qn,0,0,"ng-template",0),B.TgZ(1,"div",1),B.YNc(2,Ki,1,8,"mat-month-view",2),B.YNc(3,Mn,1,6,"mat-year-view",3),B.YNc(4,Ne,1,6,"mat-multi-year-view",4),B.qZA()),2&E&&(B.Q6J("cdkPortalOutlet",V._calendarHeaderPortal),B.xp6(1),B.Q6J("ngSwitch",V.currentView),B.xp6(1),B.Q6J("ngSwitchCase","month"),B.xp6(1),B.Q6J("ngSwitchCase","year"),B.xp6(1),B.Q6J("ngSwitchCase","multi-year"))},directives:[_t.Pl,Ue.kH,u.RF,u.n9,Ji,Kn,Ui],styles:['.mat-calendar{display:block}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-controls .mat-icon-button:hover .mat-button-focus-overlay{opacity:.04}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px}\n'],encapsulation:2,changeDetection:0}),ht})();const sr={transformPanel:(0,ke.X$)("transformPanel",[(0,ke.eR)("void => enter-dropdown",(0,ke.jt)("120ms cubic-bezier(0, 0, 0.2, 1)",(0,ke.F4)([(0,ke.oB)({opacity:0,transform:"scale(1, 0.8)"}),(0,ke.oB)({opacity:1,transform:"scale(1, 1)"})]))),(0,ke.eR)("void => enter-dialog",(0,ke.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,ke.F4)([(0,ke.oB)({opacity:0,transform:"scale(0.7)"}),(0,ke.oB)({transform:"none",opacity:1})]))),(0,ke.eR)("* => void",(0,ke.jt)("100ms linear",(0,ke.oB)({opacity:0})))]),fadeInCalendar:(0,ke.X$)("fadeInCalendar",[(0,ke.SB)("void",(0,ke.oB)({opacity:0})),(0,ke.SB)("enter",(0,ke.oB)({opacity:1})),(0,ke.eR)("void => *",(0,ke.jt)("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};let yn=0;const Vn=new B.OlP("mat-datepicker-scroll-strategy"),ar={provide:Vn,deps:[Si.aV],useFactory:function(ht){return()=>ht.scrollStrategies.reposition()}},xn=(0,jt.pj)(class{constructor(ht){this._elementRef=ht}});let tt=(()=>{class ht extends xn{constructor(E,V,it,xt,ye,ni){super(E),this._changeDetectorRef=V,this._globalModel=it,this._dateAdapter=xt,this._rangeSelectionStrategy=ye,this._subscriptions=new Pt.w0,this._animationDone=new Te.x,this._actionsPortal=null,this._closeButtonText=ni.closeCalendarLabel}ngOnInit(){this._model=this._actionsPortal?this._globalModel.clone():this._globalModel,this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(E){const V=this._model.selection,it=E.value,xt=V instanceof Ei;if(xt&&this._rangeSelectionStrategy){const ye=this._rangeSelectionStrategy.selectionFinished(it,V,E.event);this._model.updateSelection(ye,this)}else it&&(xt||!this._dateAdapter.sameDate(it,V))&&this._model.add(it);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(B.SBq),B.Y36(B.sBO),B.Y36(Tn),B.Y36(jt._A),B.Y36(Wt,8),B.Y36(gn))},ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-datepicker-content"]],viewQuery:function(E,V){if(1&E&&B.Gf(br,5),2&E){let it;B.iGM(it=B.CRH())&&(V._calendar=it.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:3,hostBindings:function(E,V){1&E&&B.WFA("@transformPanel.done",function(){return V._animationDone.next()}),2&E&&(B.d8E("@transformPanel",V._animationState),B.ekj("mat-datepicker-content-touch",V.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],features:[B.qOj],decls:5,vars:24,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"id","ngClass","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","yearSelected","monthSelected","viewChanged","_userSelection"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"color","focus","blur","click"]],template:function(E,V){if(1&E&&(B.TgZ(0,"div",0),B.TgZ(1,"mat-calendar",1),B.NdJ("yearSelected",function(xt){return V.datepicker._selectYear(xt)})("monthSelected",function(xt){return V.datepicker._selectMonth(xt)})("viewChanged",function(xt){return V.datepicker._viewChanged(xt)})("_userSelection",function(xt){return V._handleUserSelection(xt)}),B.qZA(),B.YNc(2,hn,0,0,"ng-template",2),B.TgZ(3,"button",3),B.NdJ("focus",function(){return V._closeButtonFocused=!0})("blur",function(){return V._closeButtonFocused=!1})("click",function(){return V.datepicker.close()}),B._uU(4),B.qZA(),B.qZA()),2&E){let it;B.ekj("mat-datepicker-content-container-with-custom-header",V.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",V._actionsPortal),B.uIk("aria-modal",!0)("aria-labelledby",null!==(it=V._dialogLabelId)&&void 0!==it?it:void 0),B.xp6(1),B.Q6J("id",V.datepicker.id)("ngClass",V.datepicker.panelClass)("startAt",V.datepicker.startAt)("startView",V.datepicker.startView)("minDate",V.datepicker._getMinDate())("maxDate",V.datepicker._getMaxDate())("dateFilter",V.datepicker._getDateFilter())("headerComponent",V.datepicker.calendarHeaderComponent)("selected",V._getSelected())("dateClass",V.datepicker.dateClass)("comparisonStart",V.comparisonStart)("comparisonEnd",V.comparisonEnd)("@fadeInCalendar","enter"),B.xp6(1),B.Q6J("cdkPortalOutlet",V._actionsPortal),B.xp6(1),B.ekj("cdk-visually-hidden",!V._closeButtonFocused),B.Q6J("color",V.color||"primary"),B.xp6(1),B.Oqu(V._closeButtonText)}},directives:[Ue.mK,br,u.mk,_t.Pl,$i.lW],styles:[".mat-datepicker-content{display:block;border-radius:4px}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}\n"],encapsulation:2,data:{animation:[sr.transformPanel,sr.fadeInCalendar]},changeDetection:0}),ht})(),F=(()=>{class ht{constructor(E,V,it,xt,ye,ni,Hi){this._overlay=E,this._ngZone=V,this._viewContainerRef=it,this._dateAdapter=ye,this._dir=ni,this._model=Hi,this._inputStateChanges=Pt.w0.EMPTY,this.startView="month",this._touchUi=!1,this.xPosition="start",this.yPosition="below",this._restoreFocus=!0,this.yearSelected=new B.vpe,this.monthSelected=new B.vpe,this.viewChanged=new B.vpe(!0),this.openedStream=new B.vpe,this.closedStream=new B.vpe,this._opened=!1,this.id="mat-datepicker-"+yn++,this._focusedElementBeforeOpen=null,this._backdropHarnessClass=`${this.id}-backdrop`,this.stateChanges=new Te.x,this._scrollStrategy=xt}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.getStartValue():null)}set startAt(E){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E))}get color(){return this._color||(this.datepickerInput?this.datepickerInput.getThemePalette():void 0)}set color(E){this._color=E}get touchUi(){return this._touchUi}set touchUi(E){this._touchUi=(0,zi.Ig)(E)}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(E){const V=(0,zi.Ig)(E);V!==this._disabled&&(this._disabled=V,this.stateChanges.next(void 0))}get restoreFocus(){return this._restoreFocus}set restoreFocus(E){this._restoreFocus=(0,zi.Ig)(E)}get panelClass(){return this._panelClass}set panelClass(E){this._panelClass=(0,zi.du)(E)}get opened(){return this._opened}set opened(E){(0,zi.Ig)(E)?this.open():this.close()}_getMinDate(){return this.datepickerInput&&this.datepickerInput.min}_getMaxDate(){return this.datepickerInput&&this.datepickerInput.max}_getDateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}ngOnChanges(E){const V=E.xPosition||E.yPosition;if(V&&!V.firstChange&&this._overlayRef){const it=this._overlayRef.getConfig().positionStrategy;it instanceof Si._G&&(this._setConnectedPositions(it),this.opened&&this._overlayRef.updatePosition())}this.stateChanges.next(void 0)}ngOnDestroy(){this._destroyOverlay(),this.close(),this._inputStateChanges.unsubscribe(),this.stateChanges.complete()}select(E){this._model.add(E)}_selectYear(E){this.yearSelected.emit(E)}_selectMonth(E){this.monthSelected.emit(E)}_viewChanged(E){this.viewChanged.emit(E)}registerInput(E){return this._inputStateChanges.unsubscribe(),this.datepickerInput=E,this._inputStateChanges=E.stateChanges.subscribe(()=>this.stateChanges.next(void 0)),this._model}registerActions(E){this._actionsPortal=E}removeActions(E){E===this._actionsPortal&&(this._actionsPortal=null)}open(){this._opened||this.disabled||(this._focusedElementBeforeOpen=(0,Ke.ht)(),this._openOverlay(),this._opened=!0,this.openedStream.emit())}close(){if(!this._opened)return;if(this._componentRef){const V=this._componentRef.instance;V._startExitAnimation(),V._animationDone.pipe((0,ui.q)(1)).subscribe(()=>this._destroyOverlay())}const E=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._restoreFocus&&this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(E)):E()}_applyPendingSelection(){var E,V;null==(V=null==(E=this._componentRef)?void 0:E.instance)||V._applyPendingSelection()}_forwardContentValues(E){E.datepicker=this,E.color=this.color,E._actionsPortal=this._actionsPortal,E._dialogLabelId=this.datepickerInput.getOverlayLabelId()}_openOverlay(){this._destroyOverlay();const E=this.touchUi,V=new _t.C5(tt,this._viewContainerRef),it=this._overlayRef=this._overlay.create(new Si.X_({positionStrategy:E?this._getDialogStrategy():this._getDropdownStrategy(),hasBackdrop:!0,backdropClass:[E?"cdk-overlay-dark-backdrop":"mat-overlay-transparent-backdrop",this._backdropHarnessClass],direction:this._dir,scrollStrategy:E?this._overlay.scrollStrategies.block():this._scrollStrategy(),panelClass:"mat-datepicker-"+(E?"dialog":"popup")}));this._getCloseStream(it).subscribe(xt=>{xt&&xt.preventDefault(),this.close()}),this._componentRef=it.attach(V),this._forwardContentValues(this._componentRef.instance),E||this._ngZone.onStable.pipe((0,ui.q)(1)).subscribe(()=>it.updatePosition())}_destroyOverlay(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=this._componentRef=null)}_getDialogStrategy(){return this._overlay.position().global().centerHorizontally().centerVertically()}_getDropdownStrategy(){const E=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".mat-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withLockedPosition();return this._setConnectedPositions(E)}_setConnectedPositions(E){const V="end"===this.xPosition?"end":"start",it="start"===V?"end":"start",xt="above"===this.yPosition?"bottom":"top",ye="top"===xt?"bottom":"top";return E.withPositions([{originX:V,originY:ye,overlayX:V,overlayY:xt},{originX:V,originY:xt,overlayX:V,overlayY:ye},{originX:it,originY:ye,overlayX:it,overlayY:xt},{originX:it,originY:xt,overlayX:it,overlayY:ye}])}_getCloseStream(E){return(0,Le.T)(E.backdropClick(),E.detachments(),E.keydownEvents().pipe((0,ei.h)(V=>V.keyCode===ie.hY&&!(0,ie.Vb)(V)||this.datepickerInput&&(0,ie.Vb)(V,"altKey")&&V.keyCode===ie.LH)))}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(Si.aV),B.Y36(B.R0b),B.Y36(B.s_b),B.Y36(Vn),B.Y36(jt._A,8),B.Y36(Oe.Is,8),B.Y36(Tn))},ht.\u0275dir=B.lG2({type:ht,inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",startView:"startView",color:"color",touchUi:"touchUi",disabled:"disabled",xPosition:"xPosition",yPosition:"yPosition",restoreFocus:"restoreFocus",dateClass:"dateClass",panelClass:"panelClass",opened:"opened"},outputs:{yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",openedStream:"opened",closedStream:"closed"},features:[B.TTD]}),ht})(),Z=(()=>{class ht extends F{}return ht.\u0275fac=function(){let kt;return function(V){return(kt||(kt=B.n5z(ht)))(V||ht)}}(),ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-datepicker"]],exportAs:["matDatepicker"],features:[B._Bn([Yn,{provide:F,useExisting:ht}]),B.qOj],decls:0,vars:0,template:function(E,V){},encapsulation:2,changeDetection:0}),ht})();class Q{constructor(kt,E){this.target=kt,this.targetElement=E,this.value=this.target.value}}let rt=(()=>{class ht{constructor(E,V,it){this._elementRef=E,this._dateAdapter=V,this._dateFormats=it,this.dateChange=new B.vpe,this.dateInput=new B.vpe,this.stateChanges=new Te.x,this._onTouched=()=>{},this._validatorOnChange=()=>{},this._cvaOnChange=()=>{},this._valueChangesSubscription=Pt.w0.EMPTY,this._localeSubscription=Pt.w0.EMPTY,this._parseValidator=()=>this._lastValueValid?null:{matDatepickerParse:{text:this._elementRef.nativeElement.value}},this._filterValidator=xt=>{const ye=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(xt.value));return!ye||this._matchesFilter(ye)?null:{matDatepickerFilter:!0}},this._minValidator=xt=>{const ye=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(xt.value)),ni=this._getMinDate();return!ni||!ye||this._dateAdapter.compareDate(ni,ye)<=0?null:{matDatepickerMin:{min:ni,actual:ye}}},this._maxValidator=xt=>{const ye=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(xt.value)),ni=this._getMaxDate();return!ni||!ye||this._dateAdapter.compareDate(ni,ye)>=0?null:{matDatepickerMax:{max:ni,actual:ye}}},this._lastValueValid=!1,this._localeSubscription=V.localeChanges.subscribe(()=>{this._assignValueProgrammatically(this.value)})}get value(){return this._model?this._getValueFromModel(this._model.selection):this._pendingValue}set value(E){this._assignValueProgrammatically(E)}get disabled(){return!!this._disabled||this._parentDisabled()}set disabled(E){const V=(0,zi.Ig)(E),it=this._elementRef.nativeElement;this._disabled!==V&&(this._disabled=V,this.stateChanges.next(void 0)),V&&this._isInitialized&&it.blur&&it.blur()}_getValidators(){return[this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]}_registerModel(E){this._model=E,this._valueChangesSubscription.unsubscribe(),this._pendingValue&&this._assignValue(this._pendingValue),this._valueChangesSubscription=this._model.selectionChanged.subscribe(V=>{if(this._shouldHandleChangeEvent(V)){const it=this._getValueFromModel(V.selection);this._lastValueValid=this._isValidValue(it),this._cvaOnChange(it),this._onTouched(),this._formatValue(it),this.dateInput.emit(new Q(this,this._elementRef.nativeElement)),this.dateChange.emit(new Q(this,this._elementRef.nativeElement))}})}ngAfterViewInit(){this._isInitialized=!0}ngOnChanges(E){ft(E,this._dateAdapter)&&this.stateChanges.next(void 0)}ngOnDestroy(){this._valueChangesSubscription.unsubscribe(),this._localeSubscription.unsubscribe(),this.stateChanges.complete()}registerOnValidatorChange(E){this._validatorOnChange=E}validate(E){return this._validator?this._validator(E):null}writeValue(E){this._assignValueProgrammatically(E)}registerOnChange(E){this._cvaOnChange=E}registerOnTouched(E){this._onTouched=E}setDisabledState(E){this.disabled=E}_onKeydown(E){E.altKey&&E.keyCode===ie.JH&&!this._elementRef.nativeElement.readOnly&&(this._openPopup(),E.preventDefault())}_onInput(E){const V=this._lastValueValid;let it=this._dateAdapter.parse(E,this._dateFormats.parse.dateInput);this._lastValueValid=this._isValidValue(it),it=this._dateAdapter.getValidDateOrNull(it),this._dateAdapter.sameDate(it,this.value)?(E&&!this.value&&this._cvaOnChange(it),V!==this._lastValueValid&&this._validatorOnChange()):(this._assignValue(it),this._cvaOnChange(it),this.dateInput.emit(new Q(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new Q(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched()}_formatValue(E){this._elementRef.nativeElement.value=E?this._dateAdapter.format(E,this._dateFormats.display.dateInput):""}_assignValue(E){this._model?(this._assignValueToModel(E),this._pendingValue=null):this._pendingValue=E}_isValidValue(E){return!E||this._dateAdapter.isValid(E)}_parentDisabled(){return!1}_assignValueProgrammatically(E){E=this._dateAdapter.deserialize(E),this._lastValueValid=this._isValidValue(E),E=this._dateAdapter.getValidDateOrNull(E),this._assignValue(E),this._formatValue(E)}_matchesFilter(E){const V=this._getDateFilter();return!V||V(E)}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(B.SBq),B.Y36(jt._A,8),B.Y36(jt.sG,8))},ht.\u0275dir=B.lG2({type:ht,inputs:{value:"value",disabled:"disabled"},outputs:{dateChange:"dateChange",dateInput:"dateInput"},features:[B.TTD]}),ht})();function ft(ht,kt){const E=Object.keys(ht);for(let V of E){const{previousValue:it,currentValue:xt}=ht[V];if(!kt.isDateInstance(it)||!kt.isDateInstance(xt))return!0;if(!kt.sameDate(it,xt))return!0}return!1}const Tt={provide:De.JU,useExisting:(0,B.Gpc)(()=>gt),multi:!0},Ct={provide:De.Cf,useExisting:(0,B.Gpc)(()=>gt),multi:!0};let gt=(()=>{class ht extends rt{constructor(E,V,it,xt){super(E,V,it),this._formField=xt,this._closedSubscription=Pt.w0.EMPTY,this._validator=De.kI.compose(super._getValidators())}set matDatepicker(E){E&&(this._datepicker=E,this._closedSubscription=E.closedStream.subscribe(()=>this._onTouched()),this._registerModel(E.registerInput(this)))}get min(){return this._min}set min(E){const V=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E));this._dateAdapter.sameDate(V,this._min)||(this._min=V,this._validatorOnChange())}get max(){return this._max}set max(E){const V=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E));this._dateAdapter.sameDate(V,this._max)||(this._max=V,this._validatorOnChange())}get dateFilter(){return this._dateFilter}set dateFilter(E){const V=this._matchesFilter(this.value);this._dateFilter=E,this._matchesFilter(this.value)!==V&&this._validatorOnChange()}getConnectedOverlayOrigin(){return this._formField?this._formField.getConnectedOverlayOrigin():this._elementRef}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}getThemePalette(){return this._formField?this._formField.color:void 0}getStartValue(){return this.value}ngOnDestroy(){super.ngOnDestroy(),this._closedSubscription.unsubscribe()}_openPopup(){this._datepicker&&this._datepicker.open()}_getValueFromModel(E){return E}_assignValueToModel(E){this._model&&this._model.updateSelection(E,this)}_getMinDate(){return this._min}_getMaxDate(){return this._max}_getDateFilter(){return this._dateFilter}_shouldHandleChangeEvent(E){return E.source!==this}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(B.SBq),B.Y36(jt._A,8),B.Y36(jt.sG,8),B.Y36(vi.G_,8))},ht.\u0275dir=B.lG2({type:ht,selectors:[["input","matDatepicker",""]],hostAttrs:[1,"mat-datepicker-input"],hostVars:6,hostBindings:function(E,V){1&E&&B.NdJ("input",function(xt){return V._onInput(xt.target.value)})("change",function(){return V._onChange()})("blur",function(){return V._onBlur()})("keydown",function(xt){return V._onKeydown(xt)}),2&E&&(B.Ikx("disabled",V.disabled),B.uIk("aria-haspopup",V._datepicker?"dialog":null)("aria-owns",(null==V._datepicker?null:V._datepicker.opened)&&V._datepicker.id||null)("min",V.min?V._dateAdapter.toIso8601(V.min):null)("max",V.max?V._dateAdapter.toIso8601(V.max):null)("data-mat-calendar",V._datepicker?V._datepicker.id:null))},inputs:{matDatepicker:"matDatepicker",min:"min",max:"max",dateFilter:["matDatepickerFilter","dateFilter"]},exportAs:["matDatepickerInput"],features:[B._Bn([Tt,Ct,{provide:re.Jk,useExisting:ht}]),B.qOj]}),ht})(),St=(()=>{class ht{}return ht.\u0275fac=function(E){return new(E||ht)},ht.\u0275dir=B.lG2({type:ht,selectors:[["","matDatepickerToggleIcon",""]]}),ht})(),Bt=(()=>{class ht{constructor(E,V,it){this._intl=E,this._changeDetectorRef=V,this._stateChanges=Pt.w0.EMPTY;const xt=Number(it);this.tabIndex=xt||0===xt?xt:null}get disabled(){return void 0===this._disabled&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(E){this._disabled=(0,zi.Ig)(E)}ngOnChanges(E){E.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(E){this.datepicker&&!this.disabled&&(this.datepicker.open(),E.stopPropagation())}_watchStateChanges(){const E=this.datepicker?this.datepicker.stateChanges:(0,ze.of)(),V=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:(0,ze.of)(),it=this.datepicker?(0,Le.T)(this.datepicker.openedStream,this.datepicker.closedStream):(0,ze.of)();this._stateChanges.unsubscribe(),this._stateChanges=(0,Le.T)(this._intl.changes,E,V,it).subscribe(()=>this._changeDetectorRef.markForCheck())}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(gn),B.Y36(B.sBO),B.$8M("tabindex"))},ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-datepicker-toggle"]],contentQueries:function(E,V,it){if(1&E&&B.Suo(it,St,5),2&E){let xt;B.iGM(xt=B.CRH())&&(V._customIcon=xt.first)}},viewQuery:function(E,V){if(1&E&&B.Gf(on,5),2&E){let it;B.iGM(it=B.CRH())&&(V._button=it.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(E,V){1&E&&B.NdJ("click",function(xt){return V._open(xt)}),2&E&&(B.uIk("tabindex",null)("data-mat-calendar",V.datepicker?V.datepicker.id:null),B.ekj("mat-datepicker-toggle-active",V.datepicker&&V.datepicker.opened)("mat-accent",V.datepicker&&"accent"===V.datepicker.color)("mat-warn",V.datepicker&&"warn"===V.datepicker.color))},inputs:{datepicker:["for","datepicker"],tabIndex:"tabIndex",ariaLabel:["aria-label","ariaLabel"],disabled:"disabled",disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],features:[B.TTD],ngContentSelectors:_i,decls:4,vars:6,consts:[["mat-icon-button","","type","button",3,"disabled","disableRipple"],["button",""],["class","mat-datepicker-toggle-default-icon","viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false",4,"ngIf"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(E,V){1&E&&(B.F$t(Ai),B.TgZ(0,"button",0,1),B.YNc(2,Rr,2,0,"svg",2),B.Hsn(3),B.qZA()),2&E&&(B.Q6J("disabled",V.disabled)("disableRipple",V.disableRipple),B.uIk("aria-haspopup",V.datepicker?"dialog":null)("aria-label",V.ariaLabel||V._intl.openCalendarLabel)("tabindex",V.disabled?-1:V.tabIndex),B.xp6(2),B.Q6J("ngIf",!V._customIcon))},directives:[$i.lW,u.O5],styles:[".mat-form-field-appearance-legacy .mat-form-field-prefix .mat-datepicker-toggle-default-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-datepicker-toggle-default-icon{width:1em}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-datepicker-toggle-default-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-datepicker-toggle-default-icon{display:block;width:1.5em;height:1.5em}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-datepicker-toggle-default-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-datepicker-toggle-default-icon{margin:auto}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}\n"],encapsulation:2,changeDetection:0}),ht})();const Nt=new B.OlP("MAT_DATE_RANGE_INPUT_PARENT"),be=(0,jt.FD)((()=>{class ht extends rt{constructor(E,V,it,xt,ye,ni,Hi,Un){super(V,Hi,Un),this._rangeInput=E,this._defaultErrorStateMatcher=it,this._injector=xt,this._parentForm=ye,this._parentFormGroup=ni}ngOnInit(){const E=this._injector.get(De.a5,null,B.XFs.Self|B.XFs.Optional);E&&(this.ngControl=E)}ngDoCheck(){this.ngControl&&this.updateErrorState()}isEmpty(){return 0===this._elementRef.nativeElement.value.length}_getPlaceholder(){return this._elementRef.nativeElement.placeholder}focus(){this._elementRef.nativeElement.focus()}_onInput(E){super._onInput(E),this._rangeInput._handleChildValueChange()}_openPopup(){this._rangeInput._openDatepicker()}_getMinDate(){return this._rangeInput.min}_getMaxDate(){return this._rangeInput.max}_getDateFilter(){return this._rangeInput.dateFilter}_parentDisabled(){return this._rangeInput._groupDisabled}_shouldHandleChangeEvent({source:E}){return E!==this._rangeInput._startInput&&E!==this._rangeInput._endInput}_assignValueProgrammatically(E){super._assignValueProgrammatically(E);const V=this===this._rangeInput._startInput?this._rangeInput._endInput:this._rangeInput._startInput;null==V||V._validatorOnChange()}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(Nt),B.Y36(B.SBq),B.Y36(jt.rD),B.Y36(B.zs3),B.Y36(De.F,8),B.Y36(De.sg,8),B.Y36(jt._A,8),B.Y36(jt.sG,8))},ht.\u0275dir=B.lG2({type:ht,features:[B.qOj]}),ht})());let Ce=(()=>{class ht extends be{constructor(E,V,it,xt,ye,ni,Hi,Un){super(E,V,it,xt,ye,ni,Hi,Un),this._startValidator=Qn=>{const tr=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(Qn.value)),un=this._model?this._model.selection.end:null;return!tr||!un||this._dateAdapter.compareDate(tr,un)<=0?null:{matStartDateInvalid:{end:un,actual:tr}}},this._validator=De.kI.compose([...super._getValidators(),this._startValidator])}_getValueFromModel(E){return E.start}_shouldHandleChangeEvent(E){var V;return!(!super._shouldHandleChangeEvent(E)||((null==(V=E.oldValue)?void 0:V.start)?E.selection.start&&!this._dateAdapter.compareDate(E.oldValue.start,E.selection.start):!E.selection.start))}_assignValueToModel(E){if(this._model){const V=new Ei(E,this._model.selection.end);this._model.updateSelection(V,this)}}_formatValue(E){super._formatValue(E),this._rangeInput._handleChildValueChange()}getMirrorValue(){const E=this._elementRef.nativeElement,V=E.value;return V.length>0?V:E.placeholder}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(Nt),B.Y36(B.SBq),B.Y36(jt.rD),B.Y36(B.zs3),B.Y36(De.F,8),B.Y36(De.sg,8),B.Y36(jt._A,8),B.Y36(jt.sG,8))},ht.\u0275dir=B.lG2({type:ht,selectors:[["input","matStartDate",""]],hostAttrs:["type","text",1,"mat-start-date","mat-date-range-input-inner"],hostVars:6,hostBindings:function(E,V){1&E&&B.NdJ("input",function(xt){return V._onInput(xt.target.value)})("change",function(){return V._onChange()})("keydown",function(xt){return V._onKeydown(xt)})("blur",function(){return V._onBlur()}),2&E&&(B.Ikx("disabled",V.disabled),B.uIk("id",V._rangeInput.id)("aria-haspopup",V._rangeInput.rangePicker?"dialog":null)("aria-owns",(null==V._rangeInput.rangePicker?null:V._rangeInput.rangePicker.opened)&&V._rangeInput.rangePicker.id||null)("min",V._getMinDate()?V._dateAdapter.toIso8601(V._getMinDate()):null)("max",V._getMaxDate()?V._dateAdapter.toIso8601(V._getMaxDate()):null))},inputs:{errorStateMatcher:"errorStateMatcher"},outputs:{dateChange:"dateChange",dateInput:"dateInput"},features:[B._Bn([{provide:De.JU,useExisting:ht,multi:!0},{provide:De.Cf,useExisting:ht,multi:!0}]),B.qOj]}),ht})(),Se=(()=>{class ht extends be{constructor(E,V,it,xt,ye,ni,Hi,Un){super(E,V,it,xt,ye,ni,Hi,Un),this._endValidator=Qn=>{const tr=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(Qn.value)),un=this._model?this._model.selection.start:null;return!tr||!un||this._dateAdapter.compareDate(tr,un)>=0?null:{matEndDateInvalid:{start:un,actual:tr}}},this._validator=De.kI.compose([...super._getValidators(),this._endValidator])}_getValueFromModel(E){return E.end}_shouldHandleChangeEvent(E){var V;return!(!super._shouldHandleChangeEvent(E)||((null==(V=E.oldValue)?void 0:V.end)?E.selection.end&&!this._dateAdapter.compareDate(E.oldValue.end,E.selection.end):!E.selection.end))}_assignValueToModel(E){if(this._model){const V=new Ei(this._model.selection.start,E);this._model.updateSelection(V,this)}}_onKeydown(E){E.keyCode===ie.ZH&&!this._elementRef.nativeElement.value&&this._rangeInput._startInput.focus(),super._onKeydown(E)}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(Nt),B.Y36(B.SBq),B.Y36(jt.rD),B.Y36(B.zs3),B.Y36(De.F,8),B.Y36(De.sg,8),B.Y36(jt._A,8),B.Y36(jt.sG,8))},ht.\u0275dir=B.lG2({type:ht,selectors:[["input","matEndDate",""]],hostAttrs:["type","text",1,"mat-end-date","mat-date-range-input-inner"],hostVars:5,hostBindings:function(E,V){1&E&&B.NdJ("input",function(xt){return V._onInput(xt.target.value)})("change",function(){return V._onChange()})("keydown",function(xt){return V._onKeydown(xt)})("blur",function(){return V._onBlur()}),2&E&&(B.Ikx("disabled",V.disabled),B.uIk("aria-haspopup",V._rangeInput.rangePicker?"dialog":null)("aria-owns",(null==V._rangeInput.rangePicker?null:V._rangeInput.rangePicker.opened)&&V._rangeInput.rangePicker.id||null)("min",V._getMinDate()?V._dateAdapter.toIso8601(V._getMinDate()):null)("max",V._getMaxDate()?V._dateAdapter.toIso8601(V._getMaxDate()):null))},inputs:{errorStateMatcher:"errorStateMatcher"},outputs:{dateChange:"dateChange",dateInput:"dateInput"},features:[B._Bn([{provide:De.JU,useExisting:ht,multi:!0},{provide:De.Cf,useExisting:ht,multi:!0}]),B.qOj]}),ht})(),Fe=0,Je=(()=>{class ht{constructor(E,V,it,xt,ye){if(this._changeDetectorRef=E,this._elementRef=V,this._dateAdapter=xt,this._formField=ye,this._closedSubscription=Pt.w0.EMPTY,this.id="mat-date-range-input-"+Fe++,this.focused=!1,this.controlType="mat-date-range-input",this._groupDisabled=!1,this._ariaDescribedBy=null,this.separator="\u2013",this.comparisonStart=null,this.comparisonEnd=null,this.stateChanges=new Te.x,null==ye?void 0:ye._elementRef.nativeElement.classList.contains("mat-mdc-form-field")){const ni=V.nativeElement.classList;ni.add("mat-mdc-input-element"),ni.add("mat-mdc-form-field-input-control")}this.ngControl=it}get value(){return this._model?this._model.selection:null}get shouldLabelFloat(){return this.focused||!this.empty}get placeholder(){var it,xt;const E=(null==(it=this._startInput)?void 0:it._getPlaceholder())||"",V=(null==(xt=this._endInput)?void 0:xt._getPlaceholder())||"";return E||V?`${E} ${this.separator} ${V}`:""}get rangePicker(){return this._rangePicker}set rangePicker(E){E&&(this._model=E.registerInput(this),this._rangePicker=E,this._closedSubscription.unsubscribe(),this._closedSubscription=E.closedStream.subscribe(()=>{var V,it;null==(V=this._startInput)||V._onTouched(),null==(it=this._endInput)||it._onTouched()}),this._registerModel(this._model))}get required(){return!!this._required}set required(E){this._required=(0,zi.Ig)(E)}get dateFilter(){return this._dateFilter}set dateFilter(E){const V=this._startInput,it=this._endInput,xt=V&&V._matchesFilter(V.value),ye=it&&it._matchesFilter(V.value);this._dateFilter=E,V&&V._matchesFilter(V.value)!==xt&&V._validatorOnChange(),it&&it._matchesFilter(it.value)!==ye&&it._validatorOnChange()}get min(){return this._min}set min(E){const V=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E));this._dateAdapter.sameDate(V,this._min)||(this._min=V,this._revalidate())}get max(){return this._max}set max(E){const V=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(E));this._dateAdapter.sameDate(V,this._max)||(this._max=V,this._revalidate())}get disabled(){return this._startInput&&this._endInput?this._startInput.disabled&&this._endInput.disabled:this._groupDisabled}set disabled(E){const V=(0,zi.Ig)(E);V!==this._groupDisabled&&(this._groupDisabled=V,this.stateChanges.next(void 0))}get errorState(){return!(!this._startInput||!this._endInput)&&(this._startInput.errorState||this._endInput.errorState)}get empty(){const E=!!this._startInput&&this._startInput.isEmpty(),V=!!this._endInput&&this._endInput.isEmpty();return E&&V}setDescribedByIds(E){this._ariaDescribedBy=E.length?E.join(" "):null}onContainerClick(){!this.focused&&!this.disabled&&(this._model&&this._model.selection.start?this._endInput.focus():this._startInput.focus())}ngAfterContentInit(){this._model&&this._registerModel(this._model),(0,Le.T)(this._startInput.stateChanges,this._endInput.stateChanges).subscribe(()=>{this.stateChanges.next(void 0)})}ngOnChanges(E){ft(E,this._dateAdapter)&&this.stateChanges.next(void 0)}ngOnDestroy(){this._closedSubscription.unsubscribe(),this.stateChanges.complete()}getStartValue(){return this.value?this.value.start:null}getThemePalette(){return this._formField?this._formField.color:void 0}getConnectedOverlayOrigin(){return this._formField?this._formField.getConnectedOverlayOrigin():this._elementRef}getOverlayLabelId(){return this._formField?this._formField.getLabelId():null}_getInputMirrorValue(){return this._startInput?this._startInput.getMirrorValue():""}_shouldHidePlaceholders(){return!!this._startInput&&!this._startInput.isEmpty()}_handleChildValueChange(){this.stateChanges.next(void 0),this._changeDetectorRef.markForCheck()}_openDatepicker(){this._rangePicker&&this._rangePicker.open()}_shouldHideSeparator(){return(!this._formField||this._formField.getLabelId()&&!this._formField._shouldLabelFloat())&&this.empty}_getAriaLabelledby(){const E=this._formField;return E&&E._hasFloatingLabel()?E._labelId:null}_updateFocus(E){this.focused=null!==E,this.stateChanges.next()}_revalidate(){this._startInput&&this._startInput._validatorOnChange(),this._endInput&&this._endInput._validatorOnChange()}_registerModel(E){this._startInput&&this._startInput._registerModel(E),this._endInput&&this._endInput._registerModel(E)}}return ht.\u0275fac=function(E){return new(E||ht)(B.Y36(B.sBO),B.Y36(B.SBq),B.Y36(De.gN,10),B.Y36(jt._A,8),B.Y36(vi.G_,8))},ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-date-range-input"]],contentQueries:function(E,V,it){if(1&E&&(B.Suo(it,Ce,5),B.Suo(it,Se,5)),2&E){let xt;B.iGM(xt=B.CRH())&&(V._startInput=xt.first),B.iGM(xt=B.CRH())&&(V._endInput=xt.first)}},hostAttrs:["role","group",1,"mat-date-range-input"],hostVars:8,hostBindings:function(E,V){2&E&&(B.uIk("id",null)("aria-labelledby",V._getAriaLabelledby())("aria-describedby",V._ariaDescribedBy)("data-mat-calendar",V.rangePicker?V.rangePicker.id:null),B.ekj("mat-date-range-input-hide-placeholders",V._shouldHidePlaceholders())("mat-date-range-input-required",V.required))},inputs:{rangePicker:"rangePicker",required:"required",dateFilter:"dateFilter",min:"min",max:"max",disabled:"disabled",separator:"separator",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd"},exportAs:["matDateRangeInput"],features:[B._Bn([{provide:vi.Eo,useExisting:ht},{provide:Nt,useExisting:ht}]),B.TTD],ngContentSelectors:rr,decls:9,vars:4,consts:[["cdkMonitorSubtreeFocus","",1,"mat-date-range-input-container",3,"cdkFocusChange"],[1,"mat-date-range-input-start-wrapper"],["aria-hidden","true",1,"mat-date-range-input-mirror"],[1,"mat-date-range-input-separator"],[1,"mat-date-range-input-end-wrapper"]],template:function(E,V){1&E&&(B.F$t(Wn),B.TgZ(0,"div",0),B.NdJ("cdkFocusChange",function(xt){return V._updateFocus(xt)}),B.TgZ(1,"div",1),B.Hsn(2),B.TgZ(3,"span",2),B._uU(4),B.qZA(),B.qZA(),B.TgZ(5,"span",3),B._uU(6),B.qZA(),B.TgZ(7,"div",4),B.Hsn(8,1),B.qZA(),B.qZA()),2&E&&(B.xp6(4),B.Oqu(V._getInputMirrorValue()),B.xp6(1),B.ekj("mat-date-range-input-separator-hidden",V._shouldHideSeparator()),B.xp6(1),B.Oqu(V.separator))},directives:[Ue.kH],styles:[".mat-date-range-input{display:block;width:100%}.mat-date-range-input-container{display:flex;align-items:center}.mat-date-range-input-separator{transition:opacity 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1);margin:0 4px}.mat-date-range-input-separator-hidden{-webkit-user-select:none;-moz-user-select:none;user-select:none;opacity:0;transition:none}.mat-date-range-input-inner{font:inherit;background:transparent;color:currentColor;border:none;outline:none;padding:0;margin:0;vertical-align:bottom;text-align:inherit;-webkit-appearance:none;width:100%}.mat-date-range-input-inner:-moz-ui-invalid{box-shadow:none}.mat-date-range-input-inner::placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-date-range-input-inner::-moz-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-date-range-input-inner::-webkit-input-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-date-range-input-inner:-ms-input-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-hide-placeholder .mat-date-range-input-inner::placeholder,.mat-date-range-input-hide-placeholders .mat-date-range-input-inner::placeholder{-webkit-user-select:none;-moz-user-select:none;user-select:none;color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-date-range-input-inner::placeholder,.cdk-high-contrast-active .mat-date-range-input-hide-placeholders .mat-date-range-input-inner::placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-date-range-input-inner::-moz-placeholder,.mat-date-range-input-hide-placeholders .mat-date-range-input-inner::-moz-placeholder{-webkit-user-select:none;-moz-user-select:none;user-select:none;color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-date-range-input-inner::-moz-placeholder,.cdk-high-contrast-active .mat-date-range-input-hide-placeholders .mat-date-range-input-inner::-moz-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-date-range-input-inner::-webkit-input-placeholder,.mat-date-range-input-hide-placeholders .mat-date-range-input-inner::-webkit-input-placeholder{-webkit-user-select:none;-moz-user-select:none;user-select:none;color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-date-range-input-inner::-webkit-input-placeholder,.cdk-high-contrast-active .mat-date-range-input-hide-placeholders .mat-date-range-input-inner::-webkit-input-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-date-range-input-inner:-ms-input-placeholder,.mat-date-range-input-hide-placeholders .mat-date-range-input-inner:-ms-input-placeholder{-webkit-user-select:none;-moz-user-select:none;user-select:none;color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-date-range-input-inner:-ms-input-placeholder,.cdk-high-contrast-active .mat-date-range-input-hide-placeholders .mat-date-range-input-inner:-ms-input-placeholder{opacity:0}.mat-date-range-input-mirror{-webkit-user-select:none;-moz-user-select:none;user-select:none;visibility:hidden;white-space:nowrap;display:inline-block;min-width:2px}.mat-date-range-input-start-wrapper{position:relative;overflow:hidden;max-width:calc(50% - 4px)}.mat-date-range-input-start-wrapper .mat-date-range-input-inner{position:absolute;top:0;left:0}.mat-date-range-input-end-wrapper{flex-grow:1;max-width:calc(50% - 4px)}.mat-form-field-type-mat-date-range-input .mat-form-field-infix{width:200px}\n"],encapsulation:2,changeDetection:0}),ht})(),wi=(()=>{class ht extends F{_forwardContentValues(E){super._forwardContentValues(E);const V=this.datepickerInput;V&&(E.comparisonStart=V.comparisonStart,E.comparisonEnd=V.comparisonEnd)}}return ht.\u0275fac=function(){let kt;return function(V){return(kt||(kt=B.n5z(ht)))(V||ht)}}(),ht.\u0275cmp=B.Xpm({type:ht,selectors:[["mat-date-range-picker"]],exportAs:["matDateRangePicker"],features:[B._Bn([Ie,Me,{provide:F,useExisting:ht}]),B.qOj],decls:0,vars:0,template:function(E,V){},encapsulation:2,changeDetection:0}),ht})(),Jn=(()=>{class ht{}return ht.\u0275fac=function(E){return new(E||ht)},ht.\u0275mod=B.oAB({type:ht}),ht.\u0275inj=B.cJS({providers:[gn,ar],imports:[[u.ez,$i.ot,Si.U8,Ue.rt,_t.eL,jt.BQ],mi.ZD]}),ht})()},8167:(Hn,Fi,me)=>{"use strict";me.d(Fi,{G_:()=>Yi,KE:()=>zn,Eo:()=>on,lN:()=>Yn,hX:()=>Ci,R9:()=>ln});var Ue=me(6231),Si=me(6019),_t=me(1514),u=me(6731),B=me(8290),$i=me(348),mi=me(273),jt=me(3719),Te=me(5077),Pt=me(3970),Le=me(6263),ze=me(9468),ie=me(9814),Oe=me(928),ui=me(9555);const de=["connectionContainer"],ei=["inputContainer"],zi=["label"];function Ke(he,Ie){1&he&&(_t.ynx(0),_t.TgZ(1,"div",14),_t._UZ(2,"div",15),_t._UZ(3,"div",16),_t._UZ(4,"div",17),_t.qZA(),_t.TgZ(5,"div",18),_t._UZ(6,"div",15),_t._UZ(7,"div",16),_t._UZ(8,"div",17),_t.qZA(),_t.BQk())}function ke(he,Ie){if(1&he){const Wt=_t.EpF();_t.TgZ(0,"div",19),_t.NdJ("cdkObserveContent",function(){return _t.CHM(Wt),_t.oxw().updateOutlineGap()}),_t.Hsn(1,1),_t.qZA()}if(2&he){const Wt=_t.oxw();_t.Q6J("cdkObserveContentDisabled","outline"!=Wt.appearance)}}function De(he,Ie){if(1&he&&(_t.ynx(0),_t.Hsn(1,2),_t.TgZ(2,"span"),_t._uU(3),_t.qZA(),_t.BQk()),2&he){const Wt=_t.oxw(2);_t.xp6(3),_t.Oqu(Wt._control.placeholder)}}function vi(he,Ie){1&he&&_t.Hsn(0,3,["*ngSwitchCase","true"])}function re(he,Ie){1&he&&(_t.TgZ(0,"span",23),_t._uU(1," *"),_t.qZA())}function we(he,Ie){if(1&he){const Wt=_t.EpF();_t.TgZ(0,"label",20,21),_t.NdJ("cdkObserveContent",function(){return _t.CHM(Wt),_t.oxw().updateOutlineGap()}),_t.YNc(2,De,4,1,"ng-container",12),_t.YNc(3,vi,1,0,"ng-content",12),_t.YNc(4,re,2,0,"span",22),_t.qZA()}if(2&he){const Wt=_t.oxw();_t.ekj("mat-empty",Wt._control.empty&&!Wt._shouldAlwaysFloat())("mat-form-field-empty",Wt._control.empty&&!Wt._shouldAlwaysFloat())("mat-accent","accent"==Wt.color)("mat-warn","warn"==Wt.color),_t.Q6J("cdkObserveContentDisabled","outline"!=Wt.appearance)("id",Wt._labelId)("ngSwitch",Wt._hasLabel()),_t.uIk("for",Wt._control.id)("aria-owns",Wt._control.id),_t.xp6(2),_t.Q6J("ngSwitchCase",!1),_t.xp6(1),_t.Q6J("ngSwitchCase",!0),_t.xp6(1),_t.Q6J("ngIf",!Wt.hideRequiredMarker&&Wt._control.required&&!Wt._control.disabled)}}function di(he,Ie){1&he&&(_t.TgZ(0,"div",24),_t.Hsn(1,4),_t.qZA())}function Ti(he,Ie){if(1&he&&(_t.TgZ(0,"div",25),_t._UZ(1,"span",26),_t.qZA()),2&he){const Wt=_t.oxw();_t.xp6(1),_t.ekj("mat-accent","accent"==Wt.color)("mat-warn","warn"==Wt.color)}}function an(he,Ie){if(1&he&&(_t.TgZ(0,"div"),_t.Hsn(1,5),_t.qZA()),2&he){const Wt=_t.oxw();_t.Q6J("@transitionMessages",Wt._subscriptAnimationState)}}function nr(he,Ie){if(1&he&&(_t.TgZ(0,"div",30),_t._uU(1),_t.qZA()),2&he){const Wt=_t.oxw(2);_t.Q6J("id",Wt._hintLabelId),_t.xp6(1),_t.Oqu(Wt.hintLabel)}}function nn(he,Ie){if(1&he&&(_t.TgZ(0,"div",27),_t.YNc(1,nr,2,2,"div",28),_t.Hsn(2,6),_t._UZ(3,"div",29),_t.Hsn(4,7),_t.qZA()),2&he){const Wt=_t.oxw();_t.Q6J("@transitionMessages",Wt._subscriptAnimationState),_t.xp6(1),_t.Q6J("ngIf",Wt.hintLabel)}}const fn=["*",[["","matPrefix",""]],[["mat-placeholder"]],[["mat-label"]],[["","matSuffix",""]],[["mat-error"]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],qn=["*","[matPrefix]","mat-placeholder","mat-label","[matSuffix]","mat-error","mat-hint:not([align='end'])","mat-hint[align='end']"],Mn=new _t.OlP("MatError"),hn={transitionMessages:(0,ie.X$)("transitionMessages",[(0,ie.SB)("enter",(0,ie.oB)({opacity:1,transform:"translateY(0%)"})),(0,ie.eR)("void => enter",[(0,ie.oB)({opacity:0,transform:"translateY(-5px)"}),(0,ie.jt)("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let on=(()=>{class he{}return he.\u0275fac=function(Wt){return new(Wt||he)},he.\u0275dir=_t.lG2({type:he}),he})();const rr=new _t.OlP("MatHint");let Ci=(()=>{class he{}return he.\u0275fac=function(Wt){return new(Wt||he)},he.\u0275dir=_t.lG2({type:he,selectors:[["mat-label"]]}),he})(),gn=(()=>{class he{}return he.\u0275fac=function(Wt){return new(Wt||he)},he.\u0275dir=_t.lG2({type:he,selectors:[["mat-placeholder"]]}),he})();const vr=new _t.OlP("MatPrefix"),Ve=new _t.OlP("MatSuffix");let ln=(()=>{class he{}return he.\u0275fac=function(Wt){return new(Wt||he)},he.\u0275dir=_t.lG2({type:he,selectors:[["","matSuffix",""]],features:[_t._Bn([{provide:Ve,useExisting:he}])]}),he})(),Bn=0;const Tn=(0,u.pj)(class{constructor(he){this._elementRef=he}},"primary"),pi=new _t.OlP("MAT_FORM_FIELD_DEFAULT_OPTIONS"),Yi=new _t.OlP("MatFormField");let zn=(()=>{class he extends Tn{constructor(Wt,le,ii,Me,Xn,Ji,Pi){super(Wt),this._changeDetectorRef=le,this._dir=ii,this._defaults=Me,this._platform=Xn,this._ngZone=Ji,this._outlineGapCalculationNeededImmediately=!1,this._outlineGapCalculationNeededOnStable=!1,this._destroyed=new mi.x,this._showAlwaysAnimate=!1,this._subscriptAnimationState="",this._hintLabel="",this._hintLabelId="mat-hint-"+Bn++,this._labelId="mat-form-field-label-"+Bn++,this.floatLabel=this._getDefaultFloatLabelState(),this._animationsEnabled="NoopAnimations"!==Pi,this.appearance=Me&&Me.appearance?Me.appearance:"legacy",this._hideRequiredMarker=!(!Me||null==Me.hideRequiredMarker)&&Me.hideRequiredMarker}get appearance(){return this._appearance}set appearance(Wt){const le=this._appearance;this._appearance=Wt||this._defaults&&this._defaults.appearance||"legacy","outline"===this._appearance&&le!==Wt&&(this._outlineGapCalculationNeededOnStable=!0)}get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(Wt){this._hideRequiredMarker=(0,$i.Ig)(Wt)}_shouldAlwaysFloat(){return"always"===this.floatLabel&&!this._showAlwaysAnimate}_canLabelFloat(){return"never"!==this.floatLabel}get hintLabel(){return this._hintLabel}set hintLabel(Wt){this._hintLabel=Wt,this._processHints()}get floatLabel(){return"legacy"!==this.appearance&&"never"===this._floatLabel?"auto":this._floatLabel}set floatLabel(Wt){Wt!==this._floatLabel&&(this._floatLabel=Wt||this._getDefaultFloatLabelState(),this._changeDetectorRef.markForCheck())}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(Wt){this._explicitFormFieldControl=Wt}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}ngAfterContentInit(){this._validateControlChild();const Wt=this._control;Wt.controlType&&this._elementRef.nativeElement.classList.add(`mat-form-field-type-${Wt.controlType}`),Wt.stateChanges.pipe((0,Pt.O)(null)).subscribe(()=>{this._validatePlaceholders(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),Wt.ngControl&&Wt.ngControl.valueChanges&&Wt.ngControl.valueChanges.pipe((0,Le.R)(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe((0,Le.R)(this._destroyed)).subscribe(()=>{this._outlineGapCalculationNeededOnStable&&this.updateOutlineGap()})}),(0,jt.T)(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._outlineGapCalculationNeededOnStable=!0,this._changeDetectorRef.markForCheck()}),this._hintChildren.changes.pipe((0,Pt.O)(null)).subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.pipe((0,Pt.O)(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._dir&&this._dir.change.pipe((0,Le.R)(this._destroyed)).subscribe(()=>{"function"==typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this.updateOutlineGap())}):this.updateOutlineGap()})}ngAfterContentChecked(){this._validateControlChild(),this._outlineGapCalculationNeededImmediately&&this.updateOutlineGap()}ngAfterViewInit(){this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(Wt){const le=this._control?this._control.ngControl:null;return le&&le[Wt]}_hasPlaceholder(){return!!(this._control&&this._control.placeholder||this._placeholderChild)}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_shouldLabelFloat(){return this._canLabelFloat()&&(this._control&&this._control.shouldLabelFloat||this._shouldAlwaysFloat())}_hideControlPlaceholder(){return"legacy"===this.appearance&&!this._hasLabel()||this._hasLabel()&&!this._shouldLabelFloat()}_hasFloatingLabel(){return this._hasLabel()||"legacy"===this.appearance&&this._hasPlaceholder()}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_animateAndLockLabel(){this._hasFloatingLabel()&&this._canLabelFloat()&&(this._animationsEnabled&&this._label&&(this._showAlwaysAnimate=!0,(0,Te.R)(this._label.nativeElement,"transitionend").pipe((0,ze.q)(1)).subscribe(()=>{this._showAlwaysAnimate=!1})),this.floatLabel="always",this._changeDetectorRef.markForCheck())}_validatePlaceholders(){}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_getDefaultFloatLabelState(){return this._defaults&&this._defaults.floatLabel||"auto"}_syncDescribedByIds(){if(this._control){let Wt=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&Wt.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const le=this._hintChildren?this._hintChildren.find(Me=>"start"===Me.align):null,ii=this._hintChildren?this._hintChildren.find(Me=>"end"===Me.align):null;le?Wt.push(le.id):this._hintLabel&&Wt.push(this._hintLabelId),ii&&Wt.push(ii.id)}else this._errorChildren&&Wt.push(...this._errorChildren.map(le=>le.id));this._control.setDescribedByIds(Wt)}}_validateControlChild(){}updateOutlineGap(){const Wt=this._label?this._label.nativeElement:null,le=this._connectionContainerRef.nativeElement,ii=".mat-form-field-outline-start",Me=".mat-form-field-outline-gap";if("outline"!==this.appearance||!this._platform.isBrowser)return;if(!Wt||!Wt.children.length||!Wt.textContent.trim()){const Ui=le.querySelectorAll(`${ii}, ${Me}`);for(let Ni=0;Ni<Ui.length;Ni++)Ui[Ni].style.width="0";return}if(!this._isAttachedToDOM())return void(this._outlineGapCalculationNeededImmediately=!0);let Xn=0,Ji=0;const Pi=le.querySelectorAll(ii),Cn=le.querySelectorAll(Me);if(this._label&&this._label.nativeElement.children.length){const Ui=le.getBoundingClientRect();if(0===Ui.width&&0===Ui.height)return this._outlineGapCalculationNeededOnStable=!0,void(this._outlineGapCalculationNeededImmediately=!1);const Ni=this._getStartEnd(Ui),ji=Wt.children,bi=this._getStartEnd(ji[0].getBoundingClientRect());let mn=0;for(let Kn=0;Kn<ji.length;Kn++)mn+=ji[Kn].offsetWidth;Xn=Math.abs(bi-Ni)-5,Ji=mn>0?.75*mn+10:0}for(let Ui=0;Ui<Pi.length;Ui++)Pi[Ui].style.width=`${Xn}px`;for(let Ui=0;Ui<Cn.length;Ui++)Cn[Ui].style.width=`${Ji}px`;this._outlineGapCalculationNeededOnStable=this._outlineGapCalculationNeededImmediately=!1}_getStartEnd(Wt){return this._dir&&"rtl"===this._dir.value?Wt.right:Wt.left}_isAttachedToDOM(){const Wt=this._elementRef.nativeElement;if(Wt.getRootNode){const le=Wt.getRootNode();return le&&le!==Wt}return document.documentElement.contains(Wt)}}return he.\u0275fac=function(Wt){return new(Wt||he)(_t.Y36(_t.SBq),_t.Y36(_t.sBO),_t.Y36(B.Is,8),_t.Y36(pi,8),_t.Y36(Oe.t4),_t.Y36(_t.R0b),_t.Y36(ui.Qb,8))},he.\u0275cmp=_t.Xpm({type:he,selectors:[["mat-form-field"]],contentQueries:function(Wt,le,ii){if(1&Wt&&(_t.Suo(ii,on,5),_t.Suo(ii,on,7),_t.Suo(ii,Ci,5),_t.Suo(ii,Ci,7),_t.Suo(ii,gn,5),_t.Suo(ii,Mn,5),_t.Suo(ii,rr,5),_t.Suo(ii,vr,5),_t.Suo(ii,Ve,5)),2&Wt){let Me;_t.iGM(Me=_t.CRH())&&(le._controlNonStatic=Me.first),_t.iGM(Me=_t.CRH())&&(le._controlStatic=Me.first),_t.iGM(Me=_t.CRH())&&(le._labelChildNonStatic=Me.first),_t.iGM(Me=_t.CRH())&&(le._labelChildStatic=Me.first),_t.iGM(Me=_t.CRH())&&(le._placeholderChild=Me.first),_t.iGM(Me=_t.CRH())&&(le._errorChildren=Me),_t.iGM(Me=_t.CRH())&&(le._hintChildren=Me),_t.iGM(Me=_t.CRH())&&(le._prefixChildren=Me),_t.iGM(Me=_t.CRH())&&(le._suffixChildren=Me)}},viewQuery:function(Wt,le){if(1&Wt&&(_t.Gf(de,7),_t.Gf(ei,5),_t.Gf(zi,5)),2&Wt){let ii;_t.iGM(ii=_t.CRH())&&(le._connectionContainerRef=ii.first),_t.iGM(ii=_t.CRH())&&(le._inputContainerRef=ii.first),_t.iGM(ii=_t.CRH())&&(le._label=ii.first)}},hostAttrs:[1,"mat-form-field"],hostVars:40,hostBindings:function(Wt,le){2&Wt&&_t.ekj("mat-form-field-appearance-standard","standard"==le.appearance)("mat-form-field-appearance-fill","fill"==le.appearance)("mat-form-field-appearance-outline","outline"==le.appearance)("mat-form-field-appearance-legacy","legacy"==le.appearance)("mat-form-field-invalid",le._control.errorState)("mat-form-field-can-float",le._canLabelFloat())("mat-form-field-should-float",le._shouldLabelFloat())("mat-form-field-has-label",le._hasFloatingLabel())("mat-form-field-hide-placeholder",le._hideControlPlaceholder())("mat-form-field-disabled",le._control.disabled)("mat-form-field-autofilled",le._control.autofilled)("mat-focused",le._control.focused)("ng-untouched",le._shouldForward("untouched"))("ng-touched",le._shouldForward("touched"))("ng-pristine",le._shouldForward("pristine"))("ng-dirty",le._shouldForward("dirty"))("ng-valid",le._shouldForward("valid"))("ng-invalid",le._shouldForward("invalid"))("ng-pending",le._shouldForward("pending"))("_mat-animation-noopable",!le._animationsEnabled)},inputs:{color:"color",appearance:"appearance",hideRequiredMarker:"hideRequiredMarker",hintLabel:"hintLabel",floatLabel:"floatLabel"},exportAs:["matFormField"],features:[_t._Bn([{provide:Yi,useExisting:he}]),_t.qOj],ngContentSelectors:qn,decls:15,vars:8,consts:[[1,"mat-form-field-wrapper"],[1,"mat-form-field-flex",3,"click"],["connectionContainer",""],[4,"ngIf"],["class","mat-form-field-prefix",3,"cdkObserveContentDisabled","cdkObserveContent",4,"ngIf"],[1,"mat-form-field-infix"],["inputContainer",""],[1,"mat-form-field-label-wrapper"],["class","mat-form-field-label",3,"cdkObserveContentDisabled","id","mat-empty","mat-form-field-empty","mat-accent","mat-warn","ngSwitch","cdkObserveContent",4,"ngIf"],["class","mat-form-field-suffix",4,"ngIf"],["class","mat-form-field-underline",4,"ngIf"],[1,"mat-form-field-subscript-wrapper",3,"ngSwitch"],[4,"ngSwitchCase"],["class","mat-form-field-hint-wrapper",4,"ngSwitchCase"],[1,"mat-form-field-outline"],[1,"mat-form-field-outline-start"],[1,"mat-form-field-outline-gap"],[1,"mat-form-field-outline-end"],[1,"mat-form-field-outline","mat-form-field-outline-thick"],[1,"mat-form-field-prefix",3,"cdkObserveContentDisabled","cdkObserveContent"],[1,"mat-form-field-label",3,"cdkObserveContentDisabled","id","ngSwitch","cdkObserveContent"],["label",""],["class","mat-placeholder-required mat-form-field-required-marker","aria-hidden","true",4,"ngIf"],["aria-hidden","true",1,"mat-placeholder-required","mat-form-field-required-marker"],[1,"mat-form-field-suffix"],[1,"mat-form-field-underline"],[1,"mat-form-field-ripple"],[1,"mat-form-field-hint-wrapper"],["class","mat-hint",3,"id",4,"ngIf"],[1,"mat-form-field-hint-spacer"],[1,"mat-hint",3,"id"]],template:function(Wt,le){1&Wt&&(_t.F$t(fn),_t.TgZ(0,"div",0),_t.TgZ(1,"div",1,2),_t.NdJ("click",function(Me){return le._control.onContainerClick&&le._control.onContainerClick(Me)}),_t.YNc(3,Ke,9,0,"ng-container",3),_t.YNc(4,ke,2,1,"div",4),_t.TgZ(5,"div",5,6),_t.Hsn(7),_t.TgZ(8,"span",7),_t.YNc(9,we,5,16,"label",8),_t.qZA(),_t.qZA(),_t.YNc(10,di,2,0,"div",9),_t.qZA(),_t.YNc(11,Ti,2,4,"div",10),_t.TgZ(12,"div",11),_t.YNc(13,an,2,1,"div",12),_t.YNc(14,nn,5,2,"div",13),_t.qZA(),_t.qZA()),2&Wt&&(_t.xp6(3),_t.Q6J("ngIf","outline"==le.appearance),_t.xp6(1),_t.Q6J("ngIf",le._prefixChildren.length),_t.xp6(5),_t.Q6J("ngIf",le._hasFloatingLabel()),_t.xp6(1),_t.Q6J("ngIf",le._suffixChildren.length),_t.xp6(1),_t.Q6J("ngIf","outline"!=le.appearance),_t.xp6(1),_t.Q6J("ngSwitch",le._getDisplayedMessages()),_t.xp6(1),_t.Q6J("ngSwitchCase","error"),_t.xp6(1),_t.Q6J("ngSwitchCase","hint"))},directives:[Si.O5,Si.RF,Si.n9,Ue.wD],styles:[".mat-form-field{display:inline-block;position:relative;text-align:left}[dir=rtl] .mat-form-field{text-align:right}.mat-form-field-wrapper{position:relative}.mat-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-form-field-prefix,.mat-form-field-suffix{white-space:nowrap;flex:none;position:relative}.mat-form-field-infix{display:block;position:relative;flex:auto;min-width:0;width:180px}.cdk-high-contrast-active .mat-form-field-infix{border-image:linear-gradient(transparent, transparent)}.mat-form-field-label-wrapper{position:absolute;left:0;box-sizing:content-box;width:100%;height:100%;overflow:hidden;pointer-events:none}[dir=rtl] .mat-form-field-label-wrapper{left:auto;right:0}.mat-form-field-label{position:absolute;left:0;font:inherit;pointer-events:none;width:100%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),width 400ms cubic-bezier(0.25, 0.8, 0.25, 1);display:none}[dir=rtl] .mat-form-field-label{transform-origin:100% 0;left:auto;right:0}.mat-form-field-empty.mat-form-field-label,.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{display:block}.mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:block;transition:none}.mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-form-field-can-float .mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:block}.mat-form-field-label:not(.mat-form-field-empty){transition:none}.mat-form-field-underline{position:absolute;width:100%;pointer-events:none;transform:scale3d(1, 1.0001, 1)}.mat-form-field-ripple{position:absolute;left:0;width:100%;transform-origin:50%;transform:scaleX(0.5);opacity:0;transition:background-color 300ms cubic-bezier(0.55, 0, 0.55, 0.2)}.mat-form-field.mat-focused .mat-form-field-ripple,.mat-form-field.mat-form-field-invalid .mat-form-field-ripple{opacity:1;transform:none;transition:transform 300ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 300ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-subscript-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.mat-form-field-subscript-wrapper .mat-icon,.mat-form-field-label-wrapper .mat-icon{width:1em;height:1em;font-size:inherit;vertical-align:baseline}.mat-form-field-hint-wrapper{display:flex}.mat-form-field-hint-spacer{flex:1 0 1em}.mat-error{display:block}.mat-form-field-control-wrapper{position:relative}.mat-form-field-hint-end{order:1}.mat-form-field._mat-animation-noopable .mat-form-field-label,.mat-form-field._mat-animation-noopable .mat-form-field-ripple{transition:none}\n",'.mat-form-field-appearance-fill .mat-form-field-flex{border-radius:4px 4px 0 0;padding:.75em .75em 0 .75em}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-flex{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-form-field-flex{outline:dashed 3px}.mat-form-field-appearance-fill .mat-form-field-underline::before{content:"";display:block;position:absolute;bottom:0;height:1px;width:100%}.mat-form-field-appearance-fill .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-ripple{height:0}.mat-form-field-appearance-fill:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-fill._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}.mat-form-field-appearance-fill .mat-form-field-subscript-wrapper{padding:0 1em}\n','.mat-input-element{font:inherit;background:transparent;color:currentColor;border:none;outline:none;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit;box-sizing:content-box}.mat-input-element:-moz-ui-invalid{box-shadow:none}.mat-input-element,.mat-input-element::-webkit-search-cancel-button,.mat-input-element::-webkit-search-decoration,.mat-input-element::-webkit-search-results-button,.mat-input-element::-webkit-search-results-decoration{-webkit-appearance:none}.mat-input-element::-webkit-contacts-auto-fill-button,.mat-input-element::-webkit-caps-lock-indicator,.mat-input-element:not([type=password])::-webkit-credentials-auto-fill-button{visibility:hidden}.mat-input-element[type=date],.mat-input-element[type=datetime],.mat-input-element[type=datetime-local],.mat-input-element[type=month],.mat-input-element[type=week],.mat-input-element[type=time]{line-height:1}.mat-input-element[type=date]::after,.mat-input-element[type=datetime]::after,.mat-input-element[type=datetime-local]::after,.mat-input-element[type=month]::after,.mat-input-element[type=week]::after,.mat-input-element[type=time]::after{content:" ";white-space:pre;width:1px}.mat-input-element::-webkit-inner-spin-button,.mat-input-element::-webkit-calendar-picker-indicator,.mat-input-element::-webkit-clear-button{font-size:.75em}.mat-input-element::placeholder{-webkit-user-select:none;-moz-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-moz-placeholder{-webkit-user-select:none;-moz-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-webkit-input-placeholder{-webkit-user-select:none;-moz-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element:-ms-input-placeholder{-webkit-user-select:none;-moz-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-hide-placeholder .mat-input-element::placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{opacity:0}textarea.mat-input-element{resize:vertical;overflow:auto}textarea.mat-input-element.cdk-textarea-autosize{resize:none}textarea.mat-input-element{padding:2px 0;margin:-2px 0}select.mat-input-element{-moz-appearance:none;-webkit-appearance:none;position:relative;background-color:transparent;display:inline-flex;box-sizing:border-box;padding-top:1em;top:-1em;margin-bottom:-1em}select.mat-input-element::-moz-focus-inner{border:0}select.mat-input-element:not(:disabled){cursor:pointer}.mat-form-field-type-mat-native-select .mat-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid;position:absolute;top:50%;right:0;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-form-field-type-mat-native-select .mat-form-field-infix::after{right:auto;left:0}.mat-form-field-type-mat-native-select .mat-input-element{padding-right:15px}[dir=rtl] .mat-form-field-type-mat-native-select .mat-input-element{padding-right:0;padding-left:15px}.mat-form-field-type-mat-native-select .mat-form-field-label-wrapper{max-width:calc(100% - 10px)}.mat-form-field-type-mat-native-select.mat-form-field-appearance-outline .mat-form-field-infix::after{margin-top:-5px}.mat-form-field-type-mat-native-select.mat-form-field-appearance-fill .mat-form-field-infix::after{margin-top:-10px}\n',".mat-form-field-appearance-legacy .mat-form-field-label{transform:perspective(100px)}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon{width:1em}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button{font:inherit;vertical-align:baseline}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button .mat-icon{font-size:inherit}.mat-form-field-appearance-legacy .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-legacy .mat-form-field-ripple{top:0;height:2px;overflow:hidden}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}.cdk-high-contrast-active .mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}.mat-form-field-appearance-legacy.mat-form-field-invalid:not(.mat-focused) .mat-form-field-ripple{height:1px}\n",".mat-form-field-appearance-outline .mat-form-field-wrapper{margin:.25em 0}.mat-form-field-appearance-outline .mat-form-field-flex{padding:0 .75em 0 .75em;margin-top:-0.25em;position:relative}.mat-form-field-appearance-outline .mat-form-field-prefix,.mat-form-field-appearance-outline .mat-form-field-suffix{top:.25em}.mat-form-field-appearance-outline .mat-form-field-outline{display:flex;position:absolute;top:.25em;left:0;right:0;bottom:0;pointer-events:none}.mat-form-field-appearance-outline .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-end{border:1px solid currentColor;min-width:5px}.mat-form-field-appearance-outline .mat-form-field-outline-start{border-radius:5px 0 0 5px;border-right-style:none}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-start{border-right-style:solid;border-left-style:none;border-radius:0 5px 5px 0}.mat-form-field-appearance-outline .mat-form-field-outline-end{border-radius:0 5px 5px 0;border-left-style:none;flex-grow:1}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-end{border-left-style:solid;border-right-style:none;border-radius:5px 0 0 5px}.mat-form-field-appearance-outline .mat-form-field-outline-gap{border-radius:.000001px;border:1px solid currentColor;border-left-style:none;border-right-style:none}.mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-outline-gap{border-top-color:transparent}.mat-form-field-appearance-outline .mat-form-field-outline-thick{opacity:0}.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-end,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-gap{border-width:2px}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline{opacity:0;transition:opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline-thick{opacity:1}.cdk-high-contrast-active .mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick{border:3px dashed}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline{opacity:0;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline-thick{opacity:1}.mat-form-field-appearance-outline .mat-form-field-subscript-wrapper{padding:0 1em}.mat-form-field-appearance-outline._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-start,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-end,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-gap{transition:none}\n",".mat-form-field-appearance-standard .mat-form-field-flex{padding-top:.75em}.mat-form-field-appearance-standard .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-standard .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}.cdk-high-contrast-active .mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}.mat-form-field-appearance-standard:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-standard._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}\n"],encapsulation:2,data:{animation:[hn.transitionMessages]},changeDetection:0}),he})(),Yn=(()=>{class he{}return he.\u0275fac=function(Wt){return new(Wt||he)},he.\u0275mod=_t.oAB({type:he}),he.\u0275inj=_t.cJS({imports:[[Si.ez,u.BQ,Ue.Q8],u.BQ]}),he})()},138:(Hn,Fi,me)=>{"use strict";me.d(Fi,{Jk:()=>ui,Nt:()=>Ke,c:()=>ke});var Ue=me(348),Si=me(928),_t=me(1514),u=me(5583),B=me(273);const $i=(0,Si.i$)({passive:!0});let mi=(()=>{class De{constructor(re,we){this._platform=re,this._ngZone=we,this._monitoredElements=new Map}monitor(re){if(!this._platform.isBrowser)return u.E;const we=(0,Ue.fI)(re),di=this._monitoredElements.get(we);if(di)return di.subject;const Ti=new B.x,an="cdk-text-field-autofilled",nr=nn=>{"cdk-text-field-autofill-start"!==nn.animationName||we.classList.contains(an)?"cdk-text-field-autofill-end"===nn.animationName&&we.classList.contains(an)&&(we.classList.remove(an),this._ngZone.run(()=>Ti.next({target:nn.target,isAutofilled:!1}))):(we.classList.add(an),this._ngZone.run(()=>Ti.next({target:nn.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{we.addEventListener("animationstart",nr,$i),we.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(we,{subject:Ti,unlisten:()=>{we.removeEventListener("animationstart",nr,$i)}}),Ti}stopMonitoring(re){const we=(0,Ue.fI)(re),di=this._monitoredElements.get(we);di&&(di.unlisten(),di.subject.complete(),we.classList.remove("cdk-text-field-autofill-monitored"),we.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(we))}ngOnDestroy(){this._monitoredElements.forEach((re,we)=>this.stopMonitoring(we))}}return De.\u0275fac=function(re){return new(re||De)(_t.LFG(Si.t4),_t.LFG(_t.R0b))},De.\u0275prov=_t.Yz7({token:De,factory:De.\u0275fac,providedIn:"root"}),De})(),Pt=(()=>{class De{}return De.\u0275fac=function(re){return new(re||De)},De.\u0275mod=_t.oAB({type:De}),De.\u0275inj=_t.cJS({}),De})();var Le=me(7537),ze=me(6731),ie=me(8167);const ui=new _t.OlP("MAT_INPUT_VALUE_ACCESSOR"),de=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let ei=0;const zi=(0,ze.FD)(class{constructor(De,vi,re,we){this._defaultErrorStateMatcher=De,this._parentForm=vi,this._parentFormGroup=re,this.ngControl=we}});let Ke=(()=>{class De extends zi{constructor(re,we,di,Ti,an,nr,nn,fn,qn,Ki){super(nr,Ti,an,di),this._elementRef=re,this._platform=we,this._autofillMonitor=fn,this._formField=Ki,this._uid="mat-input-"+ei++,this.focused=!1,this.stateChanges=new B.x,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(hn=>(0,Si.qK)().has(hn));const Mn=this._elementRef.nativeElement,Ne=Mn.nodeName.toLowerCase();this._inputValueAccessor=nn||Mn,this._previousNativeValue=this.value,this.id=this.id,we.IOS&&qn.runOutsideAngular(()=>{re.nativeElement.addEventListener("keyup",hn=>{const on=hn.target;!on.value&&0===on.selectionStart&&0===on.selectionEnd&&(on.setSelectionRange(1,1),on.setSelectionRange(0,0))})}),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===Ne,this._isTextarea="textarea"===Ne,this._isInFormField=!!Ki,this._isNativeSelect&&(this.controlType=Mn.multiple?"mat-native-select-multiple":"mat-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(re){this._disabled=(0,Ue.Ig)(re),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(re){this._id=re||this._uid}get required(){var re,we,di,Ti;return null!=(Ti=null!=(di=this._required)?di:null==(we=null==(re=this.ngControl)?void 0:re.control)?void 0:we.hasValidator(Le.kI.required))&&Ti}set required(re){this._required=(0,Ue.Ig)(re)}get type(){return this._type}set type(re){this._type=re||"text",this._validateType(),!this._isTextarea&&(0,Si.qK)().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(re){re!==this.value&&(this._inputValueAccessor.value=re,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(re){this._readonly=(0,Ue.Ig)(re)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(re=>{this.autofilled=re.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(re){this._elementRef.nativeElement.focus(re)}_focusChanged(re){re!==this.focused&&(this.focused=re,this.stateChanges.next())}_onInput(){}_dirtyCheckPlaceholder(){var we,di;const re=(null==(di=null==(we=this._formField)?void 0:we._hideControlPlaceholder)?void 0:di.call(we))?null:this.placeholder;if(re!==this._previousPlaceholder){const Ti=this._elementRef.nativeElement;this._previousPlaceholder=re,re?Ti.setAttribute("placeholder",re):Ti.removeAttribute("placeholder")}}_dirtyCheckNativeValue(){const re=this._elementRef.nativeElement.value;this._previousNativeValue!==re&&(this._previousNativeValue=re,this.stateChanges.next())}_validateType(){de.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let re=this._elementRef.nativeElement.validity;return re&&re.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const re=this._elementRef.nativeElement,we=re.options[0];return this.focused||re.multiple||!this.empty||!!(re.selectedIndex>-1&&we&&we.label)}return this.focused||!this.empty}setDescribedByIds(re){re.length?this._elementRef.nativeElement.setAttribute("aria-describedby",re.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const re=this._elementRef.nativeElement;return this._isNativeSelect&&(re.multiple||re.size>1)}}return De.\u0275fac=function(re){return new(re||De)(_t.Y36(_t.SBq),_t.Y36(Si.t4),_t.Y36(Le.a5,10),_t.Y36(Le.F,8),_t.Y36(Le.sg,8),_t.Y36(ze.rD),_t.Y36(ui,10),_t.Y36(mi),_t.Y36(_t.R0b),_t.Y36(ie.G_,8))},De.\u0275dir=_t.lG2({type:De,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-input-element","mat-form-field-autofill-control"],hostVars:12,hostBindings:function(re,we){1&re&&_t.NdJ("focus",function(){return we._focusChanged(!0)})("blur",function(){return we._focusChanged(!1)})("input",function(){return we._onInput()}),2&re&&(_t.Ikx("disabled",we.disabled)("required",we.required),_t.uIk("id",we.id)("data-placeholder",we.placeholder)("name",we.name||null)("readonly",we.readonly&&!we._isNativeSelect||null)("aria-invalid",we.empty&&we.required?null:we.errorState)("aria-required",we.required),_t.ekj("mat-input-server",we._isServer)("mat-native-select-inline",we._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],features:[_t._Bn([{provide:ie.Eo,useExisting:De}]),_t.qOj,_t.TTD]}),De})(),ke=(()=>{class De{}return De.\u0275fac=function(re){return new(re||De)},De.\u0275mod=_t.oAB({type:De}),De.\u0275inj=_t.cJS({providers:[ze.rD],imports:[[Pt,ie.lN,ze.BQ],Pt,ie.lN]}),De})()},7970:(Hn,Fi,me)=>{"use strict";me.d(Fi,{jh:()=>Vt,vQ:()=>pe});var Ue=me(1514);const _t="undefined"==typeof window?function(o){return o()}:window.requestAnimationFrame;function u(o,s,r){const c=r||(x=>Array.prototype.slice.call(x));let f=!1,_=[];return function(...x){_=c(x),f||(f=!0,_t.call(window,()=>{f=!1,o.apply(s,_)}))}}const $i=o=>"start"===o?"left":"end"===o?"right":"center",mi=(o,s,r)=>"start"===o?s:"end"===o?r:(s+r)/2;function Te(){}const Pt=function(){let o=0;return function(){return o++}}();function Le(o){return null==o}function ze(o){if(Array.isArray&&Array.isArray(o))return!0;const s=Object.prototype.toString.call(o);return"[object"===s.substr(0,7)&&"Array]"===s.substr(-6)}function ie(o){return null!==o&&"[object Object]"===Object.prototype.toString.call(o)}const Oe=o=>("number"==typeof o||o instanceof Number)&&isFinite(+o);function ui(o,s){return Oe(o)?o:s}function de(o,s){return void 0===o?s:o}const zi=(o,s)=>"string"==typeof o&&o.endsWith("%")?parseFloat(o)/100*s:+o;function Ke(o,s,r){if(o&&"function"==typeof o.call)return o.apply(r,s)}function ke(o,s,r,c){let f,_,x;if(ze(o))if(_=o.length,c)for(f=_-1;f>=0;f--)s.call(r,o[f],f);else for(f=0;f<_;f++)s.call(r,o[f],f);else if(ie(o))for(x=Object.keys(o),_=x.length,f=0;f<_;f++)s.call(r,o[x[f]],x[f])}function De(o,s){let r,c,f,_;if(!o||!s||o.length!==s.length)return!1;for(r=0,c=o.length;r<c;++r)if(f=o[r],_=s[r],f.datasetIndex!==_.datasetIndex||f.index!==_.index)return!1;return!0}function vi(o){if(ze(o))return o.map(vi);if(ie(o)){const s=Object.create(null),r=Object.keys(o),c=r.length;let f=0;for(;f<c;++f)s[r[f]]=vi(o[r[f]]);return s}return o}function re(o){return-1===["__proto__","prototype","constructor"].indexOf(o)}function we(o,s,r,c){if(!re(o))return;const f=s[o],_=r[o];ie(f)&&ie(_)?di(f,_,c):s[o]=vi(_)}function di(o,s,r){const c=ze(s)?s:[s],f=c.length;if(!ie(o))return o;const _=(r=r||{}).merger||we;for(let x=0;x<f;++x){if(!ie(s=c[x]))continue;const M=Object.keys(s);for(let S=0,D=M.length;S<D;++S)_(M[S],o,s,r)}return o}function Ti(o,s){return di(o,s,{merger:an})}function an(o,s,r){if(!re(o))return;const c=s[o],f=r[o];ie(c)&&ie(f)?Ti(c,f):Object.prototype.hasOwnProperty.call(s,o)||(s[o]=vi(f))}function qn(o,s){const r=o.indexOf(".",s);return-1===r?o.length:r}function Ki(o,s){if(""===s)return o;let r=0,c=qn(s,r);for(;o&&c>r;)o=o[s.substr(r,c-r)],r=c+1,c=qn(s,r);return o}function Mn(o){return o.charAt(0).toUpperCase()+o.slice(1)}const Ne=o=>void 0!==o,hn=o=>"function"==typeof o,on=(o,s)=>{if(o.size!==s.size)return!1;for(const r of o)if(!s.has(r))return!1;return!0},Ai=Math.PI,_i=2*Ai,Wn=_i+Ai,rr=Number.POSITIVE_INFINITY,ra=Ai/180,Ci=Ai/2,gn=Ai/4,vr=2*Ai/3,Vi=Math.log10,Ve=Math.sign;function ln(o){const s=Math.round(o);o=Ei(o,s,o/1e3)?s:o;const r=Math.pow(10,Math.floor(Vi(o))),c=o/r;return(c<=1?1:c<=2?2:c<=5?5:10)*r}function Pn(o){return!isNaN(parseFloat(o))&&isFinite(o)}function Ei(o,s,r){return Math.abs(o-s)<r}function pi(o,s,r){let c,f,_;for(c=0,f=o.length;c<f;c++)_=o[c][r],isNaN(_)||(s.min=Math.min(s.min,_),s.max=Math.max(s.max,_))}function Yi(o){return o*(Ai/180)}function zn(o){return o*(180/Ai)}function Yn(o){if(!Oe(o))return;let s=1,r=0;for(;Math.round(o*s)/s!==o;)s*=10,r++;return r}function he(o,s){const r=s.x-o.x,c=s.y-o.y,f=Math.sqrt(r*r+c*c);let _=Math.atan2(c,r);return _<-.5*Ai&&(_+=_i),{angle:_,distance:f}}function Ie(o,s){return Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2))}function Wt(o,s){return(o-s+Wn)%_i-Ai}function le(o){return(o%_i+_i)%_i}function ii(o,s,r,c){const f=le(o),_=le(s),x=le(r),M=le(_-f),S=le(x-f),D=le(f-_),L=le(f-x);return f===_||f===x||c&&_===x||M>S&&D<L}function Me(o,s,r){return Math.max(s,Math.min(r,o))}function Ji(o,s,r,c=1e-6){return o>=Math.min(s,r)-c&&o<=Math.max(s,r)+c}const Pi=o=>0===o||1===o,Cn=(o,s,r)=>-Math.pow(2,10*(o-=1))*Math.sin((o-s)*_i/r),Ui=(o,s,r)=>Math.pow(2,-10*o)*Math.sin((o-s)*_i/r)+1,Ni={linear:o=>o,easeInQuad:o=>o*o,easeOutQuad:o=>-o*(o-2),easeInOutQuad:o=>(o/=.5)<1?.5*o*o:-.5*(--o*(o-2)-1),easeInCubic:o=>o*o*o,easeOutCubic:o=>(o-=1)*o*o+1,easeInOutCubic:o=>(o/=.5)<1?.5*o*o*o:.5*((o-=2)*o*o+2),easeInQuart:o=>o*o*o*o,easeOutQuart:o=>-((o-=1)*o*o*o-1),easeInOutQuart:o=>(o/=.5)<1?.5*o*o*o*o:-.5*((o-=2)*o*o*o-2),easeInQuint:o=>o*o*o*o*o,easeOutQuint:o=>(o-=1)*o*o*o*o+1,easeInOutQuint:o=>(o/=.5)<1?.5*o*o*o*o*o:.5*((o-=2)*o*o*o*o+2),easeInSine:o=>1-Math.cos(o*Ci),easeOutSine:o=>Math.sin(o*Ci),easeInOutSine:o=>-.5*(Math.cos(Ai*o)-1),easeInExpo:o=>0===o?0:Math.pow(2,10*(o-1)),easeOutExpo:o=>1===o?1:1-Math.pow(2,-10*o),easeInOutExpo:o=>Pi(o)?o:o<.5?.5*Math.pow(2,10*(2*o-1)):.5*(2-Math.pow(2,-10*(2*o-1))),easeInCirc:o=>o>=1?o:-(Math.sqrt(1-o*o)-1),easeOutCirc:o=>Math.sqrt(1-(o-=1)*o),easeInOutCirc:o=>(o/=.5)<1?-.5*(Math.sqrt(1-o*o)-1):.5*(Math.sqrt(1-(o-=2)*o)+1),easeInElastic:o=>Pi(o)?o:Cn(o,.075,.3),easeOutElastic:o=>Pi(o)?o:Ui(o,.075,.3),easeInOutElastic(o){const s=.1125;return Pi(o)?o:o<.5?.5*Cn(2*o,s,.45):.5+.5*Ui(2*o-1,s,.45)},easeInBack(o){const s=1.70158;return o*o*((s+1)*o-s)},easeOutBack(o){const s=1.70158;return(o-=1)*o*((s+1)*o+s)+1},easeInOutBack(o){let s=1.70158;return(o/=.5)<1?o*o*((1+(s*=1.525))*o-s)*.5:.5*((o-=2)*o*((1+(s*=1.525))*o+s)+2)},easeInBounce:o=>1-Ni.easeOutBounce(1-o),easeOutBounce(o){const s=7.5625,r=2.75;return o<1/r?s*o*o:o<2/r?s*(o-=1.5/r)*o+.75:o<2.5/r?s*(o-=2.25/r)*o+.9375:s*(o-=2.625/r)*o+.984375},easeInOutBounce:o=>o<.5?.5*Ni.easeInBounce(2*o):.5*Ni.easeOutBounce(2*o-1)+.5},ji={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},bi="0123456789ABCDEF",mn=o=>bi[15&o],Kn=o=>bi[(240&o)>>4]+bi[15&o],Rn=o=>(240&o)>>4==(15&o);function yn(o){return o+.5|0}const Vn=(o,s,r)=>Math.max(Math.min(o,r),s);function Sn(o){return Vn(yn(2.55*o),0,255)}function ar(o){return Vn(yn(255*o),0,255)}function xn(o){return Vn(yn(o/2.55)/100,0,1)}function tt(o){return Vn(yn(100*o),0,100)}const F=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,rt=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function ft(o,s,r){const c=s*Math.min(r,1-r),f=(_,x=(_+o/30)%12)=>r-c*Math.max(Math.min(x-3,9-x,1),-1);return[f(0),f(8),f(4)]}function Tt(o,s,r){const c=(f,_=(f+o/60)%6)=>r-r*s*Math.max(Math.min(_,4-_,1),0);return[c(5),c(3),c(1)]}function Ct(o,s,r){const c=ft(o,1,.5);let f;for(s+r>1&&(f=1/(s+r),s*=f,r*=f),f=0;f<3;f++)c[f]*=1-s-r,c[f]+=s;return c}function gt(o){const r=o.r/255,c=o.g/255,f=o.b/255,_=Math.max(r,c,f),x=Math.min(r,c,f),M=(_+x)/2;let S,D,L;return _!==x&&(L=_-x,D=M>.5?L/(2-_-x):L/(_+x),S=_===r?(c-f)/L+(c<f?6:0):_===c?(f-r)/L+2:(r-c)/L+4,S=60*S+.5),[0|S,D||0,M]}function St(o,s,r,c){return(Array.isArray(s)?o(s[0],s[1],s[2]):o(s,r,c)).map(ar)}function Bt(o,s,r){return St(ft,o,s,r)}function be(o){return(o%360+360)%360}const Je={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},wi={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let yi;function Jn(o,s,r){if(o){let c=gt(o);c[s]=Math.max(0,Math.min(c[s]+c[s]*r,0===s?360:1)),c=Bt(c),o.r=c[0],o.g=c[1],o.b=c[2]}}function ht(o,s){return o&&Object.assign(s||{},o)}function kt(o){var s={r:0,g:0,b:0,a:255};return Array.isArray(o)?o.length>=3&&(s={r:o[0],g:o[1],b:o[2],a:255},o.length>3&&(s.a=ar(o[3]))):(s=ht(o,{r:0,g:0,b:0,a:1})).a=ar(s.a),s}function E(o){return"r"===o.charAt(0)?function(o){const s=F.exec(o);let c,f,_,r=255;if(s){if(s[7]!==c){const x=+s[7];r=255&(s[8]?Sn(x):255*x)}return c=+s[1],f=+s[3],_=+s[5],c=255&(s[2]?Sn(c):c),f=255&(s[4]?Sn(f):f),_=255&(s[6]?Sn(_):_),{r:c,g:f,b:_,a:r}}}(o):function(o){const s=rt.exec(o);let c,r=255;if(!s)return;s[5]!==c&&(r=s[6]?Sn(+s[5]):ar(+s[5]));const f=be(+s[2]),_=+s[3]/100,x=+s[4]/100;return c="hwb"===s[1]?function(o,s,r){return St(Ct,o,s,r)}(f,_,x):"hsv"===s[1]?function(o,s,r){return St(Tt,o,s,r)}(f,_,x):Bt(f,_,x),{r:c[0],g:c[1],b:c[2],a:r}}(o)}class V{constructor(s){if(s instanceof V)return s;const r=typeof s;let c;"object"===r?c=kt(s):"string"===r&&(c=function(o){var r,s=o.length;return"#"===o[0]&&(4===s||5===s?r={r:255&17*ji[o[1]],g:255&17*ji[o[2]],b:255&17*ji[o[3]],a:5===s?17*ji[o[4]]:255}:(7===s||9===s)&&(r={r:ji[o[1]]<<4|ji[o[2]],g:ji[o[3]]<<4|ji[o[4]],b:ji[o[5]]<<4|ji[o[6]],a:9===s?ji[o[7]]<<4|ji[o[8]]:255})),r}(s)||function(o){yi||(yi=function(){const o={},s=Object.keys(wi),r=Object.keys(Je);let c,f,_,x,M;for(c=0;c<s.length;c++){for(x=M=s[c],f=0;f<r.length;f++)_=r[f],M=M.replace(_,Je[_]);_=parseInt(wi[x],16),o[M]=[_>>16&255,_>>8&255,255&_]}return o}(),yi.transparent=[0,0,0,0]);const s=yi[o.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:4===s.length?s[3]:255}}(s)||E(s)),this._rgb=c,this._valid=!!c}get valid(){return this._valid}get rgb(){var s=ht(this._rgb);return s&&(s.a=xn(s.a)),s}set rgb(s){this._rgb=kt(s)}rgbString(){return this._valid?(o=this._rgb)&&(o.a<255?`rgba(${o.r}, ${o.g}, ${o.b}, ${xn(o.a)})`:`rgb(${o.r}, ${o.g}, ${o.b})`):this._rgb;var o}hexString(){return this._valid?function(o){var s=function(o){return Rn(o.r)&&Rn(o.g)&&Rn(o.b)&&Rn(o.a)}(o)?mn:Kn;return o&&"#"+s(o.r)+s(o.g)+s(o.b)+(o.a<255?s(o.a):"")}(this._rgb):this._rgb}hslString(){return this._valid?function(o){if(!o)return;const s=gt(o),r=s[0],c=tt(s[1]),f=tt(s[2]);return o.a<255?`hsla(${r}, ${c}%, ${f}%, ${xn(o.a)})`:`hsl(${r}, ${c}%, ${f}%)`}(this._rgb):this._rgb}mix(s,r){const c=this;if(s){const f=c.rgb,_=s.rgb;let x;const M=r===x?.5:r,S=2*M-1,D=f.a-_.a,L=((S*D==-1?S:(S+D)/(1+S*D))+1)/2;x=1-L,f.r=255&L*f.r+x*_.r+.5,f.g=255&L*f.g+x*_.g+.5,f.b=255&L*f.b+x*_.b+.5,f.a=M*f.a+(1-M)*_.a,c.rgb=f}return c}clone(){return new V(this.rgb)}alpha(s){return this._rgb.a=ar(s),this}clearer(s){return this._rgb.a*=1-s,this}greyscale(){const s=this._rgb,r=yn(.3*s.r+.59*s.g+.11*s.b);return s.r=s.g=s.b=r,this}opaquer(s){return this._rgb.a*=1+s,this}negate(){const s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return Jn(this._rgb,2,s),this}darken(s){return Jn(this._rgb,2,-s),this}saturate(s){return Jn(this._rgb,1,s),this}desaturate(s){return Jn(this._rgb,1,-s),this}rotate(s){return function(o,s){var r=gt(o);r[0]=be(r[0]+s),r=Bt(r),o.r=r[0],o.g=r[1],o.b=r[2]}(this._rgb,s),this}}function it(o){return new V(o)}const xt=o=>o instanceof CanvasGradient||o instanceof CanvasPattern;function ye(o){return xt(o)?o:it(o)}function ni(o){return xt(o)?o:it(o).saturate(.5).darken(.1).hexString()}const Hi=Object.create(null),Un=Object.create(null);function Qn(o,s){if(!s)return o;const r=s.split(".");for(let c=0,f=r.length;c<f;++c){const _=r[c];o=o[_]||(o[_]=Object.create(null))}return o}function tr(o,s,r){return"string"==typeof s?di(Qn(o,s),r):di(Qn(o,""),s)}var ri=new class{constructor(s){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,c)=>ni(c.backgroundColor),this.hoverBorderColor=(r,c)=>ni(c.borderColor),this.hoverColor=(r,c)=>ni(c.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s)}set(s,r){return tr(this,s,r)}get(s){return Qn(this,s)}describe(s,r){return tr(Un,s,r)}override(s,r){return tr(Hi,s,r)}route(s,r,c,f){const _=Qn(this,s),x=Qn(this,c),M="_"+r;Object.defineProperties(_,{[M]:{value:_[r],writable:!0},[r]:{enumerable:!0,get(){const S=this[M],D=x[f];return ie(S)?Object.assign({},D,S):de(S,D)},set(S){this[M]=S}}})}}({_scriptable:o=>!o.startsWith("on"),_indexable:o=>"events"!==o,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function ko(o,s,r,c,f){let _=s[f];return _||(_=s[f]=o.measureText(f).width,r.push(f)),_>c&&(c=_),c}function wc(o,s,r,c){let f=(c=c||{}).data=c.data||{},_=c.garbageCollect=c.garbageCollect||[];c.font!==s&&(f=c.data={},_=c.garbageCollect=[],c.font=s),o.save(),o.font=s;let x=0;const M=r.length;let S,D,L,j,q;for(S=0;S<M;S++)if(j=r[S],null!=j&&!0!==ze(j))x=ko(o,f,_,x,j);else if(ze(j))for(D=0,L=j.length;D<L;D++)q=j[D],null!=q&&!ze(q)&&(x=ko(o,f,_,x,q));o.restore();const et=_.length/2;if(et>r.length){for(S=0;S<et;S++)delete f[_[S]];_.splice(0,et)}return x}function or(o,s,r){const c=o.currentDevicePixelRatio,f=0!==r?Math.max(r/2,.5):0;return Math.round((s-f)*c)/c+f}function Is(o,s){(s=s||o.getContext("2d")).save(),s.resetTransform(),s.clearRect(0,0,o.width,o.height),s.restore()}function ss(o,s,r,c){let f,_,x,M,S;const D=s.pointStyle,L=s.rotation,j=s.radius;let q=(L||0)*ra;if(D&&"object"==typeof D&&(f=D.toString(),"[object HTMLImageElement]"===f||"[object HTMLCanvasElement]"===f))return o.save(),o.translate(r,c),o.rotate(q),o.drawImage(D,-D.width/2,-D.height/2,D.width,D.height),void o.restore();if(!(isNaN(j)||j<=0)){switch(o.beginPath(),D){default:o.arc(r,c,j,0,_i),o.closePath();break;case"triangle":o.moveTo(r+Math.sin(q)*j,c-Math.cos(q)*j),q+=vr,o.lineTo(r+Math.sin(q)*j,c-Math.cos(q)*j),q+=vr,o.lineTo(r+Math.sin(q)*j,c-Math.cos(q)*j),o.closePath();break;case"rectRounded":S=.516*j,M=j-S,_=Math.cos(q+gn)*M,x=Math.sin(q+gn)*M,o.arc(r-_,c-x,S,q-Ai,q-Ci),o.arc(r+x,c-_,S,q-Ci,q),o.arc(r+_,c+x,S,q,q+Ci),o.arc(r-x,c+_,S,q+Ci,q+Ai),o.closePath();break;case"rect":if(!L){M=Math.SQRT1_2*j,o.rect(r-M,c-M,2*M,2*M);break}q+=gn;case"rectRot":_=Math.cos(q)*j,x=Math.sin(q)*j,o.moveTo(r-_,c-x),o.lineTo(r+x,c-_),o.lineTo(r+_,c+x),o.lineTo(r-x,c+_),o.closePath();break;case"crossRot":q+=gn;case"cross":_=Math.cos(q)*j,x=Math.sin(q)*j,o.moveTo(r-_,c-x),o.lineTo(r+_,c+x),o.moveTo(r+x,c-_),o.lineTo(r-x,c+_);break;case"star":_=Math.cos(q)*j,x=Math.sin(q)*j,o.moveTo(r-_,c-x),o.lineTo(r+_,c+x),o.moveTo(r+x,c-_),o.lineTo(r-x,c+_),q+=gn,_=Math.cos(q)*j,x=Math.sin(q)*j,o.moveTo(r-_,c-x),o.lineTo(r+_,c+x),o.moveTo(r+x,c-_),o.lineTo(r-x,c+_);break;case"line":_=Math.cos(q)*j,x=Math.sin(q)*j,o.moveTo(r-_,c-x),o.lineTo(r+_,c+x);break;case"dash":o.moveTo(r,c),o.lineTo(r+Math.cos(q)*j,c+Math.sin(q)*j)}o.fill(),s.borderWidth>0&&o.stroke()}}function as(o,s,r){return r=r||.5,!s||o&&o.x>s.left-r&&o.x<s.right+r&&o.y>s.top-r&&o.y<s.bottom+r}function Ia(o,s){o.save(),o.beginPath(),o.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),o.clip()}function Ps(o){o.restore()}function os(o,s,r,c,f){if(!s)return o.lineTo(r.x,r.y);if("middle"===f){const _=(s.x+r.x)/2;o.lineTo(_,s.y),o.lineTo(_,r.y)}else"after"===f!=!!c?o.lineTo(s.x,r.y):o.lineTo(r.x,s.y);o.lineTo(r.x,r.y)}function Do(o,s,r,c){if(!s)return o.lineTo(r.x,r.y);o.bezierCurveTo(c?s.cp1x:s.cp2x,c?s.cp1y:s.cp2y,c?r.cp2x:r.cp1x,c?r.cp2y:r.cp1y,r.x,r.y)}function Nn(o,s,r,c,f,_={}){const x=ze(s)?s:[s],M=_.strokeWidth>0&&""!==_.strokeColor;let S,D;for(o.save(),o.font=f.string,function(o,s){s.translation&&o.translate(s.translation[0],s.translation[1]),Le(s.rotation)||o.rotate(s.rotation),s.color&&(o.fillStyle=s.color),s.textAlign&&(o.textAlign=s.textAlign),s.textBaseline&&(o.textBaseline=s.textBaseline)}(o,_),S=0;S<x.length;++S)D=x[S],M&&(_.strokeColor&&(o.strokeStyle=_.strokeColor),Le(_.strokeWidth)||(o.lineWidth=_.strokeWidth),o.strokeText(D,r,c,_.maxWidth)),o.fillText(D,r,c,_.maxWidth),ue(o,r,c,D,_),c+=f.lineHeight;o.restore()}function ue(o,s,r,c,f){if(f.strikethrough||f.underline){const _=o.measureText(c),x=s-_.actualBoundingBoxLeft,M=s+_.actualBoundingBoxRight,S=r-_.actualBoundingBoxAscent,D=r+_.actualBoundingBoxDescent,L=f.strikethrough?(S+D)/2:D;o.strokeStyle=o.fillStyle,o.beginPath(),o.lineWidth=f.decorationWidth||2,o.moveTo(x,L),o.lineTo(M,L),o.stroke()}}function Pa(o,s){const{x:r,y:c,w:f,h:_,radius:x}=s;o.arc(r+x.topLeft,c+x.topLeft,x.topLeft,-Ci,Ai,!0),o.lineTo(r,c+_-x.bottomLeft),o.arc(r+x.bottomLeft,c+_-x.bottomLeft,x.bottomLeft,Ai,Ci,!0),o.lineTo(r+f-x.bottomRight,c+_),o.arc(r+f-x.bottomRight,c+_-x.bottomRight,x.bottomRight,Ci,0,!0),o.lineTo(r+f,c+x.topRight),o.arc(r+f-x.topRight,c+x.topRight,x.topRight,0,-Ci,!0),o.lineTo(r+x.topLeft,c)}const ls=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),Qi=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function Zr(o,s){const r=(""+o).match(ls);if(!r||"normal"===r[1])return 1.2*s;switch(o=+r[2],r[3]){case"px":return o;case"%":o/=100}return s*o}const Or=o=>+o||0;function sa(o,s){const r={},c=ie(s),f=c?Object.keys(s):s,_=ie(o)?c?x=>de(o[x],o[s[x]]):x=>o[x]:()=>o;for(const x of f)r[x]=Or(_(x));return r}function $r(o){return sa(o,{top:"y",right:"x",bottom:"y",left:"x"})}function oe(o){return sa(o,["topLeft","topRight","bottomLeft","bottomRight"])}function je(o){const s=$r(o);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function Re(o,s){let r=de((o=o||{}).size,(s=s||ri.font).size);"string"==typeof r&&(r=parseInt(r,10));let c=de(o.style,s.style);c&&!(""+c).match(Qi)&&(console.warn('Invalid font style specified: "'+c+'"'),c="");const f={family:de(o.family,s.family),lineHeight:Zr(de(o.lineHeight,s.lineHeight),r),size:r,style:c,weight:de(o.weight,s.weight),string:""};return f.string=function(o){return!o||Le(o.size)||Le(o.family)?null:(o.style?o.style+" ":"")+(o.weight?o.weight+" ":"")+o.size+"px "+o.family}(f),f}function jn(o,s,r,c){let _,x,M,f=!0;for(_=0,x=o.length;_<x;++_)if(M=o[_],void 0!==M&&(void 0!==s&&"function"==typeof M&&(M=M(s),f=!1),void 0!==r&&ze(M)&&(M=M[r%M.length],f=!1),void 0!==M))return c&&!f&&(c.cacheable=!1),M}function qe(o,s){return Object.assign(Object.create(o),s)}function zs(o,s,r){r=r||(x=>o[x]<s);let _,c=o.length-1,f=0;for(;c-f>1;)_=f+c>>1,r(_)?f=_:c=_;return{lo:f,hi:c}}const An=(o,s,r)=>zs(o,r,c=>o[c][s]<r),za=(o,s,r)=>zs(o,r,c=>o[c][s]>=r),Gi=["push","pop","shift","splice","unshift"];function Ln(o,s){const r=o._chartjs;if(!r)return;const c=r.listeners,f=c.indexOf(s);-1!==f&&c.splice(f,1),!(c.length>0)&&(Gi.forEach(_=>{delete o[_]}),delete o._chartjs)}function Ra(o){const s=new Set;let r,c;for(r=0,c=o.length;r<c;++r)s.add(o[r]);return s.size===c?o:Array.from(s)}function cs(o,s=[""],r=o,c,f=(()=>o[0])){Ne(c)||(c=Mr("_fallback",o));const _={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:o,_rootScopes:r,_fallback:c,_getTarget:f,override:x=>cs([x,...o],s,r,c)};return new Proxy(_,{deleteProperty:(x,M)=>(delete x[M],delete x._keys,delete o[0][M],!0),get:(x,M)=>Io(x,M,()=>function(o,s,r,c){let f;for(const _ of s)if(f=Mr(fi(_,o),r),Ne(f))return oa(o,f)?Fr(r,c,o,f):f}(M,s,o,x)),getOwnPropertyDescriptor:(x,M)=>Reflect.getOwnPropertyDescriptor(x._scopes[0],M),getPrototypeOf:()=>Reflect.getPrototypeOf(o[0]),has:(x,M)=>hs(x).includes(M),ownKeys:x=>hs(x),set(x,M,S){const D=x._storage||(x._storage=f());return x[M]=D[M]=S,delete x._keys,!0}})}function wr(o,s,r,c){const f={_cacheable:!1,_proxy:o,_context:s,_subProxy:r,_stack:new Set,_descriptors:Rs(o,c),setContext:_=>wr(o,_,r,c),override:_=>wr(o.override(_),s,r,c)};return new Proxy(f,{deleteProperty:(_,x)=>(delete _[x],delete o[x],!0),get:(_,x,M)=>Io(_,x,()=>function(o,s,r){const{_proxy:c,_context:f,_subProxy:_,_descriptors:x}=o;let M=c[s];return hn(M)&&x.isScriptable(s)&&(M=function(o,s,r,c){const{_proxy:f,_context:_,_subProxy:x,_stack:M}=r;if(M.has(o))throw new Error("Recursion detected: "+Array.from(M).join("->")+"->"+o);return M.add(o),s=s(_,x||c),M.delete(o),oa(o,s)&&(s=Fr(f._scopes,f,o,s)),s}(s,M,o,r)),ze(M)&&M.length&&(M=function(o,s,r,c){const{_proxy:f,_context:_,_subProxy:x,_descriptors:M}=r;if(Ne(_.index)&&c(o))s=s[_.index%s.length];else if(ie(s[0])){const S=s,D=f._scopes.filter(L=>L!==S);s=[];for(const L of S){const j=Fr(D,f,o,L);s.push(wr(j,_,x&&x[o],M))}}return s}(s,M,o,x.isIndexable)),oa(s,M)&&(M=wr(M,f,_&&_[s],x)),M}(_,x,M)),getOwnPropertyDescriptor:(_,x)=>_._descriptors.allKeys?Reflect.has(o,x)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(o,x),getPrototypeOf:()=>Reflect.getPrototypeOf(o),has:(_,x)=>Reflect.has(o,x),ownKeys:()=>Reflect.ownKeys(o),set:(_,x,M)=>(o[x]=M,delete _[x],!0)})}function Rs(o,s={scriptable:!0,indexable:!0}){const{_scriptable:r=s.scriptable,_indexable:c=s.indexable,_allKeys:f=s.allKeys}=o;return{allKeys:f,scriptable:r,indexable:c,isScriptable:hn(r)?r:()=>r,isIndexable:hn(c)?c:()=>c}}const fi=(o,s)=>o?o+Mn(s):s,oa=(o,s)=>ie(s)&&"adapters"!==o&&(null===Object.getPrototypeOf(s)||s.constructor===Object);function Io(o,s,r){if(Object.prototype.hasOwnProperty.call(o,s))return o[s];const c=r();return o[s]=c,c}function La(o,s,r){return hn(o)?o(s,r):o}const rn=(o,s)=>!0===o?s:"string"==typeof o?Ki(s,o):void 0;function Oa(o,s,r,c,f){for(const _ of s){const x=rn(r,_);if(x){o.add(x);const M=La(x._fallback,r,f);if(Ne(M)&&M!==r&&M!==c)return M}else if(!1===x&&Ne(c)&&r!==c)return null}return!1}function Fr(o,s,r,c){const f=s._rootScopes,_=La(s._fallback,r,c),x=[...o,...f],M=new Set;M.add(c);let S=dn(M,x,r,_||r,c);return!(null===S||Ne(_)&&_!==r&&(S=dn(M,x,_,S,c),null===S))&&cs(Array.from(M),[""],f,_,()=>function(o,s,r){const c=o._getTarget();s in c||(c[s]={});const f=c[s];return ze(f)&&ie(r)?r:f}(s,r,c))}function dn(o,s,r,c,f){for(;r;)r=Oa(o,s,r,c,f);return r}function Mr(o,s){for(const r of s){if(!r)continue;const c=r[o];if(Ne(c))return c}}function hs(o){let s=o._keys;return s||(s=o._keys=function(o){const s=new Set;for(const r of o)for(const c of Object.keys(r).filter(f=>!f.startsWith("_")))s.add(c);return Array.from(s)}(o._scopes)),s}const Br=Number.EPSILON||1e-14,Ls=(o,s)=>s<o.length&&!o[s].skip&&o[s],Pl=o=>"x"===o?"y":"x";function er(o,s,r,c){const f=o.skip?s:o,_=s,x=r.skip?s:r,M=Ie(_,f),S=Ie(x,_);let D=M/(M+S),L=S/(M+S);D=isNaN(D)?0:D,L=isNaN(L)?0:L;const j=c*D,q=c*L;return{previous:{x:_.x-j*(x.x-f.x),y:_.y-j*(x.y-f.y)},next:{x:_.x+q*(x.x-f.x),y:_.y+q*(x.y-f.y)}}}function ds(o,s,r){return Math.max(Math.min(o,r),s)}function Cc(o,s,r,c,f){let _,x,M,S;if(s.spanGaps&&(o=o.filter(D=>!D.skip)),"monotone"===s.cubicInterpolationMode)!function(o,s="x"){const r=Pl(s),c=o.length,f=Array(c).fill(0),_=Array(c);let x,M,S,D=Ls(o,0);for(x=0;x<c;++x)if(M=S,S=D,D=Ls(o,x+1),S){if(D){const L=D[s]-S[s];f[x]=0!==L?(D[r]-S[r])/L:0}_[x]=M?D?Ve(f[x-1])!==Ve(f[x])?0:(f[x-1]+f[x])/2:f[x-1]:f[x]}(function(o,s,r){const c=o.length;let f,_,x,M,S,D=Ls(o,0);for(let L=0;L<c-1;++L)if(S=D,D=Ls(o,L+1),S&&D){if(Ei(s[L],0,Br)){r[L]=r[L+1]=0;continue}f=r[L]/s[L],_=r[L+1]/s[L],M=Math.pow(f,2)+Math.pow(_,2),!(M<=9)&&(x=3/Math.sqrt(M),r[L]=f*x*s[L],r[L+1]=_*x*s[L])}})(o,f,_),function(o,s,r="x"){const c=Pl(r),f=o.length;let _,x,M,S=Ls(o,0);for(let D=0;D<f;++D){if(x=M,M=S,S=Ls(o,D+1),!M)continue;const L=M[r],j=M[c];x&&(_=(L-x[r])/3,M[`cp1${r}`]=L-_,M[`cp1${c}`]=j-_*s[D]),S&&(_=(S[r]-L)/3,M[`cp2${r}`]=L+_,M[`cp2${c}`]=j+_*s[D])}}(o,_,s)}(o,f);else{let D=c?o[o.length-1]:o[0];for(_=0,x=o.length;_<x;++_)M=o[_],S=er(D,M,o[Math.min(_+1,x-(c?0:1))%x],s.tension),M.cp1x=S.previous.x,M.cp1y=S.previous.y,M.cp2x=S.next.x,M.cp2y=S.next.y,D=M}s.capBezierPoints&&function(o,s){let r,c,f,_,x,M=as(o[0],s);for(r=0,c=o.length;r<c;++r)x=_,_=M,M=r<c-1&&as(o[r+1],s),_&&(f=o[r],x&&(f.cp1x=ds(f.cp1x,s.left,s.right),f.cp1y=ds(f.cp1y,s.top,s.bottom)),M&&(f.cp2x=ds(f.cp2x,s.left,s.right),f.cp2y=ds(f.cp2y,s.top,s.bottom)))}(o,r)}function Ro(){return"undefined"!=typeof window&&"undefined"!=typeof document}function Lo(o){let s=o.parentNode;return s&&"[object ShadowRoot]"===s.toString()&&(s=s.host),s}function la(o,s,r){let c;return"string"==typeof o?(c=parseInt(o,10),-1!==o.indexOf("%")&&(c=c/100*s.parentNode[r])):c=o,c}const Oo=o=>window.getComputedStyle(o,null),Gh=["top","right","bottom","left"];function Hr(o,s,r){const c={};r=r?"-"+r:"";for(let f=0;f<4;f++){const _=Gh[f];c[_]=parseFloat(o[s+"-"+_+r])||0}return c.width=c.left+c.right,c.height=c.top+c.bottom,c}function Rl(o,s){const{canvas:r,currentDevicePixelRatio:c}=s,f=Oo(r),_="border-box"===f.boxSizing,x=Hr(f,"padding"),M=Hr(f,"border","width"),{x:S,y:D,box:L}=function(o,s){const r=o.native||o,c=r.touches,f=c&&c.length?c[0]:r,{offsetX:_,offsetY:x}=f;let S,D,M=!1;if(((o,s,r)=>(o>0||s>0)&&(!r||!r.shadowRoot))(_,x,r.target))S=_,D=x;else{const L=s.getBoundingClientRect();S=f.clientX-L.left,D=f.clientY-L.top,M=!0}return{x:S,y:D,box:M}}(o,r),j=x.left+(L&&M.left),q=x.top+(L&&M.top);let{width:et,height:ut}=s;return _&&(et-=x.width+M.width,ut-=x.height+M.height),{x:Math.round((S-j)/et*r.width/c),y:Math.round((D-q)/ut*r.height/c)}}const qr=o=>Math.round(10*o)/10;function ha(o,s,r){const c=s||1,f=Math.floor(o.height*c),_=Math.floor(o.width*c);o.height=f/c,o.width=_/c;const x=o.canvas;return x.style&&(r||!x.style.height&&!x.style.width)&&(x.style.height=`${o.height}px`,x.style.width=`${o.width}px`),(o.currentDevicePixelRatio!==c||x.height!==f||x.width!==_)&&(o.currentDevicePixelRatio=c,x.height=f,x.width=_,o.ctx.setTransform(c,0,0,c,0,0),!0)}const Ba=function(){let o=!1;try{const s={get passive(){return o=!0,!1}};window.addEventListener("test",null,s),window.removeEventListener("test",null,s)}catch(s){}return o}();function Va(o,s){const r=function(o,s){return Oo(o).getPropertyValue(s)}(o,s),c=r&&r.match(/^(\d+)(\.\d+)?px$/);return c?+c[1]:void 0}function Vr(o,s,r,c){return{x:o.x+r*(s.x-o.x),y:o.y+r*(s.y-o.y)}}function Fo(o,s,r,c){return{x:o.x+r*(s.x-o.x),y:"middle"===c?r<.5?o.y:s.y:"after"===c?r<1?o.y:s.y:r>0?s.y:o.y}}function Ua(o,s,r,c){const f={x:o.cp2x,y:o.cp2y},_={x:s.cp1x,y:s.cp1y},x=Vr(o,f,r),M=Vr(f,_,r),S=Vr(_,s,r),D=Vr(x,M,r),L=Vr(M,S,r);return Vr(D,L,r)}const ua=new Map;function ps(o,s,r){return function(o,s){s=s||{};const r=o+JSON.stringify(s);let c=ua.get(r);return c||(c=new Intl.NumberFormat(o,s),ua.set(r,c)),c}(s,r).format(o)}function fs(o,s,r){return o?function(o,s){return{x:r=>o+o+s-r,setWidth(r){s=r},textAlign:r=>"center"===r?r:"right"===r?"left":"right",xPlus:(r,c)=>r-c,leftForLtr:(r,c)=>r-c}}(s,r):{x:o=>o,setWidth(o){},textAlign:o=>o,xPlus:(o,s)=>o+s,leftForLtr:(o,s)=>o}}function ja(o,s){let r,c;("ltr"===s||"rtl"===s)&&(r=o.canvas.style,c=[r.getPropertyValue("direction"),r.getPropertyPriority("direction")],r.setProperty("direction",s,"important"),o.prevTextDirection=c)}function Ll(o,s){void 0!==s&&(delete o.prevTextDirection,o.canvas.style.setProperty("direction",s[0],s[1]))}function Dc(o){return"angle"===o?{between:ii,compare:Wt,normalize:le}:{between:Ji,compare:(s,r)=>s-r,normalize:s=>s}}function Ic({start:o,end:s,count:r,loop:c,style:f}){return{start:o%r,end:s%r,loop:c&&(s-o+1)%r==0,style:f}}function Ga(o,s,r){if(!r)return[o];const{property:c,start:f,end:_}=r,x=s.length,{compare:M,between:S,normalize:D}=Dc(c),{start:L,end:j,loop:q,style:et}=function(o,s,r){const{property:c,start:f,end:_}=r,{between:x,normalize:M}=Dc(c),S=s.length;let q,et,{start:D,end:L,loop:j}=o;if(j){for(D+=S,L+=S,q=0,et=S;q<et&&x(M(s[D%S][c]),f,_);++q)D--,L--;D%=S,L%=S}return L<D&&(L+=S),{start:D,end:L,loop:j,style:o.style}}(o,s,r),ut=[];let Et,Gt,se,mt=!1,wt=null;for(let ge=L,ce=L;ge<=j;++ge)Gt=s[ge%x],!Gt.skip&&(Et=D(Gt[c]),Et!==se&&(mt=S(Et,f,_),null===wt&&(mt||S(f,se,Et)&&0!==M(f,se))&&(wt=0===M(Et,f)?ge:ce),null!==wt&&(!mt||0===M(_,Et)||S(_,se,Et))&&(ut.push(Ic({start:wt,end:ge,loop:q,count:x,style:et})),wt=null),ce=ge,se=Et));return null!==wt&&ut.push(Ic({start:wt,end:j,loop:q,count:x,style:et})),ut}function Za(o,s){const r=[],c=o.segments;for(let f=0;f<c.length;f++){const _=Ga(c[f],o.points,s);_.length&&r.push(..._)}return r}function da(o){return{backgroundColor:o.backgroundColor,borderCapStyle:o.borderCapStyle,borderDash:o.borderDash,borderDashOffset:o.borderDashOffset,borderJoinStyle:o.borderJoinStyle,borderWidth:o.borderWidth,borderColor:o.borderColor}}function Lc(o,s){return s&&JSON.stringify(o)!==JSON.stringify(s)}var ur=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,r,c,f){const x=r.duration;r.listeners[f].forEach(M=>M({chart:s,initial:r.initial,numSteps:x,currentStep:Math.min(c-r.start,x)}))}_refresh(){this._request||(this._running=!0,this._request=_t.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let r=0;this._charts.forEach((c,f)=>{if(!c.running||!c.items.length)return;const _=c.items;let S,x=_.length-1,M=!1;for(;x>=0;--x)S=_[x],S._active?(S._total>c.duration&&(c.duration=S._total),S.tick(s),M=!0):(_[x]=_[_.length-1],_.pop());M&&(f.draw(),this._notify(f,c,s,"progress")),_.length||(c.running=!1,this._notify(f,c,s,"complete"),c.initial=!1),r+=_.length}),this._lastDate=s,0===r&&(this._running=!1)}_getAnims(s){const r=this._charts;let c=r.get(s);return c||(c={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},r.set(s,c)),c}listen(s,r,c){this._getAnims(s).listeners[r].push(c)}add(s,r){!r||!r.length||this._getAnims(s).items.push(...r)}has(s){return this._getAnims(s).items.length>0}start(s){const r=this._charts.get(s);!r||(r.running=!0,r.start=Date.now(),r.duration=r.items.reduce((c,f)=>Math.max(c,f._duration),0),this._refresh())}running(s){if(!this._running)return!1;const r=this._charts.get(s);return!(!r||!r.running||!r.items.length)}stop(s){const r=this._charts.get(s);if(!r||!r.items.length)return;const c=r.items;let f=c.length-1;for(;f>=0;--f)c[f].cancel();r.items=[],this._notify(s,r,Date.now(),"complete")}remove(s){return this._charts.delete(s)}};const ms="transparent",Vo={boolean:(o,s,r)=>r>.5?s:o,color(o,s,r){const c=ye(o||ms),f=c.valid&&ye(s||ms);return f&&f.valid?f.mix(c,r).hexString():s},number:(o,s,r)=>o+(s-o)*r};class Ol{constructor(s,r,c,f){const _=r[c];f=jn([s.to,f,_,s.from]);const x=jn([s.from,_,f]);this._active=!0,this._fn=s.fn||Vo[s.type||typeof x],this._easing=Ni[s.easing]||Ni.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=r,this._prop=c,this._from=x,this._to=f,this._promises=void 0}active(){return this._active}update(s,r,c){if(this._active){this._notify(!1);const f=this._target[this._prop],_=c-this._start,x=this._duration-_;this._start=c,this._duration=Math.floor(Math.max(x,s.duration)),this._total+=_,this._loop=!!s.loop,this._to=jn([s.to,r,f,s.from]),this._from=jn([s.from,f,r])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){const r=s-this._start,c=this._duration,f=this._prop,_=this._from,x=this._loop,M=this._to;let S;if(this._active=_!==M&&(x||r<c),!this._active)return this._target[f]=M,void this._notify(!0);r<0?this._target[f]=_:(S=r/c%2,S=x&&S>1?2-S:S,S=this._easing(Math.min(1,Math.max(0,S))),this._target[f]=this._fn(_,M,S))}wait(){const s=this._promises||(this._promises=[]);return new Promise((r,c)=>{s.push({res:r,rej:c})})}_notify(s){const r=s?"res":"rej",c=this._promises||[];for(let f=0;f<c.length;f++)c[f][r]()}}ri.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const Uo=Object.keys(ri.animation);ri.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:o=>"onProgress"!==o&&"onComplete"!==o&&"fn"!==o}),ri.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),ri.describe("animations",{_fallback:"animation"}),ri.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:o=>0|o}}}});class Wr{constructor(s,r){this._chart=s,this._properties=new Map,this.configure(r)}configure(s){if(!ie(s))return;const r=this._properties;Object.getOwnPropertyNames(s).forEach(c=>{const f=s[c];if(!ie(f))return;const _={};for(const x of Uo)_[x]=f[x];(ze(f.properties)&&f.properties||[c]).forEach(x=>{(x===c||!r.has(x))&&r.set(x,_)})})}_animateOptions(s,r){const c=r.options,f=function(o,s){if(!s)return;let r=o.options;if(r)return r.$shared&&(o.options=r=Object.assign({},r,{$shared:!1,$animations:{}})),r;o.options=s}(s,c);if(!f)return[];const _=this._createAnimations(f,c);return c.$shared&&function(o,s){const r=[],c=Object.keys(s);for(let f=0;f<c.length;f++){const _=o[c[f]];_&&_.active()&&r.push(_.wait())}return Promise.all(r)}(s.options.$animations,c).then(()=>{s.options=c},()=>{}),_}_createAnimations(s,r){const c=this._properties,f=[],_=s.$animations||(s.$animations={}),x=Object.keys(r),M=Date.now();let S;for(S=x.length-1;S>=0;--S){const D=x[S];if("$"===D.charAt(0))continue;if("options"===D){f.push(...this._animateOptions(s,r));continue}const L=r[D];let j=_[D];const q=c.get(D);if(j){if(q&&j.active()){j.update(q,L,M);continue}j.cancel()}q&&q.duration?(_[D]=j=new Ol(q,s,D,L),f.push(j)):s[D]=L}return f}update(s,r){if(0===this._properties.size)return void Object.assign(s,r);const c=this._createAnimations(s,r);return c.length?(ur.add(this._chart,c),!0):void 0}}function Wa(o,s){const r=o&&o.options||{},c=r.reverse,f=void 0===r.min?s:0,_=void 0===r.max?s:0;return{start:c?_:f,end:c?f:_}}function No(o,s){const r=[],c=o._getSortedDatasetMetas(s);let f,_;for(f=0,_=c.length;f<_;++f)r.push(c[f].index);return r}function jo(o,s,r,c={}){const f=o.keys,_="single"===c.mode;let x,M,S,D;if(null!==s){for(x=0,M=f.length;x<M;++x){if(S=+f[x],S===r){if(c.all)continue;break}D=o.values[S],Oe(D)&&(_||0===s||Ve(s)===Ve(D))&&(s+=D)}return s}}function Go(o,s){const r=o&&o.options.stacked;return r||void 0===r&&void 0!==s.stack}function $o(o,s,r){const c=o[s]||(o[s]={});return c[r]||(c[r]={})}function dr(o,s,r,c){for(const f of s.getMatchingVisibleMetas(c).reverse()){const _=o[f.index];if(r&&_>0||!r&&_<0)return f.index}return null}function Ho(o,s){const{chart:r,_cachedMeta:c}=o,f=r._stacks||(r._stacks={}),{iScale:_,vScale:x,index:M}=c,S=_.axis,D=x.axis,L=function(o,s,r){return`${o.id}.${s.id}.${r.stack||r.type}`}(_,x,c),j=s.length;let q;for(let et=0;et<j;++et){const ut=s[et],{[S]:mt,[D]:wt}=ut;q=(ut._stacks||(ut._stacks={}))[D]=$o(f,L,mt),q[M]=wt,q._top=dr(q,x,!0,c.type),q._bottom=dr(q,x,!1,c.type)}}function Ya(o,s){const r=o.scales;return Object.keys(r).filter(c=>r[c].axis===s).shift()}function pa(o,s){const r=o.controller.index,c=o.vScale&&o.vScale.axis;if(c){s=s||o._parsed;for(const f of s){const _=f._stacks;if(!_||void 0===_[c]||void 0===_[c][r])return;delete _[c][r]}}}const Cr=o=>"reset"===o||"none"===o,Os=(o,s)=>s?o:Object.assign({},o);let Sr=(()=>{class o{constructor(r,c){this.chart=r,this._ctx=r.ctx,this.index=c,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const r=this._cachedMeta;this.configure(),this.linkScales(),r._stacked=Go(r.vScale,r),this.addElements()}updateIndex(r){this.index!==r&&pa(this._cachedMeta),this.index=r}linkScales(){const r=this.chart,c=this._cachedMeta,f=this.getDataset(),_=(q,et,ut,mt)=>"x"===q?et:"r"===q?mt:ut,x=c.xAxisID=de(f.xAxisID,Ya(r,"x")),M=c.yAxisID=de(f.yAxisID,Ya(r,"y")),S=c.rAxisID=de(f.rAxisID,Ya(r,"r")),D=c.indexAxis,L=c.iAxisID=_(D,x,M,S),j=c.vAxisID=_(D,M,x,S);c.xScale=this.getScaleForId(x),c.yScale=this.getScaleForId(M),c.rScale=this.getScaleForId(S),c.iScale=this.getScaleForId(L),c.vScale=this.getScaleForId(j)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(r){return this.chart.scales[r]}_getOtherScale(r){const c=this._cachedMeta;return r===c.iScale?c.vScale:c.iScale}reset(){this._update("reset")}_destroy(){const r=this._cachedMeta;this._data&&Ln(this._data,this),r._stacked&&pa(r)}_dataCheck(){const r=this.getDataset(),c=r.data||(r.data=[]),f=this._data;if(ie(c))this._data=function(o){const s=Object.keys(o),r=new Array(s.length);let c,f,_;for(c=0,f=s.length;c<f;++c)_=s[c],r[c]={x:_,y:o[_]};return r}(c);else if(f!==c){if(f){Ln(f,this);const _=this._cachedMeta;pa(_),_._parsed=[]}c&&Object.isExtensible(c)&&function(o,s){o._chartjs?o._chartjs.listeners.push(s):(Object.defineProperty(o,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),Gi.forEach(r=>{const c="_onData"+Mn(r),f=o[r];Object.defineProperty(o,r,{configurable:!0,enumerable:!1,value(..._){const x=f.apply(this,_);return o._chartjs.listeners.forEach(M=>{"function"==typeof M[c]&&M[c](..._)}),x}})}))}(c,this),this._syncList=[],this._data=c}}addElements(){const r=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(r.dataset=new this.datasetElementType)}buildOrUpdateElements(r){const c=this._cachedMeta,f=this.getDataset();let _=!1;this._dataCheck();const x=c._stacked;c._stacked=Go(c.vScale,c),c.stack!==f.stack&&(_=!0,pa(c),c.stack=f.stack),this._resyncElements(r),(_||x!==c._stacked)&&Ho(this,c._parsed)}configure(){const r=this.chart.config,c=r.datasetScopeKeys(this._type),f=r.getOptionScopes(this.getDataset(),c,!0);this.options=r.createResolver(f,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(r,c){const{_cachedMeta:f,_data:_}=this,{iScale:x,_stacked:M}=f,S=x.axis;let j,q,et,D=0===r&&c===_.length||f._sorted,L=r>0&&f._parsed[r-1];if(!1===this._parsing)f._parsed=_,f._sorted=!0,et=_;else{et=ze(_[r])?this.parseArrayData(f,_,r,c):ie(_[r])?this.parseObjectData(f,_,r,c):this.parsePrimitiveData(f,_,r,c);const ut=()=>null===q[S]||L&&q[S]<L[S];for(j=0;j<c;++j)f._parsed[j+r]=q=et[j],D&&(ut()&&(D=!1),L=q);f._sorted=D}M&&Ho(this,et)}parsePrimitiveData(r,c,f,_){const{iScale:x,vScale:M}=r,S=x.axis,D=M.axis,L=x.getLabels(),j=x===M,q=new Array(_);let et,ut,mt;for(et=0,ut=_;et<ut;++et)mt=et+f,q[et]={[S]:j||x.parse(L[mt],mt),[D]:M.parse(c[mt],mt)};return q}parseArrayData(r,c,f,_){const{xScale:x,yScale:M}=r,S=new Array(_);let D,L,j,q;for(D=0,L=_;D<L;++D)j=D+f,q=c[j],S[D]={x:x.parse(q[0],j),y:M.parse(q[1],j)};return S}parseObjectData(r,c,f,_){const{xScale:x,yScale:M}=r,{xAxisKey:S="x",yAxisKey:D="y"}=this._parsing,L=new Array(_);let j,q,et,ut;for(j=0,q=_;j<q;++j)et=j+f,ut=c[et],L[j]={x:x.parse(Ki(ut,S),et),y:M.parse(Ki(ut,D),et)};return L}getParsed(r){return this._cachedMeta._parsed[r]}getDataElement(r){return this._cachedMeta.data[r]}applyStack(r,c,f){const x=this._cachedMeta,M=c[r.axis];return jo({keys:No(this.chart,!0),values:c._stacks[r.axis]},M,x.index,{mode:f})}updateRangeFromParsed(r,c,f,_){const x=f[c.axis];let M=null===x?NaN:x;const S=_&&f._stacks[c.axis];_&&S&&(_.values=S,M=jo(_,x,this._cachedMeta.index)),r.min=Math.min(r.min,M),r.max=Math.max(r.max,M)}getMinMax(r,c){const f=this._cachedMeta,_=f._parsed,x=f._sorted&&r===f.iScale,M=_.length,S=this._getOtherScale(r),D=((o,s,r)=>o&&!s.hidden&&s._stacked&&{keys:No(this.chart,!0),values:null})(c,f),L={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:j,max:q}=function(o){const{min:s,max:r,minDefined:c,maxDefined:f}=o.getUserBounds();return{min:c?s:Number.NEGATIVE_INFINITY,max:f?r:Number.POSITIVE_INFINITY}}(S);let et,ut;function mt(){ut=_[et];const wt=ut[S.axis];return!Oe(ut[r.axis])||j>wt||q<wt}for(et=0;et<M&&(mt()||(this.updateRangeFromParsed(L,r,ut,D),!x));++et);if(x)for(et=M-1;et>=0;--et)if(!mt()){this.updateRangeFromParsed(L,r,ut,D);break}return L}getAllParsedValues(r){const c=this._cachedMeta._parsed,f=[];let _,x,M;for(_=0,x=c.length;_<x;++_)M=c[_][r.axis],Oe(M)&&f.push(M);return f}getMaxOverflow(){return!1}getLabelAndValue(r){const c=this._cachedMeta,f=c.iScale,_=c.vScale,x=this.getParsed(r);return{label:f?""+f.getLabelForValue(x[f.axis]):"",value:_?""+_.getLabelForValue(x[_.axis]):""}}_update(r){const c=this._cachedMeta;this.update(r||"default"),c._clip=function(o){let s,r,c,f;return ie(o)?(s=o.top,r=o.right,c=o.bottom,f=o.left):s=r=c=f=o,{top:s,right:r,bottom:c,left:f,disabled:!1===o}}(de(this.options.clip,function(o,s,r){if(!1===r)return!1;const c=Wa(o,r),f=Wa(s,r);return{top:f.end,right:c.end,bottom:f.start,left:c.start}}(c.xScale,c.yScale,this.getMaxOverflow())))}update(r){}draw(){const r=this._ctx,f=this._cachedMeta,_=f.data||[],x=this.chart.chartArea,M=[],S=this._drawStart||0,D=this._drawCount||_.length-S,L=this.options.drawActiveElementsOnTop;let j;for(f.dataset&&f.dataset.draw(r,x,S,D),j=S;j<S+D;++j){const q=_[j];q.hidden||(q.active&&L?M.push(q):q.draw(r,x))}for(j=0;j<M.length;++j)M[j].draw(r,x)}getStyle(r,c){const f=c?"active":"default";return void 0===r&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(f):this.resolveDataElementOptions(r||0,f)}getContext(r,c,f){const _=this.getDataset();let x;if(r>=0&&r<this._cachedMeta.data.length){const M=this._cachedMeta.data[r];x=M.$context||(M.$context=function(o,s,r){return qe(o,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:r,index:s,mode:"default",type:"data"})}(this.getContext(),r,M)),x.parsed=this.getParsed(r),x.raw=_.data[r],x.index=x.dataIndex=r}else x=this.$context||(this.$context=function(o,s){return qe(o,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),x.dataset=_,x.index=x.datasetIndex=this.index;return x.active=!!c,x.mode=f,x}resolveDatasetElementOptions(r){return this._resolveElementOptions(this.datasetElementType.id,r)}resolveDataElementOptions(r,c){return this._resolveElementOptions(this.dataElementType.id,c,r)}_resolveElementOptions(r,c="default",f){const _="active"===c,x=this._cachedDataOpts,M=r+"-"+c,S=x[M],D=this.enableOptionSharing&&Ne(f);if(S)return Os(S,D);const L=this.chart.config,j=L.datasetElementScopeKeys(this._type,r),q=_?[`${r}Hover`,"hover",r,""]:[r,""],et=L.getOptionScopes(this.getDataset(),j),ut=Object.keys(ri.elements[r]),wt=L.resolveNamedOptions(et,ut,()=>this.getContext(f,_),q);return wt.$shared&&(wt.$shared=D,x[M]=Object.freeze(Os(wt,D))),wt}_resolveAnimations(r,c,f){const _=this.chart,x=this._cachedDataOpts,M=`animation-${c}`,S=x[M];if(S)return S;let D;if(!1!==_.options.animation){const j=this.chart.config,q=j.datasetAnimationScopeKeys(this._type,c),et=j.getOptionScopes(this.getDataset(),q);D=j.createResolver(et,this.getContext(r,f,c))}const L=new Wr(_,D&&D.animations);return D&&D._cacheable&&(x[M]=Object.freeze(L)),L}getSharedOptions(r){if(r.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},r))}includeOptions(r,c){return!c||Cr(r)||this.chart._animationsDisabled}updateElement(r,c,f,_){Cr(_)?Object.assign(r,f):this._resolveAnimations(c,_).update(r,f)}updateSharedOptions(r,c,f){r&&!Cr(c)&&this._resolveAnimations(void 0,c).update(r,f)}_setStyle(r,c,f,_){r.active=_;const x=this.getStyle(c,_);this._resolveAnimations(c,f,_).update(r,{options:!_&&this.getSharedOptions(x)||x})}removeHoverStyle(r,c,f){this._setStyle(r,f,"active",!1)}setHoverStyle(r,c,f){this._setStyle(r,f,"active",!0)}_removeDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!1)}_setDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!0)}_resyncElements(r){const c=this._data,f=this._cachedMeta.data;for(const[S,D,L]of this._syncList)this[S](D,L);this._syncList=[];const _=f.length,x=c.length,M=Math.min(x,_);M&&this.parse(0,M),x>_?this._insertElements(_,x-_,r):x<_&&this._removeElements(x,_-x)}_insertElements(r,c,f=!0){const _=this._cachedMeta,x=_.data,M=r+c;let S;const D=L=>{for(L.length+=c,S=L.length-1;S>=M;S--)L[S]=L[S-c]};for(D(x),S=r;S<M;++S)x[S]=new this.dataElementType;this._parsing&&D(_._parsed),this.parse(r,c),f&&this.updateElements(x,r,c,"reset")}updateElements(r,c,f,_){}_removeElements(r,c){const f=this._cachedMeta;if(this._parsing){const _=f._parsed.splice(r,c);f._stacked&&pa(f,_)}f.data.splice(r,c)}_sync(r){if(this._parsing)this._syncList.push(r);else{const[c,f,_]=r;this[c](f,_)}this.chart._dataChanges.push([this.index,...r])}_onDataPush(){const r=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-r,r])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(r,c){c&&this._sync(["_removeElements",r,c]);const f=arguments.length-2;f&&this._sync(["_insertElements",r,f])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return o.defaults={},o})();function qo(o){const s=o.iScale,r=function(o,s){if(!o._cache.$bar){const r=o.getMatchingVisibleMetas(s);let c=[];for(let f=0,_=r.length;f<_;f++)c=c.concat(r[f].controller.getAllParsedValues(o));o._cache.$bar=Ra(c.sort((f,_)=>f-_))}return o._cache.$bar}(s,o.type);let f,_,x,M,c=s._length;const S=()=>{32767===x||-32768===x||(Ne(M)&&(c=Math.min(c,Math.abs(x-M)||c)),M=x)};for(f=0,_=r.length;f<_;++f)x=s.getPixelForValue(r[f]),S();for(M=void 0,f=0,_=s.ticks.length;f<_;++f)x=s.getPixelForTick(f),S();return c}function Ja(o,s,r,c){return ze(o)?function(o,s,r,c){const f=r.parse(o[0],c),_=r.parse(o[1],c),x=Math.min(f,_),M=Math.max(f,_);let S=x,D=M;Math.abs(x)>Math.abs(M)&&(S=M,D=x),s[r.axis]=D,s._custom={barStart:S,barEnd:D,start:f,end:_,min:x,max:M}}(o,s,r,c):s[r.axis]=r.parse(o,c),s}function Nc(o,s,r,c){const f=o.iScale,_=o.vScale,x=f.getLabels(),M=f===_,S=[];let D,L,j,q;for(D=r,L=r+c;D<L;++D)q=s[D],j={},j[f.axis]=M||f.parse(x[D],D),S.push(Ja(q,j,_,D));return S}function Yo(o){return o&&void 0!==o.barStart&&void 0!==o.barEnd}function fa(o,s,r,c){let f=s.borderSkipped;const _={};if(!f)return void(o.borderSkipped=_);const{start:x,end:M,reverse:S,top:D,bottom:L}=function(o){let s,r,c,f,_;return o.horizontal?(s=o.base>o.x,r="left",c="right"):(s=o.base<o.y,r="bottom",c="top"),s?(f="end",_="start"):(f="start",_="end"),{start:r,end:c,reverse:s,top:f,bottom:_}}(o);"middle"===f&&r&&(o.enableBorderRadius=!0,(r._top||0)===c?f=D:(r._bottom||0)===c?f=L:(_[ma(L,x,M,S)]=!0,f=D)),_[ma(f,x,M,S)]=!0,o.borderSkipped=_}function ma(o,s,r,c){return c?(o=function(o,s,r){return o===s?r:o===r?s:o}(o,s,r),o=Xo(o,r,s)):o=Xo(o,s,r),o}function Xo(o,s,r){return"start"===o?s:"end"===o?r:o}function jc(o,{inflateAmount:s},r){o.inflateAmount="auto"===s?1===r?.33:0:s}Sr.prototype.datasetElementType=null,Sr.prototype.dataElementType=null;let Fs=(()=>{class o extends Sr{parsePrimitiveData(r,c,f,_){return Nc(r,c,f,_)}parseArrayData(r,c,f,_){return Nc(r,c,f,_)}parseObjectData(r,c,f,_){const{iScale:x,vScale:M}=r,{xAxisKey:S="x",yAxisKey:D="y"}=this._parsing,L="x"===x.axis?S:D,j="x"===M.axis?S:D,q=[];let et,ut,mt,wt;for(et=f,ut=f+_;et<ut;++et)wt=c[et],mt={},mt[x.axis]=x.parse(Ki(wt,L),et),q.push(Ja(Ki(wt,j),mt,M,et));return q}updateRangeFromParsed(r,c,f,_){super.updateRangeFromParsed(r,c,f,_);const x=f._custom;x&&c===this._cachedMeta.vScale&&(r.min=Math.min(r.min,x.min),r.max=Math.max(r.max,x.max))}getMaxOverflow(){return 0}getLabelAndValue(r){const c=this._cachedMeta,{iScale:f,vScale:_}=c,x=this.getParsed(r),M=x._custom,S=Yo(M)?"["+M.start+", "+M.end+"]":""+_.getLabelForValue(x[_.axis]);return{label:""+f.getLabelForValue(x[f.axis]),value:S}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(r){const c=this._cachedMeta;this.updateElements(c.data,0,c.data.length,r)}updateElements(r,c,f,_){const x="reset"===_,{index:M,_cachedMeta:{vScale:S}}=this,D=S.getBasePixel(),L=S.isHorizontal(),j=this._getRuler(),q=this.resolveDataElementOptions(c,_),et=this.getSharedOptions(q),ut=this.includeOptions(_,et);this.updateSharedOptions(et,_,q);for(let mt=c;mt<c+f;mt++){const wt=this.getParsed(mt),Et=x||Le(wt[S.axis])?{base:D,head:D}:this._calculateBarValuePixels(mt),Gt=this._calculateBarIndexPixels(mt,j),se=(wt._stacks||{})[S.axis],Kt={horizontal:L,base:Et.base,enableBorderRadius:!se||Yo(wt._custom)||M===se._top||M===se._bottom,x:L?Et.head:Gt.center,y:L?Gt.center:Et.head,height:L?Gt.size:Math.abs(Et.size),width:L?Math.abs(Et.size):Gt.size};ut&&(Kt.options=et||this.resolveDataElementOptions(mt,r[mt].active?"active":_));const zt=Kt.options||r[mt].options;fa(Kt,zt,se,M),jc(Kt,zt,j.ratio),this.updateElement(r[mt],mt,Kt,_)}}_getStacks(r,c){const _=this._cachedMeta.iScale,x=_.getMatchingVisibleMetas(this._type),M=_.options.stacked,S=x.length,D=[];let L,j;for(L=0;L<S;++L)if(j=x[L],j.controller.options.grouped){if(void 0!==c){const q=j.controller.getParsed(c)[j.controller._cachedMeta.vScale.axis];if(Le(q)||isNaN(q))continue}if((!1===M||-1===D.indexOf(j.stack)||void 0===M&&void 0===j.stack)&&D.push(j.stack),j.index===r)break}return D.length||D.push(void 0),D}_getStackCount(r){return this._getStacks(void 0,r).length}_getStackIndex(r,c,f){const _=this._getStacks(r,f),x=void 0!==c?_.indexOf(c):-1;return-1===x?_.length-1:x}_getRuler(){const r=this.options,c=this._cachedMeta,f=c.iScale,_=[];let x,M;for(x=0,M=c.data.length;x<M;++x)_.push(f.getPixelForValue(this.getParsed(x)[f.axis],x));const S=r.barThickness;return{min:S||qo(c),pixels:_,start:f._startPixel,end:f._endPixel,stackCount:this._getStackCount(),scale:f,grouped:r.grouped,ratio:S?1:r.categoryPercentage*r.barPercentage}}_calculateBarValuePixels(r){const{_cachedMeta:{vScale:c,_stacked:f},options:{base:_,minBarLength:x}}=this,M=_||0,S=this.getParsed(r),D=S._custom,L=Yo(D);let ut,mt,j=S[c.axis],q=0,et=f?this.applyStack(c,S,f):j;et!==j&&(q=et-j,et=j),L&&(j=D.barStart,et=D.barEnd-D.barStart,0!==j&&Ve(j)!==Ve(D.barEnd)&&(q=0),q+=j);const wt=Le(_)||L?q:_;let Et=c.getPixelForValue(wt);if(ut=this.chart.getDataVisibility(r)?c.getPixelForValue(q+et):Et,mt=ut-Et,Math.abs(mt)<x&&(mt=function(o,s,r){return 0!==o?Ve(o):(s.isHorizontal()?1:-1)*(s.min>=r?1:-1)}(mt,c,M)*x,j===M&&(Et-=mt/2),ut=Et+mt),Et===c.getPixelForValue(M)){const Gt=Ve(mt)*c.getLineWidthForValue(M)/2;Et+=Gt,mt-=Gt}return{size:mt,base:Et,head:ut,center:ut+mt/2}}_calculateBarIndexPixels(r,c){const f=c.scale,_=this.options,x=_.skipNull,M=de(_.maxBarThickness,1/0);let S,D;if(c.grouped){const L=x?this._getStackCount(r):c.stackCount,j="flex"===_.barThickness?function(o,s,r,c){const f=s.pixels,_=f[o];let x=o>0?f[o-1]:null,M=o<f.length-1?f[o+1]:null;const S=r.categoryPercentage;null===x&&(x=_-(null===M?s.end-s.start:M-_)),null===M&&(M=_+_-x);const D=_-(_-Math.min(x,M))/2*S;return{chunk:Math.abs(M-x)/2*S/c,ratio:r.barPercentage,start:D}}(r,c,_,L):function(o,s,r,c){const f=r.barThickness;let _,x;return Le(f)?(_=s.min*r.categoryPercentage,x=r.barPercentage):(_=f*c,x=1),{chunk:_/c,ratio:x,start:s.pixels[o]-_/2}}(r,c,_,L),q=this._getStackIndex(this.index,this._cachedMeta.stack,x?r:void 0);S=j.start+j.chunk*q+j.chunk/2,D=Math.min(M,j.chunk*j.ratio)}else S=f.getPixelForValue(this.getParsed(r)[f.axis],r),D=Math.min(M,c.min*c.ratio);return{base:S-D/2,head:S+D/2,center:S,size:D}}draw(){const r=this._cachedMeta,c=r.vScale,f=r.data,_=f.length;let x=0;for(;x<_;++x)null!==this.getParsed(x)[c.axis]&&f[x].draw(this._ctx)}}return o.id="bar",o.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},o.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}},o})(),to=(()=>{class o extends Sr{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(r,c,f,_){const x=super.parsePrimitiveData(r,c,f,_);for(let M=0;M<x.length;M++)x[M]._custom=this.resolveDataElementOptions(M+f).radius;return x}parseArrayData(r,c,f,_){const x=super.parseArrayData(r,c,f,_);for(let M=0;M<x.length;M++)x[M]._custom=de(c[f+M][2],this.resolveDataElementOptions(M+f).radius);return x}parseObjectData(r,c,f,_){const x=super.parseObjectData(r,c,f,_);for(let M=0;M<x.length;M++){const S=c[f+M];x[M]._custom=de(S&&S.r&&+S.r,this.resolveDataElementOptions(M+f).radius)}return x}getMaxOverflow(){const r=this._cachedMeta.data;let c=0;for(let f=r.length-1;f>=0;--f)c=Math.max(c,r[f].size(this.resolveDataElementOptions(f))/2);return c>0&&c}getLabelAndValue(r){const c=this._cachedMeta,{xScale:f,yScale:_}=c,x=this.getParsed(r),M=f.getLabelForValue(x.x),S=_.getLabelForValue(x.y),D=x._custom;return{label:c.label,value:"("+M+", "+S+(D?", "+D:"")+")"}}update(r){const c=this._cachedMeta.data;this.updateElements(c,0,c.length,r)}updateElements(r,c,f,_){const x="reset"===_,{iScale:M,vScale:S}=this._cachedMeta,D=this.resolveDataElementOptions(c,_),L=this.getSharedOptions(D),j=this.includeOptions(_,L),q=M.axis,et=S.axis;for(let ut=c;ut<c+f;ut++){const mt=r[ut],wt=!x&&this.getParsed(ut),Et={},Gt=Et[q]=x?M.getPixelForDecimal(.5):M.getPixelForValue(wt[q]),se=Et[et]=x?S.getBasePixel():S.getPixelForValue(wt[et]);Et.skip=isNaN(Gt)||isNaN(se),j&&(Et.options=this.resolveDataElementOptions(ut,mt.active?"active":_),x&&(Et.options.radius=0)),this.updateElement(mt,ut,Et,_)}this.updateSharedOptions(L,_,D)}resolveDataElementOptions(r,c){const f=this.getParsed(r);let _=super.resolveDataElementOptions(r,c);_.$shared&&(_=Object.assign({},_,{$shared:!1}));const x=_.radius;return"active"!==c&&(_.radius=0),_.radius+=de(f&&f._custom,x),_}}return o.id="bubble",o.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},o.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}},o})(),eo=(()=>{class o extends Sr{constructor(r,c){super(r,c),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(r,c){const f=this.getDataset().data,_=this._cachedMeta;if(!1===this._parsing)_._parsed=f;else{let M,S,x=D=>+f[D];if(ie(f[r])){const{key:D="value"}=this._parsing;x=L=>+Ki(f[L],D)}for(M=r,S=r+c;M<S;++M)_._parsed[M]=x(M)}}_getRotation(){return Yi(this.options.rotation-90)}_getCircumference(){return Yi(this.options.circumference)}_getRotationExtents(){let r=_i,c=-_i;for(let f=0;f<this.chart.data.datasets.length;++f)if(this.chart.isDatasetVisible(f)){const _=this.chart.getDatasetMeta(f).controller,x=_._getRotation(),M=_._getCircumference();r=Math.min(r,x),c=Math.max(c,x+M)}return{rotation:r,circumference:c-r}}update(r){const c=this.chart,{chartArea:f}=c,_=this._cachedMeta,x=_.data,M=this.getMaxBorderWidth()+this.getMaxOffset(x)+this.options.spacing,S=Math.max((Math.min(f.width,f.height)-M)/2,0),D=Math.min(((o,s)=>"string"==typeof o&&o.endsWith("%")?parseFloat(o)/100:o/s)(this.options.cutout,S),1),L=this._getRingWeight(this.index),{circumference:j,rotation:q}=this._getRotationExtents(),{ratioX:et,ratioY:ut,offsetX:mt,offsetY:wt}=function(o,s,r){let c=1,f=1,_=0,x=0;if(s<_i){const M=o,S=M+s,D=Math.cos(M),L=Math.sin(M),j=Math.cos(S),q=Math.sin(S),et=(se,Kt,zt)=>ii(se,M,S,!0)?1:Math.max(Kt,Kt*r,zt,zt*r),ut=(se,Kt,zt)=>ii(se,M,S,!0)?-1:Math.min(Kt,Kt*r,zt,zt*r),mt=et(0,D,j),wt=et(Ci,L,q),Et=ut(Ai,D,j),Gt=ut(Ai+Ci,L,q);c=(mt-Et)/2,f=(wt-Gt)/2,_=-(mt+Et)/2,x=-(wt+Gt)/2}return{ratioX:c,ratioY:f,offsetX:_,offsetY:x}}(q,j,D),se=Math.max(Math.min((f.width-M)/et,(f.height-M)/ut)/2,0),Kt=zi(this.options.radius,se),ae=(Kt-Math.max(Kt*D,0))/this._getVisibleDatasetWeightTotal();this.offsetX=mt*Kt,this.offsetY=wt*Kt,_.total=this.calculateTotal(),this.outerRadius=Kt-ae*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-ae*L,0),this.updateElements(x,0,x.length,r)}_circumference(r,c){const f=this.options,_=this._cachedMeta,x=this._getCircumference();return c&&f.animation.animateRotate||!this.chart.getDataVisibility(r)||null===_._parsed[r]||_.data[r].hidden?0:this.calculateCircumference(_._parsed[r]*x/_i)}updateElements(r,c,f,_){const x="reset"===_,M=this.chart,S=M.chartArea,j=(S.left+S.right)/2,q=(S.top+S.bottom)/2,et=x&&M.options.animation.animateScale,ut=et?0:this.innerRadius,mt=et?0:this.outerRadius,wt=this.resolveDataElementOptions(c,_),Et=this.getSharedOptions(wt),Gt=this.includeOptions(_,Et);let Kt,se=this._getRotation();for(Kt=0;Kt<c;++Kt)se+=this._circumference(Kt,x);for(Kt=c;Kt<c+f;++Kt){const zt=this._circumference(Kt,x),ae=r[Kt],fe={x:j+this.offsetX,y:q+this.offsetY,startAngle:se,endAngle:se+zt,circumference:zt,outerRadius:mt,innerRadius:ut};Gt&&(fe.options=Et||this.resolveDataElementOptions(Kt,ae.active?"active":_)),se+=zt,this.updateElement(ae,Kt,fe,_)}this.updateSharedOptions(Et,_,wt)}calculateTotal(){const r=this._cachedMeta,c=r.data;let _,f=0;for(_=0;_<c.length;_++){const x=r._parsed[_];null!==x&&!isNaN(x)&&this.chart.getDataVisibility(_)&&!c[_].hidden&&(f+=Math.abs(x))}return f}calculateCircumference(r){const c=this._cachedMeta.total;return c>0&&!isNaN(r)?_i*(Math.abs(r)/c):0}getLabelAndValue(r){const f=this.chart,_=f.data.labels||[],x=ps(this._cachedMeta._parsed[r],f.options.locale);return{label:_[r]||"",value:x}}getMaxBorderWidth(r){let c=0;const f=this.chart;let _,x,M,S,D;if(!r)for(_=0,x=f.data.datasets.length;_<x;++_)if(f.isDatasetVisible(_)){M=f.getDatasetMeta(_),r=M.data,S=M.controller;break}if(!r)return 0;for(_=0,x=r.length;_<x;++_)D=S.resolveDataElementOptions(_),"inner"!==D.borderAlign&&(c=Math.max(c,D.borderWidth||0,D.hoverBorderWidth||0));return c}getMaxOffset(r){let c=0;for(let f=0,_=r.length;f<_;++f){const x=this.resolveDataElementOptions(f);c=Math.max(c,x.offset||0,x.hoverOffset||0)}return c}_getRingWeightOffset(r){let c=0;for(let f=0;f<r;++f)this.chart.isDatasetVisible(f)&&(c+=this._getRingWeight(f));return c}_getRingWeight(r){return Math.max(de(this.chart.data.datasets[r].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return o.id="doughnut",o.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},o.descriptors={_scriptable:s=>"spacing"!==s,_indexable:s=>"spacing"!==s},o.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(s){const r=s.data;if(r.labels.length&&r.datasets.length){const{labels:{pointStyle:c}}=s.legend.options;return r.labels.map((f,_)=>{const M=s.getDatasetMeta(0).controller.getStyle(_);return{text:f,fillStyle:M.backgroundColor,strokeStyle:M.borderColor,lineWidth:M.borderWidth,pointStyle:c,hidden:!s.getDataVisibility(_),index:_}})}return[]}},onClick(s,r,c){c.chart.toggleDataVisibility(r.index),c.chart.update()}},tooltip:{callbacks:{title:()=>"",label(s){let r=s.label;const c=": "+s.formattedValue;return ze(r)?(r=r.slice(),r[0]+=c):r+=c,r}}}}},o})(),Ko=(()=>{class o extends Sr{initialize(){this.enableOptionSharing=!0,super.initialize()}update(r){const c=this._cachedMeta,{dataset:f,data:_=[],_dataset:x}=c,M=this.chart._animationsDisabled;let{start:S,count:D}=function(o,s,r){const c=s.length;let f=0,_=c;if(o._sorted){const{iScale:x,_parsed:M}=o,S=x.axis,{min:D,max:L,minDefined:j,maxDefined:q}=x.getUserBounds();j&&(f=Me(Math.min(An(M,x.axis,D).lo,r?c:An(s,S,x.getPixelForValue(D)).lo),0,c-1)),_=q?Me(Math.max(An(M,x.axis,L).hi+1,r?0:An(s,S,x.getPixelForValue(L)).hi+1),f,c)-f:c-f}return{start:f,count:_}}(c,_,M);this._drawStart=S,this._drawCount=D,function(o){const{xScale:s,yScale:r,_scaleRanges:c}=o,f={xmin:s.min,xmax:s.max,ymin:r.min,ymax:r.max};if(!c)return o._scaleRanges=f,!0;const _=c.xmin!==s.min||c.xmax!==s.max||c.ymin!==r.min||c.ymax!==r.max;return Object.assign(c,f),_}(c)&&(S=0,D=_.length),f._chart=this.chart,f._datasetIndex=this.index,f._decimated=!!x._decimated,f.points=_;const L=this.resolveDatasetElementOptions(r);this.options.showLine||(L.borderWidth=0),L.segment=this.options.segment,this.updateElement(f,void 0,{animated:!M,options:L},r),this.updateElements(_,S,D,r)}updateElements(r,c,f,_){const x="reset"===_,{iScale:M,vScale:S,_stacked:D,_dataset:L}=this._cachedMeta,j=this.resolveDataElementOptions(c,_),q=this.getSharedOptions(j),et=this.includeOptions(_,q),ut=M.axis,mt=S.axis,{spanGaps:wt,segment:Et}=this.options,Gt=Pn(wt)?wt:Number.POSITIVE_INFINITY,se=this.chart._animationsDisabled||x||"none"===_;let Kt=c>0&&this.getParsed(c-1);for(let zt=c;zt<c+f;++zt){const ae=r[zt],fe=this.getParsed(zt),ge=se?ae:{},ce=Le(fe[mt]),Xe=ge[ut]=M.getPixelForValue(fe[ut],zt),Be=ge[mt]=x||ce?S.getBasePixel():S.getPixelForValue(D?this.applyStack(S,fe,D):fe[mt],zt);ge.skip=isNaN(Xe)||isNaN(Be)||ce,ge.stop=zt>0&&fe[ut]-Kt[ut]>Gt,Et&&(ge.parsed=fe,ge.raw=L.data[zt]),et&&(ge.options=q||this.resolveDataElementOptions(zt,ae.active?"active":_)),se||this.updateElement(ae,zt,ge,_),Kt=fe}this.updateSharedOptions(q,_,j)}getMaxOverflow(){const r=this._cachedMeta,c=r.dataset,f=c.options&&c.options.borderWidth||0,_=r.data||[];if(!_.length)return f;const x=_[0].size(this.resolveDataElementOptions(0)),M=_[_.length-1].size(this.resolveDataElementOptions(_.length-1));return Math.max(f,x,M)/2}draw(){const r=this._cachedMeta;r.dataset.updateControlPoints(this.chart.chartArea,r.iScale.axis),super.draw()}}return o.id="line",o.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},o.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}},o})(),Qo=(()=>{class o extends Sr{constructor(r,c){super(r,c),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(r){const f=this.chart,_=f.data.labels||[],x=ps(this._cachedMeta._parsed[r].r,f.options.locale);return{label:_[r]||"",value:x}}update(r){const c=this._cachedMeta.data;this._updateRadius(),this.updateElements(c,0,c.length,r)}_updateRadius(){const r=this.chart,c=r.chartArea,f=r.options,_=Math.min(c.right-c.left,c.bottom-c.top),x=Math.max(_/2,0),S=(x-Math.max(f.cutoutPercentage?x/100*f.cutoutPercentage:1,0))/r.getVisibleDatasetCount();this.outerRadius=x-S*this.index,this.innerRadius=this.outerRadius-S}updateElements(r,c,f,_){const x="reset"===_,M=this.chart,S=this.getDataset(),L=M.options.animation,j=this._cachedMeta.rScale,q=j.xCenter,et=j.yCenter,ut=j.getIndexAngle(0)-.5*Ai;let wt,mt=ut;const Et=360/this.countVisibleElements();for(wt=0;wt<c;++wt)mt+=this._computeAngle(wt,_,Et);for(wt=c;wt<c+f;wt++){const Gt=r[wt];let se=mt,Kt=mt+this._computeAngle(wt,_,Et),zt=M.getDataVisibility(wt)?j.getDistanceFromCenterForValue(S.data[wt]):0;mt=Kt,x&&(L.animateScale&&(zt=0),L.animateRotate&&(se=Kt=ut));const ae={x:q,y:et,innerRadius:0,outerRadius:zt,startAngle:se,endAngle:Kt,options:this.resolveDataElementOptions(wt,Gt.active?"active":_)};this.updateElement(Gt,wt,ae,_)}}countVisibleElements(){const r=this.getDataset();let f=0;return this._cachedMeta.data.forEach((_,x)=>{!isNaN(r.data[x])&&this.chart.getDataVisibility(x)&&f++}),f}_computeAngle(r,c,f){return this.chart.getDataVisibility(r)?Yi(this.resolveDataElementOptions(r,c).angle||f):0}}return o.id="polarArea",o.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},o.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(s){const r=s.data;if(r.labels.length&&r.datasets.length){const{labels:{pointStyle:c}}=s.legend.options;return r.labels.map((f,_)=>{const M=s.getDatasetMeta(0).controller.getStyle(_);return{text:f,fillStyle:M.backgroundColor,strokeStyle:M.borderColor,lineWidth:M.borderWidth,pointStyle:c,hidden:!s.getDataVisibility(_),index:_}})}return[]}},onClick(s,r,c){c.chart.toggleDataVisibility(r.index),c.chart.update()}},tooltip:{callbacks:{title:()=>"",label:s=>s.chart.data.labels[s.dataIndex]+": "+s.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}},o})(),io=(()=>{class o extends eo{}return o.id="pie",o.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"},o})(),no=(()=>{class o extends Sr{getLabelAndValue(r){const c=this._cachedMeta.vScale,f=this.getParsed(r);return{label:c.getLabels()[r],value:""+c.getLabelForValue(f[c.axis])}}update(r){const c=this._cachedMeta,f=c.dataset,_=c.data||[],x=c.iScale.getLabels();if(f.points=_,"resize"!==r){const M=this.resolveDatasetElementOptions(r);this.options.showLine||(M.borderWidth=0),this.updateElement(f,void 0,{_loop:!0,_fullLoop:x.length===_.length,options:M},r)}this.updateElements(_,0,_.length,r)}updateElements(r,c,f,_){const x=this.getDataset(),M=this._cachedMeta.rScale,S="reset"===_;for(let D=c;D<c+f;D++){const L=r[D],j=this.resolveDataElementOptions(D,L.active?"active":_),q=M.getPointPositionForValue(D,x.data[D]),et=S?M.xCenter:q.x,ut=S?M.yCenter:q.y,mt={x:et,y:ut,angle:q.angle,skip:isNaN(et)||isNaN(ut),options:j};this.updateElement(L,D,mt,_)}}}return o.id="radar",o.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},o.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}},o})(),ro=(()=>{class o extends Ko{}return o.id="scatter",o.defaults={showLine:!1,fill:!1},o.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:s=>"("+s.label+", "+s.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}},o})();function ys(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var $h={_date:(()=>{class o{constructor(r){this.options=r||{}}formats(){return ys()}parse(r,c){return ys()}format(r,c){return ys()}add(r,c,f){return ys()}diff(r,c,f){return ys()}startOf(r,c,f){return ys()}endOf(r,c){return ys()}}return o.override=function(s){Object.assign(o.prototype,s)},o})()};function ao(o,s){return"native"in o?{x:o.x,y:o.y}:Rl(o,s)}function el(o,s,r,c){const{controller:f,data:_,_sorted:x}=o,M=f._cachedMeta.iScale;if(M&&s===M.axis&&"r"!==s&&x&&_.length){const S=M._reversePixels?za:An;if(!c)return S(_,s,r);if(f._sharedOptions){const D=_[0],L="function"==typeof D.getRange&&D.getRange(s);if(L){const j=S(_,s,r-L),q=S(_,s,r+L);return{lo:j.lo,hi:q.hi}}}}return{lo:0,hi:_.length-1}}function oo(o,s,r,c,f){const _=o.getSortedVisibleDatasetMetas(),x=r[s];for(let M=0,S=_.length;M<S;++M){const{index:D,data:L}=_[M],{lo:j,hi:q}=el(_[M],s,x,f);for(let et=j;et<=q;++et){const ut=L[et];ut.skip||c(ut,D,et)}}}function il(o,s,r,c){const f=[];return as(s,o.chartArea,o._minPadding)&&oo(o,r,s,function(x,M,S){x.inRange(s.x,s.y,c)&&f.push({element:x,datasetIndex:M,index:S})},!0),f}function rl(o,s,r,c,f){return as(s,o.chartArea,o._minPadding)?"r"!==r||c?function(o,s,r,c,f){let _=[];const x=function(o){const s=-1!==o.indexOf("x"),r=-1!==o.indexOf("y");return function(c,f){const _=s?Math.abs(c.x-f.x):0,x=r?Math.abs(c.y-f.y):0;return Math.sqrt(Math.pow(_,2)+Math.pow(x,2))}}(r);let M=Number.POSITIVE_INFINITY;return oo(o,r,s,function(D,L,j){const q=D.inRange(s.x,s.y,f);if(c&&!q)return;const et=D.getCenterPoint(f);if(!as(et,o.chartArea,o._minPadding)&&!q)return;const mt=x(s,et);mt<M?(_=[{element:D,datasetIndex:L,index:j}],M=mt):mt===M&&_.push({element:D,datasetIndex:L,index:j})}),_}(o,s,r,c,f):function(o,s,r,c){let f=[];return oo(o,r,s,function(x,M,S){const{startAngle:D,endAngle:L}=x.getProps(["startAngle","endAngle"],c),{angle:j}=he(x,{x:s.x,y:s.y});ii(j,D,L)&&f.push({element:x,datasetIndex:M,index:S})}),f}(o,s,r,f):[]}function _a(o,s,r,c){const f=ao(s,o),_=[],x=r.axis,M="x"===x?"inXRange":"inYRange";let S=!1;return function(o,s){const r=o.getSortedVisibleDatasetMetas();let c,f,_;for(let x=0,M=r.length;x<M;++x){({index:c,data:f}=r[x]);for(let S=0,D=f.length;S<D;++S)_=f[S],_.skip||s(_,c,S)}}(o,(D,L,j)=>{D[M](f[x],c)&&_.push({element:D,datasetIndex:L,index:j}),D.inRange(f.x,f.y,c)&&(S=!0)}),r.intersect&&!S?[]:_}var Zc={modes:{index(o,s,r,c){const f=ao(s,o),_=r.axis||"x",x=r.intersect?il(o,f,_,c):rl(o,f,_,!1,c),M=[];return x.length?(o.getSortedVisibleDatasetMetas().forEach(S=>{const D=x[0].index,L=S.data[D];L&&!L.skip&&M.push({element:L,datasetIndex:S.index,index:D})}),M):[]},dataset(o,s,r,c){const f=ao(s,o),_=r.axis||"xy";let x=r.intersect?il(o,f,_,c):rl(o,f,_,!1,c);if(x.length>0){const M=x[0].datasetIndex,S=o.getDatasetMeta(M).data;x=[];for(let D=0;D<S.length;++D)x.push({element:S[D],datasetIndex:M,index:D})}return x},point:(o,s,r,c)=>il(o,ao(s,o),r.axis||"xy",c),nearest:(o,s,r,c)=>rl(o,ao(s,o),r.axis||"xy",r.intersect,c),x:(o,s,r,c)=>_a(o,s,{axis:"x",intersect:r.intersect},c),y:(o,s,r,c)=>_a(o,s,{axis:"y",intersect:r.intersect},c)}};const Nl=["left","top","right","bottom"];function Xr(o,s){return o.filter(r=>r.pos===s)}function Bs(o,s){return o.filter(r=>-1===Nl.indexOf(r.pos)&&r.box.axis===s)}function Vs(o,s){return o.sort((r,c)=>{const f=s?c:r,_=s?r:c;return f.weight===_.weight?f.index-_.index:f.weight-_.weight})}function sl(o,s,r,c){return Math.max(o[r],s[r])+Math.max(o[c],s[c])}function pn(o,s){o.top=Math.max(o.top,s.top),o.left=Math.max(o.left,s.left),o.bottom=Math.max(o.bottom,s.bottom),o.right=Math.max(o.right,s.right)}function $l(o,s,r,c){const{pos:f,box:_}=r,x=o.maxPadding;if(!ie(f)){r.size&&(o[f]-=r.size);const j=c[r.stack]||{size:0,count:1};j.size=Math.max(j.size,r.horizontal?_.height:_.width),r.size=j.size/j.count,o[f]+=r.size}_.getPadding&&pn(x,_.getPadding());const M=Math.max(0,s.outerWidth-sl(x,o,"left","right")),S=Math.max(0,s.outerHeight-sl(x,o,"top","bottom")),D=M!==o.w,L=S!==o.h;return o.w=M,o.h=S,r.horizontal?{same:D,other:L}:{same:L,other:D}}function Hc(o,s){const r=s.maxPadding;return function(f){const _={left:0,top:0,right:0,bottom:0};return f.forEach(x=>{_[x]=Math.max(s[x],r[x])}),_}(o?["left","right"]:["top","bottom"])}function On(o,s,r,c){const f=[];let _,x,M,S,D,L;for(_=0,x=o.length,D=0;_<x;++_){M=o[_],S=M.box,S.update(M.width||s.w,M.height||s.h,Hc(M.horizontal,s));const{same:j,other:q}=$l(s,r,M,c);D|=j&&f.length,L=L||q,S.fullSize||f.push(M)}return D&&On(f,s,r,c)||L}function Jr(o,s,r,c,f){o.top=r,o.left=s,o.right=s+c,o.bottom=r+f,o.width=c,o.height=f}function Us(o,s,r,c){const f=r.padding;let{x:_,y:x}=s;for(const M of o){const S=M.box,D=c[M.stack]||{count:1,placed:0,weight:1},L=M.stackWeight/D.weight||1;if(M.horizontal){const j=s.w*L,q=D.size||S.height;Ne(D.start)&&(x=D.start),S.fullSize?Jr(S,f.left,x,r.outerWidth-f.right-f.left,q):Jr(S,s.left+D.placed,x,j,q),D.start=x,D.placed+=j,x=S.bottom}else{const j=s.h*L,q=D.size||S.width;Ne(D.start)&&(_=D.start),S.fullSize?Jr(S,_,f.top,q,r.outerHeight-f.bottom-f.top):Jr(S,_,s.top+D.placed,q,j),D.start=_,D.placed+=j,_=S.right}}s.x=_,s.y=x}ri.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var En={addBox(o,s){o.boxes||(o.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(r){s.draw(r)}}]},o.boxes.push(s)},removeBox(o,s){const r=o.boxes?o.boxes.indexOf(s):-1;-1!==r&&o.boxes.splice(r,1)},configure(o,s,r){s.fullSize=r.fullSize,s.position=r.position,s.weight=r.weight},update(o,s,r,c){if(!o)return;const f=je(o.options.layout.padding),_=Math.max(s-f.width,0),x=Math.max(r-f.height,0),M=function(o){const s=function(o){const s=[];let r,c,f,_,x,M;for(r=0,c=(o||[]).length;r<c;++r)f=o[r],({position:_,options:{stack:x,stackWeight:M=1}}=f),s.push({index:r,box:f,pos:_,horizontal:f.isHorizontal(),weight:f.weight,stack:x&&_+x,stackWeight:M});return s}(o),r=Vs(s.filter(D=>D.box.fullSize),!0),c=Vs(Xr(s,"left"),!0),f=Vs(Xr(s,"right")),_=Vs(Xr(s,"top"),!0),x=Vs(Xr(s,"bottom")),M=Bs(s,"x"),S=Bs(s,"y");return{fullSize:r,leftAndTop:c.concat(_),rightAndBottom:f.concat(S).concat(x).concat(M),chartArea:Xr(s,"chartArea"),vertical:c.concat(f).concat(S),horizontal:_.concat(x).concat(M)}}(o.boxes),S=M.vertical,D=M.horizontal;ke(o.boxes,mt=>{"function"==typeof mt.beforeLayout&&mt.beforeLayout()});const L=S.reduce((mt,wt)=>wt.box.options&&!1===wt.box.options.display?mt:mt+1,0)||1,j=Object.freeze({outerWidth:s,outerHeight:r,padding:f,availableWidth:_,availableHeight:x,vBoxMaxWidth:_/2/L,hBoxMaxHeight:x/2}),q=Object.assign({},f);pn(q,je(c));const et=Object.assign({maxPadding:q,w:_,h:x,x:f.left,y:f.top},f),ut=function(o,s){const r=function(o){const s={};for(const r of o){const{stack:c,pos:f,stackWeight:_}=r;if(!c||!Nl.includes(f))continue;const x=s[c]||(s[c]={count:0,placed:0,weight:0,size:0});x.count++,x.weight+=_}return s}(o),{vBoxMaxWidth:c,hBoxMaxHeight:f}=s;let _,x,M;for(_=0,x=o.length;_<x;++_){M=o[_];const{fullSize:S}=M.box,D=r[M.stack],L=D&&M.stackWeight/D.weight;M.horizontal?(M.width=L?L*c:S&&s.availableWidth,M.height=f):(M.width=c,M.height=L?L*f:S&&s.availableHeight)}return r}(S.concat(D),j);On(M.fullSize,et,j,ut),On(S,et,j,ut),On(D,et,j,ut)&&On(S,et,j,ut),function(o){const s=o.maxPadding;function r(c){const f=Math.max(s[c]-o[c],0);return o[c]+=f,f}o.y+=r("top"),o.x+=r("left"),r("right"),r("bottom")}(et),Us(M.leftAndTop,et,j,ut),et.x+=et.w,et.y+=et.h,Us(M.rightAndBottom,et,j,ut),o.chartArea={left:et.left,top:et.top,right:et.left+et.w,bottom:et.top+et.h,height:et.h,width:et.w},ke(M.chartArea,mt=>{const wt=mt.box;Object.assign(wt,o.chartArea),wt.update(et.w,et.h,{left:0,top:0,right:0,bottom:0})})}};class al{acquireContext(s,r){}releaseContext(s){return!1}addEventListener(s,r,c){}removeEventListener(s,r,c){}getDevicePixelRatio(){return 1}getMaximumSize(s,r,c,f){return r=Math.max(0,r||s.width),c=c||s.height,{width:r,height:Math.max(0,f?Math.floor(r/f):c)}}isAttached(s){return!0}updateConfig(s){}}class Hh extends al{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}}const lo="$chartjs",co={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},kn=o=>null===o||""===o,Ns=!!Ba&&{passive:!0};function _e(o,s,r){o.canvas.removeEventListener(s,r,Ns)}function po(o,s){for(const r of o)if(r===s||r.contains(s))return!0}function fo(o,s,r){const c=o.canvas,f=new MutationObserver(_=>{let x=!1;for(const M of _)x=x||po(M.addedNodes,c),x=x&&!po(M.removedNodes,c);x&&r()});return f.observe(document,{childList:!0,subtree:!0}),f}function xs(o,s,r){const c=o.canvas,f=new MutationObserver(_=>{let x=!1;for(const M of _)x=x||po(M.removedNodes,c),x=x&&!po(M.addedNodes,c);x&&r()});return f.observe(document,{childList:!0,subtree:!0}),f}const p=new Map;let i=0;function l(){const o=window.devicePixelRatio;o!==i&&(i=o,p.forEach((s,r)=>{r.currentDevicePixelRatio!==o&&s()}))}function b(o,s,r){const c=o.canvas,f=c&&Lo(c);if(!f)return;const _=u((M,S)=>{const D=f.clientWidth;r(M,S),D<f.clientWidth&&r()},window),x=new ResizeObserver(M=>{const S=M[0],D=S.contentRect.width,L=S.contentRect.height;0===D&&0===L||_(D,L)});return x.observe(f),function(o,s){p.size||window.addEventListener("resize",l),p.set(o,s)}(o,_),x}function T(o,s,r){r&&r.disconnect(),"resize"===s&&function(o){p.delete(o),p.size||window.removeEventListener("resize",l)}(o)}function A(o,s,r){const c=o.canvas,f=u(_=>{null!==o.ctx&&r(function(o,s){const r=co[o.type]||o.type,{x:c,y:f}=Rl(o,s);return{type:r,chart:s,native:o,x:void 0!==c?c:null,y:void 0!==f?f:null}}(_,o))},o,_=>{const x=_[0];return[x,x.offsetX,x.offsetY]});return function(o,s,r){o.addEventListener(s,r,Ns)}(c,s,f),f}class z extends al{acquireContext(s,r){const c=s&&s.getContext&&s.getContext("2d");return c&&c.canvas===s?(function(o,s){const r=o.style,c=o.getAttribute("height"),f=o.getAttribute("width");if(o[lo]={initial:{height:c,width:f,style:{display:r.display,height:r.height,width:r.width}}},r.display=r.display||"block",r.boxSizing=r.boxSizing||"border-box",kn(f)){const _=Va(o,"width");void 0!==_&&(o.width=_)}if(kn(c))if(""===o.style.height)o.height=o.width/(s||2);else{const _=Va(o,"height");void 0!==_&&(o.height=_)}}(s,r),c):null}releaseContext(s){const r=s.canvas;if(!r[lo])return!1;const c=r[lo].initial;["height","width"].forEach(_=>{const x=c[_];Le(x)?r.removeAttribute(_):r.setAttribute(_,x)});const f=c.style||{};return Object.keys(f).forEach(_=>{r.style[_]=f[_]}),r.width=r.width,delete r[lo],!0}addEventListener(s,r,c){this.removeEventListener(s,r),(s.$proxies||(s.$proxies={}))[r]=({attach:fo,detach:xs,resize:b}[r]||A)(s,r,c)}removeEventListener(s,r){const c=s.$proxies||(s.$proxies={}),f=c[r];f&&(({attach:T,detach:T,resize:T}[r]||_e)(s,r,f),c[r]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,r,c,f){return function(o,s,r,c){const f=Oo(o),_=Hr(f,"margin"),x=la(f.maxWidth,o,"clientWidth")||rr,M=la(f.maxHeight,o,"clientHeight")||rr,S=function(o,s,r){let c,f;if(void 0===s||void 0===r){const _=Lo(o);if(_){const x=_.getBoundingClientRect(),M=Oo(_),S=Hr(M,"border","width"),D=Hr(M,"padding");s=x.width-D.width-S.width,r=x.height-D.height-S.height,c=la(M.maxWidth,_,"clientWidth"),f=la(M.maxHeight,_,"clientHeight")}else s=o.clientWidth,r=o.clientHeight}return{width:s,height:r,maxWidth:c||rr,maxHeight:f||rr}}(o,s,r);let{width:D,height:L}=S;if("content-box"===f.boxSizing){const j=Hr(f,"border","width"),q=Hr(f,"padding");D-=q.width+j.width,L-=q.height+j.height}return D=Math.max(0,D-_.width),L=Math.max(0,c?Math.floor(D/c):L-_.height),D=qr(Math.min(D,x,S.maxWidth)),L=qr(Math.min(L,M,S.maxHeight)),D&&!L&&(L=qr(D/2)),{width:D,height:L}}(s,r,c,f)}isAttached(s){const r=Lo(s);return!(!r||!r.isConnected)}}class O{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(s){const{x:r,y:c}=this.getProps(["x","y"],s);return{x:r,y:c}}hasValue(){return Pn(this.x)&&Pn(this.y)}getProps(s,r){const c=this.$animations;if(!r||!c)return this;const f={};return s.forEach(_=>{f[_]=c[_]&&c[_].active()?c[_]._to:this[_]}),f}}O.defaults={},O.defaultRoutes=void 0;const N={values:o=>ze(o)?o:""+o,numeric(o,s,r){if(0===o)return"0";const c=this.chart.options.locale;let f,_=o;if(r.length>1){const D=Math.max(Math.abs(r[0].value),Math.abs(r[r.length-1].value));(D<1e-4||D>1e15)&&(f="scientific"),_=function(o,s){let r=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(r)>=1&&o!==Math.floor(o)&&(r=o-Math.floor(o)),r}(o,r)}const x=Vi(Math.abs(_)),M=Math.max(Math.min(-1*Math.floor(x),20),0),S={notation:f,minimumFractionDigits:M,maximumFractionDigits:M};return Object.assign(S,this.options.ticks.format),ps(o,c,S)},logarithmic(o,s,r){if(0===o)return"0";const c=o/Math.pow(10,Math.floor(Vi(o)));return 1===c||2===c||5===c?N.numeric.call(this,o,s,r):""}};var X={formatters:N};function ot(o,s,r,c,f){const _=de(c,0),x=Math.min(de(f,o.length),o.length);let S,D,L,M=0;for(r=Math.ceil(r),f&&(S=f-c,r=S/Math.floor(S/r)),L=_;L<0;)M++,L=Math.round(_+M*r);for(D=Math.max(_,0);D<x;D++)D===L&&(s.push(o[D]),M++,L=Math.round(_+M*r))}ri.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(o,s)=>s.lineWidth,tickColor:(o,s)=>s.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:X.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),ri.route("scale.ticks","color","","color"),ri.route("scale.grid","color","","borderColor"),ri.route("scale.grid","borderColor","","borderColor"),ri.route("scale.title","color","","color"),ri.describe("scale",{_fallback:!1,_scriptable:o=>!o.startsWith("before")&&!o.startsWith("after")&&"callback"!==o&&"parser"!==o,_indexable:o=>"borderDash"!==o&&"tickBorderDash"!==o}),ri.describe("scales",{_fallback:"scale"}),ri.describe("scale.ticks",{_scriptable:o=>"backdropPadding"!==o&&"callback"!==o,_indexable:o=>"backdropPadding"!==o});const pt=(o,s,r)=>"top"===s||"left"===s?o[s]+r:o[s]-r;function At(o,s){const r=[],c=o.length/s,f=o.length;let _=0;for(;_<f;_+=c)r.push(o[Math.floor(_)]);return r}function It(o,s,r){const c=o.ticks.length,f=Math.min(s,c-1),_=o._startPixel,x=o._endPixel,M=1e-6;let D,S=o.getPixelForTick(f);if(!(r&&(D=1===c?Math.max(S-_,x-S):0===s?(o.getPixelForTick(1)-S)/2:(S-o.getPixelForTick(f-1))/2,S+=f<s?D:-D,S<_-M||S>x+M)))return S}function qt(o){return o.drawTicks?o.tickLength:0}function Yt(o,s){if(!o.display)return 0;const r=Re(o.font,s),c=je(o.padding);return(ze(o.text)?o.text.length:1)*r.lineHeight+c.height}function Zt(o,s,r){let c=$i(o);return(r&&"right"!==s||!r&&"right"===s)&&(c=(o=>"left"===o?"right":"right"===o?"left":o)(c)),c}class xe extends O{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,r){return s}getUserBounds(){let{_userMin:s,_userMax:r,_suggestedMin:c,_suggestedMax:f}=this;return s=ui(s,Number.POSITIVE_INFINITY),r=ui(r,Number.NEGATIVE_INFINITY),c=ui(c,Number.POSITIVE_INFINITY),f=ui(f,Number.NEGATIVE_INFINITY),{min:ui(s,c),max:ui(r,f),minDefined:Oe(s),maxDefined:Oe(r)}}getMinMax(s){let x,{min:r,max:c,minDefined:f,maxDefined:_}=this.getUserBounds();if(f&&_)return{min:r,max:c};const M=this.getMatchingVisibleMetas();for(let S=0,D=M.length;S<D;++S)x=M[S].controller.getMinMax(this,s),f||(r=Math.min(r,x.min)),_||(c=Math.max(c,x.max));return r=_&&r>c?c:r,c=f&&r>c?r:c,{min:ui(r,ui(c,r)),max:ui(c,ui(r,c))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ke(this.options.beforeUpdate,[this])}update(s,r,c){const{beginAtZero:f,grace:_,ticks:x}=this.options,M=x.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=r,this._margins=c=Object.assign({left:0,right:0,top:0,bottom:0},c),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+c.left+c.right:this.height+c.top+c.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(o,s,r){const{min:c,max:f}=o,_=zi(s,(f-c)/2),x=(M,S)=>r&&0===M?0:M+S;return{min:x(c,-Math.abs(_)),max:x(f,_)}}(this,_,f),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const S=M<this.ticks.length;this._convertTicksToLabels(S?At(this.ticks,M):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),x.display&&(x.autoSkip||"auto"===x.source)&&(this.ticks=function(o,s){const r=o.options.ticks,c=r.maxTicksLimit||function(o){const s=o.options.offset,r=o._tickSize();return Math.floor(Math.min(o._length/r+(s?0:1),o._maxLength/r))}(o),f=r.major.enabled?function(o){const s=[];let r,c;for(r=0,c=o.length;r<c;r++)o[r].major&&s.push(r);return s}(s):[],_=f.length,x=f[0],M=f[_-1],S=[];if(_>c)return function(o,s,r,c){let x,f=0,_=r[0];for(c=Math.ceil(c),x=0;x<o.length;x++)x===_&&(s.push(o[x]),f++,_=r[f*c])}(s,S,f,_/c),S;const D=function(o,s,r){const c=function(o){const s=o.length;let r,c;if(s<2)return!1;for(c=o[0],r=1;r<s;++r)if(o[r]-o[r-1]!==c)return!1;return c}(o),f=s.length/r;if(!c)return Math.max(f,1);const _=function(o){const s=[],r=Math.sqrt(o);let c;for(c=1;c<r;c++)o%c==0&&(s.push(c),s.push(o/c));return r===(0|r)&&s.push(r),s.sort((f,_)=>f-_).pop(),s}(c);for(let x=0,M=_.length-1;x<M;x++){const S=_[x];if(S>f)return S}return Math.max(f,1)}(f,s,c);if(_>0){let L,j;const q=_>1?Math.round((M-x)/(_-1)):null;for(ot(s,S,D,Le(q)?0:x-q,x),L=0,j=_-1;L<j;L++)ot(s,S,D,f[L],f[L+1]);return ot(s,S,D,M,Le(q)?s.length:M+q),S}return ot(s,S,D),S}(this,this.ticks),this._labelSizes=null),S&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let r,c,s=this.options.reverse;this.isHorizontal()?(r=this.left,c=this.right):(r=this.top,c=this.bottom,s=!s),this._startPixel=r,this._endPixel=c,this._reversePixels=s,this._length=c-r,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ke(this.options.afterUpdate,[this])}beforeSetDimensions(){Ke(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ke(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),Ke(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ke(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){const r=this.options.ticks;let c,f,_;for(c=0,f=s.length;c<f;c++)_=s[c],_.label=Ke(r.callback,[_.value,c,s],this)}afterTickToLabelConversion(){Ke(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ke(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const s=this.options,r=s.ticks,c=this.ticks.length,f=r.minRotation||0,_=r.maxRotation;let M,S,D,x=f;if(!this._isVisible()||!r.display||f>=_||c<=1||!this.isHorizontal())return void(this.labelRotation=f);const L=this._getLabelSizes(),j=L.widest.width,q=L.highest.height,et=Me(this.chart.width-j,0,this.maxWidth);M=s.offset?this.maxWidth/c:et/(c-1),j+6>M&&(M=et/(c-(s.offset?.5:1)),S=this.maxHeight-qt(s.grid)-r.padding-Yt(s.title,this.chart.options.font),D=Math.sqrt(j*j+q*q),x=zn(Math.min(Math.asin(Me((L.highest.height+6)/M,-1,1)),Math.asin(Me(S/D,-1,1))-Math.asin(Me(q/D,-1,1)))),x=Math.max(f,Math.min(_,x))),this.labelRotation=x}afterCalculateLabelRotation(){Ke(this.options.afterCalculateLabelRotation,[this])}beforeFit(){Ke(this.options.beforeFit,[this])}fit(){const s={width:0,height:0},{chart:r,options:{ticks:c,title:f,grid:_}}=this,x=this._isVisible(),M=this.isHorizontal();if(x){const S=Yt(f,r.options.font);if(M?(s.width=this.maxWidth,s.height=qt(_)+S):(s.height=this.maxHeight,s.width=qt(_)+S),c.display&&this.ticks.length){const{first:D,last:L,widest:j,highest:q}=this._getLabelSizes(),et=2*c.padding,ut=Yi(this.labelRotation),mt=Math.cos(ut),wt=Math.sin(ut);M?s.height=Math.min(this.maxHeight,s.height+(c.mirror?0:wt*j.width+mt*q.height)+et):s.width=Math.min(this.maxWidth,s.width+(c.mirror?0:mt*j.width+wt*q.height)+et),this._calculatePadding(D,L,wt,mt)}}this._handleMargins(),M?(this.width=this._length=r.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=r.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,r,c,f){const{ticks:{align:_,padding:x},position:M}=this.options,S=0!==this.labelRotation,D="top"!==M&&"x"===this.axis;if(this.isHorizontal()){const L=this.getPixelForTick(0)-this.left,j=this.right-this.getPixelForTick(this.ticks.length-1);let q=0,et=0;S?D?(q=f*s.width,et=c*r.height):(q=c*s.height,et=f*r.width):"start"===_?et=r.width:"end"===_?q=s.width:(q=s.width/2,et=r.width/2),this.paddingLeft=Math.max((q-L+x)*this.width/(this.width-L),0),this.paddingRight=Math.max((et-j+x)*this.width/(this.width-j),0)}else{let L=r.height/2,j=s.height/2;"start"===_?(L=0,j=s.height):"end"===_&&(L=r.height,j=0),this.paddingTop=L+x,this.paddingBottom=j+x}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ke(this.options.afterFit,[this])}isHorizontal(){const{axis:s,position:r}=this.options;return"top"===r||"bottom"===r||"x"===s}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){let r,c;for(this.beforeTickToLabelConversion(),this.generateTickLabels(s),r=0,c=s.length;r<c;r++)Le(s[r].label)&&(s.splice(r,1),c--,r--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){const r=this.options.ticks.sampleSize;let c=this.ticks;r<c.length&&(c=At(c,r)),this._labelSizes=s=this._computeLabelSizes(c,c.length)}return s}_computeLabelSizes(s,r){const{ctx:c,_longestTextCache:f}=this,_=[],x=[];let D,L,j,q,et,ut,mt,wt,Et,Gt,se,M=0,S=0;for(D=0;D<r;++D){if(q=s[D].label,et=this._resolveTickFontOptions(D),c.font=ut=et.string,mt=f[ut]=f[ut]||{data:{},gc:[]},wt=et.lineHeight,Et=Gt=0,Le(q)||ze(q)){if(ze(q))for(L=0,j=q.length;L<j;++L)se=q[L],!Le(se)&&!ze(se)&&(Et=ko(c,mt.data,mt.gc,Et,se),Gt+=wt)}else Et=ko(c,mt.data,mt.gc,Et,q),Gt=wt;_.push(Et),x.push(Gt),M=Math.max(Et,M),S=Math.max(Gt,S)}!function(o,s){ke(o,r=>{const c=r.gc,f=c.length/2;let _;if(f>s){for(_=0;_<f;++_)delete r.data[c[_]];c.splice(0,f)}})}(f,r);const Kt=_.indexOf(M),zt=x.indexOf(S),ae=fe=>({width:_[fe]||0,height:x[fe]||0});return{first:ae(0),last:ae(r-1),widest:ae(Kt),highest:ae(zt),widths:_,heights:x}}getLabelForValue(s){return s}getPixelForValue(s,r){return NaN}getValueForPixel(s){}getPixelForTick(s){const r=this.ticks;return s<0||s>r.length-1?null:this.getPixelForValue(r[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);const r=this._startPixel+s*this._length;return Me(this._alignToPixels?or(this.chart,r,0):r,-32768,32767)}getDecimalForPixel(s){const r=(s-this._startPixel)/this._length;return this._reversePixels?1-r:r}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:s,max:r}=this;return s<0&&r<0?r:s>0&&r>0?s:0}getContext(s){const r=this.ticks||[];if(s>=0&&s<r.length){const c=r[s];return c.$context||(c.$context=function(o,s,r){return qe(o,{tick:r,index:s,type:"tick"})}(this.getContext(),s,c))}return this.$context||(this.$context=function(o,s){return qe(o,{scale:s,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const s=this.options.ticks,r=Yi(this.labelRotation),c=Math.abs(Math.cos(r)),f=Math.abs(Math.sin(r)),_=this._getLabelSizes(),x=s.autoSkipPadding||0,M=_?_.widest.width+x:0,S=_?_.highest.height+x:0;return this.isHorizontal()?S*c>M*f?M/c:S/f:S*f<M*c?S/c:M/f}_isVisible(){const s=this.options.display;return"auto"!==s?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){const r=this.axis,c=this.chart,f=this.options,{grid:_,position:x}=f,M=_.offset,S=this.isHorizontal(),L=this.ticks.length+(M?1:0),j=qt(_),q=[],et=_.setContext(this.getContext()),ut=et.drawBorder?et.borderWidth:0,mt=ut/2,wt=function(He){return or(c,He,ut)};let Et,Gt,se,Kt,zt,ae,fe,ge,ce,Xe,Be,We;if("top"===x)Et=wt(this.bottom),ae=this.bottom-j,ge=Et-mt,Xe=wt(s.top)+mt,We=s.bottom;else if("bottom"===x)Et=wt(this.top),Xe=s.top,We=wt(s.bottom)-mt,ae=Et+mt,ge=this.top+j;else if("left"===x)Et=wt(this.right),zt=this.right-j,fe=Et-mt,ce=wt(s.left)+mt,Be=s.right;else if("right"===x)Et=wt(this.left),ce=s.left,Be=wt(s.right)-mt,zt=Et+mt,fe=this.left+j;else if("x"===r){if("center"===x)Et=wt((s.top+s.bottom)/2+.5);else if(ie(x)){const He=Object.keys(x)[0];Et=wt(this.chart.scales[He].getPixelForValue(x[He]))}Xe=s.top,We=s.bottom,ae=Et+mt,ge=ae+j}else if("y"===r){if("center"===x)Et=wt((s.left+s.right)/2);else if(ie(x)){const He=Object.keys(x)[0];Et=wt(this.chart.scales[He].getPixelForValue(x[He]))}zt=Et-mt,fe=zt-j,ce=s.left,Be=s.right}const ci=de(f.ticks.maxTicksLimit,L),Ii=Math.max(1,Math.ceil(L/ci));for(Gt=0;Gt<L;Gt+=Ii){const He=_.setContext(this.getContext(Gt)),oi=He.lineWidth,en=He.color,Fn=_.borderDash||[],ks=He.borderDashOffset,ka=He.tickWidth,Ds=He.tickColor,kl=He.tickBorderDash||[],Dl=He.tickBorderDashOffset;se=It(this,Gt,M),void 0!==se&&(Kt=or(c,se,oi),S?zt=fe=ce=Be=Kt:ae=ge=Xe=We=Kt,q.push({tx1:zt,ty1:ae,tx2:fe,ty2:ge,x1:ce,y1:Xe,x2:Be,y2:We,width:oi,color:en,borderDash:Fn,borderDashOffset:ks,tickWidth:ka,tickColor:Ds,tickBorderDash:kl,tickBorderDashOffset:Dl}))}return this._ticksLength=L,this._borderValue=Et,q}_computeLabelItems(s){const r=this.axis,c=this.options,{position:f,ticks:_}=c,x=this.isHorizontal(),M=this.ticks,{align:S,crossAlign:D,padding:L,mirror:j}=_,q=qt(c.grid),et=q+L,ut=j?-L:et,mt=-Yi(this.labelRotation),wt=[];let Et,Gt,se,Kt,zt,ae,fe,ge,ce,Xe,Be,We,ci="middle";if("top"===f)ae=this.bottom-ut,fe=this._getXAxisLabelAlignment();else if("bottom"===f)ae=this.top+ut,fe=this._getXAxisLabelAlignment();else if("left"===f){const He=this._getYAxisLabelAlignment(q);fe=He.textAlign,zt=He.x}else if("right"===f){const He=this._getYAxisLabelAlignment(q);fe=He.textAlign,zt=He.x}else if("x"===r){if("center"===f)ae=(s.top+s.bottom)/2+et;else if(ie(f)){const He=Object.keys(f)[0];ae=this.chart.scales[He].getPixelForValue(f[He])+et}fe=this._getXAxisLabelAlignment()}else if("y"===r){if("center"===f)zt=(s.left+s.right)/2-et;else if(ie(f)){const He=Object.keys(f)[0];zt=this.chart.scales[He].getPixelForValue(f[He])}fe=this._getYAxisLabelAlignment(q).textAlign}"y"===r&&("start"===S?ci="top":"end"===S&&(ci="bottom"));const Ii=this._getLabelSizes();for(Et=0,Gt=M.length;Et<Gt;++Et){se=M[Et],Kt=se.label;const He=_.setContext(this.getContext(Et));ge=this.getPixelForTick(Et)+_.labelOffset,ce=this._resolveTickFontOptions(Et),Xe=ce.lineHeight,Be=ze(Kt)?Kt.length:1;const oi=Be/2,en=He.color,Fn=He.textStrokeColor,ks=He.textStrokeWidth;let ka;if(x?(zt=ge,We="top"===f?"near"===D||0!==mt?-Be*Xe+Xe/2:"center"===D?-Ii.highest.height/2-oi*Xe+Xe:Xe/2-Ii.highest.height:"near"===D||0!==mt?Xe/2:"center"===D?Ii.highest.height/2-oi*Xe:Ii.highest.height-Be*Xe,j&&(We*=-1)):(ae=ge,We=(1-Be)*Xe/2),He.showLabelBackdrop){const Ds=je(He.backdropPadding),kl=Ii.heights[Et],Dl=Ii.widths[Et];let Vh=ae+We-Ds.top,Uh=zt-Ds.left;switch(ci){case"middle":Vh-=kl/2;break;case"bottom":Vh-=kl}switch(fe){case"center":Uh-=Dl/2;break;case"right":Uh-=Dl}ka={left:Uh,top:Vh,width:Dl+Ds.width,height:kl+Ds.height,color:He.backdropColor}}wt.push({rotation:mt,label:Kt,font:ce,color:en,strokeColor:Fn,strokeWidth:ks,textOffset:We,textAlign:fe,textBaseline:ci,translation:[zt,ae],backdrop:ka})}return wt}_getXAxisLabelAlignment(){const{position:s,ticks:r}=this.options;if(-Yi(this.labelRotation))return"top"===s?"left":"right";let f="center";return"start"===r.align?f="left":"end"===r.align&&(f="right"),f}_getYAxisLabelAlignment(s){const{position:r,ticks:{crossAlign:c,mirror:f,padding:_}}=this.options,M=s+_,S=this._getLabelSizes().widest.width;let D,L;return"left"===r?f?(L=this.right+_,"near"===c?D="left":"center"===c?(D="center",L+=S/2):(D="right",L+=S)):(L=this.right-M,"near"===c?D="right":"center"===c?(D="center",L-=S/2):(D="left",L=this.left)):"right"===r?f?(L=this.left+_,"near"===c?D="right":"center"===c?(D="center",L-=S/2):(D="left",L-=S)):(L=this.left+M,"near"===c?D="left":"center"===c?(D="center",L+=S/2):(D="right",L=this.right)):D="right",{textAlign:D,x:L}}_computeLabelArea(){if(this.options.ticks.mirror)return;const s=this.chart,r=this.options.position;return"left"===r||"right"===r?{top:0,left:this.left,bottom:s.height,right:this.right}:"top"===r||"bottom"===r?{top:this.top,left:0,bottom:this.bottom,right:s.width}:void 0}drawBackground(){const{ctx:s,options:{backgroundColor:r},left:c,top:f,width:_,height:x}=this;r&&(s.save(),s.fillStyle=r,s.fillRect(c,f,_,x),s.restore())}getLineWidthForValue(s){const r=this.options.grid;if(!this._isVisible()||!r.display)return 0;const f=this.ticks.findIndex(_=>_.value===s);return f>=0?r.setContext(this.getContext(f)).lineWidth:0}drawGrid(s){const r=this.options.grid,c=this.ctx,f=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s));let _,x;const M=(S,D,L)=>{!L.width||!L.color||(c.save(),c.lineWidth=L.width,c.strokeStyle=L.color,c.setLineDash(L.borderDash||[]),c.lineDashOffset=L.borderDashOffset,c.beginPath(),c.moveTo(S.x,S.y),c.lineTo(D.x,D.y),c.stroke(),c.restore())};if(r.display)for(_=0,x=f.length;_<x;++_){const S=f[_];r.drawOnChartArea&&M({x:S.x1,y:S.y1},{x:S.x2,y:S.y2},S),r.drawTicks&&M({x:S.tx1,y:S.ty1},{x:S.tx2,y:S.ty2},{color:S.tickColor,width:S.tickWidth,borderDash:S.tickBorderDash,borderDashOffset:S.tickBorderDashOffset})}}drawBorder(){const{chart:s,ctx:r,options:{grid:c}}=this,f=c.setContext(this.getContext()),_=c.drawBorder?f.borderWidth:0;if(!_)return;const x=c.setContext(this.getContext(0)).lineWidth,M=this._borderValue;let S,D,L,j;this.isHorizontal()?(S=or(s,this.left,_)-_/2,D=or(s,this.right,x)+x/2,L=j=M):(L=or(s,this.top,_)-_/2,j=or(s,this.bottom,x)+x/2,S=D=M),r.save(),r.lineWidth=f.borderWidth,r.strokeStyle=f.borderColor,r.beginPath(),r.moveTo(S,L),r.lineTo(D,j),r.stroke(),r.restore()}drawLabels(s){if(!this.options.ticks.display)return;const c=this.ctx,f=this._computeLabelArea();f&&Ia(c,f);const _=this._labelItems||(this._labelItems=this._computeLabelItems(s));let x,M;for(x=0,M=_.length;x<M;++x){const S=_[x],D=S.font,L=S.label;S.backdrop&&(c.fillStyle=S.backdrop.color,c.fillRect(S.backdrop.left,S.backdrop.top,S.backdrop.width,S.backdrop.height)),Nn(c,L,0,S.textOffset,D,S)}f&&Ps(c)}drawTitle(){const{ctx:s,options:{position:r,title:c,reverse:f}}=this;if(!c.display)return;const _=Re(c.font),x=je(c.padding),M=c.align;let S=_.lineHeight/2;"bottom"===r||"center"===r||ie(r)?(S+=x.bottom,ze(c.text)&&(S+=_.lineHeight*(c.text.length-1))):S+=x.top;const{titleX:D,titleY:L,maxWidth:j,rotation:q}=function(o,s,r,c){const{top:f,left:_,bottom:x,right:M,chart:S}=o,{chartArea:D,scales:L}=S;let q,et,ut,j=0;const mt=x-f,wt=M-_;if(o.isHorizontal()){if(et=mi(c,_,M),ie(r)){const Et=Object.keys(r)[0];ut=L[Et].getPixelForValue(r[Et])+mt-s}else ut="center"===r?(D.bottom+D.top)/2+mt-s:pt(o,r,s);q=M-_}else{if(ie(r)){const Et=Object.keys(r)[0];et=L[Et].getPixelForValue(r[Et])-wt+s}else et="center"===r?(D.left+D.right)/2-wt+s:pt(o,r,s);ut=mi(c,x,f),j="left"===r?-Ci:Ci}return{titleX:et,titleY:ut,maxWidth:q,rotation:j}}(this,S,r,M);Nn(s,c.text,0,0,_,{color:c.color,maxWidth:j,rotation:q,textAlign:Zt(M,r,f),textBaseline:"middle",translation:[D,L]})}draw(s){!this._isVisible()||(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){const s=this.options,r=s.ticks&&s.ticks.z||0,c=de(s.grid&&s.grid.z,-1);return this._isVisible()&&this.draw===xe.prototype.draw?[{z:c,draw:f=>{this.drawBackground(),this.drawGrid(f),this.drawTitle()}},{z:c+1,draw:()=>{this.drawBorder()}},{z:r,draw:f=>{this.drawLabels(f)}}]:[{z:r,draw:f=>{this.draw(f)}}]}getMatchingVisibleMetas(s){const r=this.chart.getSortedVisibleDatasetMetas(),c=this.axis+"AxisID",f=[];let _,x;for(_=0,x=r.length;_<x;++_){const M=r[_];M[c]===this.id&&(!s||M.type===s)&&f.push(M)}return f}_resolveTickFontOptions(s){return Re(this.options.ticks.setContext(this.getContext(s)).font)}_maxDigits(){const s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}}class Ae{constructor(s,r,c){this.type=s,this.scope=r,this.override=c,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){const r=Object.getPrototypeOf(s);let c;var o;"id"in(o=r)&&"defaults"in o&&(c=this.register(r));const f=this.items,_=s.id,x=this.scope+"."+_;if(!_)throw new Error("class does not have id: "+s);return _ in f||(f[_]=s,function(o,s,r){const c=di(Object.create(null),[r?ri.get(r):{},ri.get(s),o.defaults]);ri.set(s,c),o.defaultRoutes&&function(o,s){Object.keys(s).forEach(r=>{const c=r.split("."),f=c.pop(),_=[o].concat(c).join("."),x=s[r].split("."),M=x.pop(),S=x.join(".");ri.route(_,f,S,M)})}(s,o.defaultRoutes),o.descriptors&&ri.describe(s,o.descriptors)}(s,x,c),this.override&&ri.override(s.id,s.overrides)),x}get(s){return this.items[s]}unregister(s){const r=this.items,c=s.id,f=this.scope;c in r&&delete r[c],f&&c in ri[f]&&(delete ri[f][c],this.override&&delete Hi[c])}}var si=new class{constructor(){this.controllers=new Ae(Sr,"datasets",!0),this.elements=new Ae(O,"elements"),this.plugins=new Ae(Object,"plugins"),this.scales=new Ae(xe,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,r,c){[...r].forEach(f=>{const _=c||this._getRegistryForType(f);c||_.isForType(f)||_===this.plugins&&f.id?this._exec(s,_,f):ke(f,x=>{const M=c||this._getRegistryForType(x);this._exec(s,M,x)})})}_exec(s,r,c){const f=Mn(s);Ke(c["before"+f],[],c),r[s](c),Ke(c["after"+f],[],c)}_getRegistryForType(s){for(let r=0;r<this._typedRegistries.length;r++){const c=this._typedRegistries[r];if(c.isForType(s))return c}return this.plugins}_get(s,r,c){const f=r.get(s);if(void 0===f)throw new Error('"'+s+'" is not a registered '+c+".");return f}};class ki{constructor(){this._init=[]}notify(s,r,c,f){"beforeInit"===r&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install"));const _=f?this._descriptors(s).filter(f):this._descriptors(s),x=this._notify(_,s,r,c);return"afterDestroy"===r&&(this._notify(_,s,"stop"),this._notify(this._init,s,"uninstall")),x}_notify(s,r,c,f){f=f||{};for(const _ of s){const x=_.plugin;if(!1===Ke(x[c],[r,f,_.options],x)&&f.cancelable)return!1}return!0}invalidate(){Le(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;const r=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),r}_createDescriptors(s,r){const c=s&&s.config,f=de(c.options&&c.options.plugins,{}),_=function(o){const s=[],r=Object.keys(si.plugins.items);for(let f=0;f<r.length;f++)s.push(si.getPlugin(r[f]));const c=o.plugins||[];for(let f=0;f<c.length;f++){const _=c[f];-1===s.indexOf(_)&&s.push(_)}return s}(c);return!1!==f||r?function(o,s,r,c){const f=[],_=o.getContext();for(let x=0;x<s.length;x++){const M=s[x],D=ti(r[M.id],c);null!==D&&f.push({plugin:M,options:cn(o.config,M,D,_)})}return f}(s,_,f,r):[]}_notifyStateChanges(s){const r=this._oldCache||[],c=this._cache,f=(_,x)=>_.filter(M=>!x.some(S=>M.plugin.id===S.plugin.id));this._notify(f(r,c),s,"stop"),this._notify(f(c,r),s,"start")}}function ti(o,s){return s||!1!==o?!0===o?{}:o:null}function cn(o,s,r,c){const f=o.pluginScopeKeys(s),_=o.getOptionScopes(r,f);return o.createResolver(_,c,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Dn(o,s){return((s.datasets||{})[o]||{}).indexAxis||s.indexAxis||(ri.datasets[o]||{}).indexAxis||"x"}function Ze(o,s){return"x"===o||"y"===o?o:s.axis||function(o){return"top"===o||"bottom"===o?"x":"left"===o||"right"===o?"y":void 0}(s.position)||o.charAt(0).toLowerCase()}function qi(o){const s=o.options||(o.options={});s.plugins=de(s.plugins,{}),s.scales=function(o,s){const r=Hi[o.type]||{scales:{}},c=s.scales||{},f=Dn(o.type,s),_=Object.create(null),x=Object.create(null);return Object.keys(c).forEach(M=>{const S=c[M];if(!ie(S))return console.error(`Invalid scale configuration for scale: ${M}`);if(S._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${M}`);const D=Ze(M,S),L=function(o,s){return o===s?"_index_":"_value_"}(D,f),j=r.scales||{};_[D]=_[D]||M,x[M]=Ti(Object.create(null),[{axis:D},S,j[D],j[L]])}),o.data.datasets.forEach(M=>{const S=M.type||o.type,D=M.indexAxis||Dn(S,s),j=(Hi[S]||{}).scales||{};Object.keys(j).forEach(q=>{const et=function(o,s){let r=o;return"_index_"===o?r=s:"_value_"===o&&(r="x"===s?"y":"x"),r}(q,D),ut=M[et+"AxisID"]||_[et]||et;x[ut]=x[ut]||Object.create(null),Ti(x[ut],[{axis:et},c[ut],j[q]])})}),Object.keys(x).forEach(M=>{const S=x[M];Ti(S,[ri.scales[S.type],ri.scale])}),x}(o,s)}function Zn(o){return(o=o||{}).datasets=o.datasets||[],o.labels=o.labels||[],o}const $n=new Map,ya=new Set;function bn(o,s){let r=$n.get(o);return r||(r=s(),$n.set(o,r),ya.add(r)),r}const Er=(o,s,r)=>{const c=Ki(s,r);void 0!==c&&o.add(c)};class ve{constructor(s){var o;this._config=((o=(o=s)||{}).data=Zn(o.data),qi(o),o),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=Zn(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){const s=this._config;this.clearCache(),qi(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return bn(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,r){return bn(`${s}.transition.${r}`,()=>[[`datasets.${s}.transitions.${r}`,`transitions.${r}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,r){return bn(`${s}-${r}`,()=>[[`datasets.${s}.elements.${r}`,`datasets.${s}`,`elements.${r}`,""]])}pluginScopeKeys(s){const r=s.id;return bn(`${this.type}-plugin-${r}`,()=>[[`plugins.${r}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,r){const c=this._scopeCache;let f=c.get(s);return(!f||r)&&(f=new Map,c.set(s,f)),f}getOptionScopes(s,r,c){const{options:f,type:_}=this,x=this._cachedScopes(s,c),M=x.get(r);if(M)return M;const S=new Set;r.forEach(L=>{s&&(S.add(s),L.forEach(j=>Er(S,s,j))),L.forEach(j=>Er(S,f,j)),L.forEach(j=>Er(S,Hi[_]||{},j)),L.forEach(j=>Er(S,ri,j)),L.forEach(j=>Er(S,Un,j))});const D=Array.from(S);return 0===D.length&&D.push(Object.create(null)),ya.has(r)&&x.set(r,D),D}chartOptionScopes(){const{options:s,type:r}=this;return[s,Hi[r]||{},ri.datasets[r]||{},{type:r},ri,Un]}resolveNamedOptions(s,r,c,f=[""]){const _={$shared:!0},{resolver:x,subPrefixes:M}=Ee(this._resolverCache,s,f);let S=x;(function(o,s){const{isScriptable:r,isIndexable:c}=Rs(o);for(const f of s){const _=r(f),x=c(f),M=(x||_)&&o[f];if(_&&(hn(M)||_n(M))||x&&ze(M))return!0}return!1})(x,r)&&(_.$shared=!1,S=wr(x,c=hn(c)?c():c,this.createResolver(s,c,M)));for(const D of r)_[D]=S[D];return _}createResolver(s,r,c=[""],f){const{resolver:_}=Ee(this._resolverCache,s,c);return ie(r)?wr(_,r,void 0,f):_}}function Ee(o,s,r){let c=o.get(s);c||(c=new Map,o.set(s,c));const f=r.join();let _=c.get(f);return _||(_={resolver:cs(s,r),subPrefixes:r.filter(M=>!M.toLowerCase().includes("hover"))},c.set(f,_)),_}const _n=o=>ie(o)&&Object.getOwnPropertyNames(o).reduce((s,r)=>s||hn(o[r]),!1),wn=["top","bottom","left","right","chartArea"];function qh(o,s){return"top"===o||"bottom"===o||-1===wn.indexOf(o)&&"x"===s}function od(o,s){return function(r,c){return r[o]===c[o]?r[s]-c[s]:r[o]-c[o]}}function ol(o){const s=o.chart,r=s.options.animation;s.notifyPlugins("afterRender"),Ke(r&&r.onComplete,[o],s)}function sn(o){const s=o.chart,r=s.options.animation;Ke(r&&r.onProgress,[o],s)}function Zi(o){return Ro()&&"string"==typeof o?o=document.getElementById(o):o&&o.length&&(o=o[0]),o&&o.canvas&&(o=o.canvas),o}const Hl={},mo=o=>{const s=Zi(o);return Object.values(Hl).filter(r=>r.canvas===s).pop()};function ll(o,s,r){const c=Object.keys(o);for(const f of c){const _=+f;if(_>=s){const x=o[f];delete o[f],(r>0||_>s)&&(o[_+r]=x)}}}class bs{constructor(s,r){const c=this.config=new ve(r),f=Zi(s),_=mo(f);if(_)throw new Error("Canvas is already in use. Chart with ID '"+_.id+"' must be destroyed before the canvas can be reused.");const x=c.createResolver(c.chartOptionScopes(),this.getContext());var o;this.platform=new(c.platform||(o=f,!Ro()||"undefined"!=typeof OffscreenCanvas&&o instanceof OffscreenCanvas?Hh:z)),this.platform.updateConfig(c);const M=this.platform.acquireContext(f,x.aspectRatio),S=M&&M.canvas,D=S&&S.height,L=S&&S.width;this.id=Pt(),this.ctx=M,this.canvas=S,this.width=L,this.height=D,this._options=x,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new ki,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(o,s){let r;return function(...c){return s?(clearTimeout(r),r=setTimeout(o,s,c)):o.apply(this,c),s}}(j=>this.update(j),x.resizeDelay||0),this._dataChanges=[],Hl[this.id]=this,M&&S?(ur.listen(this,"complete",ol),ur.listen(this,"progress",sn),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:s,maintainAspectRatio:r},width:c,height:f,_aspectRatio:_}=this;return Le(s)?r&&_?_:f?c/f:null:s}get data(){return this.config.data}set data(s){this.config.data=s}get options(){return this._options}set options(s){this.config.options=s}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ha(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Is(this.canvas,this.ctx),this}stop(){return ur.stop(this),this}resize(s,r){ur.running(this)?this._resizeBeforeDraw={width:s,height:r}:this._resize(s,r)}_resize(s,r){const c=this.options,x=this.platform.getMaximumSize(this.canvas,s,r,c.maintainAspectRatio&&this.aspectRatio),M=c.devicePixelRatio||this.platform.getDevicePixelRatio(),S=this.width?"resize":"attach";this.width=x.width,this.height=x.height,this._aspectRatio=this.aspectRatio,ha(this,M,!0)&&(this.notifyPlugins("resize",{size:x}),Ke(c.onResize,[this,x],this),this.attached&&this._doResize(S)&&this.render())}ensureScalesHaveIDs(){ke(this.options.scales||{},(c,f)=>{c.id=f})}buildOrUpdateScales(){const s=this.options,r=s.scales,c=this.scales,f=Object.keys(c).reduce((x,M)=>(x[M]=!1,x),{});let _=[];r&&(_=_.concat(Object.keys(r).map(x=>{const M=r[x],S=Ze(x,M),D="r"===S,L="x"===S;return{options:M,dposition:D?"chartArea":L?"bottom":"left",dtype:D?"radialLinear":L?"category":"linear"}}))),ke(_,x=>{const M=x.options,S=M.id,D=Ze(S,M),L=de(M.type,x.dtype);(void 0===M.position||qh(M.position,D)!==qh(x.dposition))&&(M.position=x.dposition),f[S]=!0;let j=null;S in c&&c[S].type===L?j=c[S]:(j=new(si.getScale(L))({id:S,type:L,ctx:this.ctx,chart:this}),c[j.id]=j),j.init(M,s)}),ke(f,(x,M)=>{x||delete c[M]}),ke(c,x=>{En.configure(this,x,x.options),En.addBox(this,x)})}_updateMetasets(){const s=this._metasets,r=this.data.datasets.length,c=s.length;if(s.sort((f,_)=>f.index-_.index),c>r){for(let f=r;f<c;++f)this._destroyDatasetMeta(f);s.splice(r,c-r)}this._sortedMetasets=s.slice(0).sort(od("order","index"))}_removeUnreferencedMetasets(){const{_metasets:s,data:{datasets:r}}=this;s.length>r.length&&delete this._stacks,s.forEach((c,f)=>{0===r.filter(_=>_===c._dataset).length&&this._destroyDatasetMeta(f)})}buildOrUpdateControllers(){const s=[],r=this.data.datasets;let c,f;for(this._removeUnreferencedMetasets(),c=0,f=r.length;c<f;c++){const _=r[c];let x=this.getDatasetMeta(c);const M=_.type||this.config.type;if(x.type&&x.type!==M&&(this._destroyDatasetMeta(c),x=this.getDatasetMeta(c)),x.type=M,x.indexAxis=_.indexAxis||Dn(M,this.options),x.order=_.order||0,x.index=c,x.label=""+_.label,x.visible=this.isDatasetVisible(c),x.controller)x.controller.updateIndex(c),x.controller.linkScales();else{const S=si.getController(M),{datasetElementType:D,dataElementType:L}=ri.datasets[M];Object.assign(S.prototype,{dataElementType:si.getElement(L),datasetElementType:D&&si.getElement(D)}),x.controller=new S(this,c),s.push(x.controller)}}return this._updateMetasets(),s}_resetElements(){ke(this.data.datasets,(s,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(s){const r=this.config;r.update();const c=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),f=this._animationsDisabled=!c.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:s,cancelable:!0}))return;const _=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let x=0;for(let D=0,L=this.data.datasets.length;D<L;D++){const{controller:j}=this.getDatasetMeta(D),q=!f&&-1===_.indexOf(j);j.buildOrUpdateElements(q),x=Math.max(+j.getMaxOverflow(),x)}x=this._minPadding=c.layout.autoPadding?x:0,this._updateLayout(x),f||ke(_,D=>{D.reset()}),this._updateDatasets(s),this.notifyPlugins("afterUpdate",{mode:s}),this._layers.sort(od("z","_idx"));const{_active:M,_lastEvent:S}=this;S?this._eventHandler(S,!0):M.length&&this._updateHoverStyles(M,M,!0),this.render()}_updateScales(){ke(this.scales,s=>{En.removeBox(this,s)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const s=this.options,r=new Set(Object.keys(this._listeners)),c=new Set(s.events);(!on(r,c)||!!this._responsiveListeners!==s.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:s}=this,r=this._getUniformDataChanges()||[];for(const{method:c,start:f,count:_}of r)ll(s,f,"_removeElements"===c?-_:_)}_getUniformDataChanges(){const s=this._dataChanges;if(!s||!s.length)return;this._dataChanges=[];const r=this.data.datasets.length,c=_=>new Set(s.filter(x=>x[0]===_).map((x,M)=>M+","+x.splice(1).join(","))),f=c(0);for(let _=1;_<r;_++)if(!on(f,c(_)))return;return Array.from(f).map(_=>_.split(",")).map(_=>({method:_[1],start:+_[2],count:+_[3]}))}_updateLayout(s){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;En.update(this,this.width,this.height,s);const r=this.chartArea,c=r.width<=0||r.height<=0;this._layers=[],ke(this.boxes,f=>{c&&"chartArea"===f.position||(f.configure&&f.configure(),this._layers.push(...f._layers()))},this),this._layers.forEach((f,_)=>{f._idx=_}),this.notifyPlugins("afterLayout")}_updateDatasets(s){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:s,cancelable:!0})){for(let r=0,c=this.data.datasets.length;r<c;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,c=this.data.datasets.length;r<c;++r)this._updateDataset(r,hn(s)?s({datasetIndex:r}):s);this.notifyPlugins("afterDatasetsUpdate",{mode:s})}}_updateDataset(s,r){const c=this.getDatasetMeta(s),f={meta:c,index:s,mode:r,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",f)&&(c.controller._update(r),f.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",f))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(ur.has(this)?this.attached&&!ur.running(this)&&ur.start(this):(this.draw(),ol({chart:this})))}draw(){let s;if(this._resizeBeforeDraw){const{width:c,height:f}=this._resizeBeforeDraw;this._resize(c,f),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const r=this._layers;for(s=0;s<r.length&&r[s].z<=0;++s)r[s].draw(this.chartArea);for(this._drawDatasets();s<r.length;++s)r[s].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(s){const r=this._sortedMetasets,c=[];let f,_;for(f=0,_=r.length;f<_;++f){const x=r[f];(!s||x.visible)&&c.push(x)}return c}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const s=this.getSortedVisibleDatasetMetas();for(let r=s.length-1;r>=0;--r)this._drawDataset(s[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(s){const r=this.ctx,c=s._clip,f=!c.disabled,_=this.chartArea,x={meta:s,index:s.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",x)&&(f&&Ia(r,{left:!1===c.left?0:_.left-c.left,right:!1===c.right?this.width:_.right+c.right,top:!1===c.top?0:_.top-c.top,bottom:!1===c.bottom?this.height:_.bottom+c.bottom}),s.controller.draw(),f&&Ps(r),x.cancelable=!1,this.notifyPlugins("afterDatasetDraw",x))}getElementsAtEventForMode(s,r,c,f){const _=Zc.modes[r];return"function"==typeof _?_(this,s,c,f):[]}getDatasetMeta(s){const r=this.data.datasets[s],c=this._metasets;let f=c.filter(_=>_&&_._dataset===r).pop();return f||(f={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:s,_dataset:r,_parsed:[],_sorted:!1},c.push(f)),f}getContext(){return this.$context||(this.$context=qe(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(s){const r=this.data.datasets[s];if(!r)return!1;const c=this.getDatasetMeta(s);return"boolean"==typeof c.hidden?!c.hidden:!r.hidden}setDatasetVisibility(s,r){this.getDatasetMeta(s).hidden=!r}toggleDataVisibility(s){this._hiddenIndices[s]=!this._hiddenIndices[s]}getDataVisibility(s){return!this._hiddenIndices[s]}_updateVisibility(s,r,c){const f=c?"show":"hide",_=this.getDatasetMeta(s),x=_.controller._resolveAnimations(void 0,f);Ne(r)?(_.data[r].hidden=!c,this.update()):(this.setDatasetVisibility(s,c),x.update(_,{visible:c}),this.update(M=>M.datasetIndex===s?f:void 0))}hide(s,r){this._updateVisibility(s,r,!1)}show(s,r){this._updateVisibility(s,r,!0)}_destroyDatasetMeta(s){const r=this._metasets[s];r&&r.controller&&r.controller._destroy(),delete this._metasets[s]}_stop(){let s,r;for(this.stop(),ur.remove(this),s=0,r=this.data.datasets.length;s<r;++s)this._destroyDatasetMeta(s)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:s,ctx:r}=this;this._stop(),this.config.clearCache(),s&&(this.unbindEvents(),Is(s,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete Hl[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...s){return this.canvas.toDataURL(...s)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const s=this._listeners,r=this.platform,c=(_,x)=>{r.addEventListener(this,_,x),s[_]=x},f=(_,x,M)=>{_.offsetX=x,_.offsetY=M,this._eventHandler(_)};ke(this.options.events,_=>c(_,f))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const s=this._responsiveListeners,r=this.platform,c=(S,D)=>{r.addEventListener(this,S,D),s[S]=D},f=(S,D)=>{s[S]&&(r.removeEventListener(this,S,D),delete s[S])},_=(S,D)=>{this.canvas&&this.resize(S,D)};let x;const M=()=>{f("attach",M),this.attached=!0,this.resize(),c("resize",_),c("detach",x)};x=()=>{this.attached=!1,f("resize",_),this._stop(),this._resize(0,0),c("attach",M)},r.isAttached(this.canvas)?M():x()}unbindEvents(){ke(this._listeners,(s,r)=>{this.platform.removeEventListener(this,r,s)}),this._listeners={},ke(this._responsiveListeners,(s,r)=>{this.platform.removeEventListener(this,r,s)}),this._responsiveListeners=void 0}updateHoverStyle(s,r,c){const f=c?"set":"remove";let _,x,M,S;for("dataset"===r&&(_=this.getDatasetMeta(s[0].datasetIndex),_.controller["_"+f+"DatasetHoverStyle"]()),M=0,S=s.length;M<S;++M){x=s[M];const D=x&&this.getDatasetMeta(x.datasetIndex).controller;D&&D[f+"HoverStyle"](x.element,x.datasetIndex,x.index)}}getActiveElements(){return this._active||[]}setActiveElements(s){const r=this._active||[],c=s.map(({datasetIndex:_,index:x})=>{const M=this.getDatasetMeta(_);if(!M)throw new Error("No dataset found at index "+_);return{datasetIndex:_,element:M.data[x],index:x}});!De(c,r)&&(this._active=c,this._lastEvent=null,this._updateHoverStyles(c,r))}notifyPlugins(s,r,c){return this._plugins.notify(this,s,r,c)}_updateHoverStyles(s,r,c){const f=this.options.hover,_=(S,D)=>S.filter(L=>!D.some(j=>L.datasetIndex===j.datasetIndex&&L.index===j.index)),x=_(r,s),M=c?s:_(s,r);x.length&&this.updateHoverStyle(x,f.mode,!1),M.length&&f.mode&&this.updateHoverStyle(M,f.mode,!0)}_eventHandler(s,r){const c={event:s,replay:r,cancelable:!0,inChartArea:as(s,this.chartArea,this._minPadding)},f=x=>(x.options.events||this.options.events).includes(s.native.type);if(!1===this.notifyPlugins("beforeEvent",c,f))return;const _=this._handleEvent(s,r,c.inChartArea);return c.cancelable=!1,this.notifyPlugins("afterEvent",c,f),(_||c.changed)&&this.render(),this}_handleEvent(s,r,c){const{_active:f=[],options:_}=this,M=this._getActiveElements(s,f,c,r),S="mouseup"===(o=s).type||"click"===o.type||"contextmenu"===o.type,D=function(o,s,r,c){return r&&"mouseout"!==o.type?c?s:o:null}(s,this._lastEvent,c,S);var o;c&&(this._lastEvent=null,Ke(_.onHover,[s,M,this],this),S&&Ke(_.onClick,[s,M,this],this));const L=!De(M,f);return(L||r)&&(this._active=M,this._updateHoverStyles(M,f,r)),this._lastEvent=D,L}_getActiveElements(s,r,c,f){if("mouseout"===s.type)return[];if(!c)return r;const _=this.options.hover;return this.getElementsAtEventForMode(s,_.mode,_,f)}}const Gs=()=>ke(bs.instances,o=>o._plugins.invalidate()),Qr=!0;function qc(o,s,r){const{startAngle:c,pixelMargin:f,x:_,y:x,outerRadius:M,innerRadius:S}=s;let D=f/M;o.beginPath(),o.arc(_,x,M,c-D,r+D),S>f?(D=f/S,o.arc(_,x,S,r+D,c-D,!0)):o.arc(_,x,f,r+Ci,c-Ci),o.closePath(),o.clip()}function Zs(o,s,r,c){return{x:r+o*Math.cos(s),y:c+o*Math.sin(s)}}function ql(o,s,r,c,f){const{x:_,y:x,startAngle:M,pixelMargin:S,innerRadius:D}=s,L=Math.max(s.outerRadius+c+r-S,0),j=D>0?D+c+r+S:0;let q=0;const et=f-M;if(c){const Fn=((D>0?D-c:0)+(L>0?L-c:0))/2;q=(et-(0!==Fn?et*Fn/(Fn+c):et))/2}const mt=(et-Math.max(.001,et*L-r/Ai)/L)/2,wt=M+mt+q,Et=f-mt-q,{outerStart:Gt,outerEnd:se,innerStart:Kt,innerEnd:zt}=function(o,s,r,c){const f=function(o){return sa(o,["outerStart","outerEnd","innerStart","innerEnd"])}(o.options.borderRadius),_=(r-s)/2,x=Math.min(_,c*s/2),M=S=>{const D=(r-Math.min(_,S))*c/2;return Me(S,0,Math.min(_,D))};return{outerStart:M(f.outerStart),outerEnd:M(f.outerEnd),innerStart:Me(f.innerStart,0,x),innerEnd:Me(f.innerEnd,0,x)}}(s,j,L,Et-wt),ae=L-Gt,fe=L-se,ge=wt+Gt/ae,ce=Et-se/fe,Xe=j+Kt,Be=j+zt,We=wt+Kt/Xe,ci=Et-zt/Be;if(o.beginPath(),o.arc(_,x,L,ge,ce),se>0){const oi=Zs(fe,ce,_,x);o.arc(oi.x,oi.y,se,ce,Et+Ci)}const Ii=Zs(Be,Et,_,x);if(o.lineTo(Ii.x,Ii.y),zt>0){const oi=Zs(Be,ci,_,x);o.arc(oi.x,oi.y,zt,Et+Ci,ci+Math.PI)}if(o.arc(_,x,j,Et-zt/j,wt+Kt/j,!0),Kt>0){const oi=Zs(Xe,We,_,x);o.arc(oi.x,oi.y,Kt,We+Math.PI,wt-Ci)}const He=Zs(ae,wt,_,x);if(o.lineTo(He.x,He.y),Gt>0){const oi=Zs(ae,ge,_,x);o.arc(oi.x,oi.y,Gt,wt-Ci,ge)}o.closePath()}Object.defineProperties(bs,{defaults:{enumerable:Qr,value:ri},instances:{enumerable:Qr,value:Hl},overrides:{enumerable:Qr,value:Hi},registry:{enumerable:Qr,value:si},version:{enumerable:Qr,value:"3.7.1"},getChart:{enumerable:Qr,value:mo},register:{enumerable:Qr,value:(...o)=>{si.add(...o),Gs()}},unregister:{enumerable:Qr,value:(...o)=>{si.remove(...o),Gs()}}});class _o extends O{constructor(s){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,s&&Object.assign(this,s)}inRange(s,r,c){const f=this.getProps(["x","y"],c),{angle:_,distance:x}=he(f,{x:s,y:r}),{startAngle:M,endAngle:S,innerRadius:D,outerRadius:L,circumference:j}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],c),q=this.options.spacing/2,ut=de(j,S-M)>=_i||ii(_,M,S),mt=Ji(x,D+q,L+q);return ut&&mt}getCenterPoint(s){const{x:r,y:c,startAngle:f,endAngle:_,innerRadius:x,outerRadius:M}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],s),{offset:S,spacing:D}=this.options,L=(f+_)/2,j=(x+M+D+S)/2;return{x:r+Math.cos(L)*j,y:c+Math.sin(L)*j}}tooltipPosition(s){return this.getCenterPoint(s)}draw(s){const{options:r,circumference:c}=this,f=(r.offset||0)/2,_=(r.spacing||0)/2;if(this.pixelMargin="inner"===r.borderAlign?.33:0,this.fullCircles=c>_i?Math.floor(c/_i):0,0===c||this.innerRadius<0||this.outerRadius<0)return;s.save();let x=0;if(f){x=f/2;const S=(this.startAngle+this.endAngle)/2;s.translate(Math.cos(S)*x,Math.sin(S)*x),this.circumference>=Ai&&(x=f)}s.fillStyle=r.backgroundColor,s.strokeStyle=r.borderColor;const M=function(o,s,r,c){const{fullCircles:f,startAngle:_,circumference:x}=s;let M=s.endAngle;if(f){ql(o,s,r,c,_+_i);for(let S=0;S<f;++S)o.fill();isNaN(x)||(M=_+x%_i,x%_i==0&&(M+=_i))}return ql(o,s,r,c,M),o.fill(),M}(s,this,x,_);(function(o,s,r,c,f){const{options:_}=s,{borderWidth:x,borderJoinStyle:M}=_,S="inner"===_.borderAlign;!x||(S?(o.lineWidth=2*x,o.lineJoin=M||"round"):(o.lineWidth=x,o.lineJoin=M||"bevel"),s.fullCircles&&function(o,s,r){const{x:c,y:f,startAngle:_,pixelMargin:x,fullCircles:M}=s,S=Math.max(s.outerRadius-x,0),D=s.innerRadius+x;let L;for(r&&qc(o,s,_+_i),o.beginPath(),o.arc(c,f,D,_+_i,_,!0),L=0;L<M;++L)o.stroke();for(o.beginPath(),o.arc(c,f,S,_,_+_i),L=0;L<M;++L)o.stroke()}(o,s,S),S&&qc(o,s,f),ql(o,s,r,c,f),o.stroke())})(s,this,x,_,M),s.restore()}}function Wl(o,s,r=s){o.lineCap=de(r.borderCapStyle,s.borderCapStyle),o.setLineDash(de(r.borderDash,s.borderDash)),o.lineDashOffset=de(r.borderDashOffset,s.borderDashOffset),o.lineJoin=de(r.borderJoinStyle,s.borderJoinStyle),o.lineWidth=de(r.borderWidth,s.borderWidth),o.strokeStyle=de(r.borderColor,s.borderColor)}function Qh(o,s,r){o.lineTo(r.x,r.y)}function Wc(o,s,r={}){const c=o.length,{start:f=0,end:_=c-1}=r,{start:x,end:M}=s,S=Math.max(f,x),D=Math.min(_,M);return{count:c,start:S,loop:s.loop,ilen:D<S&&!(f<x&&_<x||f>M&&_>M)?c+D-S:D-S}}function xa(o,s,r,c){const{points:f,options:_}=s,{count:x,start:M,loop:S,ilen:D}=Wc(f,r,c),L=function(o){return o.stepped?os:o.tension||"monotone"===o.cubicInterpolationMode?Do:Qh}(_);let et,ut,mt,{move:j=!0,reverse:q}=c||{};for(et=0;et<=D;++et)ut=f[(M+(q?D-et:et))%x],!ut.skip&&(j?(o.moveTo(ut.x,ut.y),j=!1):L(o,mt,ut,q,_.stepped),mt=ut);return S&&(ut=f[(M+(q?D:0))%x],L(o,mt,ut,q,_.stepped)),!!S}function Yc(o,s,r,c){const f=s.points,{count:_,start:x,ilen:M}=Wc(f,r,c),{move:S=!0,reverse:D}=c||{};let q,et,ut,mt,wt,Et,L=0,j=0;const Gt=Kt=>(x+(D?M-Kt:Kt))%_,se=()=>{mt!==wt&&(o.lineTo(L,wt),o.lineTo(L,mt),o.lineTo(L,Et))};for(S&&(et=f[Gt(0)],o.moveTo(et.x,et.y)),q=0;q<=M;++q){if(et=f[Gt(q)],et.skip)continue;const Kt=et.x,zt=et.y,ae=0|Kt;ae===ut?(zt<mt?mt=zt:zt>wt&&(wt=zt),L=(j*L+Kt)/++j):(se(),o.lineTo(Kt,zt),ut=ae,j=0,mt=wt=zt),Et=zt}se()}function cl(o){const s=o.options;return o._decimated||o._loop||s.tension||"monotone"===s.cubicInterpolationMode||s.stepped||s.borderDash&&s.borderDash.length?xa:Yc}_o.id="arc",_o.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0},_o.defaultRoutes={backgroundColor:"backgroundColor"};const cd="function"==typeof Path2D;let hl=(()=>{class o extends O{constructor(r){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,r&&Object.assign(this,r)}updateControlPoints(r,c){const f=this.options;!f.tension&&"monotone"!==f.cubicInterpolationMode||f.stepped||this._pointsUpdated||(Cc(this._points,f,r,f.spanGaps?this._loop:this._fullLoop,c),this._pointsUpdated=!0)}set points(r){this._points=r,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(o,s){const r=o.points,c=o.options.spanGaps,f=r.length;if(!f)return[];const _=!!o._loop,{start:x,end:M}=function(o,s,r,c){let f=0,_=s-1;if(r&&!c)for(;f<s&&!o[f].skip;)f++;for(;f<s&&o[f].skip;)f++;for(f%=s,r&&(_+=f);_>f&&o[_%s].skip;)_--;return _%=s,{start:f,end:_}}(r,f,_,c);return function(o,s,r,c){return c&&c.setContext&&r?function(o,s,r,c){const f=o._chart.getContext(),_=da(o.options),{_datasetIndex:x,options:{spanGaps:M}}=o,S=r.length,D=[];let L=_,j=s[0].start,q=j;function et(ut,mt,wt,Et){const Gt=M?-1:1;if(ut!==mt){for(ut+=S;r[ut%S].skip;)ut-=Gt;for(;r[mt%S].skip;)mt+=Gt;ut%S!=mt%S&&(D.push({start:ut%S,end:mt%S,loop:wt,style:Et}),L=Et,j=mt%S)}}for(const ut of s){j=M?j:ut.start;let wt,mt=r[j%S];for(q=j+1;q<=ut.end;q++){const Et=r[q%S];wt=da(c.setContext(qe(f,{type:"segment",p0:mt,p1:Et,p0DataIndex:(q-1)%S,p1DataIndex:q%S,datasetIndex:x}))),Lc(wt,L)&&et(j,q-1,ut.loop,L),mt=Et,L=wt}j<q-1&&et(j,q-1,ut.loop,L)}return D}(o,s,r,c):s}(o,!0===c?[{start:x,end:M,loop:_}]:function(o,s,r,c){const f=o.length,_=[];let S,x=s,M=o[s];for(S=s+1;S<=r;++S){const D=o[S%f];D.skip||D.stop?M.skip||(_.push({start:s%f,end:(S-1)%f,loop:c=!1}),s=x=D.stop?S:null):(x=S,M.skip&&(s=S)),M=D}return null!==x&&_.push({start:s%f,end:x%f,loop:c}),_}(r,x,M<x?M+f:M,!!o._fullLoop&&0===x&&M===f-1),r,s)}(this,this.options.segment))}first(){const r=this.segments;return r.length&&this.points[r[0].start]}last(){const r=this.segments,f=r.length;return f&&this.points[r[f-1].end]}interpolate(r,c){const f=this.options,_=r[c],x=this.points,M=Za(this,{property:c,start:_,end:_});if(!M.length)return;const S=[],D=function(o){return o.stepped?Fo:o.tension||"monotone"===o.cubicInterpolationMode?Ua:Vr}(f);let L,j;for(L=0,j=M.length;L<j;++L){const{start:q,end:et}=M[L],ut=x[q],mt=x[et];if(ut===mt){S.push(ut);continue}const Et=D(ut,mt,Math.abs((_-ut[c])/(mt[c]-ut[c])),f.stepped);Et[c]=r[c],S.push(Et)}return 1===S.length?S[0]:S}pathSegment(r,c,f){return cl(this)(r,this,c,f)}path(r,c,f){const _=this.segments,x=cl(this);let M=this._loop;c=c||0,f=f||this.points.length-c;for(const S of _)M&=x(r,this,S,{start:c,end:c+f-1});return!!M}draw(r,c,f,_){(this.points||[]).length&&(this.options||{}).borderWidth&&(r.save(),function(o,s,r,c){cd&&!s.options.segment?function(o,s,r,c){let f=s._path;f||(f=s._path=new Path2D,s.path(f,r,c)&&f.closePath()),Wl(o,s.options),o.stroke(f)}(o,s,r,c):function(o,s,r,c){const{segments:f,options:_}=s,x=cl(s);for(const M of f)Wl(o,_,M.style),o.beginPath(),x(o,s,M,{start:r,end:r+c-1})&&o.closePath(),o.stroke()}(o,s,r,c)}(r,this,f,_),r.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return o.id="line",o.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},o.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},o.descriptors={_scriptable:!0,_indexable:s=>"borderDash"!==s&&"fill"!==s},o})();function iu(o,s,r,c){const f=o.options,{[r]:_}=o.getProps([r],c);return Math.abs(s-_)<f.radius+f.hitRadius}let nu=(()=>{class o extends O{constructor(r){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,r&&Object.assign(this,r)}inRange(r,c,f){const _=this.options,{x,y:M}=this.getProps(["x","y"],f);return Math.pow(r-x,2)+Math.pow(c-M,2)<Math.pow(_.hitRadius+_.radius,2)}inXRange(r,c){return iu(this,r,"x",c)}inYRange(r,c){return iu(this,r,"y",c)}getCenterPoint(r){const{x:c,y:f}=this.getProps(["x","y"],r);return{x:c,y:f}}size(r){let c=(r=r||this.options||{}).radius||0;return c=Math.max(c,c&&r.hoverRadius||0),2*(c+(c&&r.borderWidth||0))}draw(r,c){const f=this.options;this.skip||f.radius<.1||!as(this,c,this.size(f)/2)||(r.strokeStyle=f.borderColor,r.lineWidth=f.borderWidth,r.fillStyle=f.backgroundColor,ss(r,f,this.x,this.y))}getRange(){const r=this.options||{};return r.radius+r.hitRadius}}return o.id="point",o.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},o.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},o})();function ru(o,s){const{x:r,y:c,base:f,width:_,height:x}=o.getProps(["x","y","base","width","height"],s);let M,S,D,L,j;return o.horizontal?(j=x/2,M=Math.min(r,f),S=Math.max(r,f),D=c-j,L=c+j):(j=_/2,M=r-j,S=r+j,D=Math.min(c,f),L=Math.max(c,f)),{left:M,top:D,right:S,bottom:L}}function $s(o,s,r,c){return o?0:Me(s,r,c)}function su(o,s,r,c){const f=null===s,_=null===r,M=o&&!(f&&_)&&ru(o,c);return M&&(f||Ji(s,M.left,M.right))&&(_||Ji(r,M.top,M.bottom))}function fd(o,s){o.rect(s.x,s.y,s.w,s.h)}function au(o,s,r={}){const c=o.x!==r.x?-s:0,f=o.y!==r.y?-s:0;return{x:o.x+c,y:o.y+f,w:o.w+((o.x+o.w!==r.x+r.w?s:0)-c),h:o.h+((o.y+o.h!==r.y+r.h?s:0)-f),radius:o.radius}}class Hs extends O{constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){const{inflateAmount:r,options:{borderColor:c,backgroundColor:f}}=this,{inner:_,outer:x}=function(o){const s=ru(o),r=s.right-s.left,c=s.bottom-s.top,f=function(o,s,r){const f=o.borderSkipped,_=$r(o.options.borderWidth);return{t:$s(f.top,_.top,0,r),r:$s(f.right,_.right,0,s),b:$s(f.bottom,_.bottom,0,r),l:$s(f.left,_.left,0,s)}}(o,r/2,c/2),_=function(o,s,r){const{enableBorderRadius:c}=o.getProps(["enableBorderRadius"]),f=o.options.borderRadius,_=oe(f),x=Math.min(s,r),M=o.borderSkipped,S=c||ie(f);return{topLeft:$s(!S||M.top||M.left,_.topLeft,0,x),topRight:$s(!S||M.top||M.right,_.topRight,0,x),bottomLeft:$s(!S||M.bottom||M.left,_.bottomLeft,0,x),bottomRight:$s(!S||M.bottom||M.right,_.bottomRight,0,x)}}(o,r/2,c/2);return{outer:{x:s.left,y:s.top,w:r,h:c,radius:_},inner:{x:s.left+f.l,y:s.top+f.t,w:r-f.l-f.r,h:c-f.t-f.b,radius:{topLeft:Math.max(0,_.topLeft-Math.max(f.t,f.l)),topRight:Math.max(0,_.topRight-Math.max(f.t,f.r)),bottomLeft:Math.max(0,_.bottomLeft-Math.max(f.b,f.l)),bottomRight:Math.max(0,_.bottomRight-Math.max(f.b,f.r))}}}}(this),M=(o=x.radius).topLeft||o.topRight||o.bottomLeft||o.bottomRight?Pa:fd;var o;s.save(),(x.w!==_.w||x.h!==_.h)&&(s.beginPath(),M(s,au(x,r,_)),s.clip(),M(s,au(_,-r,x)),s.fillStyle=c,s.fill("evenodd")),s.beginPath(),M(s,au(_,r)),s.fillStyle=f,s.fill(),s.restore()}inRange(s,r,c){return su(this,s,r,c)}inXRange(s,r){return su(this,s,null,r)}inYRange(s,r){return su(this,null,s,r)}getCenterPoint(s){const{x:r,y:c,base:f,horizontal:_}=this.getProps(["x","y","base","horizontal"],s);return{x:_?(r+f)/2:r,y:_?c:(c+f)/2}}getRange(s){return"x"===s?this.width/2:this.height/2}}function Hp(o,s,r){const c=function(o){const s=o.options,r=s.fill;let c=de(r&&r.target,r);return void 0===c&&(c=!!s.backgroundColor),!1!==c&&null!==c&&(!0===c?"origin":c)}(o);if(ie(c))return!isNaN(c.value)&&c;let f=parseFloat(c);return Oe(f)&&Math.floor(f)===f?(("-"===c[0]||"+"===c[0])&&(f=s+f),!(f===s||f<0||f>=r)&&f):["origin","start","end","stack","shape"].indexOf(c)>=0&&c}Hs.id="bar",Hs.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},Hs.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class yd{constructor(s){this.x=s.x,this.y=s.y,this.radius=s.radius}pathSegment(s,r,c){const{x:f,y:_,radius:x}=this;return s.arc(f,_,x,(r=r||{start:0,end:_i}).end,r.start,!0),!c.bounds}interpolate(s){const{x:r,y:c,radius:f}=this,_=s.angle;return{x:r+Math.cos(_)*f,y:c+Math.sin(_)*f,angle:_}}}function va(o,s,r){for(;s>o;s--){const c=r[s];if(!isNaN(c.x)&&!isNaN(c.y))break}return s}function Ys(o,s,r){const c=[];for(let f=0;f<r.length;f++){const _=r[f],{first:x,last:M,point:S}=go(_,s,"x");if(!(!S||x&&M))if(x)c.unshift(S);else if(o.push(S),!M)break}o.push(...c)}function go(o,s,r){const c=o.interpolate(s,r);if(!c)return{};const f=c[r],_=o.segments,x=o.points;let M=!1,S=!1;for(let D=0;D<_.length;D++){const L=_[D],j=x[L.start][r],q=x[L.end][r];if(Ji(f,j,q)){M=f===j,S=f===q;break}}return{first:M,last:S,point:c}}function Wp(o){const{chart:s,fill:r,line:c}=o;if(Oe(r))return function(o,s){const r=o.getDatasetMeta(s);return r&&o.isDatasetVisible(s)?r.dataset:null}(s,r);if("stack"===r)return function(o){const{scale:s,index:r,line:c}=o,f=[],_=c.segments,x=c.points,M=function(o,s){const r=[],c=o.getMatchingVisibleMetas("line");for(let f=0;f<c.length;f++){const _=c[f];if(_.index===s)break;_.hidden||r.unshift(_.dataset)}return r}(s,r);M.push(xd({x:null,y:s.bottom},c));for(let S=0;S<_.length;S++){const D=_[S];for(let L=D.start;L<=D.end;L++)Ys(f,x[L],M)}return new hl({points:f,options:{}})}(o);if("shape"===r)return!0;const f=function(o){return(o.scale||{}).getPointPositionForValue?function(o){const{scale:s,fill:r}=o,c=s.options,f=s.getLabels().length,_=[],x=c.reverse?s.max:s.min;let S,D,L;if(L="start"===r?x:"end"===r?c.reverse?s.min:s.max:ie(r)?r.value:s.getBaseValue(),c.grid.circular)return D=s.getPointPositionForValue(0,x),new yd({x:D.x,y:D.y,radius:s.getDistanceFromCenterForValue(L)});for(S=0;S<f;++S)_.push(s.getPointPositionForValue(S,L));return _}(o):function(o){const{scale:s={},fill:r}=o;let f,c=null;return"start"===r?c=s.bottom:"end"===r?c=s.top:ie(r)?c=s.getPixelForValue(r.value):s.getBasePixel&&(c=s.getBasePixel()),Oe(c)?(f=s.isHorizontal(),{x:f?c:null,y:f?null:c}):null}(o)}(o);return f instanceof yd?f:xd(f,c)}function xd(o,s){let r=[],c=!1;return ze(o)?(c=!0,r=o):r=function(o,s){const{x:r=null,y:c=null}=o||{},f=s.points,_=[];return s.segments.forEach(({start:x,end:M})=>{M=va(x,M,f);const S=f[x],D=f[M];null!==c?(_.push({x:S.x,y:c}),_.push({x:D.x,y:c})):null!==r&&(_.push({x:r,y:S.y}),_.push({x:r,y:D.y}))}),_}(o,s),r.length?new hl({points:r,options:{tension:0},_loop:c,_fullLoop:c}):null}function Yp(o,s,r){let f=o[s].fill;const _=[s];let x;if(!r)return f;for(;!1!==f&&-1===_.indexOf(f);){if(!Oe(f))return f;if(x=o[f],!x)return!1;if(x.visible)return f;_.push(f),f=x.fill}return!1}function vd(o,s,r){const{segments:c,points:f}=s;let _=!0,x=!1;o.beginPath();for(const M of c){const{start:S,end:D}=M,L=f[S],j=f[va(S,D,f)];_?(o.moveTo(L.x,L.y),_=!1):(o.lineTo(L.x,r),o.lineTo(L.x,L.y)),x=!!s.pathSegment(o,M,{move:x}),x?o.closePath():o.lineTo(j.x,r)}o.lineTo(s.first().x,r),o.closePath(),o.clip()}function Qc(o,s,r,c){if(c)return;let f=s[o],_=r[o];return"angle"===o&&(f=le(f),_=le(_)),{property:o,start:f,end:_}}function Jl(o,s,r,c){return o&&s?c(o[r],s[r]):o?o[r]:s?s[r]:0}function Xp(o,s,r){const{top:c,bottom:f}=s.chart.chartArea,{property:_,start:x,end:M}=r||{};"x"===_&&(o.beginPath(),o.rect(x,c,M-x,f-c),o.clip())}function bd(o,s,r,c){const f=s.interpolate(r,c);f&&o.lineTo(f.x,f.y)}function tn(o,s){const{line:r,target:c,property:f,color:_,scale:x}=s,M=function(o,s,r){const c=o.segments,f=o.points,_=s.points,x=[];for(const M of c){let{start:S,end:D}=M;D=va(S,D,f);const L=Qc(r,f[S],f[D],M.loop);if(!s.segments){x.push({source:M,target:L,start:f[S],end:f[D]});continue}const j=Za(s,L);for(const q of j){const et=Qc(r,_[q.start],_[q.end],q.loop),ut=Ga(M,f,et);for(const mt of ut)x.push({source:mt,target:q,start:{[r]:Jl(L,et,"start",Math.max)},end:{[r]:Jl(L,et,"end",Math.min)}})}}return x}(r,c,f);for(const{source:S,target:D,start:L,end:j}of M){const{style:{backgroundColor:q=_}={}}=S,et=!0!==c;o.save(),o.fillStyle=q,Xp(o,x,et&&Qc(f,L,j)),o.beginPath();const ut=!!r.pathSegment(o,S);let mt;if(et){ut?o.closePath():bd(o,c,j,f);const wt=!!c.pathSegment(o,D,{move:ut,reverse:!0});mt=ut&&wt,mt||bd(o,c,L,f)}o.closePath(),o.fill(mt?"evenodd":"nonzero"),o.restore()}}function Xs(o,s,r){const c=Wp(s),{line:f,scale:_,axis:x}=s,M=f.options,S=M.fill,D=M.backgroundColor,{above:L=D,below:j=D}=S||{};c&&f.points.length&&(Ia(o,r),function(o,s){const{line:r,target:c,above:f,below:_,area:x,scale:M}=s,S=r._loop?"angle":s.axis;o.save(),"x"===S&&_!==f&&(vd(o,c,x.top),tn(o,{line:r,target:c,color:f,scale:M,property:S}),o.restore(),o.save(),vd(o,c,x.bottom)),tn(o,{line:r,target:c,color:_,scale:M,property:S}),o.restore()}(o,{line:f,target:c,above:L,below:j,area:r,scale:_,axis:x}),Ps(o))}var lu={id:"filler",afterDatasetsUpdate(o,s,r){const c=(o.data.datasets||[]).length,f=[];let _,x,M,S;for(x=0;x<c;++x)_=o.getDatasetMeta(x),M=_.dataset,S=null,M&&M.options&&M instanceof hl&&(S={visible:o.isDatasetVisible(x),index:x,fill:Hp(M,x,c),chart:o,axis:_.controller.options.indexAxis,scale:_.vScale,line:M}),_.$filler=S,f.push(S);for(x=0;x<c;++x)S=f[x],S&&!1!==S.fill&&(S.fill=Yp(f,x,r.propagate))},beforeDraw(o,s,r){const c="beforeDraw"===r.drawTime,f=o.getSortedVisibleDatasetMetas(),_=o.chartArea;for(let x=f.length-1;x>=0;--x){const M=f[x].$filler;!M||(M.line.updateControlPoints(_,M.axis),c&&Xs(o.ctx,M,_))}},beforeDatasetsDraw(o,s,r){if("beforeDatasetsDraw"!==r.drawTime)return;const c=o.getSortedVisibleDatasetMetas();for(let f=c.length-1;f>=0;--f){const _=c[f].$filler;_&&Xs(o.ctx,_,o.chartArea)}},beforeDatasetDraw(o,s,r){const c=s.meta.$filler;!c||!1===c.fill||"beforeDatasetDraw"!==r.drawTime||Xs(o.ctx,c,o.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Mi=(o,s)=>{let{boxHeight:r=s,boxWidth:c=s}=o;return o.usePointStyle&&(r=Math.min(r,s),c=Math.min(c,s)),{boxWidth:c,boxHeight:r,itemHeight:Math.max(s,r)}};class cu extends O{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,r,c){this.maxWidth=s,this.maxHeight=r,this._margins=c,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const s=this.options.labels||{};let r=Ke(s.generateLabels,[this.chart],this)||[];s.filter&&(r=r.filter(c=>s.filter(c,this.chart.data))),s.sort&&(r=r.sort((c,f)=>s.sort(c,f,this.chart.data))),this.options.reverse&&r.reverse(),this.legendItems=r}fit(){const{options:s,ctx:r}=this;if(!s.display)return void(this.width=this.height=0);const c=s.labels,f=Re(c.font),_=f.size,x=this._computeTitleHeight(),{boxWidth:M,itemHeight:S}=Mi(c,_);let D,L;r.font=f.string,this.isHorizontal()?(D=this.maxWidth,L=this._fitRows(x,_,M,S)+10):(L=this.maxHeight,D=this._fitCols(x,_,M,S)+10),this.width=Math.min(D,s.maxWidth||this.maxWidth),this.height=Math.min(L,s.maxHeight||this.maxHeight)}_fitRows(s,r,c,f){const{ctx:_,maxWidth:x,options:{labels:{padding:M}}}=this,S=this.legendHitBoxes=[],D=this.lineWidths=[0],L=f+M;let j=s;_.textAlign="left",_.textBaseline="middle";let q=-1,et=-L;return this.legendItems.forEach((ut,mt)=>{const wt=c+r/2+_.measureText(ut.text).width;(0===mt||D[D.length-1]+wt+2*M>x)&&(j+=L,D[D.length-(mt>0?0:1)]=0,et+=L,q++),S[mt]={left:0,top:et,row:q,width:wt,height:f},D[D.length-1]+=wt+M}),j}_fitCols(s,r,c,f){const{ctx:_,maxHeight:x,options:{labels:{padding:M}}}=this,S=this.legendHitBoxes=[],D=this.columnSizes=[],L=x-s;let j=M,q=0,et=0,ut=0,mt=0;return this.legendItems.forEach((wt,Et)=>{const Gt=c+r/2+_.measureText(wt.text).width;Et>0&&et+f+2*M>L&&(j+=q+M,D.push({width:q,height:et}),ut+=q+M,mt++,q=et=0),S[Et]={left:ut,top:et,col:mt,width:Gt,height:f},q=Math.max(q,Gt),et+=f+M}),j+=q,D.push({width:q,height:et}),j}adjustHitBoxes(){if(!this.options.display)return;const s=this._computeTitleHeight(),{legendHitBoxes:r,options:{align:c,labels:{padding:f},rtl:_}}=this,x=fs(_,this.left,this.width);if(this.isHorizontal()){let M=0,S=mi(c,this.left+f,this.right-this.lineWidths[M]);for(const D of r)M!==D.row&&(M=D.row,S=mi(c,this.left+f,this.right-this.lineWidths[M])),D.top+=this.top+s+f,D.left=x.leftForLtr(x.x(S),D.width),S+=D.width+f}else{let M=0,S=mi(c,this.top+s+f,this.bottom-this.columnSizes[M].height);for(const D of r)D.col!==M&&(M=D.col,S=mi(c,this.top+s+f,this.bottom-this.columnSizes[M].height)),D.top=S,D.left+=this.left+f,D.left=x.leftForLtr(x.x(D.left),D.width),S+=D.height+f}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const s=this.ctx;Ia(s,this),this._draw(),Ps(s)}}_draw(){const{options:s,columnSizes:r,lineWidths:c,ctx:f}=this,{align:_,labels:x}=s,M=ri.color,S=fs(s.rtl,this.left,this.width),D=Re(x.font),{color:L,padding:j}=x,q=D.size,et=q/2;let ut;this.drawTitle(),f.textAlign=S.textAlign("left"),f.textBaseline="middle",f.lineWidth=.5,f.font=D.string;const{boxWidth:mt,boxHeight:wt,itemHeight:Et}=Mi(x,q),Kt=this.isHorizontal(),zt=this._computeTitleHeight();ut=Kt?{x:mi(_,this.left+j,this.right-c[0]),y:this.top+j+zt,line:0}:{x:this.left+j,y:mi(_,this.top+zt+j,this.bottom-r[0].height),line:0},ja(this.ctx,s.textDirection);const ae=Et+j;this.legendItems.forEach((fe,ge)=>{f.strokeStyle=fe.fontColor||L,f.fillStyle=fe.fontColor||L;const ce=f.measureText(fe.text).width,Xe=S.textAlign(fe.textAlign||(fe.textAlign=x.textAlign)),Be=mt+et+ce;let We=ut.x,ci=ut.y;S.setWidth(this.width),Kt?ge>0&&We+Be+j>this.right&&(ci=ut.y+=ae,ut.line++,We=ut.x=mi(_,this.left+j,this.right-c[ut.line])):ge>0&&ci+ae>this.bottom&&(We=ut.x=We+r[ut.line].width+j,ut.line++,ci=ut.y=mi(_,this.top+zt+j,this.bottom-r[ut.line].height)),function(fe,ge,ce){if(isNaN(mt)||mt<=0||isNaN(wt)||wt<0)return;f.save();const Xe=de(ce.lineWidth,1);if(f.fillStyle=de(ce.fillStyle,M),f.lineCap=de(ce.lineCap,"butt"),f.lineDashOffset=de(ce.lineDashOffset,0),f.lineJoin=de(ce.lineJoin,"miter"),f.lineWidth=Xe,f.strokeStyle=de(ce.strokeStyle,M),f.setLineDash(de(ce.lineDash,[])),x.usePointStyle){const Be={radius:mt*Math.SQRT2/2,pointStyle:ce.pointStyle,rotation:ce.rotation,borderWidth:Xe},We=S.xPlus(fe,mt/2);ss(f,Be,We,ge+et)}else{const Be=ge+Math.max((q-wt)/2,0),We=S.leftForLtr(fe,mt),ci=oe(ce.borderRadius);f.beginPath(),Object.values(ci).some(Ii=>0!==Ii)?Pa(f,{x:We,y:Be,w:mt,h:wt,radius:ci}):f.rect(We,Be,mt,wt),f.fill(),0!==Xe&&f.stroke()}f.restore()}(S.x(We),ci,fe),We=((o,s,r,c)=>o===(c?"left":"right")?r:"center"===o?(s+r)/2:s)(Xe,We+mt+et,Kt?We+Be:this.right,s.rtl),function(fe,ge,ce){Nn(f,ce.text,fe,ge+Et/2,D,{strikethrough:ce.hidden,textAlign:S.textAlign(ce.textAlign)})}(S.x(We),ci,fe),Kt?ut.x+=Be+j:ut.y+=ae}),Ll(this.ctx,s.textDirection)}drawTitle(){const s=this.options,r=s.title,c=Re(r.font),f=je(r.padding);if(!r.display)return;const _=fs(s.rtl,this.left,this.width),x=this.ctx,M=r.position,D=f.top+c.size/2;let L,j=this.left,q=this.width;if(this.isHorizontal())q=Math.max(...this.lineWidths),L=this.top+D,j=mi(s.align,j,this.right-q);else{const ut=this.columnSizes.reduce((mt,wt)=>Math.max(mt,wt.height),0);L=D+mi(s.align,this.top,this.bottom-ut-s.labels.padding-this._computeTitleHeight())}const et=mi(M,j,j+q);x.textAlign=_.textAlign($i(M)),x.textBaseline="middle",x.strokeStyle=r.color,x.fillStyle=r.color,x.font=c.string,Nn(x,r.text,et,L,c)}_computeTitleHeight(){const s=this.options.title,r=Re(s.font),c=je(s.padding);return s.display?r.lineHeight+c.height:0}_getLegendItemAt(s,r){let c,f,_;if(Ji(s,this.left,this.right)&&Ji(r,this.top,this.bottom))for(_=this.legendHitBoxes,c=0;c<_.length;++c)if(f=_[c],Ji(s,f.left,f.left+f.width)&&Ji(r,f.top,f.top+f.height))return this.legendItems[c];return null}handleEvent(s){const r=this.options;if(!function(o,s){return!!("mousemove"===o&&(s.onHover||s.onLeave)||s.onClick&&("click"===o||"mouseup"===o))}(s.type,r))return;const c=this._getLegendItemAt(s.x,s.y);if("mousemove"===s.type){const f=this._hoveredItem,_=((o,s)=>null!==o&&null!==s&&o.datasetIndex===s.datasetIndex&&o.index===s.index)(f,c);f&&!_&&Ke(r.onLeave,[s,f,this],this),this._hoveredItem=c,c&&!_&&Ke(r.onHover,[s,c,this],this)}else c&&Ke(r.onClick,[s,c,this],this)}}var yo={id:"legend",_element:cu,start(o,s,r){const c=o.legend=new cu({ctx:o.ctx,options:r,chart:o});En.configure(o,c,r),En.addBox(o,c)},stop(o){En.removeBox(o,o.legend),delete o.legend},beforeUpdate(o,s,r){const c=o.legend;En.configure(o,c,r),c.options=r},afterUpdate(o){const s=o.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(o,s){s.replay||o.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(o,s,r){const c=s.datasetIndex,f=r.chart;f.isDatasetVisible(c)?(f.hide(c),s.hidden=!0):(f.show(c),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:o=>o.chart.options.color,boxWidth:40,padding:10,generateLabels(o){const s=o.data.datasets,{labels:{usePointStyle:r,pointStyle:c,textAlign:f,color:_}}=o.legend.options;return o._getSortedDatasetMetas().map(x=>{const M=x.controller.getStyle(r?0:void 0),S=je(M.borderWidth);return{text:s[x.index].label,fillStyle:M.backgroundColor,fontColor:_,hidden:!x.visible,lineCap:M.borderCapStyle,lineDash:M.borderDash,lineDashOffset:M.borderDashOffset,lineJoin:M.borderJoinStyle,lineWidth:(S.width+S.height)/4,strokeStyle:M.borderColor,pointStyle:c||M.pointStyle,rotation:M.rotation,textAlign:f||M.textAlign,borderRadius:0,datasetIndex:x.index}},this)}},title:{color:o=>o.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:o=>!o.startsWith("on"),labels:{_scriptable:o=>!["generateLabels","filter","sort"].includes(o)}}};class Dr extends O{constructor(s){super(),this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,r){const c=this.options;if(this.left=0,this.top=0,!c.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=s,this.height=this.bottom=r;const f=ze(c.text)?c.text.length:1;this._padding=je(c.padding);const _=f*Re(c.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=_:this.width=_}isHorizontal(){const s=this.options.position;return"top"===s||"bottom"===s}_drawArgs(s){const{top:r,left:c,bottom:f,right:_,options:x}=this,M=x.align;let D,L,j,S=0;return this.isHorizontal()?(L=mi(M,c,_),j=r+s,D=_-c):("left"===x.position?(L=c+s,j=mi(M,f,r),S=-.5*Ai):(L=_-s,j=mi(M,r,f),S=.5*Ai),D=f-r),{titleX:L,titleY:j,maxWidth:D,rotation:S}}draw(){const s=this.ctx,r=this.options;if(!r.display)return;const c=Re(r.font),_=c.lineHeight/2+this._padding.top,{titleX:x,titleY:M,maxWidth:S,rotation:D}=this._drawArgs(_);Nn(s,r.text,0,0,c,{color:r.color,maxWidth:S,rotation:D,textAlign:$i(r.align),textBaseline:"middle",translation:[x,M]})}}var Ir={id:"title",_element:Dr,start(o,s,r){!function(o,s){const r=new Dr({ctx:o.ctx,options:s,chart:o});En.configure(o,r,s),En.addBox(o,r),o.titleBlock=r}(o,r)},stop(o){En.removeBox(o,o.titleBlock),delete o.titleBlock},beforeUpdate(o,s,r){const c=o.titleBlock;En.configure(o,c,r),c.options=r},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};new WeakMap;const wa={average(o){if(!o.length)return!1;let s,r,c=0,f=0,_=0;for(s=0,r=o.length;s<r;++s){const x=o[s].element;if(x&&x.hasValue()){const M=x.tooltipPosition();c+=M.x,f+=M.y,++_}}return{x:c/_,y:f/_}},nearest(o,s){if(!o.length)return!1;let _,x,M,r=s.x,c=s.y,f=Number.POSITIVE_INFINITY;for(_=0,x=o.length;_<x;++_){const S=o[_].element;if(S&&S.hasValue()){const L=Ie(s,S.getCenterPoint());L<f&&(f=L,M=S)}}if(M){const S=M.tooltipPosition();r=S.x,c=S.y}return{x:r,y:c}}};function Ur(o,s){return s&&(ze(s)?Array.prototype.push.apply(o,s):o.push(s)),o}function Js(o){return("string"==typeof o||o instanceof String)&&o.indexOf("\n")>-1?o.split("\n"):o}function hu(o,s){const{element:r,datasetIndex:c,index:f}=s,_=o.getDatasetMeta(c).controller,{label:x,value:M}=_.getLabelAndValue(f);return{chart:o,label:x,parsed:_.getParsed(f),raw:o.data.datasets[c].data[f],formattedValue:M,dataset:_.getDataset(),dataIndex:f,datasetIndex:c,element:r}}function uu(o,s){const r=o.chart.ctx,{body:c,footer:f,title:_}=o,{boxWidth:x,boxHeight:M}=s,S=Re(s.bodyFont),D=Re(s.titleFont),L=Re(s.footerFont),j=_.length,q=f.length,et=c.length,ut=je(s.padding);let mt=ut.height,wt=0,Et=c.reduce((Kt,zt)=>Kt+zt.before.length+zt.lines.length+zt.after.length,0);Et+=o.beforeBody.length+o.afterBody.length,j&&(mt+=j*D.lineHeight+(j-1)*s.titleSpacing+s.titleMarginBottom),Et&&(mt+=et*(s.displayColors?Math.max(M,S.lineHeight):S.lineHeight)+(Et-et)*S.lineHeight+(Et-1)*s.bodySpacing),q&&(mt+=s.footerMarginTop+q*L.lineHeight+(q-1)*s.footerSpacing);let Gt=0;const se=function(Kt){wt=Math.max(wt,r.measureText(Kt).width+Gt)};return r.save(),r.font=D.string,ke(o.title,se),r.font=S.string,ke(o.beforeBody.concat(o.afterBody),se),Gt=s.displayColors?x+2+s.boxPadding:0,ke(c,Kt=>{ke(Kt.before,se),ke(Kt.lines,se),ke(Kt.after,se)}),Gt=0,r.font=L.string,ke(o.footer,se),r.restore(),wt+=ut.width,{width:wt,height:mt}}function xo(o,s,r,c){const{x:f,width:_}=r,{width:x,chartArea:{left:M,right:S}}=o;let D="center";return"center"===c?D=f<=(M+S)/2?"left":"right":f<=_/2?D="left":f>=x-_/2&&(D="right"),function(o,s,r,c){const{x:f,width:_}=c,x=r.caretSize+r.caretPadding;if("left"===o&&f+_+x>s.width||"right"===o&&f-_-x<0)return!0}(D,o,s,r)&&(D="center"),D}function tc(o,s,r){const c=r.yAlign||s.yAlign||function(o,s){const{y:r,height:c}=s;return r<c/2?"top":r>o.height-c/2?"bottom":"center"}(o,r);return{xAlign:r.xAlign||s.xAlign||xo(o,s,r,c),yAlign:c}}function Td(o,s,r,c){const{caretSize:f,caretPadding:_,cornerRadius:x}=o,{xAlign:M,yAlign:S}=r,D=f+_,{topLeft:L,topRight:j,bottomLeft:q,bottomRight:et}=oe(x);let ut=function(o,s){let{x:r,width:c}=o;return"right"===s?r-=c:"center"===s&&(r-=c/2),r}(s,M);const mt=function(o,s,r){let{y:c,height:f}=o;return"top"===s?c+=r:c-="bottom"===s?f+r:f/2,c}(s,S,D);return"center"===S?"left"===M?ut+=D:"right"===M&&(ut-=D):"left"===M?ut-=Math.max(L,q)+f:"right"===M&&(ut+=Math.max(j,et)+f),{x:Me(ut,0,c.width-s.width),y:Me(mt,0,c.height-s.height)}}function ec(o,s,r){const c=je(r.padding);return"center"===s?o.x+o.width/2:"right"===s?o.x+o.width-c.right:o.x+c.left}function Cd(o){return Ur([],Js(o))}function Sd(o,s){const r=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return r?o.override(r):o}let th=(()=>{class o extends O{constructor(r){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=r.chart||r._chart,this._chart=this.chart,this.options=r.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(r){this.options=r,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const r=this._cachedAnimations;if(r)return r;const c=this.chart,f=this.options.setContext(this.getContext()),_=f.enabled&&c.options.animation&&f.animations,x=new Wr(this.chart,_);return _._cacheable&&(this._cachedAnimations=Object.freeze(x)),x}getContext(){return this.$context||(this.$context=function(o,s,r){return qe(o,{tooltip:s,tooltipItems:r,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(r,c){const{callbacks:f}=c,_=f.beforeTitle.apply(this,[r]),x=f.title.apply(this,[r]),M=f.afterTitle.apply(this,[r]);let S=[];return S=Ur(S,Js(_)),S=Ur(S,Js(x)),S=Ur(S,Js(M)),S}getBeforeBody(r,c){return Cd(c.callbacks.beforeBody.apply(this,[r]))}getBody(r,c){const{callbacks:f}=c,_=[];return ke(r,x=>{const M={before:[],lines:[],after:[]},S=Sd(f,x);Ur(M.before,Js(S.beforeLabel.call(this,x))),Ur(M.lines,S.label.call(this,x)),Ur(M.after,Js(S.afterLabel.call(this,x))),_.push(M)}),_}getAfterBody(r,c){return Cd(c.callbacks.afterBody.apply(this,[r]))}getFooter(r,c){const{callbacks:f}=c,_=f.beforeFooter.apply(this,[r]),x=f.footer.apply(this,[r]),M=f.afterFooter.apply(this,[r]);let S=[];return S=Ur(S,Js(_)),S=Ur(S,Js(x)),S=Ur(S,Js(M)),S}_createItems(r){const c=this._active,f=this.chart.data,_=[],x=[],M=[];let D,L,S=[];for(D=0,L=c.length;D<L;++D)S.push(hu(this.chart,c[D]));return r.filter&&(S=S.filter((j,q,et)=>r.filter(j,q,et,f))),r.itemSort&&(S=S.sort((j,q)=>r.itemSort(j,q,f))),ke(S,j=>{const q=Sd(r.callbacks,j);_.push(q.labelColor.call(this,j)),x.push(q.labelPointStyle.call(this,j)),M.push(q.labelTextColor.call(this,j))}),this.labelColors=_,this.labelPointStyles=x,this.labelTextColors=M,this.dataPoints=S,S}update(r,c){const f=this.options.setContext(this.getContext()),_=this._active;let x,M=[];if(_.length){const S=wa[f.position].call(this,_,this._eventPosition);M=this._createItems(f),this.title=this.getTitle(M,f),this.beforeBody=this.getBeforeBody(M,f),this.body=this.getBody(M,f),this.afterBody=this.getAfterBody(M,f),this.footer=this.getFooter(M,f);const D=this._size=uu(this,f),L=Object.assign({},S,D),j=tc(this.chart,f,L),q=Td(f,L,j,this.chart);this.xAlign=j.xAlign,this.yAlign=j.yAlign,x={opacity:1,x:q.x,y:q.y,width:D.width,height:D.height,caretX:S.x,caretY:S.y}}else 0!==this.opacity&&(x={opacity:0});this._tooltipItems=M,this.$context=void 0,x&&this._resolveAnimations().update(this,x),r&&f.external&&f.external.call(this,{chart:this.chart,tooltip:this,replay:c})}drawCaret(r,c,f,_){const x=this.getCaretPosition(r,f,_);c.lineTo(x.x1,x.y1),c.lineTo(x.x2,x.y2),c.lineTo(x.x3,x.y3)}getCaretPosition(r,c,f){const{xAlign:_,yAlign:x}=this,{caretSize:M,cornerRadius:S}=f,{topLeft:D,topRight:L,bottomLeft:j,bottomRight:q}=oe(S),{x:et,y:ut}=r,{width:mt,height:wt}=c;let Et,Gt,se,Kt,zt,ae;return"center"===x?(zt=ut+wt/2,"left"===_?(Et=et,Gt=Et-M,Kt=zt+M,ae=zt-M):(Et=et+mt,Gt=Et+M,Kt=zt-M,ae=zt+M),se=Et):(Gt="left"===_?et+Math.max(D,j)+M:"right"===_?et+mt-Math.max(L,q)-M:this.caretX,"top"===x?(Kt=ut,zt=Kt-M,Et=Gt-M,se=Gt+M):(Kt=ut+wt,zt=Kt+M,Et=Gt+M,se=Gt-M),ae=Kt),{x1:Et,x2:Gt,x3:se,y1:Kt,y2:zt,y3:ae}}drawTitle(r,c,f){const _=this.title,x=_.length;let M,S,D;if(x){const L=fs(f.rtl,this.x,this.width);for(r.x=ec(this,f.titleAlign,f),c.textAlign=L.textAlign(f.titleAlign),c.textBaseline="middle",M=Re(f.titleFont),S=f.titleSpacing,c.fillStyle=f.titleColor,c.font=M.string,D=0;D<x;++D)c.fillText(_[D],L.x(r.x),r.y+M.lineHeight/2),r.y+=M.lineHeight+S,D+1===x&&(r.y+=f.titleMarginBottom-S)}}_drawColorBox(r,c,f,_,x){const M=this.labelColors[f],S=this.labelPointStyles[f],{boxHeight:D,boxWidth:L,boxPadding:j}=x,q=Re(x.bodyFont),et=ec(this,"left",x),ut=_.x(et),wt=c.y+(D<q.lineHeight?(q.lineHeight-D)/2:0);if(x.usePointStyle){const Et={radius:Math.min(L,D)/2,pointStyle:S.pointStyle,rotation:S.rotation,borderWidth:1},Gt=_.leftForLtr(ut,L)+L/2,se=wt+D/2;r.strokeStyle=x.multiKeyBackground,r.fillStyle=x.multiKeyBackground,ss(r,Et,Gt,se),r.strokeStyle=M.borderColor,r.fillStyle=M.backgroundColor,ss(r,Et,Gt,se)}else{r.lineWidth=M.borderWidth||1,r.strokeStyle=M.borderColor,r.setLineDash(M.borderDash||[]),r.lineDashOffset=M.borderDashOffset||0;const Et=_.leftForLtr(ut,L-j),Gt=_.leftForLtr(_.xPlus(ut,1),L-j-2),se=oe(M.borderRadius);Object.values(se).some(Kt=>0!==Kt)?(r.beginPath(),r.fillStyle=x.multiKeyBackground,Pa(r,{x:Et,y:wt,w:L,h:D,radius:se}),r.fill(),r.stroke(),r.fillStyle=M.backgroundColor,r.beginPath(),Pa(r,{x:Gt,y:wt+1,w:L-2,h:D-2,radius:se}),r.fill()):(r.fillStyle=x.multiKeyBackground,r.fillRect(Et,wt,L,D),r.strokeRect(Et,wt,L,D),r.fillStyle=M.backgroundColor,r.fillRect(Gt,wt+1,L-2,D-2))}r.fillStyle=this.labelTextColors[f]}drawBody(r,c,f){const{body:_}=this,{bodySpacing:x,bodyAlign:M,displayColors:S,boxHeight:D,boxWidth:L,boxPadding:j}=f,q=Re(f.bodyFont);let et=q.lineHeight,ut=0;const mt=fs(f.rtl,this.x,this.width),wt=function(ce){c.fillText(ce,mt.x(r.x+ut),r.y+et/2),r.y+=et+x},Et=mt.textAlign(M);let Gt,se,Kt,zt,ae,fe,ge;for(c.textAlign=M,c.textBaseline="middle",c.font=q.string,r.x=ec(this,Et,f),c.fillStyle=f.bodyColor,ke(this.beforeBody,wt),ut=S&&"right"!==Et?"center"===M?L/2+j:L+2+j:0,zt=0,fe=_.length;zt<fe;++zt){for(Gt=_[zt],se=this.labelTextColors[zt],c.fillStyle=se,ke(Gt.before,wt),Kt=Gt.lines,S&&Kt.length&&(this._drawColorBox(c,r,zt,mt,f),et=Math.max(q.lineHeight,D)),ae=0,ge=Kt.length;ae<ge;++ae)wt(Kt[ae]),et=q.lineHeight;ke(Gt.after,wt)}ut=0,et=q.lineHeight,ke(this.afterBody,wt),r.y-=x}drawFooter(r,c,f){const _=this.footer,x=_.length;let M,S;if(x){const D=fs(f.rtl,this.x,this.width);for(r.x=ec(this,f.footerAlign,f),r.y+=f.footerMarginTop,c.textAlign=D.textAlign(f.footerAlign),c.textBaseline="middle",M=Re(f.footerFont),c.fillStyle=f.footerColor,c.font=M.string,S=0;S<x;++S)c.fillText(_[S],D.x(r.x),r.y+M.lineHeight/2),r.y+=M.lineHeight+f.footerSpacing}}drawBackground(r,c,f,_){const{xAlign:x,yAlign:M}=this,{x:S,y:D}=r,{width:L,height:j}=f,{topLeft:q,topRight:et,bottomLeft:ut,bottomRight:mt}=oe(_.cornerRadius);c.fillStyle=_.backgroundColor,c.strokeStyle=_.borderColor,c.lineWidth=_.borderWidth,c.beginPath(),c.moveTo(S+q,D),"top"===M&&this.drawCaret(r,c,f,_),c.lineTo(S+L-et,D),c.quadraticCurveTo(S+L,D,S+L,D+et),"center"===M&&"right"===x&&this.drawCaret(r,c,f,_),c.lineTo(S+L,D+j-mt),c.quadraticCurveTo(S+L,D+j,S+L-mt,D+j),"bottom"===M&&this.drawCaret(r,c,f,_),c.lineTo(S+ut,D+j),c.quadraticCurveTo(S,D+j,S,D+j-ut),"center"===M&&"left"===x&&this.drawCaret(r,c,f,_),c.lineTo(S,D+q),c.quadraticCurveTo(S,D,S+q,D),c.closePath(),c.fill(),_.borderWidth>0&&c.stroke()}_updateAnimationTarget(r){const c=this.chart,f=this.$animations,_=f&&f.x,x=f&&f.y;if(_||x){const M=wa[r.position].call(this,this._active,this._eventPosition);if(!M)return;const S=this._size=uu(this,r),D=Object.assign({},M,this._size),L=tc(c,r,D),j=Td(r,D,L,c);(_._to!==j.x||x._to!==j.y)&&(this.xAlign=L.xAlign,this.yAlign=L.yAlign,this.width=S.width,this.height=S.height,this.caretX=M.x,this.caretY=M.y,this._resolveAnimations().update(this,j))}}draw(r){const c=this.options.setContext(this.getContext());let f=this.opacity;if(!f)return;this._updateAnimationTarget(c);const _={width:this.width,height:this.height},x={x:this.x,y:this.y};f=Math.abs(f)<.001?0:f;const M=je(c.padding);c.enabled&&(this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length)&&(r.save(),r.globalAlpha=f,this.drawBackground(x,r,_,c),ja(r,c.textDirection),x.y+=M.top,this.drawTitle(x,r,c),this.drawBody(x,r,c),this.drawFooter(x,r,c),Ll(r,c.textDirection),r.restore())}getActiveElements(){return this._active||[]}setActiveElements(r,c){const f=this._active,_=r.map(({datasetIndex:S,index:D})=>{const L=this.chart.getDatasetMeta(S);if(!L)throw new Error("Cannot find a dataset at index "+S);return{datasetIndex:S,element:L.data[D],index:D}}),x=!De(f,_),M=this._positionChanged(_,c);(x||M)&&(this._active=_,this._eventPosition=c,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(r,c,f=!0){if(c&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const _=this.options,x=this._active||[],M=this._getActiveElements(r,x,c,f),S=this._positionChanged(M,r),D=c||!De(M,x)||S;return D&&(this._active=M,(_.enabled||_.external)&&(this._eventPosition={x:r.x,y:r.y},this.update(!0,c))),D}_getActiveElements(r,c,f,_){const x=this.options;if("mouseout"===r.type)return[];if(!_)return c;const M=this.chart.getElementsAtEventForMode(r,x.mode,x,f);return x.reverse&&M.reverse(),M}_positionChanged(r,c){const{caretX:f,caretY:_,options:x}=this,M=wa[x.position].call(this,r,c);return!1!==M&&(f!==M.x||_!==M.y)}}return o.positioners=wa,o})();var fu={id:"tooltip",_element:th,positioners:wa,afterInit(o,s,r){r&&(o.tooltip=new th({chart:o,options:r}))},beforeUpdate(o,s,r){o.tooltip&&o.tooltip.initialize(r)},reset(o,s,r){o.tooltip&&o.tooltip.initialize(r)},afterDraw(o){const s=o.tooltip,r={tooltip:s};!1!==o.notifyPlugins("beforeTooltipDraw",r)&&(s&&s.draw(o.ctx),o.notifyPlugins("afterTooltipDraw",r))},afterEvent(o,s){o.tooltip&&o.tooltip.handleEvent(s.event,s.replay,s.inChartArea)&&(s.changed=!0)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(o,s)=>s.bodyFont.size,boxWidth:(o,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:Te,title(o){if(o.length>0){const s=o[0],r=s.chart.data.labels,c=r?r.length:0;if(this&&this.options&&"dataset"===this.options.mode)return s.dataset.label||"";if(s.label)return s.label;if(c>0&&s.dataIndex<c)return r[s.dataIndex]}return""},afterTitle:Te,beforeBody:Te,beforeLabel:Te,label(o){if(this&&this.options&&"dataset"===this.options.mode)return o.label+": "+o.formattedValue||o.formattedValue;let s=o.dataset.label||"";s&&(s+=": ");const r=o.formattedValue;return Le(r)||(s+=r),s},labelColor(o){const r=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{borderColor:r.borderColor,backgroundColor:r.backgroundColor,borderWidth:r.borderWidth,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(o){const r=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{pointStyle:r.pointStyle,rotation:r.rotation}},afterLabel:Te,afterBody:Te,beforeFooter:Te,footer:Te,afterFooter:Te}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:o=>"filter"!==o&&"itemSort"!==o&&"external"!==o,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};class Ms extends xe{constructor(s){super(s),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(s){const r=this._addedLabels;if(r.length){const c=this.getLabels();for(const{index:f,label:_}of r)c[f]===_&&c.splice(f,1);this._addedLabels=[]}super.init(s)}parse(s,r){if(Le(s))return null;const c=this.getLabels();return((o,s)=>null===o?null:Me(Math.round(o),0,s))(r=isFinite(r)&&c[r]===s?r:function(o,s,r,c){const f=o.indexOf(s);return-1===f?((o,s,r,c)=>("string"==typeof s?(r=o.push(s)-1,c.unshift({index:r,label:s})):isNaN(s)&&(r=null),r))(o,s,r,c):f!==o.lastIndexOf(s)?r:f}(c,s,de(r,s),this._addedLabels),c.length-1)}determineDataLimits(){const{minDefined:s,maxDefined:r}=this.getUserBounds();let{min:c,max:f}=this.getMinMax(!0);"ticks"===this.options.bounds&&(s||(c=0),r||(f=this.getLabels().length-1)),this.min=c,this.max=f}buildTicks(){const s=this.min,r=this.max,c=this.options.offset,f=[];let _=this.getLabels();_=0===s&&r===_.length-1?_:_.slice(s,r+1),this._valueRange=Math.max(_.length-(c?0:1),1),this._startValue=this.min-(c?.5:0);for(let x=s;x<=r;x++)f.push({value:x});return f}getLabelForValue(s){const r=this.getLabels();return s>=0&&s<r.length?r[s]:s}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(s){return"number"!=typeof s&&(s=this.parse(s)),null===s?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getPixelForTick(s){const r=this.ticks;return s<0||s>r.length-1?null:this.getPixelForValue(r[s].value)}getValueForPixel(s){return Math.round(this._startValue+this.getDecimalForPixel(s)*this._valueRange)}getBasePixel(){return this.bottom}}function mu(o,s,{horizontal:r,minRotation:c}){const f=Yi(c),_=(r?Math.sin(f):Math.cos(f))||.001;return Math.min(s/_,.75*s*(""+o).length)}Ms.id="category",Ms.defaults={ticks:{callback:Ms.prototype.getLabelForValue}};class ic extends xe{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,r){return Le(s)||("number"==typeof s||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){const{beginAtZero:s}=this.options,{minDefined:r,maxDefined:c}=this.getUserBounds();let{min:f,max:_}=this;const x=S=>f=r?f:S,M=S=>_=c?_:S;if(s){const S=Ve(f),D=Ve(_);S<0&&D<0?M(0):S>0&&D>0&&x(0)}if(f===_){let S=1;(_>=Number.MAX_SAFE_INTEGER||f<=Number.MIN_SAFE_INTEGER)&&(S=Math.abs(.05*_)),M(_+S),s||x(f-S)}this.min=f,this.max=_}getTickLimit(){const s=this.options.ticks;let f,{maxTicksLimit:r,stepSize:c}=s;return c?(f=Math.ceil(this.max/c)-Math.floor(this.min/c)+1,f>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${c} would result generating up to ${f} ticks. Limiting to 1000.`),f=1e3)):(f=this.computeTickLimit(),r=r||11),r&&(f=Math.min(r,f)),f}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const s=this.options,r=s.ticks;let c=this.getTickLimit();c=Math.max(2,c);const x=function(o,s){const r=[],{bounds:f,step:_,min:x,max:M,precision:S,count:D,maxTicks:L,maxDigits:j,includeBounds:q}=o,et=_||1,ut=L-1,{min:mt,max:wt}=s,Et=!Le(x),Gt=!Le(M),se=!Le(D),Kt=(wt-mt)/(j+1);let ae,fe,ge,ce,zt=ln((wt-mt)/ut/et)*et;if(zt<1e-14&&!Et&&!Gt)return[{value:mt},{value:wt}];ce=Math.ceil(wt/zt)-Math.floor(mt/zt),ce>ut&&(zt=ln(ce*zt/ut/et)*et),Le(S)||(ae=Math.pow(10,S),zt=Math.ceil(zt*ae)/ae),"ticks"===f?(fe=Math.floor(mt/zt)*zt,ge=Math.ceil(wt/zt)*zt):(fe=mt,ge=wt),Et&&Gt&&_&&function(o,s){const r=Math.round(o);return r-s<=o&&r+s>=o}((M-x)/_,zt/1e3)?(ce=Math.round(Math.min((M-x)/zt,L)),zt=(M-x)/ce,fe=x,ge=M):se?(fe=Et?x:fe,ge=Gt?M:ge,ce=D-1,zt=(ge-fe)/ce):(ce=(ge-fe)/zt,ce=Ei(ce,Math.round(ce),zt/1e3)?Math.round(ce):Math.ceil(ce));const Xe=Math.max(Yn(zt),Yn(fe));ae=Math.pow(10,Le(S)?Xe:S),fe=Math.round(fe*ae)/ae,ge=Math.round(ge*ae)/ae;let Be=0;for(Et&&(q&&fe!==x?(r.push({value:x}),fe<x&&Be++,Ei(Math.round((fe+Be*zt)*ae)/ae,x,mu(x,Kt,o))&&Be++):fe<x&&Be++);Be<ce;++Be)r.push({value:Math.round((fe+Be*zt)*ae)/ae});return Gt&&q&&ge!==M?r.length&&Ei(r[r.length-1].value,M,mu(M,Kt,o))?r[r.length-1].value=M:r.push({value:M}):(!Gt||ge===M)&&r.push({value:ge}),r}({maxTicks:c,bounds:s.bounds,min:s.min,max:s.max,precision:r.precision,step:r.stepSize,count:r.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:r.minRotation||0,includeBounds:!1!==r.includeBounds},this._range||this);return"ticks"===s.bounds&&pi(x,this,"value"),s.reverse?(x.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),x}configure(){const s=this.ticks;let r=this.min,c=this.max;if(super.configure(),this.options.offset&&s.length){const f=(c-r)/Math.max(s.length-1,1)/2;r-=f,c+=f}this._startValue=r,this._endValue=c,this._valueRange=c-r}getLabelForValue(s){return ps(s,this.chart.options.locale,this.options.ticks.format)}}class ih extends ic{determineDataLimits(){const{min:s,max:r}=this.getMinMax(!0);this.min=Oe(s)?s:0,this.max=Oe(r)?r:1,this.handleTickRangeOptions()}computeTickLimit(){const s=this.isHorizontal(),r=s?this.width:this.height,c=Yi(this.options.ticks.minRotation),f=(s?Math.sin(c):Math.cos(c))||.001,_=this._resolveTickFontOptions(0);return Math.ceil(r/Math.min(40,_.lineHeight/f))}getPixelForValue(s){return null===s?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}}function kd(o){return o/Math.pow(10,Math.floor(Vi(o)))==1}ih.id="linear",ih.defaults={ticks:{callback:X.formatters.numeric}};class Pr extends xe{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(s,r){const c=ic.prototype.parse.apply(this,[s,r]);if(0!==c)return Oe(c)&&c>0?c:null;this._zero=!0}determineDataLimits(){const{min:s,max:r}=this.getMinMax(!0);this.min=Oe(s)?Math.max(0,s):null,this.max=Oe(r)?Math.max(0,r):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:s,maxDefined:r}=this.getUserBounds();let c=this.min,f=this.max;const _=S=>c=s?c:S,x=S=>f=r?f:S,M=(S,D)=>Math.pow(10,Math.floor(Vi(S))+D);c===f&&(c<=0?(_(1),x(10)):(_(M(c,-1)),x(M(f,1)))),c<=0&&_(M(f,-1)),f<=0&&x(M(c,1)),this._zero&&this.min!==this._suggestedMin&&c===M(this.min,0)&&_(M(c,-1)),this.min=c,this.max=f}buildTicks(){const s=this.options,c=function(o,s){const r=Math.floor(Vi(s.max)),c=Math.ceil(s.max/Math.pow(10,r)),f=[];let _=ui(o.min,Math.pow(10,Math.floor(Vi(s.min)))),x=Math.floor(Vi(_)),M=Math.floor(_/Math.pow(10,x)),S=x<0?Math.pow(10,Math.abs(x)):1;do{f.push({value:_,major:kd(_)}),++M,10===M&&(M=1,++x,S=x>=0?1:S),_=Math.round(M*Math.pow(10,x)*S)/S}while(x<r||x===r&&M<c);const D=ui(o.max,_);return f.push({value:D,major:kd(_)}),f}({min:this._userMin,max:this._userMax},this);return"ticks"===s.bounds&&pi(c,this,"value"),s.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}getLabelForValue(s){return void 0===s?"0":ps(s,this.chart.options.locale,this.options.ticks.format)}configure(){const s=this.min;super.configure(),this._startValue=Vi(s),this._valueRange=Vi(this.max)-Vi(s)}getPixelForValue(s){return(void 0===s||0===s)&&(s=this.min),null===s||isNaN(s)?NaN:this.getPixelForDecimal(s===this.min?0:(Vi(s)-this._startValue)/this._valueRange)}getValueForPixel(s){const r=this.getDecimalForPixel(s);return Math.pow(10,this._startValue+r*this._valueRange)}}function nh(o){const s=o.ticks;if(s.display&&o.display){const r=je(s.backdropPadding);return de(s.font&&s.font.size,ri.font.size)+r.height}return 0}function Qp(o,s,r){return r=ze(r)?r:[r],{w:wc(o,s.string,r),h:r.length*s.lineHeight}}function gu(o,s,r,c,f){return o===c||o===f?{start:s-r/2,end:s+r/2}:o<c||o>f?{start:s-r,end:s}:{start:s,end:s+r}}function ef(o,s,r,c,f){const _=Math.abs(Math.sin(r)),x=Math.abs(Math.cos(r));let M=0,S=0;c.start<s.l?(M=(s.l-c.start)/_,o.l=Math.min(o.l,s.l-M)):c.end>s.r&&(M=(c.end-s.r)/_,o.r=Math.max(o.r,s.r+M)),f.start<s.t?(S=(s.t-f.start)/x,o.t=Math.min(o.t,s.t-S)):f.end>s.b&&(S=(f.end-s.b)/x,o.b=Math.max(o.b,s.b+S))}function yu(o){return 0===o||180===o?"center":o<180?"left":"right"}function Id(o,s,r){return"right"===r?o-=s:"center"===r&&(o-=s/2),o}function xu(o,s,r){return 90===r||270===r?o-=s/2:(r>270||r<90)&&(o-=s),o}function mr(o,s,r,c){const{ctx:f}=o;if(r)f.arc(o.xCenter,o.yCenter,s,0,_i);else{let _=o.getPointPosition(0,s);f.moveTo(_.x,_.y);for(let x=1;x<c;x++)_=o.getPointPosition(x,s),f.lineTo(_.x,_.y)}}Pr.id="logarithmic",Pr.defaults={ticks:{callback:X.formatters.logarithmic,major:{enabled:!0}}};class pl extends ic{constructor(s){super(s),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const s=this._padding=je(nh(this.options)/2),r=this.width=this.maxWidth-s.width,c=this.height=this.maxHeight-s.height;this.xCenter=Math.floor(this.left+r/2+s.left),this.yCenter=Math.floor(this.top+c/2+s.top),this.drawingArea=Math.floor(Math.min(r,c)/2)}determineDataLimits(){const{min:s,max:r}=this.getMinMax(!1);this.min=Oe(s)&&!isNaN(s)?s:0,this.max=Oe(r)&&!isNaN(r)?r:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/nh(this.options))}generateTickLabels(s){ic.prototype.generateTickLabels.call(this,s),this._pointLabels=this.getLabels().map((r,c)=>{const f=Ke(this.options.pointLabels.callback,[r,c],this);return f||0===f?f:""}).filter((r,c)=>this.chart.getDataVisibility(c))}fit(){const s=this.options;s.display&&s.pointLabels.display?function(o){const s={l:o.left+o._padding.left,r:o.right-o._padding.right,t:o.top+o._padding.top,b:o.bottom-o._padding.bottom},r=Object.assign({},s),c=[],f=[],_=o._pointLabels.length,x=o.options.pointLabels,M=x.centerPointLabels?Ai/_:0;for(let S=0;S<_;S++){const D=x.setContext(o.getPointLabelContext(S));f[S]=D.padding;const L=o.getPointPosition(S,o.drawingArea+f[S],M),j=Re(D.font),q=Qp(o.ctx,j,o._pointLabels[S]);c[S]=q;const et=le(o.getIndexAngle(S)+M),ut=Math.round(zn(et));ef(r,s,et,gu(ut,L.x,q.w,0,180),gu(ut,L.y,q.h,90,270))}o.setCenterPoint(s.l-r.l,r.r-s.r,s.t-r.t,r.b-s.b),o._pointLabelItems=function(o,s,r){const c=[],f=o._pointLabels.length,_=o.options,x=nh(_)/2,M=o.drawingArea,S=_.pointLabels.centerPointLabels?Ai/f:0;for(let D=0;D<f;D++){const L=o.getPointPosition(D,M+x+r[D],S),j=Math.round(zn(le(L.angle+Ci))),q=s[D],et=xu(L.y,q.h,j),ut=yu(j),mt=Id(L.x,q.w,ut);c.push({x:L.x,y:et,textAlign:ut,left:mt,top:et,right:mt+q.w,bottom:et+q.h})}return c}(o,c,f)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(s,r,c,f){this.xCenter+=Math.floor((s-r)/2),this.yCenter+=Math.floor((c-f)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(s,r,c,f))}getIndexAngle(s){return le(s*(_i/(this._pointLabels.length||1))+Yi(this.options.startAngle||0))}getDistanceFromCenterForValue(s){if(Le(s))return NaN;const r=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-s)*r:(s-this.min)*r}getValueForDistanceFromCenter(s){if(Le(s))return NaN;const r=s/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-r:this.min+r}getPointLabelContext(s){const r=this._pointLabels||[];if(s>=0&&s<r.length){const c=r[s];return function(o,s,r){return qe(o,{label:r,index:s,type:"pointLabel"})}(this.getContext(),s,c)}}getPointPosition(s,r,c=0){const f=this.getIndexAngle(s)-Ci+c;return{x:Math.cos(f)*r+this.xCenter,y:Math.sin(f)*r+this.yCenter,angle:f}}getPointPositionForValue(s,r){return this.getPointPosition(s,this.getDistanceFromCenterForValue(r))}getBasePosition(s){return this.getPointPositionForValue(s||0,this.getBaseValue())}getPointLabelPosition(s){const{left:r,top:c,right:f,bottom:_}=this._pointLabelItems[s];return{left:r,top:c,right:f,bottom:_}}drawBackground(){const{backgroundColor:s,grid:{circular:r}}=this.options;if(s){const c=this.ctx;c.save(),c.beginPath(),mr(this,this.getDistanceFromCenterForValue(this._endValue),r,this._pointLabels.length),c.closePath(),c.fillStyle=s,c.fill(),c.restore()}}drawGrid(){const s=this.ctx,r=this.options,{angleLines:c,grid:f}=r,_=this._pointLabels.length;let x,M,S;if(r.pointLabels.display&&function(o,s){const{ctx:r,options:{pointLabels:c}}=o;for(let f=s-1;f>=0;f--){const _=c.setContext(o.getPointLabelContext(f)),x=Re(_.font),{x:M,y:S,textAlign:D,left:L,top:j,right:q,bottom:et}=o._pointLabelItems[f],{backdropColor:ut}=_;if(!Le(ut)){const mt=je(_.backdropPadding);r.fillStyle=ut,r.fillRect(L-mt.left,j-mt.top,q-L+mt.width,et-j+mt.height)}Nn(r,o._pointLabels[f],M,S+x.lineHeight/2,x,{color:_.color,textAlign:D,textBaseline:"middle"})}}(this,_),f.display&&this.ticks.forEach((D,L)=>{0!==L&&(M=this.getDistanceFromCenterForValue(D.value),function(o,s,r,c){const f=o.ctx,_=s.circular,{color:x,lineWidth:M}=s;!_&&!c||!x||!M||r<0||(f.save(),f.strokeStyle=x,f.lineWidth=M,f.setLineDash(s.borderDash),f.lineDashOffset=s.borderDashOffset,f.beginPath(),mr(o,r,_,c),f.closePath(),f.stroke(),f.restore())}(this,f.setContext(this.getContext(L-1)),M,_))}),c.display){for(s.save(),x=_-1;x>=0;x--){const D=c.setContext(this.getPointLabelContext(x)),{color:L,lineWidth:j}=D;!j||!L||(s.lineWidth=j,s.strokeStyle=L,s.setLineDash(D.borderDash),s.lineDashOffset=D.borderDashOffset,M=this.getDistanceFromCenterForValue(r.ticks.reverse?this.min:this.max),S=this.getPointPosition(x,M),s.beginPath(),s.moveTo(this.xCenter,this.yCenter),s.lineTo(S.x,S.y),s.stroke())}s.restore()}}drawBorder(){}drawLabels(){const s=this.ctx,r=this.options,c=r.ticks;if(!c.display)return;const f=this.getIndexAngle(0);let _,x;s.save(),s.translate(this.xCenter,this.yCenter),s.rotate(f),s.textAlign="center",s.textBaseline="middle",this.ticks.forEach((M,S)=>{if(0===S&&!r.reverse)return;const D=c.setContext(this.getContext(S)),L=Re(D.font);if(_=this.getDistanceFromCenterForValue(this.ticks[S].value),D.showLabelBackdrop){s.font=L.string,x=s.measureText(M.label).width,s.fillStyle=D.backdropColor;const j=je(D.backdropPadding);s.fillRect(-x/2-j.left,-_-L.size/2-j.top,x+j.width,L.size+j.height)}Nn(s,M.label,0,-_,L,{color:D.color})}),s.restore()}drawTitle(){}}pl.id="radialLinear",pl.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:X.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:o=>o,padding:5,centerPointLabels:!1}},pl.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},pl.descriptors={angleLines:{_fallback:"grid"}};const rh={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},_r=Object.keys(rh);function sh(o,s){return o-s}function Pd(o,s){if(Le(s))return null;const r=o._adapter,{parser:c,round:f,isoWeekday:_}=o._parseOpts;let x=s;return"function"==typeof c&&(x=c(x)),Oe(x)||(x="string"==typeof c?r.parse(x,c):r.parse(x)),null===x?null:(f&&(x="week"!==f||!Pn(_)&&!0!==_?r.startOf(x,f):r.startOf(x,"isoWeek",_)),+x)}function nc(o,s,r,c){const f=_r.length;for(let _=_r.indexOf(o);_<f-1;++_){const x=rh[_r[_]],M=x.steps?x.steps:Number.MAX_SAFE_INTEGER;if(x.common&&Math.ceil((r-s)/(M*x.size))<=c)return _r[_]}return _r[f-1]}function fl(o,s,r){if(r){if(r.length){const{lo:c,hi:f}=zs(r,s);o[r[c]>=s?r[c]:r[f]]=!0}}else o[s]=!0}function Rd(o,s,r){const c=[],f={},_=s.length;let x,M;for(x=0;x<_;++x)M=s[x],f[M]=x,c.push({value:M,major:!1});return 0!==_&&r?function(o,s,r,c){const f=o._adapter,_=+f.startOf(s[0].value,c),x=s[s.length-1].value;let M,S;for(M=_;M<=x;M=+f.add(M,1,c))S=r[M],S>=0&&(s[S].major=!0);return s}(o,c,f,r):c}let bu=(()=>{class o extends xe{constructor(r){super(r),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(r,c){const f=r.time||(r.time={}),_=this._adapter=new $h._date(r.adapters.date);Ti(f.displayFormats,_.formats()),this._parseOpts={parser:f.parser,round:f.round,isoWeekday:f.isoWeekday},super.init(r),this._normalized=c.normalized}parse(r,c){return void 0===r?null:Pd(this,r)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const r=this.options,c=this._adapter,f=r.time.unit||"day";let{min:_,max:x,minDefined:M,maxDefined:S}=this.getUserBounds();function D(L){!M&&!isNaN(L.min)&&(_=Math.min(_,L.min)),!S&&!isNaN(L.max)&&(x=Math.max(x,L.max))}(!M||!S)&&(D(this._getLabelBounds()),("ticks"!==r.bounds||"labels"!==r.ticks.source)&&D(this.getMinMax(!1))),_=Oe(_)&&!isNaN(_)?_:+c.startOf(Date.now(),f),x=Oe(x)&&!isNaN(x)?x:+c.endOf(Date.now(),f)+1,this.min=Math.min(_,x-1),this.max=Math.max(_+1,x)}_getLabelBounds(){const r=this.getLabelTimestamps();let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY;return r.length&&(c=r[0],f=r[r.length-1]),{min:c,max:f}}buildTicks(){const r=this.options,c=r.time,f=r.ticks,_="labels"===f.source?this.getLabelTimestamps():this._generate();"ticks"===r.bounds&&_.length&&(this.min=this._userMin||_[0],this.max=this._userMax||_[_.length-1]);const x=this.min,S=function(o,s,r){let c=0,f=o.length;for(;c<f&&o[c]<s;)c++;for(;f>c&&o[f-1]>r;)f--;return c>0||f<o.length?o.slice(c,f):o}(_,x,this.max);return this._unit=c.unit||(f.autoSkip?nc(c.minUnit,this.min,this.max,this._getLabelCapacity(x)):function(o,s,r,c,f){for(let _=_r.length-1;_>=_r.indexOf(r);_--){const x=_r[_];if(rh[x].common&&o._adapter.diff(f,c,x)>=s-1)return x}return _r[r?_r.indexOf(r):0]}(this,S.length,c.minUnit,this.min,this.max)),this._majorUnit=f.major.enabled&&"year"!==this._unit?function(o){for(let s=_r.indexOf(o)+1,r=_r.length;s<r;++s)if(rh[_r[s]].common)return _r[s]}(this._unit):void 0,this.initOffsets(_),r.reverse&&S.reverse(),Rd(this,S,this._majorUnit)}initOffsets(r){let _,x,c=0,f=0;this.options.offset&&r.length&&(_=this.getDecimalForValue(r[0]),c=1===r.length?1-_:(this.getDecimalForValue(r[1])-_)/2,x=this.getDecimalForValue(r[r.length-1]),f=1===r.length?x:(x-this.getDecimalForValue(r[r.length-2]))/2);const M=r.length<3?.5:.25;c=Me(c,0,M),f=Me(f,0,M),this._offsets={start:c,end:f,factor:1/(c+1+f)}}_generate(){const r=this._adapter,c=this.min,f=this.max,_=this.options,x=_.time,M=x.unit||nc(x.minUnit,c,f,this._getLabelCapacity(c)),S=de(x.stepSize,1),D="week"===M&&x.isoWeekday,L=Pn(D)||!0===D,j={};let et,ut,q=c;if(L&&(q=+r.startOf(q,"isoWeek",D)),q=+r.startOf(q,L?"day":M),r.diff(f,c,M)>1e5*S)throw new Error(c+" and "+f+" are too far apart with stepSize of "+S+" "+M);const mt="data"===_.ticks.source&&this.getDataTimestamps();for(et=q,ut=0;et<f;et=+r.add(et,S,M),ut++)fl(j,et,mt);return(et===f||"ticks"===_.bounds||1===ut)&&fl(j,et,mt),Object.keys(j).sort((wt,Et)=>wt-Et).map(wt=>+wt)}getLabelForValue(r){const f=this.options.time;return this._adapter.format(r,f.tooltipFormat?f.tooltipFormat:f.displayFormats.datetime)}_tickFormatFunction(r,c,f,_){const x=this.options,M=x.time.displayFormats,S=this._unit,D=this._majorUnit,j=D&&M[D],q=f[c],ut=this._adapter.format(r,_||(D&&j&&q&&q.major?j:S&&M[S])),mt=x.ticks.callback;return mt?Ke(mt,[ut,c,f],this):ut}generateTickLabels(r){let c,f,_;for(c=0,f=r.length;c<f;++c)_=r[c],_.label=this._tickFormatFunction(_.value,c,r)}getDecimalForValue(r){return null===r?NaN:(r-this.min)/(this.max-this.min)}getPixelForValue(r){const c=this._offsets,f=this.getDecimalForValue(r);return this.getPixelForDecimal((c.start+f)*c.factor)}getValueForPixel(r){const c=this._offsets,f=this.getDecimalForPixel(r)/c.factor-c.end;return this.min+f*(this.max-this.min)}_getLabelSize(r){const c=this.options.ticks,f=this.ctx.measureText(r).width,_=Yi(this.isHorizontal()?c.maxRotation:c.minRotation),x=Math.cos(_),M=Math.sin(_),S=this._resolveTickFontOptions(0).size;return{w:f*x+S*M,h:f*M+S*x}}_getLabelCapacity(r){const c=this.options.time,f=c.displayFormats,_=f[c.unit]||f.millisecond,x=this._tickFormatFunction(r,0,Rd(this,[r],this._majorUnit),_),M=this._getLabelSize(x),S=Math.floor(this.isHorizontal()?this.width/M.w:this.height/M.h)-1;return S>0?S:1}getDataTimestamps(){let c,f,r=this._cache.data||[];if(r.length)return r;const _=this.getMatchingVisibleMetas();if(this._normalized&&_.length)return this._cache.data=_[0].controller.getAllParsedValues(this);for(c=0,f=_.length;c<f;++c)r=r.concat(_[c].controller.getAllParsedValues(this));return this._cache.data=this.normalize(r)}getLabelTimestamps(){const r=this._cache.labels||[];let c,f;if(r.length)return r;const _=this.getLabels();for(c=0,f=_.length;c<f;++c)r.push(Pd(this,_[c]));return this._cache.labels=this._normalized?r:this.normalize(r)}normalize(r){return Ra(r.sort(sh))}}return o.id="time",o.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}},o})();function ah(o,s,r){let _,x,M,S,c=0,f=o.length-1;r?(s>=o[c].pos&&s<=o[f].pos&&({lo:c,hi:f}=An(o,"pos",s)),({pos:_,time:M}=o[c]),({pos:x,time:S}=o[f])):(s>=o[c].time&&s<=o[f].time&&({lo:c,hi:f}=An(o,"time",s)),({time:_,pos:M}=o[c]),({time:x,pos:S}=o[f]));const D=x-_;return D?M+(S-M)*(s-_)/D:M}class oh extends bu{constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const s=this._getTimestampsForTable(),r=this._table=this.buildLookupTable(s);this._minPos=ah(r,this.min),this._tableRange=ah(r,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){const{min:r,max:c}=this,f=[],_=[];let x,M,S,D,L;for(x=0,M=s.length;x<M;++x)D=s[x],D>=r&&D<=c&&f.push(D);if(f.length<2)return[{time:r,pos:0},{time:c,pos:1}];for(x=0,M=f.length;x<M;++x)L=f[x+1],S=f[x-1],D=f[x],Math.round((L+S)/2)!==D&&_.push({time:D,pos:x/(M-1)});return _}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;const r=this.getDataTimestamps(),c=this.getLabelTimestamps();return s=r.length&&c.length?this.normalize(r.concat(c)):r.length?r:c,s=this._cache.all=s,s}getDecimalForValue(s){return(ah(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){const r=this._offsets,c=this.getDecimalForPixel(s)/r.factor-r.end;return ah(this._table,c*this._tableRange+this._minPos,!0)}}oh.id="timeseries",oh.defaults=bu.defaults;var wu=me(5488);const Wi=function(o,s){return o===s||o!=o&&s!=s},rc=function(o,s){for(var r=o.length;r--;)if(Wi(o[r][0],s))return r;return-1};var hh=Array.prototype.splice;function Ts(o){var s=-1,r=null==o?0:o.length;for(this.clear();++s<r;){var c=o[s];this.set(c[0],c[1])}}Ts.prototype.clear=function(){this.__data__=[],this.size=0},Ts.prototype.delete=function(o){var s=this.__data__,r=rc(s,o);return!(r<0||(r==s.length-1?s.pop():hh.call(s,r,1),--this.size,0))},Ts.prototype.get=function(o){var s=this.__data__,r=rc(s,o);return r<0?void 0:s[r][1]},Ts.prototype.has=function(o){return rc(this.__data__,o)>-1},Ts.prototype.set=function(o,s){var r=this.__data__,c=rc(r,o);return c<0?(++this.size,r.push([o,s])):r[c][1]=s,this};const uh=Ts,Bd="object"==typeof global&&global&&global.Object===Object&&global;var Vd="object"==typeof self&&self&&self.Object===Object&&self;const gl=Bd||Vd||Function("return this")();var ff=gl.Symbol,Eu=Object.prototype,mf=Eu.hasOwnProperty,_f=Eu.toString,is=ff?ff.toStringTag:void 0;var Ud=Object.prototype.toString;var Du=ff?ff.toStringTag:void 0;const ph=function(o){return null==o?void 0===o?"[object Undefined]":"[object Null]":Du&&Du in Object(o)?function(o){var s=mf.call(o,is),r=o[is];try{o[is]=void 0;var c=!0}catch(_){}var f=_f.call(o);return c&&(s?o[is]=r:delete o[is]),f}(o):function(o){return Ud.call(o)}(o)},vo=function(o){var s=typeof o;return null!=o&&("object"==s||"function"==s)},Iu=function(o){if(!vo(o))return!1;var s=ph(o);return"[object Function]"==s||"[object GeneratorFunction]"==s||"[object AsyncFunction]"==s||"[object Proxy]"==s};var o,jd=gl["__core-js_shared__"],Pu=(o=/[^.]+$/.exec(jd&&jd.keys&&jd.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"";var kf=Function.prototype.toString;var Cs=/^\[object .+?Constructor\]$/,Pf=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const zf=function(o){return!(!vo(o)||function(o){return!!Pu&&Pu in o}(o))&&(Iu(o)?Pf:Cs).test(function(o){if(null!=o){try{return kf.call(o)}catch(s){}try{return o+""}catch(s){}}return""}(o))},bo=function(o,s){var r=function(o,s){return null==o?void 0:o[s]}(o,s);return zf(r)?r:void 0},gh=bo(gl,"Map"),xl=bo(Object,"create");var Bf=Object.prototype.hasOwnProperty;var jf=Object.prototype.hasOwnProperty;function wl(o){var s=-1,r=null==o?0:o.length;for(this.clear();++s<r;){var c=o[s];this.set(c[0],c[1])}}wl.prototype.clear=function(){this.__data__=xl?xl(null):{},this.size=0},wl.prototype.delete=function(o){var s=this.has(o)&&delete this.__data__[o];return this.size-=s?1:0,s},wl.prototype.get=function(o){var s=this.__data__;if(xl){var r=s[o];return"__lodash_hash_undefined__"===r?void 0:r}return Bf.call(s,o)?s[o]:void 0},wl.prototype.has=function(o){var s=this.__data__;return xl?void 0!==s[o]:jf.call(s,o)},wl.prototype.set=function(o,s){var r=this.__data__;return this.size+=this.has(o)?0:1,r[o]=xl&&void 0===s?"__lodash_hash_undefined__":s,this};const Yd=wl,ea=function(o,s){var r=o.__data__;return function(o){var s=typeof o;return"string"==s||"number"==s||"symbol"==s||"boolean"==s?"__proto__"!==o:null===o}(s)?r["string"==typeof s?"string":"hash"]:r.map};function Ca(o){var s=-1,r=null==o?0:o.length;for(this.clear();++s<r;){var c=o[s];this.set(c[0],c[1])}}Ca.prototype.clear=function(){this.size=0,this.__data__={hash:new Yd,map:new(gh||uh),string:new Yd}},Ca.prototype.delete=function(o){var s=ea(this,o).delete(o);return this.size-=s?1:0,s},Ca.prototype.get=function(o){return ea(this,o).get(o)},Ca.prototype.has=function(o){return ea(this,o).has(o)},Ca.prototype.set=function(o,s){var r=ea(this,o),c=r.size;return r.set(o,s),this.size+=r.size==c?0:1,this};const Fu=Ca;function gr(o){var s=this.__data__=new uh(o);this.size=s.size}gr.prototype.clear=function(){this.__data__=new uh,this.size=0},gr.prototype.delete=function(o){var s=this.__data__,r=s.delete(o);return this.size=s.size,r},gr.prototype.get=function(o){return this.__data__.get(o)},gr.prototype.has=function(o){return this.__data__.has(o)},gr.prototype.set=function(o,s){var r=this.__data__;if(r instanceof uh){var c=r.__data__;if(!gh||c.length<199)return c.push([o,s]),this.size=++r.size,this;r=this.__data__=new Fu(c)}return r.set(o,s),this.size=r.size,this};const np=gr;var rp=function(){try{var o=bo(Object,"defineProperty");return o({},"",{}),o}catch(s){}}();const dc=rp,Bu=function(o,s,r){"__proto__"==s&&dc?dc(o,s,{configurable:!0,enumerable:!0,value:r,writable:!0}):o[s]=r},vh=function(o,s,r){(void 0!==r&&!Wi(o[s],r)||void 0===r&&!(s in o))&&Bu(o,s,r)};const lp=function(s,r,c){for(var f=-1,_=Object(s),x=c(s),M=x.length;M--;){var S=x[++f];if(!1===r(_[S],S,_))break}return s};var wh="object"==typeof exports&&exports&&!exports.nodeType&&exports,wo=wh&&"object"==typeof module&&module&&!module.nodeType&&module,pc=wo&&wo.exports===wh?gl.Buffer:void 0,Vu=pc?pc.allocUnsafe:void 0;const hp=gl.Uint8Array,Ml=function(o,s){var r=s?function(o){var s=new o.constructor(o.byteLength);return new hp(s).set(new hp(o)),s}(o.buffer):o.buffer;return new o.constructor(r,o.byteOffset,o.length)};var Nu=Object.create,tm=function(){function o(){}return function(s){if(!vo(s))return{};if(Nu)return Nu(s);o.prototype=s;var r=new o;return o.prototype=void 0,r}}();const ju=tm;var up=function(o,s){return function(r){return o(s(r))}}(Object.getPrototypeOf,Object);const Gu=up;var Ch=Object.prototype;const dp=function(o){var s=o&&o.constructor;return o===("function"==typeof s&&s.prototype||Ch)},To=function(o){return null!=o&&"object"==typeof o},Ah=function(o){return To(o)&&"[object Arguments]"==ph(o)};var ia=Object.prototype,sm=ia.hasOwnProperty,Hu=ia.propertyIsEnumerable,pp=Ah(function(){return arguments}())?Ah:function(o){return To(o)&&sm.call(o,"callee")&&!Hu.call(o,"callee")};const Tl=pp,qu=Array.isArray,Eh=function(o){return"number"==typeof o&&o>-1&&o%1==0&&o<=9007199254740991},kh=function(o){return null!=o&&Eh(o.length)&&!Iu(o)};var fc="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ih=fc&&"object"==typeof module&&module&&!module.nodeType&&module,gp=Ih&&Ih.exports===fc?gl.Buffer:void 0;const Wu=(gp?gp.isBuffer:void 0)||function(){return!1};var Cl=Function.prototype.toString,Sl=Object.prototype.hasOwnProperty,Xu=Cl.call(Object);var Xi={};Xi["[object Float32Array]"]=Xi["[object Float64Array]"]=Xi["[object Int8Array]"]=Xi["[object Int16Array]"]=Xi["[object Int32Array]"]=Xi["[object Uint8Array]"]=Xi["[object Uint8ClampedArray]"]=Xi["[object Uint16Array]"]=Xi["[object Uint32Array]"]=!0,Xi["[object Arguments]"]=Xi["[object Array]"]=Xi["[object ArrayBuffer]"]=Xi["[object Boolean]"]=Xi["[object DataView]"]=Xi["[object Date]"]=Xi["[object Error]"]=Xi["[object Function]"]=Xi["[object Map]"]=Xi["[object Number]"]=Xi["[object Object]"]=Xi["[object RegExp]"]=Xi["[object Set]"]=Xi["[object String]"]=Xi["[object WeakMap]"]=!1;var na="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ea=na&&"object"==typeof module&&module&&!module.nodeType&&module,mc=Ea&&Ea.exports===na&&Bd.process,Rp=function(){try{return Ea&&Ea.require&&Ea.require("util").types||mc&&mc.binding&&mc.binding("util")}catch(s){}}(),Lp=Rp&&Rp.isTypedArray;const td=Lp?function(o){return function(s){return o(s)}}(Lp):function(o){return To(o)&&Eh(o.length)&&!!Xi[ph(o)]},_c=function(o,s){if(("constructor"!==s||"function"!=typeof o[s])&&"__proto__"!=s)return o[s]};var xr=Object.prototype.hasOwnProperty;const Oh=function(o,s,r){var c=o[s];(!xr.call(o,s)||!Wi(c,r)||void 0===r&&!(s in o))&&Bu(o,s,r)};var Vp=/^(?:0|[1-9]\d*)$/;const Ao=function(o,s){var r=typeof o;return!!(s=null==s?9007199254740991:s)&&("number"==r||"symbol"!=r&&Vp.test(o))&&o>-1&&o%1==0&&o<s};var gm=Object.prototype.hasOwnProperty;const Np=function(o,s){var r=qu(o),c=!r&&Tl(o),f=!r&&!c&&Wu(o),_=!r&&!c&&!f&&td(o),x=r||c||f||_,M=x?function(o,s){for(var r=-1,c=Array(o);++r<o;)c[r]=s(r);return c}(o.length,String):[],S=M.length;for(var D in o)(s||gm.call(o,D))&&(!x||!("length"==D||f&&("offset"==D||"parent"==D)||_&&("buffer"==D||"byteLength"==D||"byteOffset"==D)||Ao(D,S)))&&M.push(D);return M};var xm=Object.prototype.hasOwnProperty;const yc=function(o){if(!vo(o))return function(o){var s=[];if(null!=o)for(var r in Object(o))s.push(r);return s}(o);var s=dp(o),r=[];for(var c in o)"constructor"==c&&(s||!xm.call(o,c))||r.push(c);return r},Al=function(o){return kh(o)?Np(o,!0):yc(o)},vm=function(o){return function(o,s,r,c){var f=!r;r||(r={});for(var _=-1,x=s.length;++_<x;){var M=s[_],S=c?c(r[M],o[M],M,r,o):void 0;void 0===S&&(S=o[M]),f?Bu(r,M,S):Oh(r,M,S)}return r}(o,Al(o))},El=function(o,s,r,c,f,_,x){var M=_c(o,r),S=_c(s,r),D=x.get(S);if(D)vh(o,r,D);else{var L=_?_(M,S,r+"",o,s,x):void 0,j=void 0===L;if(j){var q=qu(S),et=!q&&Wu(S),ut=!q&&!et&&td(S);L=S,q||et||ut?qu(M)?L=M:function(o){return To(o)&&kh(o)}(M)?L=function(o,s){var r=-1,c=o.length;for(s||(s=Array(c));++r<c;)s[r]=o[r];return s}(M):et?(j=!1,L=function(o,s){if(s)return o.slice();var r=o.length,c=Vu?Vu(r):new o.constructor(r);return o.copy(c),c}(S,!0)):ut?(j=!1,L=Ml(S,!0)):L=[]:function(o){if(!To(o)||"[object Object]"!=ph(o))return!1;var s=Gu(o);if(null===s)return!0;var r=Sl.call(s,"constructor")&&s.constructor;return"function"==typeof r&&r instanceof r&&Cl.call(r)==Xu}(S)||Tl(S)?(L=M,Tl(M)?L=vm(M):(!vo(M)||Iu(M))&&(L=function(o){return"function"!=typeof o.constructor||dp(o)?{}:ju(Gu(o))}(S))):j=!1}j&&(x.set(S,L),f(L,S,c,_,x),x.delete(S)),vh(o,r,L)}},wm=function vc(o,s,r,c,f){o!==s&&lp(s,function(_,x){if(f||(f=new np),vo(_))El(o,s,x,r,vc,c,f);else{var M=c?c(_c(o,x),_,x+"",o,s,f):void 0;void 0===M&&(M=_),vh(o,x,M)}},Al)},rd=function(o){return o},Gp=function(o,s,r){switch(r.length){case 0:return o.call(s);case 1:return o.call(s,r[0]);case 2:return o.call(s,r[0],r[1]);case 3:return o.call(s,r[0],r[1],r[2])}return o.apply(s,r)};var sd=Math.max;const a=function(o){return function(){return o}};var h=dc?function(o,s){return dc(o,"toString",{configurable:!0,enumerable:!1,value:a(s),writable:!0})}:rd,w=Date.now,I=function(o){var s=0,r=0;return function(){var c=w(),f=16-(c-r);if(r=c,f>0){if(++s>=800)return arguments[0]}else s=0;return o.apply(void 0,arguments)}}(h);const P=I,G=function(o,s){return P(function(o,s,r){return s=sd(void 0===s?o.length-1:s,0),function(){for(var c=arguments,f=-1,_=sd(c.length-s,0),x=Array(_);++f<_;)x[f]=c[s+f];f=-1;for(var M=Array(s+1);++f<s;)M[f]=c[f];return M[s]=r(x),Gp(o,this,M)}}(o,s,rd),o+"")};var yt=function(o){return G(function(s,r){var c=-1,f=r.length,_=f>1?r[f-1]:void 0,x=f>2?r[2]:void 0;for(_=o.length>3&&"function"==typeof _?(f--,_):void 0,x&&function(o,s,r){if(!vo(r))return!1;var c=typeof s;return!!("number"==c?kh(r)&&Ao(s,r.length):"string"==c&&s in r)&&Wi(r[s],o)}(r[0],r[1],x)&&(_=f<3?void 0:_,f=1),s=Object(s);++c<f;){var M=r[c];M&&o(s,M,c)}return s})}(function(o,s,r){wm(o,s,r)});const vt=yt;var bt=me(4499);let Mt=(()=>{class o{constructor(){this.colorschemesOptions=new bt.X(void 0)}setColorschemesOptions(r){this.pColorschemesOptions=r,this.colorschemesOptions.next(r)}getColorschemesOptions(){return this.pColorschemesOptions}}return o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=Ue.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),Vt=(()=>{class o{constructor(r,c,f){this.element=r,this.zone=c,this.themeService=f,this.type="bar",this.plugins=[],this.chartClick=new Ue.vpe,this.chartHover=new Ue.vpe,this.subs=[],this.ctx=r.nativeElement.getContext("2d"),this.subs.push(this.themeService.colorschemesOptions.pipe((0,wu.x)()).subscribe(_=>this.themeChanged(_)))}ngOnChanges(r){const c=["type"],f=Object.getOwnPropertyNames(r);if(f.some(_=>c.includes(_))||f.every(_=>r[_].isFirstChange()))this.render();else{const _=this.getChartConfiguration();this.chart&&(Object.assign(this.chart.config.data,_.data),Object.assign(this.chart.config.plugins,_.plugins),Object.assign(this.chart.config.options,_.options)),this.update()}}ngOnDestroy(){this.chart&&(this.chart.destroy(),this.chart=void 0),this.subs.forEach(r=>r.unsubscribe())}render(){return this.chart&&this.chart.destroy(),this.zone.runOutsideAngular(()=>this.chart=new bs(this.ctx,this.getChartConfiguration()))}update(r){this.chart&&this.zone.runOutsideAngular(()=>{var c;return null==(c=this.chart)?void 0:c.update(r)})}hideDataset(r,c){this.chart&&(this.chart.getDatasetMeta(r).hidden=c,this.update())}isDatasetHidden(r){var c,f;return null==(f=null==(c=this.chart)?void 0:c.getDatasetMeta(r))?void 0:f.hidden}toBase64Image(){var r;return null==(r=this.chart)?void 0:r.toBase64Image()}themeChanged(r){this.themeOverrides=r,this.chart&&(Object.assign(this.chart.config.options,this.getChartOptions()),this.update())}getChartOptions(){return vt({onHover:(r,c)=>{this.chartHover.observed&&c&&!c.length||this.zone.run(()=>this.chartHover.emit({event:r,active:c}))},onClick:(r,c)=>{!this.chartClick.observed||this.zone.run(()=>this.chartClick.emit({event:r,active:c}))}},this.themeOverrides,this.options,{plugins:{legend:{display:this.legend}}})}getChartConfiguration(){return{type:this.type,data:this.getChartData(),plugins:this.plugins,options:this.getChartOptions()}}getChartData(){return this.data?this.data:{labels:this.labels||[],datasets:this.datasets||[]}}}return o.\u0275fac=function(r){return new(r||o)(Ue.Y36(Ue.SBq),Ue.Y36(Ue.R0b),Ue.Y36(Mt))},o.\u0275dir=Ue.lG2({type:o,selectors:[["canvas","baseChart",""]],inputs:{type:"type",legend:"legend",data:"data",options:"options",plugins:"plugins",labels:"labels",datasets:"datasets"},outputs:{chartClick:"chartClick",chartHover:"chartHover"},exportAs:["base-chart"],features:[Ue.TTD]}),o})();const Ot=[[255,99,132],[54,162,235],[255,206,86],[231,233,237],[75,192,192],[151,187,205],[220,220,220],[247,70,74],[70,191,189],[253,180,92],[148,159,177],[77,83,96]],ne={datasets:{line:{backgroundColor:o=>Ht(Jt(o.datasetIndex),.4),borderColor:o=>Ht(Jt(o.datasetIndex),1),pointBackgroundColor:o=>Ht(Jt(o.datasetIndex),1),pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:o=>Ht(Jt(o.datasetIndex),.8)},bar:{backgroundColor:o=>Ht(Jt(o.datasetIndex),.6),borderColor:o=>Ht(Jt(o.datasetIndex),1),hoverBackgroundColor:o=>Ht(Jt(o.datasetIndex),.8),hoverBorderColor:o=>Ht(Jt(o.datasetIndex),1)},get radar(){return this.line},doughnut:{backgroundColor:o=>Ht(Jt(o.dataIndex),.6),borderColor:"#fff",hoverBackgroundColor:o=>Ht(Jt(o.dataIndex),1),hoverBorderColor:o=>Ht(Jt(o.dataIndex),1)},get pie(){return this.doughnut},polarArea:{backgroundColor:o=>Ht(Jt(o.dataIndex),.6),borderColor:o=>Ht(Jt(o.dataIndex),1),hoverBackgroundColor:o=>Ht(Jt(o.dataIndex),.8),hoverBorderColor:o=>Ht(Jt(o.dataIndex),1)},get bubble(){return this.doughnut},get scatter(){return this.doughnut},get area(){return this.polarArea}}};function Ht(o,s){return"rgba("+o.concat(s).join(",")+")"}function Ft(o,s){return Math.floor(Math.random()*(s-o+1))+o}function Jt(o=0){return Ot[o]||[Ft(0,255),Ft(0,255),Ft(0,255)]}bs.register(Ir,fu,lu,yo,Ko,hl,nu,ih,Ms,Fs,Hs,eo,_o,no,pl,io,Qo,to,ro,oh);let $t=(()=>{class o{}return o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=Ue.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),pe=(()=>{class o{constructor(r){(null==r?void 0:r.plugins)&&bs.register(...null==r?void 0:r.plugins);const c=vt(ne,(null==r?void 0:r.defaults)||{});ri.set(c)}static forRoot(r){return{ngModule:o,providers:[{provide:$t,useValue:r}]}}}return o.\u0275fac=function(r){return new(r||o)(Ue.LFG($t,8))},o.\u0275mod=Ue.oAB({type:o}),o.\u0275inj=Ue.cJS({imports:[[]]}),o})()}}]);